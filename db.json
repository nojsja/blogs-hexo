{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-11.png","path":"img/article/Ubuntu18.04-11.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-13.png","path":"img/article/Ubuntu18.04-13.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-2.png","path":"img/article/Ubuntu18.04-2.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-3.png","path":"img/article/Ubuntu18.04-3.png","modified":0,"renderable":0},{"_id":"source/img/article/snapshot.png","path":"img/article/snapshot.png","modified":0,"renderable":0},{"_id":"source/img/article/snapshot_select.png","path":"img/article/snapshot_select.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-1.png","path":"img/article/tree-1.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-2.png","path":"img/article/tree-2.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-3.png","path":"img/article/tree-3.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-5.png","path":"img/article/tree-5.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-6.png","path":"img/article/tree-6.png","modified":0,"renderable":0},{"_id":"source/img/article/upload.png","path":"img/article/upload.png","modified":0,"renderable":0},{"_id":"source/img/article/waterfall-2.jpg","path":"img/article/waterfall-2.jpg","modified":0,"renderable":0},{"_id":"source/img/avatar/nojsja.jpeg","path":"img/avatar/nojsja.jpeg","modified":0,"renderable":0},{"_id":"themes/huweihuang/source/css/archive.styl","path":"css/archive.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/beantech.css","path":"css/beantech.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/beantech.min.css","path":"css/beantech.min.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/donate.css","path":"css/donate.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/highlight.styl","path":"css/highlight.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/hux-blog.min.css","path":"css/hux-blog.min.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/rocket.styl","path":"css/rocket.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/signature.styl","path":"css/signature.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/toc.styl","path":"css/toc.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/widget.styl","path":"css/widget.styl","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.eot","path":"fonts/glyphicons-halflings-regular.eot","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.ttf","path":"fonts/glyphicons-halflings-regular.ttf","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.woff","path":"fonts/glyphicons-halflings-regular.woff","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.woff2","path":"fonts/glyphicons-halflings-regular.woff2","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/hux-blog.js","path":"js/hux-blog.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/hux-blog.min.js","path":"js/hux-blog.min.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/jquery.nav.js","path":"js/jquery.nav.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/jquery.tagcloud.js","path":"js/jquery.tagcloud.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/toc.js","path":"js/toc.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"source/img/article/Fly.jpg","path":"img/article/Fly.jpg","modified":0,"renderable":0},{"_id":"source/img/article/lifeIsStrange.jpg","path":"img/article/lifeIsStrange.jpg","modified":0,"renderable":0},{"_id":"source/img/article/mobx9.png","path":"img/article/mobx9.png","modified":0,"renderable":0},{"_id":"source/img/article/shards_upload.jpg","path":"img/article/shards_upload.jpg","modified":0,"renderable":0},{"_id":"source/img/article/tree-4.png","path":"img/article/tree-4.png","modified":0,"renderable":0},{"_id":"source/img/article/waterfall-3.jpg","path":"img/article/waterfall-3.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/about.jpg","path":"img/header_img/about.jpg","modified":0,"renderable":0},{"_id":"themes/huweihuang/source/css/bootstrap.min.css","path":"css/bootstrap.min.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.svg","path":"fonts/glyphicons-halflings-regular.svg","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/bootstrap.js","path":"js/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"source/img/article/Ubuntu18.04-1.jpg","path":"img/article/Ubuntu18.04-1.jpg","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-9.png","path":"img/article/Ubuntu18.04-9.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx1.png","path":"img/article/mobx1.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx2.png","path":"img/article/mobx2.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx3.png","path":"img/article/mobx3.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx4.png","path":"img/article/mobx4.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx5.png","path":"img/article/mobx5.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx6.png","path":"img/article/mobx6.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx8.png","path":"img/article/mobx8.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-bug1.gif","path":"img/article/tree-bug1.gif","modified":0,"renderable":0},{"_id":"source/img/header_img/archive.jpg","path":"img/header_img/archive.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/archives-widget.jpg","path":"img/header_img/archives-widget.jpg","modified":0,"renderable":0},{"_id":"source/img/signature/BeanTechSign-white.png","path":"img/signature/BeanTechSign-white.png","modified":0,"renderable":0},{"_id":"themes/huweihuang/source/css/bootstrap.css","path":"css/bootstrap.css","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/images/ironman.png","path":"css/images/ironman.png","modified":0,"renderable":1},{"_id":"themes/huweihuang/source/css/images/rocket.png","path":"css/images/rocket.png","modified":0,"renderable":1},{"_id":"source/img/article/Ubuntu18.04-10.png","path":"img/article/Ubuntu18.04-10.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-12.png","path":"img/article/Ubuntu18.04-12.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx10.png","path":"img/article/mobx10.png","modified":0,"renderable":0},{"_id":"source/img/article/mobx7.png","path":"img/article/mobx7.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-bug-fix.gif","path":"img/article/tree-bug-fix.gif","modified":0,"renderable":0},{"_id":"source/img/signature/BeanTechSign-black.png","path":"img/signature/BeanTechSign-black.png","modified":0,"renderable":0},{"_id":"themes/huweihuang/source/js/jquery.js","path":"js/jquery.js","modified":0,"renderable":1},{"_id":"source/img/article/Ubuntu18.04-14.png","path":"img/article/Ubuntu18.04-14.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-5.png","path":"img/article/Ubuntu18.04-5.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-7.png","path":"img/article/Ubuntu18.04-7.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-8.png","path":"img/article/Ubuntu18.04-8.png","modified":0,"renderable":0},{"_id":"source/img/avatar/ironman.png","path":"img/avatar/ironman.png","modified":0,"renderable":0},{"_id":"source/img/article/Ubuntu18.04-6.png","path":"img/article/Ubuntu18.04-6.png","modified":0,"renderable":0},{"_id":"source/img/article/tree-bug2.gif","path":"img/article/tree-bug2.gif","modified":0,"renderable":0},{"_id":"source/img/header_img/home.jpg","path":"img/header_img/home.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/tag.png","path":"img/header_img/tag.png","modified":0,"renderable":0},{"_id":"source/img/article_header/article_bg.jpg","path":"img/article_header/article_bg.jpg","modified":0,"renderable":0},{"_id":"source/img/article/Desktop2.png","path":"img/article/Desktop2.png","modified":0,"renderable":0},{"_id":"source/img/article/Desktop3.png","path":"img/article/Desktop3.png","modified":0,"renderable":0},{"_id":"source/img/header_img/home3.jpg","path":"img/header_img/home3.jpg","modified":0,"renderable":0},{"_id":"source/img/article_header/article_header.png","path":"img/article_header/article_header.png","modified":0,"renderable":0},{"_id":"source/img/article/Desktop.png","path":"img/article/Desktop.png","modified":0,"renderable":0},{"_id":"source/img/header_img/404.png","path":"img/header_img/404.png","modified":0,"renderable":0},{"_id":"source/img/header_img/home-bg-o.png","path":"img/header_img/home-bg-o.png","modified":0,"renderable":0},{"_id":"source/img/header_img/home2.png","path":"img/header_img/home2.png","modified":0,"renderable":0},{"_id":"source/img/article/animation.gif","path":"img/article/animation.gif","modified":0,"renderable":0},{"_id":"source/img/article/city.jpg","path":"img/article/city.jpg","modified":0,"renderable":0},{"_id":"source/img/article/waterfall-1.gif","path":"img/article/waterfall-1.gif","modified":0,"renderable":0}],"Cache":[{"_id":"source/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1583849290172},{"_id":"source/404.md","hash":"1adbd167ac3762bb2b73b762351582e75f589dac","modified":1583852676875},{"_id":"themes/huweihuang/LICENSE","hash":"2b209f06bebeb2a8c2b7e187e436f3e1e1fbc8a7","modified":1583838440464},{"_id":"themes/huweihuang/_config.yml","hash":"e800e32847df32dacddb5202823a004557023bcd","modified":1583838440464},{"_id":"source/_posts/Docker运行容器化的Tim和wechat.md","hash":"aa478d48b38c13eb720fa163c47aa45e0d1b7758","modified":1583858998666},{"_id":"source/_posts/Electron+Mobx+React开发记录(一).md","hash":"262b75997438d33ef90dcfc3526e588b37314bb1","modified":1584872920579},{"_id":"source/_posts/Electron+Mobx+React开发记录(二).md","hash":"a8e27923f8cbd0d506ec38a3d1e16341d591abe5","modified":1583978685298},{"_id":"source/_posts/Ubuntu18.04踩坑记录.md","hash":"a2c83700f5ee5aa1aaf9927576160cb1fa8e38de","modified":1584791745060},{"_id":"source/_posts/echarts图表-树形图开发记录.md","hash":"620e520b8979378fb906d15659ff406a188832d5","modified":1584950313400},{"_id":"source/_posts/linux-mint-configure.md","hash":"762082ed86b0a78b096ee3c8324c85ae61ff4a21","modified":1583859087253},{"_id":"source/_posts/proxychains终端代理.md","hash":"f31cd18d56531025aeae122443b218bedb3ab318","modified":1583979789187},{"_id":"source/_posts/sass开发规范.md","hash":"b0dc859ea643cc3a0632c4bf2a6f9e0dcfb43837","modified":1583859131943},{"_id":"source/_posts/shadowsocks_polipo.md","hash":"84544d12880ee1cdde65ac9150c17344790931fb","modified":1583979773471},{"_id":"source/_posts/water-fall-layout.md","hash":"317ee7febd51bff47444f2a435b6eb4aa24242f4","modified":1583859177560},{"_id":"source/_posts/使用ES5实现ES6中的Promise.md","hash":"9491923e8f036dd70a1afd43f2d755089bbeaec3","modified":1583978573019},{"_id":"source/_posts/基于s3对象存储多文件分片上传的Javascript实现.md","hash":"0ae47d714f7ab873517abcfb25ce15182cee2317","modified":1583859509819},{"_id":"source/_posts/用Javascript实现一个可自定义样式的tootips组件.md","hash":"cb7bb4a76e475fc89530bf750c0feb3546847299","modified":1583858980630},{"_id":"source/_posts/简单实现一个Javascript动画处理类.md","hash":"f8f4234a28188ebb65fa9d9a5a0468615c06a4d4","modified":1583858891030},{"_id":"source/_posts/联想y7000安装ubuntu18.04显卡驱动解决方案.md","hash":"ff55de6637979347c4b53ecf0491c63c11cb47ca","modified":1583859210973},{"_id":"source/about/index.md","hash":"b7c8e62902b7ed2b59b6ecfa3ff7808d353c3d6c","modified":1583978323791},{"_id":"source/archive/index.md","hash":"e928cec32f6da92dbc8bba2192540693372bd121","modified":1583852664152},{"_id":"source/tags/index.md","hash":"e26c8d4bc59da0f3b52d25921164bed12ca96a37","modified":1583852672679},{"_id":"themes/huweihuang/languages_to_be_added/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/default.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/en.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1583838440464},{"_id":"themes/huweihuang/languages_to_be_added/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1583838440464},{"_id":"themes/huweihuang/layout/404.ejs","hash":"40de38bd399f6f4aef0d6c63c7b13b02d74f1c56","modified":1583838440464},{"_id":"themes/huweihuang/layout/about.ejs","hash":"edcf8fa3bf7093c974d418ffef42ac89c19af128","modified":1583838440464},{"_id":"themes/huweihuang/layout/archive.ejs","hash":"c15726ab348cbf75291b88ffe5e5e50335b5cb0b","modified":1583838440464},{"_id":"themes/huweihuang/layout/index.ejs","hash":"9e682d5d19cce88ffcae6bbcd0d644df64a6d735","modified":1583838440464},{"_id":"themes/huweihuang/layout/keynote.ejs","hash":"f5689862281e34dbe8402b0e72f632902e53e88b","modified":1583838440464},{"_id":"themes/huweihuang/layout/layout.ejs","hash":"a5af5b99ac3456ab5da1a319455904b979b91601","modified":1583838440468},{"_id":"themes/huweihuang/layout/page.ejs","hash":"5e588f200a7b7cd3ae40402b0dd3b779aac6787f","modified":1583838440468},{"_id":"themes/huweihuang/layout/post.ejs","hash":"b1bbb84a228084bde7fe44d685e17292e8a03931","modified":1584091300545},{"_id":"themes/huweihuang/layout/tags.ejs","hash":"2c72eb2e89130658aa068d80d27b561b509c5dcd","modified":1583838440468},{"_id":"source/img/article/Ubuntu18.04-11.png","hash":"8ae8ed9c52709ffdde63ef92ed26578e87e05cce","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-13.png","hash":"2f929624df2751c01731ed1ba21cda2ffb7d7092","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-2.png","hash":"63ab9b51046225b0846b88664d90cacc1db4aab3","modified":1583863440000},{"_id":"source/img/article/Ubuntu18.04-3.png","hash":"f331b6722e7cf2035e00f1dd307c58a2379b0c7f","modified":1583863440000},{"_id":"source/img/article/snapshot.png","hash":"3a129083f67b48903e4ae97b03f4f4512bff7d38","modified":1584933891093},{"_id":"source/img/article/snapshot_select.png","hash":"824dd884cf2adb5e242e4f9ea0fa6e01f8f2bb90","modified":1584934060001},{"_id":"source/img/article/tree-1.png","hash":"578e4bdb1137ef445656eb97ee67c435f19a8d06","modified":1584933811265},{"_id":"source/img/article/tree-2.png","hash":"a62ee08694c713d651e0172c1599e079ad63737d","modified":1584933811297},{"_id":"source/img/article/tree-3.png","hash":"db2dd99b4426807d07e845c53d951a4ddb2ea674","modified":1584933811325},{"_id":"source/img/article/tree-5.png","hash":"4d50533df3958632bc7099d7bbe49e0daffbed18","modified":1584936004808},{"_id":"source/img/article/tree-6.png","hash":"a14dd20862d5cfabd75e921a58bab86b6dc479b6","modified":1584936557303},{"_id":"source/img/article/upload.png","hash":"2ff71d516e47ee8826ecda7484b454cb7d3e719f","modified":1583863578000},{"_id":"source/img/article/waterfall-2.jpg","hash":"4d7458625acd7ac9b3768b84c32fee7b5572776d","modified":1583863578000},{"_id":"source/img/avatar/nojsja.jpeg","hash":"71fc59f8b263f90563e6f4f7c91efac2c7c97921","modified":1583894141425},{"_id":"themes/huweihuang/layout/_partial/footer.ejs","hash":"3d636e6c921b62d2ab9a7dbaa76f5b791ca37f36","modified":1583859930469},{"_id":"themes/huweihuang/layout/_partial/head.ejs","hash":"720349195a5ea7b610a82ce3ce74298fb2bc7347","modified":1583838440464},{"_id":"themes/huweihuang/layout/_partial/header.ejs","hash":"3bd09df76e0622d76d186b020393fcab361e6c97","modified":1583838440464},{"_id":"themes/huweihuang/layout/_partial/nav.ejs","hash":"4c905166c960852e9b9a3c9d5c680091e37b481f","modified":1583838440464},{"_id":"themes/huweihuang/layout/_partial/pagination.ejs","hash":"557d6bb069a1d48af49ae912994653f44b32a570","modified":1583838440464},{"_id":"themes/huweihuang/layout/_partial/sidebar.ejs","hash":"2e4e528a555917b2a267da4db2440bcc4a7a65ab","modified":1583838440464},{"_id":"themes/huweihuang/layout/_partial/toc.ejs","hash":"40e11b303df113c64a5ca35b79dd53c824010c09","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/archive.ejs","hash":"7594929d472806ca4c64d9906d9903a96de111a0","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/category.ejs","hash":"1cf485def07dc06e870dc9613767c6c614bcf428","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/featured-tags.ejs","hash":"0c9ce1942f1943dc8891a9302a922ef1ffe300c5","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/friends-blog.ejs","hash":"734d3775017aedac185028924baf890a71a74548","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/recent-posts.ejs","hash":"e08ab8ba60e31638006acf27f066b989a0a3c433","modified":1583838440464},{"_id":"themes/huweihuang/layout/_widget/short-about.ejs","hash":"315de02246f07c747c32495e107ad7b19cb3ff54","modified":1583838440464},{"_id":"themes/huweihuang/source/css/archive.styl","hash":"715bcbd085eb95ec26c9805c11c374919cde971c","modified":1583838440468},{"_id":"themes/huweihuang/source/css/beantech.css","hash":"4c361354fd8e9851923fb21a620bc079380ebcd8","modified":1583838440468},{"_id":"themes/huweihuang/source/css/beantech.min.css","hash":"05a06230b1a9eca0b30cece54a397008cb77dc50","modified":1583838440468},{"_id":"themes/huweihuang/source/css/donate.css","hash":"f65ac8363d8d215adb896158e7b45165db259a47","modified":1583838440468},{"_id":"themes/huweihuang/source/css/highlight.styl","hash":"e842080e6d580f0f70a7df71fbde3c4e49463c19","modified":1583838440468},{"_id":"themes/huweihuang/source/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1583838440468},{"_id":"themes/huweihuang/source/css/rocket.styl","hash":"e15c51c8566ecd943112e57592888dd318b6fa6a","modified":1583838440468},{"_id":"themes/huweihuang/source/css/signature.styl","hash":"88159b31c59d59c01a0b534af57242662a2a3969","modified":1583838440468},{"_id":"themes/huweihuang/source/css/toc.styl","hash":"631e97f634d30f53314e2fec8bdde267c1c49f4c","modified":1583838440468},{"_id":"themes/huweihuang/source/css/widget.styl","hash":"7a9f735f5ef323dc2950fbd9d76daa16c9a0f1a9","modified":1583838440468},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1583838440468},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1583838440468},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1583838440468},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1583838440468},{"_id":"themes/huweihuang/source/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1583838440468},{"_id":"themes/huweihuang/source/js/hux-blog.js","hash":"4b4d3c557405d04c3087d36c13e2834fe05c0f73","modified":1583838440468},{"_id":"themes/huweihuang/source/js/hux-blog.min.js","hash":"1563e7f70550ac6b30803d6f449719b853200e35","modified":1583838440468},{"_id":"themes/huweihuang/source/js/jquery.nav.js","hash":"ef2160a456176a4d09cc0b95d52b27dfbbadf2d8","modified":1583838440472},{"_id":"themes/huweihuang/source/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1583838440472},{"_id":"themes/huweihuang/source/js/toc.js","hash":"41e52551731854224c249d53010c1bae5aa92ffa","modified":1583838440472},{"_id":"themes/huweihuang/source/js/totop.js","hash":"c05360f6fc699ac12e794b1764b4a952713a3017","modified":1583838440472},{"_id":"source/img/article/Fly.jpg","hash":"88fbee27cef45dfe26b5fb0b084313fa8887b5b6","modified":1583863440000},{"_id":"source/img/article/lifeIsStrange.jpg","hash":"01e12f5319efa056db6cd359d9bf820079bf69c3","modified":1583863440000},{"_id":"source/img/article/mobx9.png","hash":"0c1433628cd9227b7cb07753a1ed79a36e8125a1","modified":1583863440000},{"_id":"source/img/article/shards_upload.jpg","hash":"0fbc0f41f8db68b2d203bfeb40a10ed1db35ad1b","modified":1583863440000},{"_id":"source/img/article/tree-4.png","hash":"7e4dfbf28f940c524b7c2826847f392e7aabb942","modified":1584934655602},{"_id":"source/img/article/waterfall-3.jpg","hash":"e9ae0afb7829e68a8f46ffada84373ae026cf787","modified":1583863578000},{"_id":"source/img/header_img/about.jpg","hash":"fda614a689e2557831f157d4fad104aec259f2d1","modified":1583979527523},{"_id":"themes/huweihuang/source/css/bootstrap.min.css","hash":"fec7b176a4b9a67c0eb5d184f57b84297efc23aa","modified":1583838440468},{"_id":"themes/huweihuang/source/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1583838440468},{"_id":"themes/huweihuang/source/js/bootstrap.js","hash":"f8752e9ae24daec0a0baffd7819122f8c6fd9103","modified":1583838440468},{"_id":"themes/huweihuang/source/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1583838440472},{"_id":"source/img/article/Ubuntu18.04-1.jpg","hash":"2f2a11b7d0fddda07c17e99be43633f23b6583a3","modified":1583863440000},{"_id":"source/img/article/Ubuntu18.04-9.png","hash":"a863261a9a1730c361887d336738a414c2f0a53f","modified":1583863578000},{"_id":"source/img/article/mobx1.png","hash":"899db5dde67d4417c78848d93794b9118dd03b99","modified":1583863440000},{"_id":"source/img/article/mobx2.png","hash":"07f4fb4a584c4ae7be2aa5256eaceb9aad03cdb9","modified":1583863440000},{"_id":"source/img/article/mobx3.png","hash":"192a7ab1f6411b166deb64d38ed67f2dbfffab50","modified":1583863440000},{"_id":"source/img/article/mobx4.png","hash":"192a7ab1f6411b166deb64d38ed67f2dbfffab50","modified":1583863440000},{"_id":"source/img/article/mobx5.png","hash":"8baae467c558711224feb2c241012bdc46004716","modified":1583863440000},{"_id":"source/img/article/mobx6.png","hash":"e72cec49c559744899d5a23f0bfa30f4356045cf","modified":1583863440000},{"_id":"source/img/article/mobx8.png","hash":"fdb356e7d6388d858f9b861d95062ed72274400d","modified":1583863440000},{"_id":"source/img/article/tree-bug1.gif","hash":"7e1143cb1125a5289dabf1e5c8b2243eaa2cea3d","modified":1584948646992},{"_id":"source/img/header_img/archive.jpg","hash":"4ef24aaf2edd05ebbbcdc024e61d6b52e1f80e0f","modified":1583865446000},{"_id":"source/img/header_img/archives-widget.jpg","hash":"3dc11cfeac5c8e05e66fe8c78f1c3a51517f738c","modified":1583865446000},{"_id":"source/img/signature/BeanTechSign-white.png","hash":"34289ed41cf9ddac2d56be46fbb1515b7d5913cd","modified":1583838440464},{"_id":"themes/huweihuang/source/css/bootstrap.css","hash":"41c54bf695145ae0b4d9020a1da308ceb05dcaf3","modified":1583838440468},{"_id":"themes/huweihuang/source/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1583838440468},{"_id":"themes/huweihuang/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1583838440468},{"_id":"source/img/article/Ubuntu18.04-10.png","hash":"c869b15cada3d4690f2bdd695e4486d8db277b13","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-12.png","hash":"9530e2c1ea32225e8674ca2fa296c0f80e450157","modified":1583863578000},{"_id":"source/img/article/mobx10.png","hash":"699ca58d9abc07172b853d85230691bc95359a8b","modified":1583863440000},{"_id":"source/img/article/mobx7.png","hash":"699ca58d9abc07172b853d85230691bc95359a8b","modified":1583863440000},{"_id":"source/img/article/tree-bug-fix.gif","hash":"879461e9e878149d4275058d141c4501776c2350","modified":1584948647052},{"_id":"source/img/signature/BeanTechSign-black.png","hash":"94b7102e819fd6ee082d3fb0166f4de7458c22ff","modified":1583838440464},{"_id":"themes/huweihuang/source/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1583838440468},{"_id":"source/img/article/Ubuntu18.04-14.png","hash":"33615ccf60fa2adb47aa70113e00030ddc84cd76","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-5.png","hash":"793113383ec939091149fdbda57e7ffb1be2be9b","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-7.png","hash":"73c40e7f1f5d92baa4fee2613833b78e2efde447","modified":1583863578000},{"_id":"source/img/article/Ubuntu18.04-8.png","hash":"60000d58e2b4699fe83242c91709c87c7af06a7c","modified":1583863578000},{"_id":"source/img/avatar/ironman.png","hash":"7d6a06b4b544ab146c3b3e8474edc33f14ac6e4d","modified":1583838440448},{"_id":"source/img/article/Ubuntu18.04-6.png","hash":"0a9748216e91b802bf53cc5b589f7557af46d58c","modified":1583863578000},{"_id":"source/img/article/tree-bug2.gif","hash":"027471c8f8c9f81eec010d1f64aa9abff423e59c","modified":1584948647024},{"_id":"source/img/header_img/home.jpg","hash":"ae194734c8fddbfc4fcb673a3d9685d038e49dcc","modified":1583979527347},{"_id":"source/img/header_img/tag.png","hash":"2fc57dff9e7ca736be24b04cce54ac7476937b67","modified":1583865446000},{"_id":"source/img/article_header/article_bg.jpg","hash":"a51db494ff5b672793985001dafb581598c9c2de","modified":1583894128070},{"_id":"source/img/article/Desktop2.png","hash":"7bb9f6713506e7a4a57def450ea0f7f01c894fb0","modified":1583863440000},{"_id":"source/img/article/Desktop3.png","hash":"aed0dbf83defa9800c0ab059d17e9c4040f94c4b","modified":1583863440000},{"_id":"source/img/header_img/home3.jpg","hash":"d1f39791cb2a331d8bd3cedc5d7a0f940e0b4f68","modified":1583979122347},{"_id":"source/img/article_header/article_header.png","hash":"ecd26beb4e13612ff419ad794f0371be823222e6","modified":1583894139013},{"_id":"source/img/article/Desktop.png","hash":"a2214d606233f1b469428dc445f2ec2f1f8b5088","modified":1583863440000},{"_id":"source/img/header_img/404.png","hash":"1b98b8219ecee2e263c8c81c58a53e32a62c3526","modified":1583865446000},{"_id":"source/img/header_img/home-bg-o.png","hash":"e9ba54c513f0a37bbccddfdf7841570f86cdc6a5","modified":1583865446000},{"_id":"source/img/header_img/home2.png","hash":"74d23c05e93a2e4bb469737f69d1714d1074bcf9","modified":1583865446000},{"_id":"source/img/article/animation.gif","hash":"77eadaec7549bb72c597258999dc2e065eadc19b","modified":1583892762657},{"_id":"source/img/article/city.jpg","hash":"c21151177f3aa521e64586eee169915f6fd9bd37","modified":1583863438000},{"_id":"source/img/article/waterfall-1.gif","hash":"5c2321cba8e414d902be7e4ae403d2a12ac814d0","modified":1583892762705},{"_id":"public/post-sitemap.xml","hash":"e3cf8a54ba049387cfd6e6bec638d503f404bd24","modified":1584950320536},{"_id":"public/page-sitemap.xml","hash":"2aba1d56873bb2a3203128e67176a1988cf3aae7","modified":1584950320668},{"_id":"public/tag-sitemap.xml","hash":"bf0e9e693c3673b37b4ab89acbbb610e0a4c33b8","modified":1584950320712},{"_id":"public/sitemap.xsl","hash":"4321fa69dc1b8811d32b7a1478e5603e038cea1a","modified":1584950320717},{"_id":"public/sitemap.xml","hash":"26d4e1c56418c54075be47cc384b537d4763954f","modified":1584950320717},{"_id":"public/404.html","hash":"4f4eb591c65aede00f5200b6b88761ad64e47dc3","modified":1584950320722},{"_id":"public/tags/index.html","hash":"52f9e5e0f5764de3317f1a1a245f21884a082568","modified":1584950320722},{"_id":"public/article/echarts图表-树形图开发记录/index.html","hash":"d728955f407c9e2bfa1aa5be2c649c3e02f90fd8","modified":1584950320722},{"_id":"public/article/基于s3对象存储多文件分片上传的Javascript实现/index.html","hash":"6d08d38ab76389e7a2907a4caf72449ef93b9bda","modified":1584950320722},{"_id":"public/article/Electron+Mobx+React开发记录(一)/index.html","hash":"67a0a0476275cf7cd0cd51bb8f131fe9cdf26a54","modified":1584950320722},{"_id":"public/article/联想y7000安装ubuntu18.04显卡驱动解决方案/index.html","hash":"fc64957957fbdd9e350a2e8ce8bf123025cc40e1","modified":1584950320723},{"_id":"public/article/Docker运行容器化的Tim和wechat/index.html","hash":"d7c1e46b6a49b3b2fe355fb002e541639dd438c9","modified":1584950320723},{"_id":"public/article/用Javascript实现一个可自定义样式的tootips组件/index.html","hash":"3d8206f298c7875106eb6f1fbfabebaa73ac312e","modified":1584950320723},{"_id":"public/article/简单实现一个Javascript动画处理类/index.html","hash":"abd8da6586e7f6407605cc66704efaf90773ccbd","modified":1584950320723},{"_id":"public/article/使用ES5实现ES6中的Promise/index.html","hash":"a42a9b99ce6b9b3fc1800faf9fffa0df0e641b37","modified":1584950320723},{"_id":"public/article/Electron+Mobx+React开发记录(二)/index.html","hash":"feea40255d9dd7f1ee54e1c3936542569e0e9e3f","modified":1584950320723},{"_id":"public/article/Ubuntu18.04踩坑记录/index.html","hash":"6978db4af684ba466e228d8d020740c3d2cbfcb0","modified":1584950320723},{"_id":"public/article/linux-mint-configure/index.html","hash":"89f81931c60c3da24f410e1b2eba5470f721c78c","modified":1584950320723},{"_id":"public/article/proxychains终端代理/index.html","hash":"bb8904619281e4cd076b0cb57ee5e746041c18de","modified":1584950320723},{"_id":"public/article/sass开发规范/index.html","hash":"7720065a9ef670111118d7cee0a8a605fd8bfed1","modified":1584950320723},{"_id":"public/article/shadowsocks_polipo/index.html","hash":"01ea2ac55d0ce6f7bd1999015fd57f2b8d20bb4f","modified":1584950320723},{"_id":"public/article/water-fall-layout/index.html","hash":"846e89d095ad5826dd9633a01eede6c987a49403","modified":1584950320723},{"_id":"public/about/index.html","hash":"11c85c5d48a0545c2d04baa2901bdade8be6ca48","modified":1584950320723},{"_id":"public/archive/index.html","hash":"0004b70bef5751c177186808a82e4873714173f1","modified":1584950320723},{"_id":"public/archives/index.html","hash":"079946d2ffdf15db797072be8bc90332b165c225","modified":1584950320723},{"_id":"public/archives/archives/2/index.html","hash":"fdd0d061880d5158d6feef3261df8b7c5fc9b21b","modified":1584950320723},{"_id":"public/archives/2018/index.html","hash":"64a375ead3e40141b1f10e018143a5b0a7592875","modified":1584950320723},{"_id":"public/archives/2018/archives/2/index.html","hash":"e8bf4955d088332be432454d9bb1219e1ab28205","modified":1584950320723},{"_id":"public/archives/2018/04/index.html","hash":"10623486448c5be329f65d459ddd88532dc89dee","modified":1584950320723},{"_id":"public/archives/2018/10/index.html","hash":"090300908dab2a70e44227ec950b09ca60ecf655","modified":1584950320723},{"_id":"public/archives/2018/11/index.html","hash":"2a3a2964eca47fb2e7d2b56105b60bfef99a2f1e","modified":1584950320723},{"_id":"public/archives/2019/index.html","hash":"4a651309d791c341434e8b994e2d6b0c7d2e7303","modified":1584950320724},{"_id":"public/archives/2019/09/index.html","hash":"0535994fcfd92c019825cacfd2605077d8c54128","modified":1584950320724},{"_id":"public/archives/2019/10/index.html","hash":"6e77b5d06047c66467f6875015ad40d01dcea136","modified":1584950320724},{"_id":"public/archives/2020/index.html","hash":"f469b71b0e211ce9ed4ad4bd6f5c781d5d88b0ca","modified":1584950320724},{"_id":"public/archives/2020/03/index.html","hash":"9ebaa9e19d95369701741c2c4e8addc469bd03e1","modified":1584950320724},{"_id":"public/index.html","hash":"3a02107dbb869f4b5b2a90eff1142f8263aa677a","modified":1584950320724},{"_id":"public/page/2/index.html","hash":"97a91215289bcaeea92dd219d07524ca7fcb2292","modified":1584950320724},{"_id":"public/tags/Linux/index.html","hash":"38d1d371ebe013c590ca2203e83323c9284bba0a","modified":1584950320724},{"_id":"public/tags/Docker/index.html","hash":"6e465e6406eabc8a1ae4296eec78a73fe347a3a5","modified":1584950320724},{"_id":"public/tags/ES6/index.html","hash":"20eb5b035dafe2421342117f2d8b74bfbd951466","modified":1584950320724},{"_id":"public/tags/React/index.html","hash":"f84469d423b899670a887ff6756c77d4f993dfe4","modified":1584950320724},{"_id":"public/tags/Mobx/index.html","hash":"5aa4ef69eca24c7c4f4a3df12bf6f05bd8467314","modified":1584950320724},{"_id":"public/tags/Electron/index.html","hash":"ec9857d4440d5650cfb705cc8e3777b3803a7ca3","modified":1584950320724},{"_id":"public/tags/Ubuntu18-04/index.html","hash":"5b238a5a879182cefb1dc14ed654fe4c40d551ad","modified":1584950320724},{"_id":"public/tags/Echarts/index.html","hash":"36ea6cf82b76091796df07998feb7160eb418641","modified":1584950320724},{"_id":"public/tags/Mint/index.html","hash":"e979f0c403ef9d08e9b8b50f091857112dd7e9d8","modified":1584950320724},{"_id":"public/tags/Proxy/index.html","hash":"3743c45bb8cfad53e58369ba8f99366673080275","modified":1584950320724},{"_id":"public/tags/Shadowsocks/index.html","hash":"10c3aa8b989273a8db244b75adf9108c35bc7c28","modified":1584950320724},{"_id":"public/tags/Sass/index.html","hash":"482bb88fb2d680ce82322ec7d4f52a5a951f6f7a","modified":1584950320724},{"_id":"public/tags/Css/index.html","hash":"b7bf4d8578774b0dc9d558f30c6dc447ec74b7e1","modified":1584950320724},{"_id":"public/tags/Javascript/index.html","hash":"44b640ae1708fa71363ea38498702f9c2e584b44","modified":1584950320724},{"_id":"public/tags/WaterFall/index.html","hash":"83657c297c5913082262a86c7416502c2b000f9b","modified":1584950320724},{"_id":"public/tags/Promise/index.html","hash":"e67da26e4148d52ebf77e817a5efcf7e076ce76b","modified":1584950320724},{"_id":"public/tags/ES5/index.html","hash":"f8917ea19b5c92b6088792f91b82f5f46be25462","modified":1584950320724},{"_id":"public/tags/FileUpload/index.html","hash":"1f5304a43022ac1bc6915b4680d28356467bf06f","modified":1584950320725},{"_id":"public/tags/AWS/index.html","hash":"519dd3df460ff17d37558486373e47b987bdfc09","modified":1584950320725},{"_id":"public/tags/S3/index.html","hash":"cd583039b619ee9b1ff15c38e8017965205c44f4","modified":1584950320725},{"_id":"public/tags/Animation/index.html","hash":"aca404550803764e0e01e8e2bbb45c40430c0210","modified":1584950320725},{"_id":"public/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1584950320733},{"_id":"public/img/article/Ubuntu18.04-11.png","hash":"8ae8ed9c52709ffdde63ef92ed26578e87e05cce","modified":1584950320741},{"_id":"public/img/article/Ubuntu18.04-13.png","hash":"2f929624df2751c01731ed1ba21cda2ffb7d7092","modified":1584950320741},{"_id":"public/img/article/Ubuntu18.04-2.png","hash":"63ab9b51046225b0846b88664d90cacc1db4aab3","modified":1584950320741},{"_id":"public/img/article/Ubuntu18.04-3.png","hash":"f331b6722e7cf2035e00f1dd307c58a2379b0c7f","modified":1584950320741},{"_id":"public/img/article/snapshot.png","hash":"3a129083f67b48903e4ae97b03f4f4512bff7d38","modified":1584950320741},{"_id":"public/img/article/snapshot_select.png","hash":"824dd884cf2adb5e242e4f9ea0fa6e01f8f2bb90","modified":1584950320741},{"_id":"public/img/article/tree-1.png","hash":"578e4bdb1137ef445656eb97ee67c435f19a8d06","modified":1584950320742},{"_id":"public/img/article/tree-2.png","hash":"a62ee08694c713d651e0172c1599e079ad63737d","modified":1584950320742},{"_id":"public/img/article/tree-3.png","hash":"db2dd99b4426807d07e845c53d951a4ddb2ea674","modified":1584950320742},{"_id":"public/img/article/tree-5.png","hash":"4d50533df3958632bc7099d7bbe49e0daffbed18","modified":1584950320742},{"_id":"public/img/article/tree-6.png","hash":"a14dd20862d5cfabd75e921a58bab86b6dc479b6","modified":1584950320742},{"_id":"public/img/article/upload.png","hash":"2ff71d516e47ee8826ecda7484b454cb7d3e719f","modified":1584950320742},{"_id":"public/img/article/waterfall-2.jpg","hash":"4d7458625acd7ac9b3768b84c32fee7b5572776d","modified":1584950320742},{"_id":"public/img/avatar/nojsja.jpeg","hash":"71fc59f8b263f90563e6f4f7c91efac2c7c97921","modified":1584950320742},{"_id":"public/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1584950320742},{"_id":"public/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1584950320742},{"_id":"public/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1584950320742},{"_id":"public/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1584950320742},{"_id":"public/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1584950320742},{"_id":"public/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1584950320742},{"_id":"public/img/article/lifeIsStrange.jpg","hash":"01e12f5319efa056db6cd359d9bf820079bf69c3","modified":1584950320880},{"_id":"public/img/article/mobx9.png","hash":"0c1433628cd9227b7cb07753a1ed79a36e8125a1","modified":1584950320880},{"_id":"public/img/article/shards_upload.jpg","hash":"0fbc0f41f8db68b2d203bfeb40a10ed1db35ad1b","modified":1584950320881},{"_id":"public/img/article/tree-4.png","hash":"7e4dfbf28f940c524b7c2826847f392e7aabb942","modified":1584950320882},{"_id":"public/img/article/waterfall-3.jpg","hash":"e9ae0afb7829e68a8f46ffada84373ae026cf787","modified":1584950320882},{"_id":"public/img/header_img/about.jpg","hash":"fda614a689e2557831f157d4fad104aec259f2d1","modified":1584950320882},{"_id":"public/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1584950320882},{"_id":"public/css/archive.css","hash":"8db895ebaeff19ac145c961abcfd5d4a8d67a8ea","modified":1584950320889},{"_id":"public/css/donate.css","hash":"f65ac8363d8d215adb896158e7b45165db259a47","modified":1584950320889},{"_id":"public/css/highlight.css","hash":"c58b4569c086e477a00dcbf5a95a166fe5fecfb0","modified":1584950320890},{"_id":"public/css/rocket.css","hash":"9456fd92f729e09d6de8cda70f95d78e0d789c70","modified":1584950320890},{"_id":"public/css/signature.css","hash":"820fa4743cea34a61808cd8f7de528605c32d7e3","modified":1584950320890},{"_id":"public/css/toc.css","hash":"f756b9e1b2208d2e5b0f3d2ac5e4fea3b7da0e10","modified":1584950320890},{"_id":"public/css/widget.css","hash":"da95ad3f1938f24d20f1fa77d7a38f0c392b5ec8","modified":1584950320890},{"_id":"public/js/hux-blog.js","hash":"4b4d3c557405d04c3087d36c13e2834fe05c0f73","modified":1584950320890},{"_id":"public/js/hux-blog.min.js","hash":"1563e7f70550ac6b30803d6f449719b853200e35","modified":1584950320890},{"_id":"public/js/jquery.nav.js","hash":"ef2160a456176a4d09cc0b95d52b27dfbbadf2d8","modified":1584950320890},{"_id":"public/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1584950320890},{"_id":"public/js/toc.js","hash":"41e52551731854224c249d53010c1bae5aa92ffa","modified":1584950320890},{"_id":"public/js/totop.js","hash":"c05360f6fc699ac12e794b1764b4a952713a3017","modified":1584950320890},{"_id":"public/css/beantech.css","hash":"4c361354fd8e9851923fb21a620bc079380ebcd8","modified":1584950320890},{"_id":"public/css/beantech.min.css","hash":"05a06230b1a9eca0b30cece54a397008cb77dc50","modified":1584950320890},{"_id":"public/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1584950320890},{"_id":"public/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1584950320891},{"_id":"public/css/bootstrap.min.css","hash":"fec7b176a4b9a67c0eb5d184f57b84297efc23aa","modified":1584950320891},{"_id":"public/js/bootstrap.js","hash":"f8752e9ae24daec0a0baffd7819122f8c6fd9103","modified":1584950320891},{"_id":"public/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1584950320891},{"_id":"public/css/bootstrap.css","hash":"41c54bf695145ae0b4d9020a1da308ceb05dcaf3","modified":1584950320891},{"_id":"public/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1584950320891},{"_id":"public/img/article/Fly.jpg","hash":"88fbee27cef45dfe26b5fb0b084313fa8887b5b6","modified":1584950320891},{"_id":"public/img/article/Ubuntu18.04-1.jpg","hash":"2f2a11b7d0fddda07c17e99be43633f23b6583a3","modified":1584950320891},{"_id":"public/img/article/mobx1.png","hash":"899db5dde67d4417c78848d93794b9118dd03b99","modified":1584950320891},{"_id":"public/img/article/mobx2.png","hash":"07f4fb4a584c4ae7be2aa5256eaceb9aad03cdb9","modified":1584950320892},{"_id":"public/img/article/mobx3.png","hash":"192a7ab1f6411b166deb64d38ed67f2dbfffab50","modified":1584950320892},{"_id":"public/img/article/mobx8.png","hash":"fdb356e7d6388d858f9b861d95062ed72274400d","modified":1584950320892},{"_id":"public/img/article/tree-bug1.gif","hash":"7e1143cb1125a5289dabf1e5c8b2243eaa2cea3d","modified":1584950320892},{"_id":"public/img/header_img/archive.jpg","hash":"4ef24aaf2edd05ebbbcdc024e61d6b52e1f80e0f","modified":1584950320892},{"_id":"public/img/header_img/archives-widget.jpg","hash":"3dc11cfeac5c8e05e66fe8c78f1c3a51517f738c","modified":1584950320892},{"_id":"public/img/article/Ubuntu18.04-10.png","hash":"c869b15cada3d4690f2bdd695e4486d8db277b13","modified":1584950320892},{"_id":"public/img/article/Ubuntu18.04-12.png","hash":"9530e2c1ea32225e8674ca2fa296c0f80e450157","modified":1584950320893},{"_id":"public/img/article/Ubuntu18.04-5.png","hash":"793113383ec939091149fdbda57e7ffb1be2be9b","modified":1584950320893},{"_id":"public/img/article/mobx4.png","hash":"192a7ab1f6411b166deb64d38ed67f2dbfffab50","modified":1584950320897},{"_id":"public/img/article/mobx6.png","hash":"e72cec49c559744899d5a23f0bfa30f4356045cf","modified":1584950320897},{"_id":"public/img/signature/BeanTechSign-white.png","hash":"34289ed41cf9ddac2d56be46fbb1515b7d5913cd","modified":1584950320897},{"_id":"public/img/article/tree-bug-fix.gif","hash":"879461e9e878149d4275058d141c4501776c2350","modified":1584950320897},{"_id":"public/img/article/Ubuntu18.04-14.png","hash":"33615ccf60fa2adb47aa70113e00030ddc84cd76","modified":1584950320897},{"_id":"public/img/article/Ubuntu18.04-7.png","hash":"73c40e7f1f5d92baa4fee2613833b78e2efde447","modified":1584950320898},{"_id":"public/img/article/Ubuntu18.04-8.png","hash":"60000d58e2b4699fe83242c91709c87c7af06a7c","modified":1584950320898},{"_id":"public/img/avatar/ironman.png","hash":"7d6a06b4b544ab146c3b3e8474edc33f14ac6e4d","modified":1584950320898},{"_id":"public/img/article/tree-bug2.gif","hash":"027471c8f8c9f81eec010d1f64aa9abff423e59c","modified":1584950320898},{"_id":"public/img/article_header/article_bg.jpg","hash":"a51db494ff5b672793985001dafb581598c9c2de","modified":1584950320898},{"_id":"public/img/article/Ubuntu18.04-9.png","hash":"a863261a9a1730c361887d336738a414c2f0a53f","modified":1584950320904},{"_id":"public/img/signature/BeanTechSign-black.png","hash":"94b7102e819fd6ee082d3fb0166f4de7458c22ff","modified":1584950320904},{"_id":"public/img/header_img/home.jpg","hash":"ae194734c8fddbfc4fcb673a3d9685d038e49dcc","modified":1584950320905},{"_id":"public/img/article/mobx5.png","hash":"8baae467c558711224feb2c241012bdc46004716","modified":1584950320908},{"_id":"public/img/article/mobx7.png","hash":"699ca58d9abc07172b853d85230691bc95359a8b","modified":1584950320908},{"_id":"public/img/article/Ubuntu18.04-6.png","hash":"0a9748216e91b802bf53cc5b589f7557af46d58c","modified":1584950320908},{"_id":"public/img/article/Desktop2.png","hash":"7bb9f6713506e7a4a57def450ea0f7f01c894fb0","modified":1584950320909},{"_id":"public/img/article/mobx10.png","hash":"699ca58d9abc07172b853d85230691bc95359a8b","modified":1584950320912},{"_id":"public/img/article_header/article_header.png","hash":"ecd26beb4e13612ff419ad794f0371be823222e6","modified":1584950320918},{"_id":"public/img/article/animation.gif","hash":"77eadaec7549bb72c597258999dc2e065eadc19b","modified":1584950320918},{"_id":"public/img/header_img/tag.png","hash":"2fc57dff9e7ca736be24b04cce54ac7476937b67","modified":1584950320920},{"_id":"public/img/article/Desktop3.png","hash":"aed0dbf83defa9800c0ab059d17e9c4040f94c4b","modified":1584950320920},{"_id":"public/img/header_img/home3.jpg","hash":"d1f39791cb2a331d8bd3cedc5d7a0f940e0b4f68","modified":1584950320920},{"_id":"public/img/article/Desktop.png","hash":"a2214d606233f1b469428dc445f2ec2f1f8b5088","modified":1584950320921},{"_id":"public/img/header_img/404.png","hash":"1b98b8219ecee2e263c8c81c58a53e32a62c3526","modified":1584950320921},{"_id":"public/img/header_img/home2.png","hash":"74d23c05e93a2e4bb469737f69d1714d1074bcf9","modified":1584950320923},{"_id":"public/img/header_img/home-bg-o.png","hash":"e9ba54c513f0a37bbccddfdf7841570f86cdc6a5","modified":1584950320924},{"_id":"public/img/article/city.jpg","hash":"c21151177f3aa521e64586eee169915f6fd9bd37","modified":1584950320925},{"_id":"public/img/article/waterfall-1.gif","hash":"5c2321cba8e414d902be7e4ae403d2a12ac814d0","modified":1584950320929}],"Category":[],"Data":[],"Page":[{"layout":"404","description":"你来到了没有知识的荒原","header-img":"/blogs/img/header_img/404.png","_content":"","source":"404.md","raw":"---\nlayout: 404\ndescription: \"你来到了没有知识的荒原\"\nheader-img: \"/blogs/img/header_img/404.png\"\n---\n","date":"2020-03-10T15:26:53.505Z","updated":"2020-03-10T15:04:36.875Z","path":"404.html","title":"","comments":1,"_id":"ck846hxlu0000a895ldiovrti","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"about","title":"About","date":"2017-10-03T02:48:33.000Z","description":"一定有什么事儿还没发生","header-img":"/blogs/img/header_img/about.jpg","aplayer":true,"fixed":false,"_content":"\n### 一句话\n\n>Style hungry, Stay foolish.\n\n### 关于我\n\n>一个Coder，喜欢敲代码，喜欢研究技术的，表面上不苟言笑的.\n>一个Photograher，喜欢拍照，静物摄影和人像摄影.\n>一个Gamer，Xbox One X 我的爱.\n\n### 兴趣方向\n\n> Javascript生态/Electron/Linux\n\n### 参与社区\n\n > 简书:https://www.jianshu.com/u/d5c8b784c1d0\n >\n > Github:https://github.com/NoJSJa\n\n### 联系我\n\n>Email: yangwei13@outlook.com\n\n","source":"about/index.md","raw":"---\nlayout: \"about\"\ntitle: \"About\"\ndate: 2017-10-03 10:48:33\ndescription: \"一定有什么事儿还没发生\"\nheader-img: \"/blogs/img/header_img/about.jpg\"\naplayer: true\nfixed: false\n---\n\n### 一句话\n\n>Style hungry, Stay foolish.\n\n### 关于我\n\n>一个Coder，喜欢敲代码，喜欢研究技术的，表面上不苟言笑的.\n>一个Photograher，喜欢拍照，静物摄影和人像摄影.\n>一个Gamer，Xbox One X 我的爱.\n\n### 兴趣方向\n\n> Javascript生态/Electron/Linux\n\n### 参与社区\n\n > 简书:https://www.jianshu.com/u/d5c8b784c1d0\n >\n > Github:https://github.com/NoJSJa\n\n### 联系我\n\n>Email: yangwei13@outlook.com\n\n","updated":"2020-03-12T01:58:43.791Z","path":"about/index.html","comments":1,"_id":"ck846hxms0002a895de17di2m","content":"<h3 id=\"一句话\">一句话</h3>\n<blockquote>\n<p>Style hungry, Stay foolish.</p>\n</blockquote>\n<h3 id=\"关于我\">关于我</h3>\n<blockquote>\n<p>一个Coder，喜欢敲代码，喜欢研究技术的，表面上不苟言笑的.<br>\n一个Photograher，喜欢拍照，静物摄影和人像摄影.<br>\n一个Gamer，Xbox One X 我的爱.</p>\n</blockquote>\n<h3 id=\"兴趣方向\">兴趣方向</h3>\n<blockquote>\n<p>Javascript生态/Electron/Linux</p>\n</blockquote>\n<h3 id=\"参与社区\">参与社区</h3>\n<blockquote>\n<p>简书:<a href=\"https://www.jianshu.com/u/d5c8b784c1d0\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/u/d5c8b784c1d0</a></p>\n<p>Github:<a href=\"https://github.com/NoJSJa\" target=\"_blank\" rel=\"noopener\">https://github.com/NoJSJa</a></p>\n</blockquote>\n<h3 id=\"联系我\">联系我</h3>\n<blockquote>\n<p>Email: <a href=\"mailto:yangwei13@outlook.com\" target=\"_blank\" rel=\"noopener\">yangwei13@outlook.com</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h3>一句话</h3>\n<blockquote>\n<p>Style hungry, Stay foolish.</p>\n</blockquote>\n<h3>关于我</h3>\n<blockquote>\n<p>一个Coder，喜欢敲代码，喜欢研究技术的，表面上不苟言笑的.<br>\n一个Photograher，喜欢拍照，静物摄影和人像摄影.<br>\n一个Gamer，Xbox One X 我的爱.</p>\n</blockquote>\n<h3>兴趣方向</h3>\n<blockquote>\n<p>Javascript生态/Electron/Linux</p>\n</blockquote>\n<h3>参与社区</h3>\n<blockquote>\n<p>简书:<a href=\"https://www.jianshu.com/u/d5c8b784c1d0\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/u/d5c8b784c1d0</a></p>\n<p>Github:<a href=\"https://github.com/NoJSJa\" target=\"_blank\" rel=\"noopener\">https://github.com/NoJSJa</a></p>\n</blockquote>\n<h3>联系我</h3>\n<blockquote>\n<p>Email: <a href=\"mailto:yangwei13@outlook.com\" target=\"_blank\" rel=\"noopener\">yangwei13@outlook.com</a></p>\n</blockquote>\n"},{"layout":"archive","title":"Archives","header-img":"/blogs/img/header_img/archive.jpg","comments":0,"date":"2017-09-20T12:49:56.000Z","description":"Hey, this is archives","_content":"","source":"archive/index.md","raw":"---\nlayout: \"archive\"\ntitle: \"Archives\"\nheader-img: \"/blogs/img/header_img/archive.jpg\"\ncomments: false\ndate: 2017-09-20 20:49:56\ndescription: \"Hey, this is archives\"\n---\n","updated":"2020-03-10T15:04:24.152Z","path":"archive/index.html","_id":"ck846hxmt0004a895gsutj4ao","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"tags","title":"Tags","description":"Hey, this is Tags.","header-img":"/blogs/img/header_img/tag.png","_content":"","source":"tags/index.md","raw":"---\nlayout: \"tags\"\ntitle: \"Tags\"\ndescription: \"Hey, this is Tags.\"\nheader-img: \"/blogs/img/header_img/tag.png\"\n---\n","date":"2020-03-10T15:26:53.521Z","updated":"2020-03-10T15:04:32.679Z","path":"tags/index.html","comments":1,"_id":"ck846hxmw0007a895g3agtxpz","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Docker 运行容器化的Tim和wechat","catalog":true,"toc_nav_num":true,"date":"2018-11-06T11:16:00.000Z","subtitle":"docker linux-qq/wechat","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2018-11-06T11:16:00.000Z","top":null,"_content":"\n### Contents\n* 安装docker\n* 安装容器\n* 容器管理\n\n### 安装docker\n\n> \n> Docker Engine-Community 支持以下的 Ubuntu 版本：\n> \n> -   Xenial 16.04 (LTS)\n> -   Bionic 18.04 (LTS)\n> -   Cosmic 18.10\n> -   Disco 19.04\n> -   其他更新的版本……\n> \n> Docker Engine - Community 支持上 x86_64（或 amd64）armhf，arm64，s390x （IBM Z），和 ppc64le（IBM的Power）架构。\n> \n> * * *\n> \n> #### 卸载旧版本\n> \n> Docker 的旧版本被称为 docker，docker.io 或 docker-engine 。如果已安装，请卸载它们：\n> \n`$ sudo apt-get remove docker docker-engine docker.io containerd runc`\n> \n> 当前称为 Docker Engine-Community 软件包 docker-ce 。\n> \n> 安装 Docker Engine-Community，以下介绍两种方式。\n> \n> * * *\n> \n> #### 使用 Docker 仓库进行安装\n> \n> 在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker 。\n> \n> #### 设置仓库\n> \n> 更新 apt 包索引。\n> \n`$ sudo apt-get update`\n> \n> 安装 apt 依赖包，用于通过HTTPS来获取仓库:\n> \n`$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common`\n> \n> 添加 Docker 的官方 GPG 密钥：\n> \n`$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -`\n> \n> 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥。\n> \n`$ sudo apt-key fingerprint 0EBFCD88`\n>      \n> pub   rsa4096 2017-02-22 \\[SCEA\\]  \n>       9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88  \n> uid           \\[ unknown\\] Docker Release (CE deb) <docker@docker.com>  \n> sub   rsa4096 2017-02-22 \\[S\\]  \n> \n> 使用以下指令设置稳定版仓库\n> \n`$ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ ubuntu $(lsb_release -cs) stable\"`\n> \n> #### 安装 Docker Engine-Community\n> \n> 更新 apt 包索引。\n> \n`$ sudo apt-get update`\n> \n> 安装最新版本的 Docker Engine-Community 和 containerd ，或者转到下一步安装特定版本：\n> \n`$ sudo apt-get install docker-ce docker-ce-cli containerd.io`\n> \n> 要安装特定版本的 Docker Engine-Community，请在仓库中列出可用版本，然后选择一种安装。列出您的仓库中可用的版本：\n> \n`$ apt-cache madison docker-ce `\n>   \n>   docker-ce | 5:18.09.1~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 5:18.09.0~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 18.06.1~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 18.06.0~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   ...  \n> \n> 使用第二列中的版本字符串安装特定版本，例如 5:18.09.1~3-0~ubuntu-xenial。\n> \n`$ sudo apt-get install docker-ce=<VERSION_STRING> docker-ce-cli=<VERSION_STRING> containerd.io`\n> \n> 测试 Docker 是否安装成功，输入以下指令，打印出以下信息则安装成功:\n> \n`$ sudo docker run hello-world`\n> #### 安装 docker-compose\n`$ sudo apt install docker-compose`\n> #### 切换docker源为国内的源\n`$ sudo gedit /etc/docker/daemon.json`\n>\n> 写入配置\n> ```\n>  {\n>    \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"]\n>  }\n> ```\n>\n\n### 安装容器\n* Tim => `sudo docker pull bestwu/qq`\n* wechat => `sudo docker pull bestwu/wechat`\n\n### 容器管理\n1. 获取audio的组ID  \n`getent group audio | cut -d: -f3`\n2. 容器启动文件  \n接下来创建一个yml文件，比如说这里创建 docker-tim.yml，添加如下内容：\n```yml\nversion: '2'\nservices:\n qq:\n   image: bestwu/qq:office    # 后面这个 office 改成 latest ， 登录的就是QQ，否则是Tim\n   container_name: qq\n   devices:\n     - /dev/snd #声音\n   volumes:\n     - /tmp/.X11-unix:/tmp/.X11-unix\n     - $HOME/TencentFiles:/TencentFiles\n   environment:\n     - DISPLAY=unix$DISPLAY\n     - XMODIFIERS=@im=ibus #中文输入\n     - QT_IM_MODULE=ibus\n     - GTK_IM_MODULE=ibus\n     - AUDIO_GID=29 # 可选 (29 parrotsec) 主机audio gid 解决声音设备访问权限问题\n     - GID=1000 # 可选 默认1000 主机当前用户 gid 解决挂载目录访问权限问题\n     - UID=1000 # 可选 默认1000 主机当前用户 uid 解决挂载目录访问权限问题\n```\n\n3. 容器启动命令  \n编写start-tim.sh：\n```yml\n#!/bin/sh\n# 密码更改为自己的\n# -d 指定为后台启动\necho \"yw020154\" | sudo docker-compose -f docker-tim.yml up -d\n```\n\n4. 容器的常用操作\n```sh\n# 启动/停止/重启\nsudo docker start/stop/restart qq\n# 终止容器进程\nsudo docker kill qq\n# 查看运行容器\nsudo docker ps\n```","source":"_posts/Docker运行容器化的Tim和wechat.md","raw":"---\ntitle: \"Docker 运行容器化的Tim和wechat\"\ncatalog: true\ntoc_nav_num: true\ndate:  2018-11-06 19:16:00\nsubtitle: \"docker linux-qq/wechat\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Linux\n- Docker\ncatagories:\n- Linux\nupdateDate: 2018-11-06 19:16:00\ntop: \n---\n\n### Contents\n* 安装docker\n* 安装容器\n* 容器管理\n\n### 安装docker\n\n> \n> Docker Engine-Community 支持以下的 Ubuntu 版本：\n> \n> -   Xenial 16.04 (LTS)\n> -   Bionic 18.04 (LTS)\n> -   Cosmic 18.10\n> -   Disco 19.04\n> -   其他更新的版本……\n> \n> Docker Engine - Community 支持上 x86_64（或 amd64）armhf，arm64，s390x （IBM Z），和 ppc64le（IBM的Power）架构。\n> \n> * * *\n> \n> #### 卸载旧版本\n> \n> Docker 的旧版本被称为 docker，docker.io 或 docker-engine 。如果已安装，请卸载它们：\n> \n`$ sudo apt-get remove docker docker-engine docker.io containerd runc`\n> \n> 当前称为 Docker Engine-Community 软件包 docker-ce 。\n> \n> 安装 Docker Engine-Community，以下介绍两种方式。\n> \n> * * *\n> \n> #### 使用 Docker 仓库进行安装\n> \n> 在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker 。\n> \n> #### 设置仓库\n> \n> 更新 apt 包索引。\n> \n`$ sudo apt-get update`\n> \n> 安装 apt 依赖包，用于通过HTTPS来获取仓库:\n> \n`$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common`\n> \n> 添加 Docker 的官方 GPG 密钥：\n> \n`$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -`\n> \n> 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥。\n> \n`$ sudo apt-key fingerprint 0EBFCD88`\n>      \n> pub   rsa4096 2017-02-22 \\[SCEA\\]  \n>       9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88  \n> uid           \\[ unknown\\] Docker Release (CE deb) <docker@docker.com>  \n> sub   rsa4096 2017-02-22 \\[S\\]  \n> \n> 使用以下指令设置稳定版仓库\n> \n`$ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ ubuntu $(lsb_release -cs) stable\"`\n> \n> #### 安装 Docker Engine-Community\n> \n> 更新 apt 包索引。\n> \n`$ sudo apt-get update`\n> \n> 安装最新版本的 Docker Engine-Community 和 containerd ，或者转到下一步安装特定版本：\n> \n`$ sudo apt-get install docker-ce docker-ce-cli containerd.io`\n> \n> 要安装特定版本的 Docker Engine-Community，请在仓库中列出可用版本，然后选择一种安装。列出您的仓库中可用的版本：\n> \n`$ apt-cache madison docker-ce `\n>   \n>   docker-ce | 5:18.09.1~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 5:18.09.0~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 18.06.1~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   docker-ce | 18.06.0~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages  \n>   ...  \n> \n> 使用第二列中的版本字符串安装特定版本，例如 5:18.09.1~3-0~ubuntu-xenial。\n> \n`$ sudo apt-get install docker-ce=<VERSION_STRING> docker-ce-cli=<VERSION_STRING> containerd.io`\n> \n> 测试 Docker 是否安装成功，输入以下指令，打印出以下信息则安装成功:\n> \n`$ sudo docker run hello-world`\n> #### 安装 docker-compose\n`$ sudo apt install docker-compose`\n> #### 切换docker源为国内的源\n`$ sudo gedit /etc/docker/daemon.json`\n>\n> 写入配置\n> ```\n>  {\n>    \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"]\n>  }\n> ```\n>\n\n### 安装容器\n* Tim => `sudo docker pull bestwu/qq`\n* wechat => `sudo docker pull bestwu/wechat`\n\n### 容器管理\n1. 获取audio的组ID  \n`getent group audio | cut -d: -f3`\n2. 容器启动文件  \n接下来创建一个yml文件，比如说这里创建 docker-tim.yml，添加如下内容：\n```yml\nversion: '2'\nservices:\n qq:\n   image: bestwu/qq:office    # 后面这个 office 改成 latest ， 登录的就是QQ，否则是Tim\n   container_name: qq\n   devices:\n     - /dev/snd #声音\n   volumes:\n     - /tmp/.X11-unix:/tmp/.X11-unix\n     - $HOME/TencentFiles:/TencentFiles\n   environment:\n     - DISPLAY=unix$DISPLAY\n     - XMODIFIERS=@im=ibus #中文输入\n     - QT_IM_MODULE=ibus\n     - GTK_IM_MODULE=ibus\n     - AUDIO_GID=29 # 可选 (29 parrotsec) 主机audio gid 解决声音设备访问权限问题\n     - GID=1000 # 可选 默认1000 主机当前用户 gid 解决挂载目录访问权限问题\n     - UID=1000 # 可选 默认1000 主机当前用户 uid 解决挂载目录访问权限问题\n```\n\n3. 容器启动命令  \n编写start-tim.sh：\n```yml\n#!/bin/sh\n# 密码更改为自己的\n# -d 指定为后台启动\necho \"yw020154\" | sudo docker-compose -f docker-tim.yml up -d\n```\n\n4. 容器的常用操作\n```sh\n# 启动/停止/重启\nsudo docker start/stop/restart qq\n# 终止容器进程\nsudo docker kill qq\n# 查看运行容器\nsudo docker ps\n```","slug":"Docker运行容器化的Tim和wechat","published":1,"updated":"2020-03-10T16:49:58.666Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxmp0001a8954hwbwkx2","content":"<h3 id=\"contents\">Contents</h3>\n<ul>\n<li>安装docker</li>\n<li>安装容器</li>\n<li>容器管理</li>\n</ul>\n<h3 id=\"安装docker\">安装docker</h3>\n<blockquote>\n<p>Docker Engine-Community 支持以下的 Ubuntu 版本：</p>\n<ul>\n<li>Xenial 16.04 (LTS)</li>\n<li>Bionic 18.04 (LTS)</li>\n<li>Cosmic 18.10</li>\n<li>Disco 19.04</li>\n<li>其他更新的版本……</li>\n</ul>\n<p>Docker Engine - Community 支持上 x86_64（或 amd64）armhf，arm64，s390x （IBM Z），和 ppc64le（IBM的Power）架构。</p>\n<hr>\n<h4 id=\"卸载旧版本\">卸载旧版本</h4>\n<p>Docker 的旧版本被称为 docker，<a href=\"http://docker.io\" target=\"_blank\" rel=\"noopener\">docker.io</a> 或 docker-engine 。如果已安装，请卸载它们：</p>\n</blockquote>\n<p><code>$ sudo apt-get remove docker docker-engine docker.io containerd runc</code></p>\n<blockquote>\n<p>当前称为 Docker Engine-Community 软件包 docker-ce 。</p>\n<p>安装 Docker Engine-Community，以下介绍两种方式。</p>\n<hr>\n<h4 id=\"使用-docker-仓库进行安装\">使用 Docker 仓库进行安装</h4>\n<p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker 。</p>\n<h4 id=\"设置仓库\">设置仓库</h4>\n<p>更新 apt 包索引。</p>\n</blockquote>\n<p><code>$ sudo apt-get update</code></p>\n<blockquote>\n<p>安装 apt 依赖包，用于通过HTTPS来获取仓库:</p>\n</blockquote>\n<p><code>$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common</code></p>\n<blockquote>\n<p>添加 Docker 的官方 GPG 密钥：</p>\n</blockquote>\n<p><code>$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></p>\n<blockquote>\n<p>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥。</p>\n</blockquote>\n<p><code>$ sudo apt-key fingerprint 0EBFCD88</code></p>\n<blockquote>\n<p>pub   rsa4096 2017-02-22 [SCEA]<br>\n      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88<br>\nuid           [ unknown] Docker Release (CE deb) <a href=\"mailto:docker@docker.com\" target=\"_blank\" rel=\"noopener\">docker@docker.com</a><br>\nsub   rsa4096 2017-02-22 [S]</p>\n<p>使用以下指令设置稳定版仓库</p>\n</blockquote>\n<p><code>$ sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ ubuntu $(lsb_release -cs) stable&quot;</code></p>\n<blockquote>\n<h4 id=\"安装-docker-engine-community\">安装 Docker Engine-Community</h4>\n<p>更新 apt 包索引。</p>\n</blockquote>\n<p><code>$ sudo apt-get update</code></p>\n<blockquote>\n<p>安装最新版本的 Docker Engine-Community 和 containerd ，或者转到下一步安装特定版本：</p>\n</blockquote>\n<p><code>$ sudo apt-get install docker-ce docker-ce-cli containerd.io</code></p>\n<blockquote>\n<p>要安装特定版本的 Docker Engine-Community，请在仓库中列出可用版本，然后选择一种安装。列出您的仓库中可用的版本：</p>\n</blockquote>\n<p><code>$ apt-cache madison docker-ce</code></p>\n<blockquote>\n<p>docker-ce | 5:18.09.1~3-0~ubuntu-xenial | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 5:18.09.0~3-0~ubuntu-xenial | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 18.06.1~ce~3-0~ubuntu       | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 18.06.0~ce~3-0~ubuntu       | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  …</p>\n<p>使用第二列中的版本字符串安装特定版本，例如 5:18.09.1~3-0~ubuntu-xenial。</p>\n</blockquote>\n<p><code>$ sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</code></p>\n<blockquote>\n<p>测试 Docker 是否安装成功，输入以下指令，打印出以下信息则安装成功:</p>\n</blockquote>\n<p><code>$ sudo docker run hello-world</code></p>\n<blockquote>\n<h4 id=\"安装-docker-compose\">安装 docker-compose</h4>\n</blockquote>\n<p><code>$ sudo apt install docker-compose</code></p>\n<blockquote>\n<h4 id=\"切换docker源为国内的源\">切换docker源为国内的源</h4>\n</blockquote>\n<p><code>$ sudo gedit /etc/docker/daemon.json</code></p>\n<blockquote>\n<p>写入配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;  &#123;</span><br><span class=\"line\">&gt;    &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class=\"line\">&gt;  &#125;</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote></blockquote>\n<h3 id=\"安装容器\">安装容器</h3>\n<ul>\n<li>Tim =&gt; <code>sudo docker pull bestwu/qq</code></li>\n<li>wechat =&gt; <code>sudo docker pull bestwu/wechat</code></li>\n</ul>\n<h3 id=\"容器管理\">容器管理</h3>\n<ol>\n<li>获取audio的组ID<br>\n<code>getent group audio | cut -d: -f3</code></li>\n<li>容器启动文件<br>\n接下来创建一个yml文件，比如说这里创建 docker-tim.yml，添加如下内容：</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'2'</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"attr\"> qq:</span></span><br><span class=\"line\"><span class=\"attr\">   image:</span> <span class=\"string\">bestwu/qq:office</span>    <span class=\"comment\"># 后面这个 office 改成 latest ， 登录的就是QQ，否则是Tim</span></span><br><span class=\"line\"><span class=\"attr\">   container_name:</span> <span class=\"string\">qq</span></span><br><span class=\"line\"><span class=\"attr\">   devices:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">/dev/snd</span> <span class=\"comment\">#声音</span></span><br><span class=\"line\"><span class=\"attr\">   volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">/tmp/.X11-unix:/tmp/.X11-unix</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">$HOME/TencentFiles:/TencentFiles</span></span><br><span class=\"line\"><span class=\"attr\">   environment:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">DISPLAY=unix$DISPLAY</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">XMODIFIERS=@im=ibus</span> <span class=\"comment\">#中文输入</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">QT_IM_MODULE=ibus</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">GTK_IM_MODULE=ibus</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">AUDIO_GID=29</span> <span class=\"comment\"># 可选 (29 parrotsec) 主机audio gid 解决声音设备访问权限问题</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">GID=1000</span> <span class=\"comment\"># 可选 默认1000 主机当前用户 gid 解决挂载目录访问权限问题</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">UID=1000</span> <span class=\"comment\"># 可选 默认1000 主机当前用户 uid 解决挂载目录访问权限问题</span></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>容器启动命令<br>\n<a href=\"http://xn--start-tim-zq3o4611b.sh\" target=\"_blank\" rel=\"noopener\">编写start-tim.sh</a>：</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># 密码更改为自己的</span></span><br><span class=\"line\"><span class=\"comment\"># -d 指定为后台启动</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">\"yw020154\"</span> <span class=\"string\">| sudo docker-compose -f docker-tim.yml up -d</span></span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>容器的常用操作</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动/停止/重启</span></span><br><span class=\"line\">sudo docker start/stop/restart qq</span><br><span class=\"line\"><span class=\"comment\"># 终止容器进程</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">kill</span> qq</span><br><span class=\"line\"><span class=\"comment\"># 查看运行容器</span></span><br><span class=\"line\">sudo docker ps</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3>Contents</h3>\n<ul>\n<li>安装docker</li>\n<li>安装容器</li>\n<li>容器管理</li>\n</ul>\n<h3>安装docker</h3>\n<blockquote>\n<p>Docker Engine-Community 支持以下的 Ubuntu 版本：</p>\n<ul>\n<li>Xenial 16.04 (LTS)</li>\n<li>Bionic 18.04 (LTS)</li>\n<li>Cosmic 18.10</li>\n<li>Disco 19.04</li>\n<li>其他更新的版本……</li>\n</ul>\n<p>Docker Engine - Community 支持上 x86_64（或 amd64）armhf，arm64，s390x （IBM Z），和 ppc64le（IBM的Power）架构。</p>\n<hr>\n<h4>卸载旧版本</h4>\n<p>Docker 的旧版本被称为 docker，<a href=\"http://docker.io\" target=\"_blank\" rel=\"noopener\">docker.io</a> 或 docker-engine 。如果已安装，请卸载它们：</p>\n</blockquote>\n<p><code>$ sudo apt-get remove docker docker-engine docker.io containerd runc</code></p>\n<blockquote>\n<p>当前称为 Docker Engine-Community 软件包 docker-ce 。</p>\n<p>安装 Docker Engine-Community，以下介绍两种方式。</p>\n<hr>\n<h4>使用 Docker 仓库进行安装</h4>\n<p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker 。</p>\n<h4>设置仓库</h4>\n<p>更新 apt 包索引。</p>\n</blockquote>\n<p><code>$ sudo apt-get update</code></p>\n<blockquote>\n<p>安装 apt 依赖包，用于通过HTTPS来获取仓库:</p>\n</blockquote>\n<p><code>$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common</code></p>\n<blockquote>\n<p>添加 Docker 的官方 GPG 密钥：</p>\n</blockquote>\n<p><code>$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></p>\n<blockquote>\n<p>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥。</p>\n</blockquote>\n<p><code>$ sudo apt-key fingerprint 0EBFCD88</code></p>\n<blockquote>\n<p>pub   rsa4096 2017-02-22 [SCEA]<br>\n      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88<br>\nuid           [ unknown] Docker Release (CE deb) <a href=\"mailto:docker@docker.com\" target=\"_blank\" rel=\"noopener\">docker@docker.com</a><br>\nsub   rsa4096 2017-02-22 [S]</p>\n<p>使用以下指令设置稳定版仓库</p>\n</blockquote>\n<p><code>$ sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ ubuntu $(lsb_release -cs) stable&quot;</code></p>\n<blockquote>\n<h4>安装 Docker Engine-Community</h4>\n<p>更新 apt 包索引。</p>\n</blockquote>\n<p><code>$ sudo apt-get update</code></p>\n<blockquote>\n<p>安装最新版本的 Docker Engine-Community 和 containerd ，或者转到下一步安装特定版本：</p>\n</blockquote>\n<p><code>$ sudo apt-get install docker-ce docker-ce-cli containerd.io</code></p>\n<blockquote>\n<p>要安装特定版本的 Docker Engine-Community，请在仓库中列出可用版本，然后选择一种安装。列出您的仓库中可用的版本：</p>\n</blockquote>\n<p><code>$ apt-cache madison docker-ce</code></p>\n<blockquote>\n<p>docker-ce | 5:18.09.1~3-0~ubuntu-xenial | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 5:18.09.0~3-0~ubuntu-xenial | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 18.06.1~ce~3-0~ubuntu       | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  docker-ce | 18.06.0~ce~3-0~ubuntu       | <a href=\"https://download.docker.com/linux/ubuntu\" target=\"_blank\" rel=\"noopener\">https://download.docker.com/linux/ubuntu</a>  xenial/stable amd64 Packages<br>\n  …</p>\n<p>使用第二列中的版本字符串安装特定版本，例如 5:18.09.1~3-0~ubuntu-xenial。</p>\n</blockquote>\n<p><code>$ sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</code></p>\n<blockquote>\n<p>测试 Docker 是否安装成功，输入以下指令，打印出以下信息则安装成功:</p>\n</blockquote>\n<p><code>$ sudo docker run hello-world</code></p>\n<blockquote>\n<h4>安装 docker-compose</h4>\n</blockquote>\n<p><code>$ sudo apt install docker-compose</code></p>\n<blockquote>\n<h4>切换docker源为国内的源</h4>\n</blockquote>\n<p><code>$ sudo gedit /etc/docker/daemon.json</code></p>\n<blockquote>\n<p>写入配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;  &#123;</span><br><span class=\"line\">&gt;    &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class=\"line\">&gt;  &#125;</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote></blockquote>\n<h3>安装容器</h3>\n<ul>\n<li>Tim =&gt; <code>sudo docker pull bestwu/qq</code></li>\n<li>wechat =&gt; <code>sudo docker pull bestwu/wechat</code></li>\n</ul>\n<h3>容器管理</h3>\n<ol>\n<li>获取audio的组ID<br>\n<code>getent group audio | cut -d: -f3</code></li>\n<li>容器启动文件<br>\n接下来创建一个yml文件，比如说这里创建 docker-tim.yml，添加如下内容：</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'2'</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"attr\"> qq:</span></span><br><span class=\"line\"><span class=\"attr\">   image:</span> <span class=\"string\">bestwu/qq:office</span>    <span class=\"comment\"># 后面这个 office 改成 latest ， 登录的就是QQ，否则是Tim</span></span><br><span class=\"line\"><span class=\"attr\">   container_name:</span> <span class=\"string\">qq</span></span><br><span class=\"line\"><span class=\"attr\">   devices:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">/dev/snd</span> <span class=\"comment\">#声音</span></span><br><span class=\"line\"><span class=\"attr\">   volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">/tmp/.X11-unix:/tmp/.X11-unix</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">$HOME/TencentFiles:/TencentFiles</span></span><br><span class=\"line\"><span class=\"attr\">   environment:</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">DISPLAY=unix$DISPLAY</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">XMODIFIERS=@im=ibus</span> <span class=\"comment\">#中文输入</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">QT_IM_MODULE=ibus</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">GTK_IM_MODULE=ibus</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">AUDIO_GID=29</span> <span class=\"comment\"># 可选 (29 parrotsec) 主机audio gid 解决声音设备访问权限问题</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">GID=1000</span> <span class=\"comment\"># 可选 默认1000 主机当前用户 gid 解决挂载目录访问权限问题</span></span><br><span class=\"line\"><span class=\"bullet\">     -</span> <span class=\"string\">UID=1000</span> <span class=\"comment\"># 可选 默认1000 主机当前用户 uid 解决挂载目录访问权限问题</span></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>容器启动命令<br>\n<a href=\"http://xn--start-tim-zq3o4611b.sh\" target=\"_blank\" rel=\"noopener\">编写start-tim.sh</a>：</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># 密码更改为自己的</span></span><br><span class=\"line\"><span class=\"comment\"># -d 指定为后台启动</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">\"yw020154\"</span> <span class=\"string\">| sudo docker-compose -f docker-tim.yml up -d</span></span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>容器的常用操作</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动/停止/重启</span></span><br><span class=\"line\">sudo docker start/stop/restart qq</span><br><span class=\"line\"><span class=\"comment\"># 终止容器进程</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">kill</span> qq</span><br><span class=\"line\"><span class=\"comment\"># 查看运行容器</span></span><br><span class=\"line\">sudo docker ps</span><br></pre></td></tr></table></figure>"},{"title":"Electron+Mobx+React开发记录(二)","catalog":true,"toc_nav_num":true,"date":"2018-10-26T11:43:00.000Z","subtitle":"Electron Mobx React","header-img":"/blogs/img/article_header/article_header.png","catagories":["Electron"],"updateDate":"2018-10-26T11:43:00.000Z","top":null,"_content":"\n![Hello World](/blogs/img/article/Fly.jpg)\n\n### Contents\n\n1. 前言\n2. webpack4图片打包的问题\n3. webpack4样式表打包分离\n4. 应用构建工具electron-builder配置\n5. 应用构建工具electron-builder的问题\n\n### 前言\n-------------\n[前一篇文章](www.jianshu.com/p/53d74df07e4c)主要记录了开发环境的搭建和一些开发时遇到的问题，这篇文章主要说说自己在coding work之后进行应用打包时遇到的问题(webpack打包和electron打包)，[项目地址](https://github.com/NoJsJa/electronux)。\n\n### webpack4图片打包的问题\n------------------------------------------\n\n#### jsx中声明的img:src不能被webpack识别和打包\n在jsx中使用图片时，如下：\n```html\n<div className=\"install-item-image\" onClick={() => {showTerminalInfo(item.label)}}>\n  <Dimmer active={loading} inverted>\n    <Loader size=\"tiny\">{ loadingLable }</Loader>\n  </Dimmer>\n  <img alt=\"error\" src={item.url} />\n</div>\n```\n这里img:src使用了一个变量，但无论是变量还是字符串，webpack在打包的时候都不能根据我们引用的资源路径在dist目录下生成正确的资源引用路径结构，所以只能在我们需要引用图片的地方，手动require引入，如下：\n```html\n...\nconst imgSrc = require('path/to/img');\n...\n<img src={imgSrc}>\n```\n那如果img:src真的是变量而且需要一次引入多个那怎么办，如果你说想用for循环引入可以不，这其实是不行的，因为webpack打包的时候是识别不了你for循环内定义的变量的。引入办法如下，可以用正则表达式对一个文件夹内的所有文件进行匹配引入，并且可以在项目任意位置引入：\n```\n// 匹配1：只匹配图片\nconst requireContext = require.context('resources/install', true, /^\\.\\/.*\\.(jpg|png)$/);\n// 匹配2：匹配所有文件\nconst requireContext = require.context('resources/install', true, /.*/);\nrequireContext.keys().map(requireContext);\n```\n\n#### 生产环境和开发环境的publicPath配置\n关于publicPath这里有一篇说得比较清楚的[文章](https://www.jianshu.com/p/cbe81be10d78)\n> output.path ： 硬盘上的路径，也就是你打算把文件打包到你的哪个目录，与发布时的路径完全无关。  \n\n> output.publicPath： 主要用来转换url中的相对路径的。如果你引用到包含url的资源，一定要配置output.publicPath，配置了此项，webpack在打包时才能根据配置动态修改uri中的相对值。比如果你将所有打包生成好的文件托管在服务器上，访问格式是`www.yourhost.com/dist/index.html`的话，那publicPath就需要指定为`/dist/`。\n\n* webpack-dev-server的publicPath默认是`/`，也就是在开发环境下webpack-dev-server在内存中生成的bundle.js文件路径是`/`，我们在浏览器中访问`localhost:3000/bundle.js`就能看见了，如果你在生产环境下的访问路径是`localhost:3000/dist/bundle.js`，就需要指定webpack-dev-server的publicPath为`/dist/`，这只是一个内存中虚拟的路径映射，目的是为了统一开发环境和生产环境的路径问题。\n\n* 开发环境下：\n```\nwebpack.config.js\n...\ndevtool: 'source-map',\n  entry: [\n    'react-hot-loader/patch',\n    'webpack-dev-server/client?http://localhost:3000',\n    'webpack/hot/only-dev-server',\n    './app/index',\n  ],\n  mode: 'development',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n...\n```\n* 生产环境下：\n```\nwebpack.prod.config.js\n...\nentry: [\n    './app/index',\n  ],\n  mode: 'production',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n...\n```\n\n#### 统一生产环境和开发环境的资源引用路径\n可以在webpack.config文件中指定`resolve.alias`来将一个绝对路径重命名，然后在项目任意位置直接使用重命名路径就行了，不用在import的时候搞很多相对路径声明`../../../`，如下：\n* 声明：  \n```\nwebpack.config.js\n...\nresolve: {\n    alias: {\n      resources: path.resolve(__dirname, 'resources'),\n      app: path.resolve(__dirname, 'app'),\n    },\n  },\n...\n```\n* 使用：\n```html\n<img src=\"resources/install/albert.png\"}>\n```\n\n### webpack4样式表打包分离\n------------------------------------------\n#### css属性`backgroup-image: url(...)`的路径统一\n我们在webpack.config中指定`resolve.alias`之后，如果你要在css属性中引用那个绝对路径的别名的话，需要在img:url字符前多加一个`~`路径转换符号，来让webpack为你自动替换路径，如下：\n```css\n.router-left-background {\n  background-image: url(~resources/public/gohome.jpg); /* The image used */\n  background-color: #f6f6f6; /* Used if the image is unavailable */\n  background-position: center; /* Center the image */\n  background-repeat: no-repeat; /* Do not repeat the image */\n  background-size: cover; /* cover size */\n}\n```\n#### 将样式表从bundle.js文件中分离\n如果项目比较大的话，直接将样式表压缩进bundle.js文件中会导致页面首页加载时间比较长，这里我们使用`extract-text-webpack-plugin`webpack插件分离样式表，然后在index.html引入样式表，这样页面加载的时候浏览器就会发送异步请求来同时加载bundle.js文件和css文件，极大地提高加载速度。\n* index.html\n\n```html\n<!DOCTYPE HTML>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>electronux</title>\n  <link rel=\"stylesheet\" href=\"style.scss.css\">\n  <link rel=\"stylesheet\" href=\"style.css\">\n  <base href=\"./\">\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script src=\"bundle.js\"></script>\n</body>\n</html>\n```\n* 开发环境下webpack插件`extract-text-webpack-plugin`配置\n这里的插件`publicPath`需要根据webpack-dev-server的`publicPath`配置(默认是`/`)，如果我们的样式表会加载外部文件(例如图片和字体文件)的话，那个实际资源请求路径就会根据这里的`publicPath`来计算得出。\n\n```js\nwebpack.config.js\n...\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\nconst ExtractTextPlugin = require('extract-text-webpack-plugin');\n\n// 拆分样式文件\nconst extractSass = new ExtractTextPlugin({\n  filename: 'style.scss.css',\n});\nconst extractCss = new ExtractTextPlugin({\n  filename: 'style.css',\n});\n...\nmodule.exports = {\n  ...\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        use: ['babel-loader'],\n      },\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: '/',\n        }),\n      },\n      ...\n    ],\n    ...\n  },\n\n  plugins: [\n    extractSass,\n    extractCss,\n    ...\n  ],\n...\n```\n\n* 生产环境下webpack插件`extract-text-webpack-plugin`配置\n生产环境下需要将`publicPath`设置为我们打包后生成的dist目录，不然css中引用的外部资源如图片等是不能生成到dist目录中的。\n\n```js\nwebpack.prod.config.js\n...\nmodule.exports = {\n  ...\n  module: {\n    rules: [\n      ...\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: path.join(__dirname, 'dist/'),\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: path.join(__dirname, 'dist/'),\n        }),\n      },\n    ...\n```\n\n### 应用构建工具electron-builder配置\n----------------------------------------------------\n```json\n{\n  \"appId\": \"com.nojsja.electronux\",\n  \"copyright\": \"nojsja\",\n  \"productName\": \"electronux\",\n  \"asar\": false,\n  \"directories\": {\n    \"buildResources\": \"build-assets/\",\n    \"output\": \"build/\"\n  },\n  \"files\": [\"package.json\", \"index.js\", \"dist/\", \"app/\", \"node_modules/\"],\n  \"linux\": {\n    \"icon\": \"resources\",\n    \"category\": \"System\",\n    \"description\": \"A System Management Tool Build For Manjaro Linux 17\",\n    \"synopsis\": \"electronux\",\n    \"target\": [\"zip\"]\n  }\n}\n```\nelectron-builder打包主要解决两个问题，一是怎么打包前端界面代码目录`dist`下的资源(渲染进程代码)，二是怎么打包由根目录下的index.js文件引入的资源(主进程代码)。配置文件中`files`参数项配置的就是所有需要最终打包进我们应用的所有文件了。\n* package.json -- 整个应用程序的依赖配置文件\n* index.js -- 主进程入口文件\n* dist -- 渲染进程资源文件\n* app -- 运行时引用的源代码和资源目录\n* node_modules -- 运行时引用的第三方模块和资源目录\n\n配置说明详细见[官方文档](https://www.electron.build/configuration/configuration)\n\n### 应用构建工具electron-builder的问题\n-------------------------------------------------\n#### 国内墙导致打包工具依赖下载失败\n运行electron-builder的时候会首先下载各个打包依赖，但是如果直接下载是会失败的(下载源文件存在github)。但我这边终端是用polipo配置了http-proxy的，下载的时候还是很慢，最后仍会导致下载失败，这个真的比较头痛，我索性将git仓库clone到自己搭建的vps虚拟机上(日本节点)，然后在服务器上运行一次打包命令，再把`~/.cache/electron-builder`、`~/.cache/electron`这两个打包工具生成的目录直接下载到本地对应的目录下，最后在本地运行打包命令的时候就不会再去下载依赖了。\n\n#### 打包成AppImage后在运行时不能使用chmod更改文件权限的问题\n先来看一段Linux上常见的AppImage打包应用的定义：  \n> AppImage不把Linux应用程序安装在文件系统相应的目录中，相反，它没有进行实际的安装，AppImage文件只是个压缩文件，在它运行时候`挂载`，用AppImage打包的程序，一个程序就是一个文件。  \n\n在我的应用中需要执行一些shell脚本获取系统信息，但是这些脚本在第一次运行的时候是需要使用node.js中fs模块的`fs.chmod`方法对shell脚本进行赋予可执行权限的(chmod 755)，但是AppImage运行时是不允许动态更改文件属性的，所有挂载的Applmage文件都是只读的，无奈，我放弃了将应用打包成AppImage这种格式。\n为了便于测试可以直接打包成zip文件，解压后就能运行，如果要安装到不同的发行版的话还能打包成`pacman`、`deb`、`rpm`、`tar.gz`等文件。\n\n#### arar加密打包时造成绝对路径查找失败\nelectron-builder的打包参数中有一个参数是`asar: true/false`，如果指定了为true的话打包后的压缩包内的源代码是会被arar加密的，这个对一些不开源的代码来说还是很有必要，但在我这个应用中应用在运行的时候会动态加载一些自定义的模块文件，如果你加载的路径用的是绝对路径的话，这个加载过程就会失败，因为如果启用了arar的话，我们资源目录下所有的源代码都只是一个加密的压缩包，此时你是不能通过系统的绝对路径来找到我们要引入的那个模块代码路径的，当然如果你手动解压arar压缩包的话就能看到所有源代码的目录结构了。\n\n#### 外部引用资源(img:src / css:url)的相对路径和绝对路径\nhtml demo:\n```html\n<div className=\"install-item-image\" onClick={() => {showTerminalInfo(item.label)}}>\n  <Dimmer active={loading} inverted>\n    <Loader size=\"tiny\">{ loadingLable }</Loader>\n  </Dimmer>\n  <img alt=\"error\" src={item.url} />\n</div>\n```\ncss demo:\n```css\n.router-left-background {\n  background-image: url(~resources/public/gohome.jpg); /* The image used */\n  background-color: #f6f6f6; /* Used if the image is unavailable */\n  background-position: center; /* Center the image */\n  background-repeat: no-repeat; /* Do not repeat the image */\n  background-size: cover; /* cover size */\n}\n```\n如果我们正确地通过webpack打包了前端界面的代码，在dist目录下生成了正确的资源目录结构，然后尝试使用`electron index.js`命令来模拟生产环境下应用的运行(使用file协议加载dist目录下的资源)，发现代码中所有的引用资源请求都会失败。这是因为electron在生产环境下是使用`file`协议来加载文件的，首先我们在在执行了`electron index.js`命令后，electron窗口会按照我们定义的路径结构去查找index.html文件，然后加载主窗口，这个过程没有问题，如下：  \n```js\nwindow.loadURL(url.format({\n  pathname: path.resolve(__dirname, 'dist', 'index.html'),\n  protocol: 'file:',\n  slashes: true,\n}));\n```\n然后在这个index.html中的css图片请求和react组件的图片请求就是问题之处了，因为我们没有指定当前工作目录，file协议加载文件时就会直接从系统根目录开始根据资源目录结构查找了，实际上，我们的所有资源都是在`dist`文件夹下的，而不是系统根目录`/`，解决办法是在我们的index.html文件里面指定一个base标签，指明当前工作目录就行了，如下：\n```html\n<!DOCTYPE HTML>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>electronux</title>\n  <link rel=\"stylesheet\" href=\"style.scss.css\">\n  <link rel=\"stylesheet\" href=\"style.css\">\n  <base href=\"./\">\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script src=\"bundle.js\"></script>\n</body>\n</html>\n```\n\n#### 使用node.js对shell脚本赋予可执行权限\nnode.js的fs模块可以为文件赋予可执行权限，并且`fs.chmod`命令不用额外申请权限，估计是如果当前用户可以以root权限运行文件的话，node会自动为你获取权限。  \n* 定义fsChmod模块递归为一个目录内的所有文件授予权限：\n\n```js\nconst fs = require('fs');\nconst path = require('path');\n\nfunction chmod(target, opstr) {\n  if (fs.statSync(target).isDirectory()) {\n    const files = fs.readdirSync(target);\n    if (files.length) {\n      files.forEach((file) => {\n        chmod(path.join(target, file), opstr);\n      });\n    }\n  } else {\n    fs.chmodSync(target, opstr);\n  }\n}\nfunction fsChmod(dir, opstr) {\n  chmod(dir, opstr);\n}\n\nmodule.exports = fsChmod;\n\n```\n\n* 在fsChmod同级目录下定义shell授权模块\n这样子的话会避开绝对路径查找的问题\n\n```js\nconst path = require('path');\nconst fsChmod = require('./fs-chmod');\nfunction fsChmodShell() {\n  fsChmod(path.join(__dirname, '../shell'), 0o711);\n}\nmodule.exports = fsChmodShell;\n```\n\n* 项目index.js中引入执行\n__注意：__请尽量不要在项目的index.js文件中进行运行时绝对路径查询(使用`path.resolve`)，因为在开发环境下我们的代码目录结构和electron-builder打包后生产环境下的的应用代码结构是不一样的，比如开发环境下，index.js文件位于项目根目录`/`下，shell文件夹(存放shell scripts)的路径是`/app/service/shell`，经过electron-builder打包后，index.js(实际上被编译成了一个可执行文件 )仍然位于根目录`/`下，但是shell文件夹位置却变成了`/resources/app/app/shell`，这样子如果在index.js文件中对shell文件夹进行绝对路径查询的话就会发生严重错误。electron-builder打包后的源代码会被放到资源目录`/resources/app`下，位于资源目录下的代码是可以进行运行时绝对路径查询(前提是没有开启`arar`源代码加密)和相对路径查询的。\n\n```js\nconst fsChmodShell = require('./app/services/middleware/fs-chmod-shell.js');\nfsChmodShell();\n```\n\n### 感谢阅读，如有错误，还请指正：- )\n","source":"_posts/Electron+Mobx+React开发记录(二).md","raw":"---\ntitle: \"Electron+Mobx+React开发记录(二)\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-10-26 19:43:00\nsubtitle: \"Electron Mobx React\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- ES6\n- React\n- Mobx\n- Electron\ncatagories:\n- Electron\nupdateDate: 2018-10-26 19:43:00\ntop: \n---\n\n![Hello World](/blogs/img/article/Fly.jpg)\n\n### Contents\n\n1. 前言\n2. webpack4图片打包的问题\n3. webpack4样式表打包分离\n4. 应用构建工具electron-builder配置\n5. 应用构建工具electron-builder的问题\n\n### 前言\n-------------\n[前一篇文章](www.jianshu.com/p/53d74df07e4c)主要记录了开发环境的搭建和一些开发时遇到的问题，这篇文章主要说说自己在coding work之后进行应用打包时遇到的问题(webpack打包和electron打包)，[项目地址](https://github.com/NoJsJa/electronux)。\n\n### webpack4图片打包的问题\n------------------------------------------\n\n#### jsx中声明的img:src不能被webpack识别和打包\n在jsx中使用图片时，如下：\n```html\n<div className=\"install-item-image\" onClick={() => {showTerminalInfo(item.label)}}>\n  <Dimmer active={loading} inverted>\n    <Loader size=\"tiny\">{ loadingLable }</Loader>\n  </Dimmer>\n  <img alt=\"error\" src={item.url} />\n</div>\n```\n这里img:src使用了一个变量，但无论是变量还是字符串，webpack在打包的时候都不能根据我们引用的资源路径在dist目录下生成正确的资源引用路径结构，所以只能在我们需要引用图片的地方，手动require引入，如下：\n```html\n...\nconst imgSrc = require('path/to/img');\n...\n<img src={imgSrc}>\n```\n那如果img:src真的是变量而且需要一次引入多个那怎么办，如果你说想用for循环引入可以不，这其实是不行的，因为webpack打包的时候是识别不了你for循环内定义的变量的。引入办法如下，可以用正则表达式对一个文件夹内的所有文件进行匹配引入，并且可以在项目任意位置引入：\n```\n// 匹配1：只匹配图片\nconst requireContext = require.context('resources/install', true, /^\\.\\/.*\\.(jpg|png)$/);\n// 匹配2：匹配所有文件\nconst requireContext = require.context('resources/install', true, /.*/);\nrequireContext.keys().map(requireContext);\n```\n\n#### 生产环境和开发环境的publicPath配置\n关于publicPath这里有一篇说得比较清楚的[文章](https://www.jianshu.com/p/cbe81be10d78)\n> output.path ： 硬盘上的路径，也就是你打算把文件打包到你的哪个目录，与发布时的路径完全无关。  \n\n> output.publicPath： 主要用来转换url中的相对路径的。如果你引用到包含url的资源，一定要配置output.publicPath，配置了此项，webpack在打包时才能根据配置动态修改uri中的相对值。比如果你将所有打包生成好的文件托管在服务器上，访问格式是`www.yourhost.com/dist/index.html`的话，那publicPath就需要指定为`/dist/`。\n\n* webpack-dev-server的publicPath默认是`/`，也就是在开发环境下webpack-dev-server在内存中生成的bundle.js文件路径是`/`，我们在浏览器中访问`localhost:3000/bundle.js`就能看见了，如果你在生产环境下的访问路径是`localhost:3000/dist/bundle.js`，就需要指定webpack-dev-server的publicPath为`/dist/`，这只是一个内存中虚拟的路径映射，目的是为了统一开发环境和生产环境的路径问题。\n\n* 开发环境下：\n```\nwebpack.config.js\n...\ndevtool: 'source-map',\n  entry: [\n    'react-hot-loader/patch',\n    'webpack-dev-server/client?http://localhost:3000',\n    'webpack/hot/only-dev-server',\n    './app/index',\n  ],\n  mode: 'development',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n...\n```\n* 生产环境下：\n```\nwebpack.prod.config.js\n...\nentry: [\n    './app/index',\n  ],\n  mode: 'production',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n...\n```\n\n#### 统一生产环境和开发环境的资源引用路径\n可以在webpack.config文件中指定`resolve.alias`来将一个绝对路径重命名，然后在项目任意位置直接使用重命名路径就行了，不用在import的时候搞很多相对路径声明`../../../`，如下：\n* 声明：  \n```\nwebpack.config.js\n...\nresolve: {\n    alias: {\n      resources: path.resolve(__dirname, 'resources'),\n      app: path.resolve(__dirname, 'app'),\n    },\n  },\n...\n```\n* 使用：\n```html\n<img src=\"resources/install/albert.png\"}>\n```\n\n### webpack4样式表打包分离\n------------------------------------------\n#### css属性`backgroup-image: url(...)`的路径统一\n我们在webpack.config中指定`resolve.alias`之后，如果你要在css属性中引用那个绝对路径的别名的话，需要在img:url字符前多加一个`~`路径转换符号，来让webpack为你自动替换路径，如下：\n```css\n.router-left-background {\n  background-image: url(~resources/public/gohome.jpg); /* The image used */\n  background-color: #f6f6f6; /* Used if the image is unavailable */\n  background-position: center; /* Center the image */\n  background-repeat: no-repeat; /* Do not repeat the image */\n  background-size: cover; /* cover size */\n}\n```\n#### 将样式表从bundle.js文件中分离\n如果项目比较大的话，直接将样式表压缩进bundle.js文件中会导致页面首页加载时间比较长，这里我们使用`extract-text-webpack-plugin`webpack插件分离样式表，然后在index.html引入样式表，这样页面加载的时候浏览器就会发送异步请求来同时加载bundle.js文件和css文件，极大地提高加载速度。\n* index.html\n\n```html\n<!DOCTYPE HTML>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>electronux</title>\n  <link rel=\"stylesheet\" href=\"style.scss.css\">\n  <link rel=\"stylesheet\" href=\"style.css\">\n  <base href=\"./\">\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script src=\"bundle.js\"></script>\n</body>\n</html>\n```\n* 开发环境下webpack插件`extract-text-webpack-plugin`配置\n这里的插件`publicPath`需要根据webpack-dev-server的`publicPath`配置(默认是`/`)，如果我们的样式表会加载外部文件(例如图片和字体文件)的话，那个实际资源请求路径就会根据这里的`publicPath`来计算得出。\n\n```js\nwebpack.config.js\n...\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\nconst ExtractTextPlugin = require('extract-text-webpack-plugin');\n\n// 拆分样式文件\nconst extractSass = new ExtractTextPlugin({\n  filename: 'style.scss.css',\n});\nconst extractCss = new ExtractTextPlugin({\n  filename: 'style.css',\n});\n...\nmodule.exports = {\n  ...\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        use: ['babel-loader'],\n      },\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: '/',\n        }),\n      },\n      ...\n    ],\n    ...\n  },\n\n  plugins: [\n    extractSass,\n    extractCss,\n    ...\n  ],\n...\n```\n\n* 生产环境下webpack插件`extract-text-webpack-plugin`配置\n生产环境下需要将`publicPath`设置为我们打包后生成的dist目录，不然css中引用的外部资源如图片等是不能生成到dist目录中的。\n\n```js\nwebpack.prod.config.js\n...\nmodule.exports = {\n  ...\n  module: {\n    rules: [\n      ...\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: path.join(__dirname, 'dist/'),\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: path.join(__dirname, 'dist/'),\n        }),\n      },\n    ...\n```\n\n### 应用构建工具electron-builder配置\n----------------------------------------------------\n```json\n{\n  \"appId\": \"com.nojsja.electronux\",\n  \"copyright\": \"nojsja\",\n  \"productName\": \"electronux\",\n  \"asar\": false,\n  \"directories\": {\n    \"buildResources\": \"build-assets/\",\n    \"output\": \"build/\"\n  },\n  \"files\": [\"package.json\", \"index.js\", \"dist/\", \"app/\", \"node_modules/\"],\n  \"linux\": {\n    \"icon\": \"resources\",\n    \"category\": \"System\",\n    \"description\": \"A System Management Tool Build For Manjaro Linux 17\",\n    \"synopsis\": \"electronux\",\n    \"target\": [\"zip\"]\n  }\n}\n```\nelectron-builder打包主要解决两个问题，一是怎么打包前端界面代码目录`dist`下的资源(渲染进程代码)，二是怎么打包由根目录下的index.js文件引入的资源(主进程代码)。配置文件中`files`参数项配置的就是所有需要最终打包进我们应用的所有文件了。\n* package.json -- 整个应用程序的依赖配置文件\n* index.js -- 主进程入口文件\n* dist -- 渲染进程资源文件\n* app -- 运行时引用的源代码和资源目录\n* node_modules -- 运行时引用的第三方模块和资源目录\n\n配置说明详细见[官方文档](https://www.electron.build/configuration/configuration)\n\n### 应用构建工具electron-builder的问题\n-------------------------------------------------\n#### 国内墙导致打包工具依赖下载失败\n运行electron-builder的时候会首先下载各个打包依赖，但是如果直接下载是会失败的(下载源文件存在github)。但我这边终端是用polipo配置了http-proxy的，下载的时候还是很慢，最后仍会导致下载失败，这个真的比较头痛，我索性将git仓库clone到自己搭建的vps虚拟机上(日本节点)，然后在服务器上运行一次打包命令，再把`~/.cache/electron-builder`、`~/.cache/electron`这两个打包工具生成的目录直接下载到本地对应的目录下，最后在本地运行打包命令的时候就不会再去下载依赖了。\n\n#### 打包成AppImage后在运行时不能使用chmod更改文件权限的问题\n先来看一段Linux上常见的AppImage打包应用的定义：  \n> AppImage不把Linux应用程序安装在文件系统相应的目录中，相反，它没有进行实际的安装，AppImage文件只是个压缩文件，在它运行时候`挂载`，用AppImage打包的程序，一个程序就是一个文件。  \n\n在我的应用中需要执行一些shell脚本获取系统信息，但是这些脚本在第一次运行的时候是需要使用node.js中fs模块的`fs.chmod`方法对shell脚本进行赋予可执行权限的(chmod 755)，但是AppImage运行时是不允许动态更改文件属性的，所有挂载的Applmage文件都是只读的，无奈，我放弃了将应用打包成AppImage这种格式。\n为了便于测试可以直接打包成zip文件，解压后就能运行，如果要安装到不同的发行版的话还能打包成`pacman`、`deb`、`rpm`、`tar.gz`等文件。\n\n#### arar加密打包时造成绝对路径查找失败\nelectron-builder的打包参数中有一个参数是`asar: true/false`，如果指定了为true的话打包后的压缩包内的源代码是会被arar加密的，这个对一些不开源的代码来说还是很有必要，但在我这个应用中应用在运行的时候会动态加载一些自定义的模块文件，如果你加载的路径用的是绝对路径的话，这个加载过程就会失败，因为如果启用了arar的话，我们资源目录下所有的源代码都只是一个加密的压缩包，此时你是不能通过系统的绝对路径来找到我们要引入的那个模块代码路径的，当然如果你手动解压arar压缩包的话就能看到所有源代码的目录结构了。\n\n#### 外部引用资源(img:src / css:url)的相对路径和绝对路径\nhtml demo:\n```html\n<div className=\"install-item-image\" onClick={() => {showTerminalInfo(item.label)}}>\n  <Dimmer active={loading} inverted>\n    <Loader size=\"tiny\">{ loadingLable }</Loader>\n  </Dimmer>\n  <img alt=\"error\" src={item.url} />\n</div>\n```\ncss demo:\n```css\n.router-left-background {\n  background-image: url(~resources/public/gohome.jpg); /* The image used */\n  background-color: #f6f6f6; /* Used if the image is unavailable */\n  background-position: center; /* Center the image */\n  background-repeat: no-repeat; /* Do not repeat the image */\n  background-size: cover; /* cover size */\n}\n```\n如果我们正确地通过webpack打包了前端界面的代码，在dist目录下生成了正确的资源目录结构，然后尝试使用`electron index.js`命令来模拟生产环境下应用的运行(使用file协议加载dist目录下的资源)，发现代码中所有的引用资源请求都会失败。这是因为electron在生产环境下是使用`file`协议来加载文件的，首先我们在在执行了`electron index.js`命令后，electron窗口会按照我们定义的路径结构去查找index.html文件，然后加载主窗口，这个过程没有问题，如下：  \n```js\nwindow.loadURL(url.format({\n  pathname: path.resolve(__dirname, 'dist', 'index.html'),\n  protocol: 'file:',\n  slashes: true,\n}));\n```\n然后在这个index.html中的css图片请求和react组件的图片请求就是问题之处了，因为我们没有指定当前工作目录，file协议加载文件时就会直接从系统根目录开始根据资源目录结构查找了，实际上，我们的所有资源都是在`dist`文件夹下的，而不是系统根目录`/`，解决办法是在我们的index.html文件里面指定一个base标签，指明当前工作目录就行了，如下：\n```html\n<!DOCTYPE HTML>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>electronux</title>\n  <link rel=\"stylesheet\" href=\"style.scss.css\">\n  <link rel=\"stylesheet\" href=\"style.css\">\n  <base href=\"./\">\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script src=\"bundle.js\"></script>\n</body>\n</html>\n```\n\n#### 使用node.js对shell脚本赋予可执行权限\nnode.js的fs模块可以为文件赋予可执行权限，并且`fs.chmod`命令不用额外申请权限，估计是如果当前用户可以以root权限运行文件的话，node会自动为你获取权限。  \n* 定义fsChmod模块递归为一个目录内的所有文件授予权限：\n\n```js\nconst fs = require('fs');\nconst path = require('path');\n\nfunction chmod(target, opstr) {\n  if (fs.statSync(target).isDirectory()) {\n    const files = fs.readdirSync(target);\n    if (files.length) {\n      files.forEach((file) => {\n        chmod(path.join(target, file), opstr);\n      });\n    }\n  } else {\n    fs.chmodSync(target, opstr);\n  }\n}\nfunction fsChmod(dir, opstr) {\n  chmod(dir, opstr);\n}\n\nmodule.exports = fsChmod;\n\n```\n\n* 在fsChmod同级目录下定义shell授权模块\n这样子的话会避开绝对路径查找的问题\n\n```js\nconst path = require('path');\nconst fsChmod = require('./fs-chmod');\nfunction fsChmodShell() {\n  fsChmod(path.join(__dirname, '../shell'), 0o711);\n}\nmodule.exports = fsChmodShell;\n```\n\n* 项目index.js中引入执行\n__注意：__请尽量不要在项目的index.js文件中进行运行时绝对路径查询(使用`path.resolve`)，因为在开发环境下我们的代码目录结构和electron-builder打包后生产环境下的的应用代码结构是不一样的，比如开发环境下，index.js文件位于项目根目录`/`下，shell文件夹(存放shell scripts)的路径是`/app/service/shell`，经过electron-builder打包后，index.js(实际上被编译成了一个可执行文件 )仍然位于根目录`/`下，但是shell文件夹位置却变成了`/resources/app/app/shell`，这样子如果在index.js文件中对shell文件夹进行绝对路径查询的话就会发生严重错误。electron-builder打包后的源代码会被放到资源目录`/resources/app`下，位于资源目录下的代码是可以进行运行时绝对路径查询(前提是没有开启`arar`源代码加密)和相对路径查询的。\n\n```js\nconst fsChmodShell = require('./app/services/middleware/fs-chmod-shell.js');\nfsChmodShell();\n```\n\n### 感谢阅读，如有错误，还请指正：- )\n","slug":"Electron+Mobx+React开发记录(二)","published":1,"updated":"2020-03-12T02:04:45.298Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxms0003a8952sa1ze1s","content":"<p><img src=\"/blogs/img/article/Fly.jpg\" alt=\"Hello World\"></p>\n<h3 id=\"contents\">Contents</h3>\n<ol>\n<li>前言</li>\n<li>webpack4图片打包的问题</li>\n<li>webpack4样式表打包分离</li>\n<li>应用构建工具electron-builder配置</li>\n<li>应用构建工具electron-builder的问题</li>\n</ol>\n<h3 id=\"前言\">前言</h3>\n<hr>\n<p><a href=\"www.jianshu.com/p/53d74df07e4c\">前一篇文章</a>主要记录了开发环境的搭建和一些开发时遇到的问题，这篇文章主要说说自己在coding work之后进行应用打包时遇到的问题(webpack打包和electron打包)，<a href=\"https://github.com/NoJsJa/electronux\" target=\"_blank\" rel=\"noopener\">项目地址</a>。</p>\n<h3 id=\"webpack4图片打包的问题\">webpack4图片打包的问题</h3>\n<hr>\n<h4 id=\"jsx中声明的imgsrc不能被webpack识别和打包\">jsx中声明的img:src不能被webpack识别和打包</h4>\n<p>在jsx中使用图片时，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">\"install-item-image\"</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;showTerminalInfo(item.label)&#125;&#125;&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Dimmer</span> <span class=\"attr\">active</span>=<span class=\"string\">&#123;loading&#125;</span> <span class=\"attr\">inverted</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loader</span> <span class=\"attr\">size</span>=<span class=\"string\">\"tiny\"</span>&gt;</span>&#123; loadingLable &#125;<span class=\"tag\">&lt;/<span class=\"name\">Loader</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Dimmer</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"error\"</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;item.url&#125;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这里img:src使用了一个变量，但无论是变量还是字符串，webpack在打包的时候都不能根据我们引用的资源路径在dist目录下生成正确的资源引用路径结构，所以只能在我们需要引用图片的地方，手动require引入，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">const imgSrc = require('path/to/img');</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;imgSrc&#125;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>那如果img:src真的是变量而且需要一次引入多个那怎么办，如果你说想用for循环引入可以不，这其实是不行的，因为webpack打包的时候是识别不了你for循环内定义的变量的。引入办法如下，可以用正则表达式对一个文件夹内的所有文件进行匹配引入，并且可以在项目任意位置引入：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 匹配1：只匹配图片</span><br><span class=\"line\">const requireContext = require.context(&apos;resources/install&apos;, true, /^\\.\\/.*\\.(jpg|png)$/);</span><br><span class=\"line\">// 匹配2：匹配所有文件</span><br><span class=\"line\">const requireContext = require.context(&apos;resources/install&apos;, true, /.*/);</span><br><span class=\"line\">requireContext.keys().map(requireContext);</span><br></pre></td></tr></table></figure>\n<h4 id=\"生产环境和开发环境的publicpath配置\">生产环境和开发环境的publicPath配置</h4>\n<p>关于publicPath这里有一篇说得比较清楚的<a href=\"https://www.jianshu.com/p/cbe81be10d78\" target=\"_blank\" rel=\"noopener\">文章</a></p>\n<blockquote>\n<p>output.path ： 硬盘上的路径，也就是你打算把文件打包到你的哪个目录，与发布时的路径完全无关。</p>\n</blockquote>\n<blockquote>\n<p>output.publicPath： 主要用来转换url中的相对路径的。如果你引用到包含url的资源，一定要配置output.publicPath，配置了此项，webpack在打包时才能根据配置动态修改uri中的相对值。比如果你将所有打包生成好的文件托管在服务器上，访问格式是<code>www.yourhost.com/dist/index.html</code>的话，那publicPath就需要指定为<code>/dist/</code>。</p>\n</blockquote>\n<ul>\n<li>\n<p>webpack-dev-server的publicPath默认是<code>/</code>，也就是在开发环境下webpack-dev-server在内存中生成的bundle.js文件路径是<code>/</code>，我们在浏览器中访问<code>localhost:3000/bundle.js</code>就能看见了，如果你在生产环境下的访问路径是<code>localhost:3000/dist/bundle.js</code>，就需要指定webpack-dev-server的publicPath为<code>/dist/</code>，这只是一个内存中虚拟的路径映射，目的是为了统一开发环境和生产环境的路径问题。</p>\n</li>\n<li>\n<p>开发环境下：</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">devtool: &apos;source-map&apos;,</span><br><span class=\"line\">  entry: [</span><br><span class=\"line\">    &apos;react-hot-loader/patch&apos;,</span><br><span class=\"line\">    &apos;webpack-dev-server/client?http://localhost:3000&apos;,</span><br><span class=\"line\">    &apos;webpack/hot/only-dev-server&apos;,</span><br><span class=\"line\">    &apos;./app/index&apos;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: &apos;development&apos;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: &apos;bundle.js&apos;,</span><br><span class=\"line\">    path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class=\"line\">    publicPath: &apos;/&apos;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>生产环境下：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.prod.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">entry: [</span><br><span class=\"line\">    &apos;./app/index&apos;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: &apos;production&apos;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: &apos;bundle.js&apos;,</span><br><span class=\"line\">    path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class=\"line\">    publicPath: &apos;/&apos;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<h4 id=\"统一生产环境和开发环境的资源引用路径\">统一生产环境和开发环境的资源引用路径</h4>\n<p>可以在webpack.config文件中指定<code>resolve.alias</code>来将一个绝对路径重命名，然后在项目任意位置直接使用重命名路径就行了，不用在import的时候搞很多相对路径声明<code>../../../</code>，如下：</p>\n<ul>\n<li>声明：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">    alias: &#123;</span><br><span class=\"line\">      resources: path.resolve(__dirname, &apos;resources&apos;),</span><br><span class=\"line\">      app: path.resolve(__dirname, &apos;app&apos;),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用：</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"resources/install/albert.png\"</span>&#125;&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"webpack4样式表打包分离\">webpack4样式表打包分离</h3>\n<hr>\n<h4 id=\"css属性backgroup-image-url的路径统一\">css属性<code>backgroup-image: url(...)</code>的路径统一</h4>\n<p>我们在webpack.config中指定<code>resolve.alias</code>之后，如果你要在css属性中引用那个绝对路径的别名的话，需要在img:url字符前多加一个<code>~</code>路径转换符号，来让webpack为你自动替换路径，如下：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.router-left-background</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(~resources/public/gohome.jpg); <span class=\"comment\">/* The image used */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#f6f6f6</span>; <span class=\"comment\">/* Used if the image is unavailable */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-position</span>: center; <span class=\"comment\">/* Center the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-repeat</span>: no-repeat; <span class=\"comment\">/* Do not repeat the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">/* cover size */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"将样式表从bundlejs文件中分离\">将样式表从bundle.js文件中分离</h4>\n<p>如果项目比较大的话，直接将样式表压缩进bundle.js文件中会导致页面首页加载时间比较长，这里我们使用<code>extract-text-webpack-plugin</code>webpack插件分离样式表，然后在index.html引入样式表，这样页面加载的时候浏览器就会发送异步请求来同时加载bundle.js文件和css文件，极大地提高加载速度。</p>\n<ul>\n<li>index.html</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>electronux<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.scss.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">base</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bundle.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>开发环境下webpack插件<code>extract-text-webpack-plugin</code>配置<br>\n这里的插件<code>publicPath</code>需要根据webpack-dev-server的<code>publicPath</code>配置(默认是<code>/</code>)，如果我们的样式表会加载外部文件(例如图片和字体文件)的话，那个实际资源请求路径就会根据这里的<code>publicPath</code>来计算得出。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拆分样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractSass = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.scss.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> extractCss = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'babel-loader'</span>],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    extractSass,</span><br><span class=\"line\">    extractCss,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ],</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>生产环境下webpack插件<code>extract-text-webpack-plugin</code>配置<br>\n生产环境下需要将<code>publicPath</code>设置为我们打包后生成的dist目录，不然css中引用的外部资源如图片等是不能生成到dist目录中的。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.prod.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      ...</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: path.join(__dirname, <span class=\"string\">'dist/'</span>),</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: path.join(__dirname, <span class=\"string\">'dist/'</span>),</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<h3 id=\"应用构建工具electron-builder配置\">应用构建工具electron-builder配置</h3>\n<hr>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"appId\"</span>: <span class=\"string\">\"com.nojsja.electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"copyright\"</span>: <span class=\"string\">\"nojsja\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"productName\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"asar\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"directories\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"buildResources\"</span>: <span class=\"string\">\"build-assets/\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"output\"</span>: <span class=\"string\">\"build/\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"files\"</span>: [<span class=\"string\">\"package.json\"</span>, <span class=\"string\">\"index.js\"</span>, <span class=\"string\">\"dist/\"</span>, <span class=\"string\">\"app/\"</span>, <span class=\"string\">\"node_modules/\"</span>],</span><br><span class=\"line\">  <span class=\"attr\">\"linux\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"icon\"</span>: <span class=\"string\">\"resources\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"category\"</span>: <span class=\"string\">\"System\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"A System Management Tool Build For Manjaro Linux 17\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"synopsis\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"target\"</span>: [<span class=\"string\">\"zip\"</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>electron-builder打包主要解决两个问题，一是怎么打包前端界面代码目录<code>dist</code>下的资源(渲染进程代码)，二是怎么打包由根目录下的index.js文件引入的资源(主进程代码)。配置文件中<code>files</code>参数项配置的就是所有需要最终打包进我们应用的所有文件了。</p>\n<ul>\n<li>package.json – 整个应用程序的依赖配置文件</li>\n<li>index.js – 主进程入口文件</li>\n<li>dist – 渲染进程资源文件</li>\n<li>app – 运行时引用的源代码和资源目录</li>\n<li>node_modules – 运行时引用的第三方模块和资源目录</li>\n</ul>\n<p>配置说明详细见<a href=\"https://www.electron.build/configuration/configuration\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<h3 id=\"应用构建工具electron-builder的问题\">应用构建工具electron-builder的问题</h3>\n<hr>\n<h4 id=\"国内墙导致打包工具依赖下载失败\">国内墙导致打包工具依赖下载失败</h4>\n<p>运行electron-builder的时候会首先下载各个打包依赖，但是如果直接下载是会失败的(下载源文件存在github)。但我这边终端是用polipo配置了http-proxy的，下载的时候还是很慢，最后仍会导致下载失败，这个真的比较头痛，我索性将git仓库clone到自己搭建的vps虚拟机上(日本节点)，然后在服务器上运行一次打包命令，再把<code>~/.cache/electron-builder</code>、<code>~/.cache/electron</code>这两个打包工具生成的目录直接下载到本地对应的目录下，最后在本地运行打包命令的时候就不会再去下载依赖了。</p>\n<h4 id=\"打包成appimage后在运行时不能使用chmod更改文件权限的问题\">打包成AppImage后在运行时不能使用chmod更改文件权限的问题</h4>\n<p>先来看一段Linux上常见的AppImage打包应用的定义：</p>\n<blockquote>\n<p>AppImage不把Linux应用程序安装在文件系统相应的目录中，相反，它没有进行实际的安装，AppImage文件只是个压缩文件，在它运行时候<code>挂载</code>，用AppImage打包的程序，一个程序就是一个文件。</p>\n</blockquote>\n<p>在我的应用中需要执行一些shell脚本获取系统信息，但是这些脚本在第一次运行的时候是需要使用node.js中fs模块的<code>fs.chmod</code>方法对shell脚本进行赋予可执行权限的(chmod 755)，但是AppImage运行时是不允许动态更改文件属性的，所有挂载的Applmage文件都是只读的，无奈，我放弃了将应用打包成AppImage这种格式。<br>\n为了便于测试可以直接打包成zip文件，解压后就能运行，如果要安装到不同的发行版的话还能打包成<code>pacman</code>、<code>deb</code>、<code>rpm</code>、<code>tar.gz</code>等文件。</p>\n<h4 id=\"arar加密打包时造成绝对路径查找失败\">arar加密打包时造成绝对路径查找失败</h4>\n<p>electron-builder的打包参数中有一个参数是<code>asar: true/false</code>，如果指定了为true的话打包后的压缩包内的源代码是会被arar加密的，这个对一些不开源的代码来说还是很有必要，但在我这个应用中应用在运行的时候会动态加载一些自定义的模块文件，如果你加载的路径用的是绝对路径的话，这个加载过程就会失败，因为如果启用了arar的话，我们资源目录下所有的源代码都只是一个加密的压缩包，此时你是不能通过系统的绝对路径来找到我们要引入的那个模块代码路径的，当然如果你手动解压arar压缩包的话就能看到所有源代码的目录结构了。</p>\n<h4 id=\"外部引用资源imgsrc-cssurl的相对路径和绝对路径\">外部引用资源(img:src / css:url)的相对路径和绝对路径</h4>\n<p>html demo:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">\"install-item-image\"</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;showTerminalInfo(item.label)&#125;&#125;&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Dimmer</span> <span class=\"attr\">active</span>=<span class=\"string\">&#123;loading&#125;</span> <span class=\"attr\">inverted</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loader</span> <span class=\"attr\">size</span>=<span class=\"string\">\"tiny\"</span>&gt;</span>&#123; loadingLable &#125;<span class=\"tag\">&lt;/<span class=\"name\">Loader</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Dimmer</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"error\"</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;item.url&#125;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>css demo:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.router-left-background</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(~resources/public/gohome.jpg); <span class=\"comment\">/* The image used */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#f6f6f6</span>; <span class=\"comment\">/* Used if the image is unavailable */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-position</span>: center; <span class=\"comment\">/* Center the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-repeat</span>: no-repeat; <span class=\"comment\">/* Do not repeat the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">/* cover size */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果我们正确地通过webpack打包了前端界面的代码，在dist目录下生成了正确的资源目录结构，然后尝试使用<code>electron index.js</code>命令来模拟生产环境下应用的运行(使用file协议加载dist目录下的资源)，发现代码中所有的引用资源请求都会失败。这是因为electron在生产环境下是使用<code>file</code>协议来加载文件的，首先我们在在执行了<code>electron index.js</code>命令后，electron窗口会按照我们定义的路径结构去查找index.html文件，然后加载主窗口，这个过程没有问题，如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">  pathname: path.resolve(__dirname, <span class=\"string\">'dist'</span>, <span class=\"string\">'index.html'</span>),</span><br><span class=\"line\">  protocol: <span class=\"string\">'file:'</span>,</span><br><span class=\"line\">  slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n<p>然后在这个index.html中的css图片请求和react组件的图片请求就是问题之处了，因为我们没有指定当前工作目录，file协议加载文件时就会直接从系统根目录开始根据资源目录结构查找了，实际上，我们的所有资源都是在<code>dist</code>文件夹下的，而不是系统根目录<code>/</code>，解决办法是在我们的index.html文件里面指定一个base标签，指明当前工作目录就行了，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>electronux<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.scss.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">base</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bundle.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"使用nodejs对shell脚本赋予可执行权限\">使用node.js对shell脚本赋予可执行权限</h4>\n<p>node.js的fs模块可以为文件赋予可执行权限，并且<code>fs.chmod</code>命令不用额外申请权限，估计是如果当前用户可以以root权限运行文件的话，node会自动为你获取权限。</p>\n<ul>\n<li>定义fsChmod模块递归为一个目录内的所有文件授予权限：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">chmod</span>(<span class=\"params\">target, opstr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (fs.statSync(target).isDirectory()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> files = fs.readdirSync(target);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (files.length) &#123;</span><br><span class=\"line\">      files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        chmod(path.join(target, file), opstr);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fs.chmodSync(target, opstr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fsChmod</span>(<span class=\"params\">dir, opstr</span>) </span>&#123;</span><br><span class=\"line\">  chmod(dir, opstr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fsChmod;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在fsChmod同级目录下定义shell授权模块<br>\n这样子的话会避开绝对路径查找的问题</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fsChmod = <span class=\"built_in\">require</span>(<span class=\"string\">'./fs-chmod'</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fsChmodShell</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  fsChmod(path.join(__dirname, <span class=\"string\">'../shell'</span>), <span class=\"number\">0o711</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fsChmodShell;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>项目index.js中引入执行<br>\n__注意：__请尽量不要在项目的index.js文件中进行运行时绝对路径查询(使用<code>path.resolve</code>)，因为在开发环境下我们的代码目录结构和electron-builder打包后生产环境下的的应用代码结构是不一样的，比如开发环境下，index.js文件位于项目根目录<code>/</code>下，shell文件夹(存放shell scripts)的路径是<code>/app/service/shell</code>，经过electron-builder打包后，index.js(实际上被编译成了一个可执行文件 )仍然位于根目录<code>/</code>下，但是shell文件夹位置却变成了<code>/resources/app/app/shell</code>，这样子如果在index.js文件中对shell文件夹进行绝对路径查询的话就会发生严重错误。electron-builder打包后的源代码会被放到资源目录<code>/resources/app</code>下，位于资源目录下的代码是可以进行运行时绝对路径查询(前提是没有开启<code>arar</code>源代码加密)和相对路径查询的。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fsChmodShell = <span class=\"built_in\">require</span>(<span class=\"string\">'./app/services/middleware/fs-chmod-shell.js'</span>);</span><br><span class=\"line\">fsChmodShell();</span><br></pre></td></tr></table></figure>\n<h3 id=\"感谢阅读如有错误还请指正-\">感谢阅读，如有错误，还请指正：- )</h3>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/Fly.jpg\" alt=\"Hello World\"></p>\n<h3>Contents</h3>\n<ol>\n<li>前言</li>\n<li>webpack4图片打包的问题</li>\n<li>webpack4样式表打包分离</li>\n<li>应用构建工具electron-builder配置</li>\n<li>应用构建工具electron-builder的问题</li>\n</ol>\n<h3>前言</h3>\n<hr>\n<p><a href=\"www.jianshu.com/p/53d74df07e4c\">前一篇文章</a>主要记录了开发环境的搭建和一些开发时遇到的问题，这篇文章主要说说自己在coding work之后进行应用打包时遇到的问题(webpack打包和electron打包)，<a href=\"https://github.com/NoJsJa/electronux\" target=\"_blank\" rel=\"noopener\">项目地址</a>。</p>\n<h3>webpack4图片打包的问题</h3>\n<hr>\n<h4>jsx中声明的img:src不能被webpack识别和打包</h4>\n<p>在jsx中使用图片时，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">\"install-item-image\"</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;showTerminalInfo(item.label)&#125;&#125;&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Dimmer</span> <span class=\"attr\">active</span>=<span class=\"string\">&#123;loading&#125;</span> <span class=\"attr\">inverted</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loader</span> <span class=\"attr\">size</span>=<span class=\"string\">\"tiny\"</span>&gt;</span>&#123; loadingLable &#125;<span class=\"tag\">&lt;/<span class=\"name\">Loader</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Dimmer</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"error\"</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;item.url&#125;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这里img:src使用了一个变量，但无论是变量还是字符串，webpack在打包的时候都不能根据我们引用的资源路径在dist目录下生成正确的资源引用路径结构，所以只能在我们需要引用图片的地方，手动require引入，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">const imgSrc = require('path/to/img');</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;imgSrc&#125;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>那如果img:src真的是变量而且需要一次引入多个那怎么办，如果你说想用for循环引入可以不，这其实是不行的，因为webpack打包的时候是识别不了你for循环内定义的变量的。引入办法如下，可以用正则表达式对一个文件夹内的所有文件进行匹配引入，并且可以在项目任意位置引入：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 匹配1：只匹配图片</span><br><span class=\"line\">const requireContext = require.context(&apos;resources/install&apos;, true, /^\\.\\/.*\\.(jpg|png)$/);</span><br><span class=\"line\">// 匹配2：匹配所有文件</span><br><span class=\"line\">const requireContext = require.context(&apos;resources/install&apos;, true, /.*/);</span><br><span class=\"line\">requireContext.keys().map(requireContext);</span><br></pre></td></tr></table></figure>\n<h4>生产环境和开发环境的publicPath配置</h4>\n<p>关于publicPath这里有一篇说得比较清楚的<a href=\"https://www.jianshu.com/p/cbe81be10d78\" target=\"_blank\" rel=\"noopener\">文章</a></p>\n<blockquote>\n<p>output.path ： 硬盘上的路径，也就是你打算把文件打包到你的哪个目录，与发布时的路径完全无关。</p>\n</blockquote>\n<blockquote>\n<p>output.publicPath： 主要用来转换url中的相对路径的。如果你引用到包含url的资源，一定要配置output.publicPath，配置了此项，webpack在打包时才能根据配置动态修改uri中的相对值。比如果你将所有打包生成好的文件托管在服务器上，访问格式是<code>www.yourhost.com/dist/index.html</code>的话，那publicPath就需要指定为<code>/dist/</code>。</p>\n</blockquote>\n<ul>\n<li>\n<p>webpack-dev-server的publicPath默认是<code>/</code>，也就是在开发环境下webpack-dev-server在内存中生成的bundle.js文件路径是<code>/</code>，我们在浏览器中访问<code>localhost:3000/bundle.js</code>就能看见了，如果你在生产环境下的访问路径是<code>localhost:3000/dist/bundle.js</code>，就需要指定webpack-dev-server的publicPath为<code>/dist/</code>，这只是一个内存中虚拟的路径映射，目的是为了统一开发环境和生产环境的路径问题。</p>\n</li>\n<li>\n<p>开发环境下：</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">devtool: &apos;source-map&apos;,</span><br><span class=\"line\">  entry: [</span><br><span class=\"line\">    &apos;react-hot-loader/patch&apos;,</span><br><span class=\"line\">    &apos;webpack-dev-server/client?http://localhost:3000&apos;,</span><br><span class=\"line\">    &apos;webpack/hot/only-dev-server&apos;,</span><br><span class=\"line\">    &apos;./app/index&apos;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: &apos;development&apos;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: &apos;bundle.js&apos;,</span><br><span class=\"line\">    path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class=\"line\">    publicPath: &apos;/&apos;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>生产环境下：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.prod.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">entry: [</span><br><span class=\"line\">    &apos;./app/index&apos;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: &apos;production&apos;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: &apos;bundle.js&apos;,</span><br><span class=\"line\">    path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class=\"line\">    publicPath: &apos;/&apos;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<h4>统一生产环境和开发环境的资源引用路径</h4>\n<p>可以在webpack.config文件中指定<code>resolve.alias</code>来将一个绝对路径重命名，然后在项目任意位置直接使用重命名路径就行了，不用在import的时候搞很多相对路径声明<code>../../../</code>，如下：</p>\n<ul>\n<li>声明：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">    alias: &#123;</span><br><span class=\"line\">      resources: path.resolve(__dirname, &apos;resources&apos;),</span><br><span class=\"line\">      app: path.resolve(__dirname, &apos;app&apos;),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用：</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"resources/install/albert.png\"</span>&#125;&gt;</span></span><br></pre></td></tr></table></figure>\n<h3>webpack4样式表打包分离</h3>\n<hr>\n<h4>css属性<code>backgroup-image: url(...)</code>的路径统一</h4>\n<p>我们在webpack.config中指定<code>resolve.alias</code>之后，如果你要在css属性中引用那个绝对路径的别名的话，需要在img:url字符前多加一个<code>~</code>路径转换符号，来让webpack为你自动替换路径，如下：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.router-left-background</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(~resources/public/gohome.jpg); <span class=\"comment\">/* The image used */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#f6f6f6</span>; <span class=\"comment\">/* Used if the image is unavailable */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-position</span>: center; <span class=\"comment\">/* Center the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-repeat</span>: no-repeat; <span class=\"comment\">/* Do not repeat the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">/* cover size */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>将样式表从bundle.js文件中分离</h4>\n<p>如果项目比较大的话，直接将样式表压缩进bundle.js文件中会导致页面首页加载时间比较长，这里我们使用<code>extract-text-webpack-plugin</code>webpack插件分离样式表，然后在index.html引入样式表，这样页面加载的时候浏览器就会发送异步请求来同时加载bundle.js文件和css文件，极大地提高加载速度。</p>\n<ul>\n<li>index.html</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>electronux<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.scss.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">base</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bundle.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>开发环境下webpack插件<code>extract-text-webpack-plugin</code>配置<br>\n这里的插件<code>publicPath</code>需要根据webpack-dev-server的<code>publicPath</code>配置(默认是<code>/</code>)，如果我们的样式表会加载外部文件(例如图片和字体文件)的话，那个实际资源请求路径就会根据这里的<code>publicPath</code>来计算得出。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拆分样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractSass = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.scss.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> extractCss = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'babel-loader'</span>],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    extractSass,</span><br><span class=\"line\">    extractCss,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ],</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>生产环境下webpack插件<code>extract-text-webpack-plugin</code>配置<br>\n生产环境下需要将<code>publicPath</code>设置为我们打包后生成的dist目录，不然css中引用的外部资源如图片等是不能生成到dist目录中的。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack.prod.config.js</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      ...</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: path.join(__dirname, <span class=\"string\">'dist/'</span>),</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: path.join(__dirname, <span class=\"string\">'dist/'</span>),</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n<h3>应用构建工具electron-builder配置</h3>\n<hr>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"appId\"</span>: <span class=\"string\">\"com.nojsja.electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"copyright\"</span>: <span class=\"string\">\"nojsja\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"productName\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"asar\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"directories\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"buildResources\"</span>: <span class=\"string\">\"build-assets/\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"output\"</span>: <span class=\"string\">\"build/\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"files\"</span>: [<span class=\"string\">\"package.json\"</span>, <span class=\"string\">\"index.js\"</span>, <span class=\"string\">\"dist/\"</span>, <span class=\"string\">\"app/\"</span>, <span class=\"string\">\"node_modules/\"</span>],</span><br><span class=\"line\">  <span class=\"attr\">\"linux\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"icon\"</span>: <span class=\"string\">\"resources\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"category\"</span>: <span class=\"string\">\"System\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"A System Management Tool Build For Manjaro Linux 17\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"synopsis\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"target\"</span>: [<span class=\"string\">\"zip\"</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>electron-builder打包主要解决两个问题，一是怎么打包前端界面代码目录<code>dist</code>下的资源(渲染进程代码)，二是怎么打包由根目录下的index.js文件引入的资源(主进程代码)。配置文件中<code>files</code>参数项配置的就是所有需要最终打包进我们应用的所有文件了。</p>\n<ul>\n<li>package.json – 整个应用程序的依赖配置文件</li>\n<li>index.js – 主进程入口文件</li>\n<li>dist – 渲染进程资源文件</li>\n<li>app – 运行时引用的源代码和资源目录</li>\n<li>node_modules – 运行时引用的第三方模块和资源目录</li>\n</ul>\n<p>配置说明详细见<a href=\"https://www.electron.build/configuration/configuration\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<h3>应用构建工具electron-builder的问题</h3>\n<hr>\n<h4>国内墙导致打包工具依赖下载失败</h4>\n<p>运行electron-builder的时候会首先下载各个打包依赖，但是如果直接下载是会失败的(下载源文件存在github)。但我这边终端是用polipo配置了http-proxy的，下载的时候还是很慢，最后仍会导致下载失败，这个真的比较头痛，我索性将git仓库clone到自己搭建的vps虚拟机上(日本节点)，然后在服务器上运行一次打包命令，再把<code>~/.cache/electron-builder</code>、<code>~/.cache/electron</code>这两个打包工具生成的目录直接下载到本地对应的目录下，最后在本地运行打包命令的时候就不会再去下载依赖了。</p>\n<h4>打包成AppImage后在运行时不能使用chmod更改文件权限的问题</h4>\n<p>先来看一段Linux上常见的AppImage打包应用的定义：</p>\n<blockquote>\n<p>AppImage不把Linux应用程序安装在文件系统相应的目录中，相反，它没有进行实际的安装，AppImage文件只是个压缩文件，在它运行时候<code>挂载</code>，用AppImage打包的程序，一个程序就是一个文件。</p>\n</blockquote>\n<p>在我的应用中需要执行一些shell脚本获取系统信息，但是这些脚本在第一次运行的时候是需要使用node.js中fs模块的<code>fs.chmod</code>方法对shell脚本进行赋予可执行权限的(chmod 755)，但是AppImage运行时是不允许动态更改文件属性的，所有挂载的Applmage文件都是只读的，无奈，我放弃了将应用打包成AppImage这种格式。<br>\n为了便于测试可以直接打包成zip文件，解压后就能运行，如果要安装到不同的发行版的话还能打包成<code>pacman</code>、<code>deb</code>、<code>rpm</code>、<code>tar.gz</code>等文件。</p>\n<h4>arar加密打包时造成绝对路径查找失败</h4>\n<p>electron-builder的打包参数中有一个参数是<code>asar: true/false</code>，如果指定了为true的话打包后的压缩包内的源代码是会被arar加密的，这个对一些不开源的代码来说还是很有必要，但在我这个应用中应用在运行的时候会动态加载一些自定义的模块文件，如果你加载的路径用的是绝对路径的话，这个加载过程就会失败，因为如果启用了arar的话，我们资源目录下所有的源代码都只是一个加密的压缩包，此时你是不能通过系统的绝对路径来找到我们要引入的那个模块代码路径的，当然如果你手动解压arar压缩包的话就能看到所有源代码的目录结构了。</p>\n<h4>外部引用资源(img:src / css:url)的相对路径和绝对路径</h4>\n<p>html demo:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">\"install-item-image\"</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;showTerminalInfo(item.label)&#125;&#125;&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Dimmer</span> <span class=\"attr\">active</span>=<span class=\"string\">&#123;loading&#125;</span> <span class=\"attr\">inverted</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loader</span> <span class=\"attr\">size</span>=<span class=\"string\">\"tiny\"</span>&gt;</span>&#123; loadingLable &#125;<span class=\"tag\">&lt;/<span class=\"name\">Loader</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Dimmer</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"error\"</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;item.url&#125;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>css demo:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.router-left-background</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>: <span class=\"built_in\">url</span>(~resources/public/gohome.jpg); <span class=\"comment\">/* The image used */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#f6f6f6</span>; <span class=\"comment\">/* Used if the image is unavailable */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-position</span>: center; <span class=\"comment\">/* Center the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-repeat</span>: no-repeat; <span class=\"comment\">/* Do not repeat the image */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover; <span class=\"comment\">/* cover size */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果我们正确地通过webpack打包了前端界面的代码，在dist目录下生成了正确的资源目录结构，然后尝试使用<code>electron index.js</code>命令来模拟生产环境下应用的运行(使用file协议加载dist目录下的资源)，发现代码中所有的引用资源请求都会失败。这是因为electron在生产环境下是使用<code>file</code>协议来加载文件的，首先我们在在执行了<code>electron index.js</code>命令后，electron窗口会按照我们定义的路径结构去查找index.html文件，然后加载主窗口，这个过程没有问题，如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">  pathname: path.resolve(__dirname, <span class=\"string\">'dist'</span>, <span class=\"string\">'index.html'</span>),</span><br><span class=\"line\">  protocol: <span class=\"string\">'file:'</span>,</span><br><span class=\"line\">  slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n<p>然后在这个index.html中的css图片请求和react组件的图片请求就是问题之处了，因为我们没有指定当前工作目录，file协议加载文件时就会直接从系统根目录开始根据资源目录结构查找了，实际上，我们的所有资源都是在<code>dist</code>文件夹下的，而不是系统根目录<code>/</code>，解决办法是在我们的index.html文件里面指定一个base标签，指明当前工作目录就行了，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>electronux<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.scss.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">base</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"bundle.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4>使用node.js对shell脚本赋予可执行权限</h4>\n<p>node.js的fs模块可以为文件赋予可执行权限，并且<code>fs.chmod</code>命令不用额外申请权限，估计是如果当前用户可以以root权限运行文件的话，node会自动为你获取权限。</p>\n<ul>\n<li>定义fsChmod模块递归为一个目录内的所有文件授予权限：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">chmod</span>(<span class=\"params\">target, opstr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (fs.statSync(target).isDirectory()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> files = fs.readdirSync(target);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (files.length) &#123;</span><br><span class=\"line\">      files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        chmod(path.join(target, file), opstr);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fs.chmodSync(target, opstr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fsChmod</span>(<span class=\"params\">dir, opstr</span>) </span>&#123;</span><br><span class=\"line\">  chmod(dir, opstr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fsChmod;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在fsChmod同级目录下定义shell授权模块<br>\n这样子的话会避开绝对路径查找的问题</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fsChmod = <span class=\"built_in\">require</span>(<span class=\"string\">'./fs-chmod'</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fsChmodShell</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  fsChmod(path.join(__dirname, <span class=\"string\">'../shell'</span>), <span class=\"number\">0o711</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fsChmodShell;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>项目index.js中引入执行<br>\n__注意：__请尽量不要在项目的index.js文件中进行运行时绝对路径查询(使用<code>path.resolve</code>)，因为在开发环境下我们的代码目录结构和electron-builder打包后生产环境下的的应用代码结构是不一样的，比如开发环境下，index.js文件位于项目根目录<code>/</code>下，shell文件夹(存放shell scripts)的路径是<code>/app/service/shell</code>，经过electron-builder打包后，index.js(实际上被编译成了一个可执行文件 )仍然位于根目录<code>/</code>下，但是shell文件夹位置却变成了<code>/resources/app/app/shell</code>，这样子如果在index.js文件中对shell文件夹进行绝对路径查询的话就会发生严重错误。electron-builder打包后的源代码会被放到资源目录<code>/resources/app</code>下，位于资源目录下的代码是可以进行运行时绝对路径查询(前提是没有开启<code>arar</code>源代码加密)和相对路径查询的。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fsChmodShell = <span class=\"built_in\">require</span>(<span class=\"string\">'./app/services/middleware/fs-chmod-shell.js'</span>);</span><br><span class=\"line\">fsChmodShell();</span><br></pre></td></tr></table></figure>\n<h3>感谢阅读，如有错误，还请指正：- )</h3>\n"},{"title":"Electron+Mobx+React开发记录","catalog":true,"toc_nav_num":true,"date":"2019-10-14T08:18:46.000Z","subtitle":"Electron Mobx React","header-img":"/blogs/img/article_header/article_header.png","catagories":["Mobx","Electron"],"updateDate":"2019-10-14T08:18:46.000Z","top":1,"_content":"\n![Hello World](/blogs/img/article/Fly.jpg)\n\n### Contents\n1. 前言\n2. 开发环境搭建\n3. 引入Webpack4.0前端打包工具\n4. Electron代码结构和代码热更新\n5. 前端界面React + Mobx 代码结构和热更新\n6. Linux桌面客户端开发遇到的问题\n\n### 前言\n-----------\n最近桌面系统从Ubuntu18.04切换到了Manjaro Linux 17，之前听说Manjaro的软件丰富，仓库更新及时，很多常用软件都能一键安装(比如QQ，微信)，同时也支持主流的Linux桌面环境：Gnome、KDE、Cinnamon、Mate、Deepin等等，安装了Gnome版本的Manjaro之后发现果然还不错。系统安装好后配置比较繁琐，就想给Manjaro写一个GUI客户端工具用于安装常用软件和作为简单的系统管理工具 - [electronux](https://github.com/NoJsJa/electronux.git)\n作为一名正直的前端开发人员，理所应当地就准备使用Electron + Node.js + React + Mobx + Webpack + Shell 来进行开发啦 ~ 目前仍然在开发中，这篇文章用于记录自己的环境搭建过程、一些对Electron+React开发的理解以及谈谈自己遇到的一些Linux桌面软件开发时遇到的问题和解决办法。\n\n![clean_detail.png](/blogs/img/article/mobx1.png)\n\n![clean_search.png](/blogs/img/article/mobx2.png)\n\n![electron_pssword.png](/blogs/img/article/mobx3.png)\n\n![info_total.png](/blogs/img/article/mobx4.png)\n\n![install_detail.png](/blogs/img/article/mobx5.png)\n\n![install_list.png](/blogs/img/article/mobx6.png)\n\n![install_permission.png](/blogs/img/article/mobx7.png)\n\n![startup_list.png](/blogs/img/article/mobx8.png)\n\n### 开发环境搭建\n------------------------\n#### 代码目录结构\n```sh\nelectronux  \n|---- [dir ] app ( 主代码目录 )\n|----------- [dir ] app/configure ( 应用配置更新 )\n|----------- [dir ] app/runtime ( 运行数据文件 )\n|\n|----------- [dir ] app/services ( 后台服务存放目录 )\n|------------------------ [dir ] app/services/middleware ( 一些中间处理件 )\n|------------------------ [dir ] app/services/shell ( shell脚本存放目录 )\n|------------------------ [dir ] app/services/main-serv ( 主进程服务 )\n|------------------------ [dir ] app/services/render-serv ( 渲染进程服务 )\n|\n|----------- [dir ] app/stores ( 前端状态管理文件目录 )\n|----------- [dir ] app/styles  ( 公用样式表文件 )\n|----------- [dir ] app/utils  ( 公用工具函数 )\n|\n|----------- [dir ] app/views  ( UI界面代码 )\n|------------------------ [dir ] app/views/module1  ( 界面模块1 )\n|------------------------ [dir ] app/views/module2  ( 界面模块2)\n|------------------------ [dir ] app/views/module3  ( 界面模块3 )\n|\n|----------- [file] app/App.js  ( 前端应用入口文件 )\n|----------- [file] app/index.js ( 前端应用热加载文件 )\n|\n|---- [dir ] dist ( 前端代码编译打包文件存放目录 )\n|---- [dir ] resources ( 前端静态资源存放目录 )\n|\n|---- [file] .babelrc ( babel配置文件 )\n|---- [file] .editorconfig (编辑器编码规范文件)\n|---- [file] .eslintrc ( 代码格式检查配置文件 )\n|---- [file] .gitignore ( git忽略追踪配置文件 )\n|---- [file] electron-builder.json ( electron-builder打包配置文件 )\n|---- [file] index.html  ( 应用渲染入口页面 )\n|---- [file] index.js ( 应用主进程入口文件 )\n|---- [file] package.json (前端模块和框架配置文件)\n|---- [file] webpack.config.js (webpack开发环境配置文件)\n|---- [file] webpack.prod.config.js  ( webpack生产环境配置文件 )\n\n```\n\n#### 项目环境依赖配置文件\n```json\n{\n  \"name\": \"electronux\",\n  \"description\": \"linux manager-software powered by electron & react & Mobx \",\n  \"version\": \"1.0.0\",\n  \"author\": {\n    \"name\": \"NoJsJa\",\n    \"email\": \"yangwei020154@gmail.com\"\n  },\n  \"scripts\": {\n    \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",\n    \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",\n    \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron --inspect=5858 index'\",\n    \"start-production\": \"cross-env NODE_ENV=production electron --inspect=5858 index\",\n    \"build-all\": \"npm run dist && npm run build\",\n    \"dist\": \"cross-env NODE_ENV=production webpack --config webpack.prod.config.js\",\n    \"build\": \"electron-builder -l\"\n  },\n  \"keywords\": [\n    \"electron\",\n    \"react\",\n    \"mobx\",\n    \"react-router\",\n    \"webpack4\"\n  ],\n  \"license\": \"\",\n  \"nodemonConfig\": {\n    \"ignore\": [\n      \"resources/*\",\n      \"node_modules/*\",\n      \"dist/*\",\n      \"build/*\",\n      \"app/stores/*\",\n      \"app/styles/*\",\n      \"app/services/shell/*\",\n      \"app/configure/view.conf\",\n      \"app/views/*\",\n      \"app/App.js\",\n      \"app/main.js\",\n      \"app/index.js\",\n      \"electron-builder.yml\"\n    ],\n    \"delay\": \"1000\"\n  },\n  \"dependencies\": {\n    \"semantic-ui-css\": \"^2.4.0\",\n    \"semantic-ui-react\": \"^0.82.5\",\n    \"mobx\": \"^4.4.1\",\n    \"mobx-react\": \"^5.2.8\",\n    \"prop-types\": \"^15.6.2\",\n    \"react\": \"^16.5.1\",\n    \"react-dom\": \"^16.5.1\",\n    \"react-hot-loader\": \"^4.3.8\",\n    \"react-router\": \"^4.3.1\",\n    \"react-router-dom\": \"^4.3.1\",\n    \"history\": \"^4.7.2\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^6.26.3\",\n    \"babel-eslint\": \"^10.0.1\",\n    \"babel-loader\": \"^7.1.5\",\n    \"babel-plugin-transform-decorators-legacy\": \"^1.3.5\",\n    \"babel-preset-env\": \"^1.7.0\",\n    \"babel-preset-es2015\": \"^6.24.1\",\n    \"babel-preset-react\": \"^6.24.1\",\n    \"babel-preset-stage-0\": \"^6.24.1\",\n    \"clean-webpack-plugin\": \"^0.1.19\",\n    \"concurrently\": \"^3.6.1\",\n    \"cross-env\": \"^5.2.0\",\n    \"css-loader\": \"^0.28.11\",\n    \"electron\": \"^2.0.9\",\n    \"electron-builder\": \"^20.28.4\",\n    \"eslint\": \"^5.6.1\",\n    \"eslint-config-airbnb\": \"^17.1.0\",\n    \"eslint-plugin-import\": \"^2.14.0\",\n    \"eslint-plugin-jsx-a11y\": \"^6.1.2\",\n    \"eslint-plugin-react\": \"^7.11.1\",\n    \"extract-text-webpack-plugin\": \"^4.0.0-beta.0\",\n    \"file-loader\": \"^2.0.0\",\n    \"html-loader\": \"^0.5.5\",\n    \"html-webpack-plugin\": \"^3.2.0\",\n    \"node-sass\": \"^4.9.4\",\n    \"nodemon\": \"^1.18.4\",\n    \"sass-loader\": \"^7.1.0\",\n    \"source-map-support\": \"^0.5.9\",\n    \"style-loader\": \"^0.21.0\",\n    \"url-loader\": \"^1.1.2\",\n    \"webpack\": \"^4.19.0\",\n    \"webpack-cli\": \"^2.1.5\",\n    \"webpack-dev-server\": \"^3.1.8\"\n  }\n}\n\n```\n\n### 引入Webpack4.0前端打包工具\n---------------------------------------------\n\n#### webpack开发环境配置文件\n```js\nconst path = require('path');\nconst webpack = require('webpack');\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\nconst ExtractTextPlugin = require('extract-text-webpack-plugin');\n\n// 拆分样式文件\nconst extractSass = new ExtractTextPlugin({\n  filename: 'style.scss.css',\n});\n\nconst extractCss = new ExtractTextPlugin({\n  filename: 'style.css',\n});\n\nmodule.exports = {\n  devtool: 'source-map',\n  entry: [\n    'react-hot-loader/patch',\n    'webpack-dev-server/client?http://localhost:3000',\n    'webpack/hot/only-dev-server',\n    './app/index',\n  ],\n  mode: 'development',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n  resolve: {\n    alias: {\n      resources: path.resolve(__dirname, 'resources'),\n      app: path.resolve(__dirname, 'app'),\n    },\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        use: ['babel-loader'],\n      },\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.html$/,\n        use: {\n          loader: 'html-loader',\n        },\n      },\n      {\n        test: /\\.(png|jpg|gif|svg|ico|woff|eot|ttf|woff2)$/,\n        use: [\n          {\n            loader: 'file-loader',\n            options: {\n              name: '[path][name].[ext]',\n            },\n          },\n        ],\n      },\n    ],\n  },\n\n  plugins: [\n    extractSass,\n    extractCss,\n    new webpack.HotModuleReplacementPlugin(),\n    new CleanWebpackPlugin(['dist']),\n    new webpack.NamedModulesPlugin(),\n    new webpack.NoEmitOnErrorsPlugin(),\n  ],\n\n  devServer: {\n    host: 'localhost',\n    port: 3000,\n    historyApiFallback: true,\n    hot: true,\n  },\n  target: 'electron-renderer',\n};\n\n```\n\n### Electron基本原理和代码热更新\n----------------------------------------------\n> Electron 运行 package.json 的 main 脚本的进程被称为主进程。 在主进程中运行的脚本通过创建web页面来展示用户界面。 一个 Electron 应用总是有且只有一个主进程。\n由于 Electron 使用了 Chromium 来展示 web 页面，所以 Chromium 的多进程架构也被使用到。 每个 Electron 中的 web 页面运行在它自己的渲染进程中。\n在普通的浏览器中，web页面通常在一个沙盒环境中运行，不被允许去接触原生的资源。 然而 Electron 的用户在 Node.js 的 API 支持下可以在页面中和操作系统进行一些底层交互。\n进程使用 BrowserWindow 实例创建页面。 每个 BrowserWindow 实例都在自己的渲染进程里运行页面。 当一个 BrowserWindow 实例被销毁后，相应的渲染进程也会被终止。\n主进程管理所有的web页面和它们对应的渲染进程。 每个渲染进程都是独立的，它只关心它所运行的 web 页面。\n在页面中调用与 GUI 相关的原生 API 是不被允许的，因为在 web 页面里操作原生的 GUI 资源是非常危险的，而且容易造成资源泄露。 如果你想在 web 页面里使用 GUI 操作，其对应的渲染进程必须与主进程进行通讯，请求主进程进行相关的 GUI 操作。\n\n#### 创建主进程\n在index.js文件中我们引入electron和所有的自定义模块文件，并根据开发环境或是生产环境来进行主进程窗口加载，开发环境下使用`http协议`加载由webpack-dev-server启动的http服务，生产环境下使用`file协议`加载本地由webpack打包好的前端bundle.js文件，所以开发环境下`npm start`指令其实主要是执行了两步操作，一是启动webpack-dev-server，此时已经可以通过外部浏览器访问到localhost:3000的http服务，只不过我们实际是用electron之中的chromium浏览器来加载的，它与node.js主进程共享同一个chrome v8引擎，所以理论上，在页面加载后，你同样可以在渲染进程中使用node.js API，比如用使用fs模块访问文件系统。\n\n#### 主进程代码热更新\n我用了nodemon工具实现了主进程代码热更新，如果不用nodemon工具那么 `npm start-electron`命令实际是执行`cross-env NODE_ENV=development electron index`，就是简单的用electron启动主进程文件，使用nodemon之后`npm start-electron`实际上是执行`nodemon --exec 'cross-env NODE_ENV=development electron index'`，最后在package.json文件中增加一个nodemonConfig字段用于指定哪些文件需要纳入nodemon监听即可。\n\n=> package.json中定义的启动脚本：\n```json\n  \"scripts\": {\n    \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",\n    \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",\n    \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron index'\",\n    \"build\": \"npm run dist && npm run build-all\",\n    \"dist\": \"cross-env NODE_ENV=production webpack  --config webpack.production.config.js\",\n    \"build-all\": \"build -lmw\"\n  },\n```\n\n=> package.json中nodemonConfig字段\n```json\n\"nodemonConfig\": {\n    \"ignore\": [\n      \"resources/*\",\n      \"node_modules/*\",\n      \"dist/*\",\n      \"app/stores/*\",\n      \"app/styles/*\",\n      \"app/services/shell/*\",\n      \"app/configure/view.conf\",\n      \"app/views/*\",\n      \"app/App.js\",\n      \"app/main.js\",\n      \"app/index.js\"\n    ],\n    \"delay\": \"1000\"\n  },\n```\n\n=> 项目启动文件index.js：\n```js\n...\n// 根据运行环境加载窗口 //\nfunction loadWindow(window, env) {\n  if (env === 'development') {\n    // wait for webpack-dev-server start\n    setTimeout(() => {\n      window.loadURL(url.format({\n        pathname: 'localhost:3000',\n        protocol: 'http:',\n        slashes: true,\n      }));\n      // window.webContents.openDevTools();\n    }, 1e3);\n  } else {\n    window.loadURL(url.format({\n      pathname: path.join(path.resolve(__dirname, './dist'), 'index.html'),\n      protocol: 'file:',\n      slashes: true,\n    }));\n  }\n}\n\n/* ------------------- main window ------------------- */\n\nfunction createWindow() {\n  const { width, height } = getAppConf();\n  win = new BrowserWindow({\n    width,\n    height,\n    title: 'electronux',\n    autoHideMenuBar: true,\n  });\n\n  win.on('resize', () => {\n    const [_width, _height] = win.getContentSize();\n    viewConf.set({\n      width: _width,\n      height: _height,\n    });\n  });\n\n  loadWindow(win, nodeEnv);\n}\n\n/* ------------------- electron event ------------------- */\n\napp.on('ready', () => {\n  if (nodeEnv === 'development') {\n    sourceMapSupport.install();\n  }\n  createWindow();\n});\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n\napp.on('will-quit', () => {\n  viewConf.write().then(() => 0, (err) => {\n    console.error(err);\n    throw new Error('App quit: view-conf write error !');\n  });\n});\n\napp.on('activate', () => {\n  if (win === null) {\n    createWindow();\n  }\n});\n```\n\n### 前端界面React + Mobx 代码结构和热更新\n-------------------------------------------------------------\n\n#### 代码结构\n1. App.js前端入口文件\n入口文件基本是整个前端应用的关键点，我们使用`mobx-react`包提供的Provider组件加载整个应用，并把各个应用模块(按功能划分)的mobx store示例作为props属性传入Provider，在各个组建中使用修饰器`@inject`就能直接使用store实例了，页面层次比较多的话最好使用React Router进行路由管理，值得注意的是React Router V4版本跟之前版本的理念和使用方式有很大区别，可以去官网查阅相关文档[react-router4](https://reacttraining.com/react-router/web/guides/quick-start)\n\n```js\n/* ------------------- export global history ------------------- */\nexport const history = createHistory();\n\nconst stores = {\n  install: new InstallState(),\n  startup: new StartupState(),\n  info: new InfoState(),\n  clean: new CleanState(),\n  pub: new PublicState(),\n};\n\nfunction App() {\n  return (\n    <Provider {...stores}>\n      <Router history={history}>\n        <Route path=\"/\" component={HomePage} />\n      </Router>\n    </Provider>\n  );\n}\n\n/* ------------------- export provider ------------------- */\nexport default App;\n\n```\n\n2. mobx store 存储\n这是项目其中一个系统清理模块的mobx store，在store中被mobx监听的属性最好结构层次简单、只有单一的功能划分，不要把一个属性对象的嵌套写得太深。开发时我们把UI界面的数据抽象成store中的数据时可能会下意识地根据页面显示状态而把单个属性对象写得过于复杂，但其实页面显示状态只是逻辑的数据结构，我们在store中存储的时候应该尽量将这种逻辑数据结构`翻译`成扁平化的数据结构，然后再在各个属性对象之间建立映射关系。\n并且使用了mobx之后请尽量依赖mobx的数据引用监听自动更新特性，多写`computed`、`autorun`来自动生成数据，使用`action`修饰一些需要更改store属性的方法。\n\n```js\nclass Clean {\n  constructor() { }\n  /* ------------------- observable ------------------- */\n\n  // 所有检查项目 //\n  @observable items = {\n    appCache: false,\n    appLog: false,\n    trash: false,\n    packageCache: false,\n  };\n\n  // 主界面加载 //\n  @observable loadingMain = false;\n\n  // 清理路径 //\n  cleanPaths = {\n    appCache: [`/home/${this.userinfo.username}/.cache`],\n    appLog: ['/var/log/'],\n    trash: [`/home/${this.userinfo.username}/.local/share/Trash/files`],\n    packageCache: ['/var/cache/pacman/pkg'],\n  }\n\n  // 路径模块映射 //\n  @observable cleanPathMap = {\n    appCache: [], // '/var/log/pacman.log'\n    appLog: [],\n    trash: [],\n    packageCache: [],\n  }\n\n  // 清理内容 //\n  @observable cleanContents = observable.map({})\n\n  // 清理大小 //\n  cleanSizes = {\n    // '/var/log//pacman.log': '10kb',\n  }\n\n  // ---- 清理选项细节-数据对象逻辑树结构 ---- //\n  // @observable cleanDetails = {\n  //   appCache: {\n  //     url: [`/home/${this.userinfo.username}/.cache`], // 指定扫描路径多个\n  //     contents: { // 绝对路径\n  //       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': false,\n  //     },\n  //     size: {\n  //       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': '10kb',\n  //     },\n  //   },\n  //   appLog: {\n  //     url: ['/var/log/'],\n  //     contents: {\n  //       // '/var/log//pacman.log': false,\n  //     },\n  //     size: {\n  //       // '/var/log//pacman.log': '10kb',\n  //     },\n  //   }\n  // }\n\n  /* ------------------- static ------------------- */\n\n\n  /* ------------------- computed ------------------- */\n\n  // 获取所有被选中的detail item //\n  @computed get allCheckedDetail() {\n    const a = [];\n    this.cleanContents.forEach((v, k) => {\n      if (v) a.push(k);\n    });\n    return a;\n  }\n\n  // 清理路径详细信息 //\n  @computed get cleanDetail() {\n    const result = [];\n    Object.keys(this.cleanPathMap).forEach((item) => {\n      if (this.items[item]) {\n        const oneResult = {\n          label: item,\n          contents: [],\n        };\n        this.cleanPathMap[item].forEach((it) => {\n          oneResult.contents.push({\n            content: it,\n            size: this.cleanSizes[it] || 0,\n          });\n        });\n\n        result.push(oneResult);\n      }\n    });\n\n    return result;\n  }\n}\n\nexport default Clean;\n\n```\n\n3. 页面组件划分\n在views目录下创建的各个目录都是一个单独的组件目录，组件目录下有一个组件入口文件和css样式表文件以及其它子组件，入口文件载入css文件和子组件，使用`@inject`修饰器后各个组件都可以独立访问mobx store实例，不必在父和子组件之间通过props进行逐级参数传递，但是如果一个子组件依赖父组件来加工原始数据的话也可以使用props传递参数。\n使用了mobx之后，并不是说每个页面需要使用的数据都有必要纳入mobx store的管理，在我的代码中只是把`关键性数据`以及`关键性数据加工方法`存入了store中，每个组件拿到store传递下来的数据后一些页面状态可能需要依赖组件各自的数据处理函数进行数据二次加工，我觉得这样应该会减轻store实例的负载压力，非绝对中心化。比如在一个列表菜单组件中，这个组件的列表数据可以切换显示和隐藏，但是控制这个列表显示/隐藏的参数状态`visible`没有必要纳入store实例管理，相对的管理这个列表组件的store实例只是存储了列表数据的数组，以及一些必要的数据加工方法。\n\n4. 渲染进程和主进程ipc通信的问题\n页面的每个渲染进程(ipcRender)，虽然说可以直接使用node.js原生模块和api，但是不建议在渲染进程中过度使用原生模块，一是因为一些node.js原生模块并没有考虑到进程安全的问题，第二个原因是渲染进程应该专注处理页面交互和数据处理问题，划清代码的功能区域，把和系统交互的问题交由主进程(ipcMain)处理，把网络数据请求也交由各自的service服务，减少不必要的模块和数据耦合。渲染进程通过ipc通信向主进程发送处理请求，主进程和service负责原始数据的获取和网络数据的传输，最后主进程通过ipc通信向对应的渲染进程返回处理结果，service拿到的网络数据也通过回调事件发送给渲染进程。项目中我把mobx store作为和主进程通信的桥梁，mobx store向主进程发送信号，同时也在接收到主进程的ipc通信事件后再把主进程发回来的数据更新到各个observer。总之主进程和service服务负责系统交互、原始数据获取和传输，渲染进程mobx store负责响应信号和事件进行业务数据更新，各个view子组件只负责页面渲染和用户交互。\n\n\n#### 前端代码热更新\n1. webpack.config.js中启动webpack-dev-server的热更新功能\n\n```js\ndevServer: {\n    host: 'localhost',\n    port: 3000,\n    historyApiFallback: true,\n    hot: true,\n  },\n```\n2. 使用`react-hot-loader`的AppContainer组件\n\n```js\nimport { AppContainer } from 'react-hot-loader';\n\nimport 'semantic-ui-css/semantic.min.css';\nimport './styles/public.css';\n\nimport App from './App';\n\nrender(\n  <AppContainer>\n    <App />\n  </AppContainer>,\n  document.getElementById('root')\n);\n```\n### Linux桌面客户端开发遇到的问题\n-------------------------------------------------------\n#### 使用node.js子进程child_process执行shell脚本时无法取得系统root权限\n项目中有的脚本需要使用root权限，比如安装和卸载软件、扫描系统关键路径，node.js里执行shell脚本可以使用child_process模块(node.js子进程)，child_process有几个方法，`spawn`、`exec`、`execFile`、`fork`，它们都能创建子进程以执行指定文件或命令，具体的使用方法见[Node API](http://nodejs.cn/api/child_process.html#child_process_asynchronous_process_creation)，如果我们的脚本或指令需要使用root权限那可就麻烦了，桌面应用又不是终端，不可能用着用着让用户去终端输入密码吧，况且只是在开发环境下能看到终端输出，应用打包安装运行起来后就是一个独立的应用程序了，根本没法输入终端密码，仔细查阅了Electron官网API发现electron官方并没有集成一个什么系统权限调用窗口之类的组件。没办法了，这种情况下手动写出了两种方法：\n1. 调用获取系统权限的系统自带组件来执行自定义命令和脚本\n2. 封装一个弹窗组件来获取用户首次输入的密码，然后手动把密码记录到文件中，应用启动的时候从文件中读出密码，在使用child_process创建子进程的时候再监听子进程的输出事件和错误事件，然后把读取到的保存在内存中的密码以输入流(input stream)的形式发送给child_process创建的子进程，子进程读取到输入流传入的密码后就能继续执行了。  \n\n![electron_pssword.png](/blogs/img/article/mobx9.png)\n\n![install_permission.png](/blogs/img/article/mobx10.png)\n\n\n__具体代码见__：[github/nojsja/electronux/app/utils/sudo-prompt.js](/blogs/img/article/mobx10.png)  \n\n_感谢阅读，文章中出现的错误之处还请多指正~_  \n\n### 未完待续\n","source":"_posts/Electron+Mobx+React开发记录(一).md","raw":"---\ntitle: \"Electron+Mobx+React开发记录\"\ncatalog: true\ntoc_nav_num: true\ndate:   2019-10-14 16:18:46\nsubtitle: \"Electron Mobx React\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- ES6\n- React\n- Mobx\n- Electron\ncatagories:\n- Mobx\n- Electron\nupdateDate: 2019-10-14 16:18:46\ntop: 1\n---\n\n![Hello World](/blogs/img/article/Fly.jpg)\n\n### Contents\n1. 前言\n2. 开发环境搭建\n3. 引入Webpack4.0前端打包工具\n4. Electron代码结构和代码热更新\n5. 前端界面React + Mobx 代码结构和热更新\n6. Linux桌面客户端开发遇到的问题\n\n### 前言\n-----------\n最近桌面系统从Ubuntu18.04切换到了Manjaro Linux 17，之前听说Manjaro的软件丰富，仓库更新及时，很多常用软件都能一键安装(比如QQ，微信)，同时也支持主流的Linux桌面环境：Gnome、KDE、Cinnamon、Mate、Deepin等等，安装了Gnome版本的Manjaro之后发现果然还不错。系统安装好后配置比较繁琐，就想给Manjaro写一个GUI客户端工具用于安装常用软件和作为简单的系统管理工具 - [electronux](https://github.com/NoJsJa/electronux.git)\n作为一名正直的前端开发人员，理所应当地就准备使用Electron + Node.js + React + Mobx + Webpack + Shell 来进行开发啦 ~ 目前仍然在开发中，这篇文章用于记录自己的环境搭建过程、一些对Electron+React开发的理解以及谈谈自己遇到的一些Linux桌面软件开发时遇到的问题和解决办法。\n\n![clean_detail.png](/blogs/img/article/mobx1.png)\n\n![clean_search.png](/blogs/img/article/mobx2.png)\n\n![electron_pssword.png](/blogs/img/article/mobx3.png)\n\n![info_total.png](/blogs/img/article/mobx4.png)\n\n![install_detail.png](/blogs/img/article/mobx5.png)\n\n![install_list.png](/blogs/img/article/mobx6.png)\n\n![install_permission.png](/blogs/img/article/mobx7.png)\n\n![startup_list.png](/blogs/img/article/mobx8.png)\n\n### 开发环境搭建\n------------------------\n#### 代码目录结构\n```sh\nelectronux  \n|---- [dir ] app ( 主代码目录 )\n|----------- [dir ] app/configure ( 应用配置更新 )\n|----------- [dir ] app/runtime ( 运行数据文件 )\n|\n|----------- [dir ] app/services ( 后台服务存放目录 )\n|------------------------ [dir ] app/services/middleware ( 一些中间处理件 )\n|------------------------ [dir ] app/services/shell ( shell脚本存放目录 )\n|------------------------ [dir ] app/services/main-serv ( 主进程服务 )\n|------------------------ [dir ] app/services/render-serv ( 渲染进程服务 )\n|\n|----------- [dir ] app/stores ( 前端状态管理文件目录 )\n|----------- [dir ] app/styles  ( 公用样式表文件 )\n|----------- [dir ] app/utils  ( 公用工具函数 )\n|\n|----------- [dir ] app/views  ( UI界面代码 )\n|------------------------ [dir ] app/views/module1  ( 界面模块1 )\n|------------------------ [dir ] app/views/module2  ( 界面模块2)\n|------------------------ [dir ] app/views/module3  ( 界面模块3 )\n|\n|----------- [file] app/App.js  ( 前端应用入口文件 )\n|----------- [file] app/index.js ( 前端应用热加载文件 )\n|\n|---- [dir ] dist ( 前端代码编译打包文件存放目录 )\n|---- [dir ] resources ( 前端静态资源存放目录 )\n|\n|---- [file] .babelrc ( babel配置文件 )\n|---- [file] .editorconfig (编辑器编码规范文件)\n|---- [file] .eslintrc ( 代码格式检查配置文件 )\n|---- [file] .gitignore ( git忽略追踪配置文件 )\n|---- [file] electron-builder.json ( electron-builder打包配置文件 )\n|---- [file] index.html  ( 应用渲染入口页面 )\n|---- [file] index.js ( 应用主进程入口文件 )\n|---- [file] package.json (前端模块和框架配置文件)\n|---- [file] webpack.config.js (webpack开发环境配置文件)\n|---- [file] webpack.prod.config.js  ( webpack生产环境配置文件 )\n\n```\n\n#### 项目环境依赖配置文件\n```json\n{\n  \"name\": \"electronux\",\n  \"description\": \"linux manager-software powered by electron & react & Mobx \",\n  \"version\": \"1.0.0\",\n  \"author\": {\n    \"name\": \"NoJsJa\",\n    \"email\": \"yangwei020154@gmail.com\"\n  },\n  \"scripts\": {\n    \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",\n    \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",\n    \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron --inspect=5858 index'\",\n    \"start-production\": \"cross-env NODE_ENV=production electron --inspect=5858 index\",\n    \"build-all\": \"npm run dist && npm run build\",\n    \"dist\": \"cross-env NODE_ENV=production webpack --config webpack.prod.config.js\",\n    \"build\": \"electron-builder -l\"\n  },\n  \"keywords\": [\n    \"electron\",\n    \"react\",\n    \"mobx\",\n    \"react-router\",\n    \"webpack4\"\n  ],\n  \"license\": \"\",\n  \"nodemonConfig\": {\n    \"ignore\": [\n      \"resources/*\",\n      \"node_modules/*\",\n      \"dist/*\",\n      \"build/*\",\n      \"app/stores/*\",\n      \"app/styles/*\",\n      \"app/services/shell/*\",\n      \"app/configure/view.conf\",\n      \"app/views/*\",\n      \"app/App.js\",\n      \"app/main.js\",\n      \"app/index.js\",\n      \"electron-builder.yml\"\n    ],\n    \"delay\": \"1000\"\n  },\n  \"dependencies\": {\n    \"semantic-ui-css\": \"^2.4.0\",\n    \"semantic-ui-react\": \"^0.82.5\",\n    \"mobx\": \"^4.4.1\",\n    \"mobx-react\": \"^5.2.8\",\n    \"prop-types\": \"^15.6.2\",\n    \"react\": \"^16.5.1\",\n    \"react-dom\": \"^16.5.1\",\n    \"react-hot-loader\": \"^4.3.8\",\n    \"react-router\": \"^4.3.1\",\n    \"react-router-dom\": \"^4.3.1\",\n    \"history\": \"^4.7.2\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^6.26.3\",\n    \"babel-eslint\": \"^10.0.1\",\n    \"babel-loader\": \"^7.1.5\",\n    \"babel-plugin-transform-decorators-legacy\": \"^1.3.5\",\n    \"babel-preset-env\": \"^1.7.0\",\n    \"babel-preset-es2015\": \"^6.24.1\",\n    \"babel-preset-react\": \"^6.24.1\",\n    \"babel-preset-stage-0\": \"^6.24.1\",\n    \"clean-webpack-plugin\": \"^0.1.19\",\n    \"concurrently\": \"^3.6.1\",\n    \"cross-env\": \"^5.2.0\",\n    \"css-loader\": \"^0.28.11\",\n    \"electron\": \"^2.0.9\",\n    \"electron-builder\": \"^20.28.4\",\n    \"eslint\": \"^5.6.1\",\n    \"eslint-config-airbnb\": \"^17.1.0\",\n    \"eslint-plugin-import\": \"^2.14.0\",\n    \"eslint-plugin-jsx-a11y\": \"^6.1.2\",\n    \"eslint-plugin-react\": \"^7.11.1\",\n    \"extract-text-webpack-plugin\": \"^4.0.0-beta.0\",\n    \"file-loader\": \"^2.0.0\",\n    \"html-loader\": \"^0.5.5\",\n    \"html-webpack-plugin\": \"^3.2.0\",\n    \"node-sass\": \"^4.9.4\",\n    \"nodemon\": \"^1.18.4\",\n    \"sass-loader\": \"^7.1.0\",\n    \"source-map-support\": \"^0.5.9\",\n    \"style-loader\": \"^0.21.0\",\n    \"url-loader\": \"^1.1.2\",\n    \"webpack\": \"^4.19.0\",\n    \"webpack-cli\": \"^2.1.5\",\n    \"webpack-dev-server\": \"^3.1.8\"\n  }\n}\n\n```\n\n### 引入Webpack4.0前端打包工具\n---------------------------------------------\n\n#### webpack开发环境配置文件\n```js\nconst path = require('path');\nconst webpack = require('webpack');\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\nconst ExtractTextPlugin = require('extract-text-webpack-plugin');\n\n// 拆分样式文件\nconst extractSass = new ExtractTextPlugin({\n  filename: 'style.scss.css',\n});\n\nconst extractCss = new ExtractTextPlugin({\n  filename: 'style.css',\n});\n\nmodule.exports = {\n  devtool: 'source-map',\n  entry: [\n    'react-hot-loader/patch',\n    'webpack-dev-server/client?http://localhost:3000',\n    'webpack/hot/only-dev-server',\n    './app/index',\n  ],\n  mode: 'development',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n    publicPath: '/',\n  },\n  resolve: {\n    alias: {\n      resources: path.resolve(__dirname, 'resources'),\n      app: path.resolve(__dirname, 'app'),\n    },\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        use: ['babel-loader'],\n      },\n      {\n        test: /\\.css$/,\n        use: extractCss.extract({\n          fallback: 'style-loader',\n          use: 'css-loader',\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.scss$/,\n        use: extractSass.extract({\n          use: [{\n            loader: 'css-loader',\n          }, {\n            loader: 'sass-loader',\n          }],\n          fallback: 'style-loader', // 在开发环境使用 style-loader\n          publicPath: '/',\n        }),\n      },\n      {\n        test: /\\.html$/,\n        use: {\n          loader: 'html-loader',\n        },\n      },\n      {\n        test: /\\.(png|jpg|gif|svg|ico|woff|eot|ttf|woff2)$/,\n        use: [\n          {\n            loader: 'file-loader',\n            options: {\n              name: '[path][name].[ext]',\n            },\n          },\n        ],\n      },\n    ],\n  },\n\n  plugins: [\n    extractSass,\n    extractCss,\n    new webpack.HotModuleReplacementPlugin(),\n    new CleanWebpackPlugin(['dist']),\n    new webpack.NamedModulesPlugin(),\n    new webpack.NoEmitOnErrorsPlugin(),\n  ],\n\n  devServer: {\n    host: 'localhost',\n    port: 3000,\n    historyApiFallback: true,\n    hot: true,\n  },\n  target: 'electron-renderer',\n};\n\n```\n\n### Electron基本原理和代码热更新\n----------------------------------------------\n> Electron 运行 package.json 的 main 脚本的进程被称为主进程。 在主进程中运行的脚本通过创建web页面来展示用户界面。 一个 Electron 应用总是有且只有一个主进程。\n由于 Electron 使用了 Chromium 来展示 web 页面，所以 Chromium 的多进程架构也被使用到。 每个 Electron 中的 web 页面运行在它自己的渲染进程中。\n在普通的浏览器中，web页面通常在一个沙盒环境中运行，不被允许去接触原生的资源。 然而 Electron 的用户在 Node.js 的 API 支持下可以在页面中和操作系统进行一些底层交互。\n进程使用 BrowserWindow 实例创建页面。 每个 BrowserWindow 实例都在自己的渲染进程里运行页面。 当一个 BrowserWindow 实例被销毁后，相应的渲染进程也会被终止。\n主进程管理所有的web页面和它们对应的渲染进程。 每个渲染进程都是独立的，它只关心它所运行的 web 页面。\n在页面中调用与 GUI 相关的原生 API 是不被允许的，因为在 web 页面里操作原生的 GUI 资源是非常危险的，而且容易造成资源泄露。 如果你想在 web 页面里使用 GUI 操作，其对应的渲染进程必须与主进程进行通讯，请求主进程进行相关的 GUI 操作。\n\n#### 创建主进程\n在index.js文件中我们引入electron和所有的自定义模块文件，并根据开发环境或是生产环境来进行主进程窗口加载，开发环境下使用`http协议`加载由webpack-dev-server启动的http服务，生产环境下使用`file协议`加载本地由webpack打包好的前端bundle.js文件，所以开发环境下`npm start`指令其实主要是执行了两步操作，一是启动webpack-dev-server，此时已经可以通过外部浏览器访问到localhost:3000的http服务，只不过我们实际是用electron之中的chromium浏览器来加载的，它与node.js主进程共享同一个chrome v8引擎，所以理论上，在页面加载后，你同样可以在渲染进程中使用node.js API，比如用使用fs模块访问文件系统。\n\n#### 主进程代码热更新\n我用了nodemon工具实现了主进程代码热更新，如果不用nodemon工具那么 `npm start-electron`命令实际是执行`cross-env NODE_ENV=development electron index`，就是简单的用electron启动主进程文件，使用nodemon之后`npm start-electron`实际上是执行`nodemon --exec 'cross-env NODE_ENV=development electron index'`，最后在package.json文件中增加一个nodemonConfig字段用于指定哪些文件需要纳入nodemon监听即可。\n\n=> package.json中定义的启动脚本：\n```json\n  \"scripts\": {\n    \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",\n    \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",\n    \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron index'\",\n    \"build\": \"npm run dist && npm run build-all\",\n    \"dist\": \"cross-env NODE_ENV=production webpack  --config webpack.production.config.js\",\n    \"build-all\": \"build -lmw\"\n  },\n```\n\n=> package.json中nodemonConfig字段\n```json\n\"nodemonConfig\": {\n    \"ignore\": [\n      \"resources/*\",\n      \"node_modules/*\",\n      \"dist/*\",\n      \"app/stores/*\",\n      \"app/styles/*\",\n      \"app/services/shell/*\",\n      \"app/configure/view.conf\",\n      \"app/views/*\",\n      \"app/App.js\",\n      \"app/main.js\",\n      \"app/index.js\"\n    ],\n    \"delay\": \"1000\"\n  },\n```\n\n=> 项目启动文件index.js：\n```js\n...\n// 根据运行环境加载窗口 //\nfunction loadWindow(window, env) {\n  if (env === 'development') {\n    // wait for webpack-dev-server start\n    setTimeout(() => {\n      window.loadURL(url.format({\n        pathname: 'localhost:3000',\n        protocol: 'http:',\n        slashes: true,\n      }));\n      // window.webContents.openDevTools();\n    }, 1e3);\n  } else {\n    window.loadURL(url.format({\n      pathname: path.join(path.resolve(__dirname, './dist'), 'index.html'),\n      protocol: 'file:',\n      slashes: true,\n    }));\n  }\n}\n\n/* ------------------- main window ------------------- */\n\nfunction createWindow() {\n  const { width, height } = getAppConf();\n  win = new BrowserWindow({\n    width,\n    height,\n    title: 'electronux',\n    autoHideMenuBar: true,\n  });\n\n  win.on('resize', () => {\n    const [_width, _height] = win.getContentSize();\n    viewConf.set({\n      width: _width,\n      height: _height,\n    });\n  });\n\n  loadWindow(win, nodeEnv);\n}\n\n/* ------------------- electron event ------------------- */\n\napp.on('ready', () => {\n  if (nodeEnv === 'development') {\n    sourceMapSupport.install();\n  }\n  createWindow();\n});\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n\napp.on('will-quit', () => {\n  viewConf.write().then(() => 0, (err) => {\n    console.error(err);\n    throw new Error('App quit: view-conf write error !');\n  });\n});\n\napp.on('activate', () => {\n  if (win === null) {\n    createWindow();\n  }\n});\n```\n\n### 前端界面React + Mobx 代码结构和热更新\n-------------------------------------------------------------\n\n#### 代码结构\n1. App.js前端入口文件\n入口文件基本是整个前端应用的关键点，我们使用`mobx-react`包提供的Provider组件加载整个应用，并把各个应用模块(按功能划分)的mobx store示例作为props属性传入Provider，在各个组建中使用修饰器`@inject`就能直接使用store实例了，页面层次比较多的话最好使用React Router进行路由管理，值得注意的是React Router V4版本跟之前版本的理念和使用方式有很大区别，可以去官网查阅相关文档[react-router4](https://reacttraining.com/react-router/web/guides/quick-start)\n\n```js\n/* ------------------- export global history ------------------- */\nexport const history = createHistory();\n\nconst stores = {\n  install: new InstallState(),\n  startup: new StartupState(),\n  info: new InfoState(),\n  clean: new CleanState(),\n  pub: new PublicState(),\n};\n\nfunction App() {\n  return (\n    <Provider {...stores}>\n      <Router history={history}>\n        <Route path=\"/\" component={HomePage} />\n      </Router>\n    </Provider>\n  );\n}\n\n/* ------------------- export provider ------------------- */\nexport default App;\n\n```\n\n2. mobx store 存储\n这是项目其中一个系统清理模块的mobx store，在store中被mobx监听的属性最好结构层次简单、只有单一的功能划分，不要把一个属性对象的嵌套写得太深。开发时我们把UI界面的数据抽象成store中的数据时可能会下意识地根据页面显示状态而把单个属性对象写得过于复杂，但其实页面显示状态只是逻辑的数据结构，我们在store中存储的时候应该尽量将这种逻辑数据结构`翻译`成扁平化的数据结构，然后再在各个属性对象之间建立映射关系。\n并且使用了mobx之后请尽量依赖mobx的数据引用监听自动更新特性，多写`computed`、`autorun`来自动生成数据，使用`action`修饰一些需要更改store属性的方法。\n\n```js\nclass Clean {\n  constructor() { }\n  /* ------------------- observable ------------------- */\n\n  // 所有检查项目 //\n  @observable items = {\n    appCache: false,\n    appLog: false,\n    trash: false,\n    packageCache: false,\n  };\n\n  // 主界面加载 //\n  @observable loadingMain = false;\n\n  // 清理路径 //\n  cleanPaths = {\n    appCache: [`/home/${this.userinfo.username}/.cache`],\n    appLog: ['/var/log/'],\n    trash: [`/home/${this.userinfo.username}/.local/share/Trash/files`],\n    packageCache: ['/var/cache/pacman/pkg'],\n  }\n\n  // 路径模块映射 //\n  @observable cleanPathMap = {\n    appCache: [], // '/var/log/pacman.log'\n    appLog: [],\n    trash: [],\n    packageCache: [],\n  }\n\n  // 清理内容 //\n  @observable cleanContents = observable.map({})\n\n  // 清理大小 //\n  cleanSizes = {\n    // '/var/log//pacman.log': '10kb',\n  }\n\n  // ---- 清理选项细节-数据对象逻辑树结构 ---- //\n  // @observable cleanDetails = {\n  //   appCache: {\n  //     url: [`/home/${this.userinfo.username}/.cache`], // 指定扫描路径多个\n  //     contents: { // 绝对路径\n  //       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': false,\n  //     },\n  //     size: {\n  //       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': '10kb',\n  //     },\n  //   },\n  //   appLog: {\n  //     url: ['/var/log/'],\n  //     contents: {\n  //       // '/var/log//pacman.log': false,\n  //     },\n  //     size: {\n  //       // '/var/log//pacman.log': '10kb',\n  //     },\n  //   }\n  // }\n\n  /* ------------------- static ------------------- */\n\n\n  /* ------------------- computed ------------------- */\n\n  // 获取所有被选中的detail item //\n  @computed get allCheckedDetail() {\n    const a = [];\n    this.cleanContents.forEach((v, k) => {\n      if (v) a.push(k);\n    });\n    return a;\n  }\n\n  // 清理路径详细信息 //\n  @computed get cleanDetail() {\n    const result = [];\n    Object.keys(this.cleanPathMap).forEach((item) => {\n      if (this.items[item]) {\n        const oneResult = {\n          label: item,\n          contents: [],\n        };\n        this.cleanPathMap[item].forEach((it) => {\n          oneResult.contents.push({\n            content: it,\n            size: this.cleanSizes[it] || 0,\n          });\n        });\n\n        result.push(oneResult);\n      }\n    });\n\n    return result;\n  }\n}\n\nexport default Clean;\n\n```\n\n3. 页面组件划分\n在views目录下创建的各个目录都是一个单独的组件目录，组件目录下有一个组件入口文件和css样式表文件以及其它子组件，入口文件载入css文件和子组件，使用`@inject`修饰器后各个组件都可以独立访问mobx store实例，不必在父和子组件之间通过props进行逐级参数传递，但是如果一个子组件依赖父组件来加工原始数据的话也可以使用props传递参数。\n使用了mobx之后，并不是说每个页面需要使用的数据都有必要纳入mobx store的管理，在我的代码中只是把`关键性数据`以及`关键性数据加工方法`存入了store中，每个组件拿到store传递下来的数据后一些页面状态可能需要依赖组件各自的数据处理函数进行数据二次加工，我觉得这样应该会减轻store实例的负载压力，非绝对中心化。比如在一个列表菜单组件中，这个组件的列表数据可以切换显示和隐藏，但是控制这个列表显示/隐藏的参数状态`visible`没有必要纳入store实例管理，相对的管理这个列表组件的store实例只是存储了列表数据的数组，以及一些必要的数据加工方法。\n\n4. 渲染进程和主进程ipc通信的问题\n页面的每个渲染进程(ipcRender)，虽然说可以直接使用node.js原生模块和api，但是不建议在渲染进程中过度使用原生模块，一是因为一些node.js原生模块并没有考虑到进程安全的问题，第二个原因是渲染进程应该专注处理页面交互和数据处理问题，划清代码的功能区域，把和系统交互的问题交由主进程(ipcMain)处理，把网络数据请求也交由各自的service服务，减少不必要的模块和数据耦合。渲染进程通过ipc通信向主进程发送处理请求，主进程和service负责原始数据的获取和网络数据的传输，最后主进程通过ipc通信向对应的渲染进程返回处理结果，service拿到的网络数据也通过回调事件发送给渲染进程。项目中我把mobx store作为和主进程通信的桥梁，mobx store向主进程发送信号，同时也在接收到主进程的ipc通信事件后再把主进程发回来的数据更新到各个observer。总之主进程和service服务负责系统交互、原始数据获取和传输，渲染进程mobx store负责响应信号和事件进行业务数据更新，各个view子组件只负责页面渲染和用户交互。\n\n\n#### 前端代码热更新\n1. webpack.config.js中启动webpack-dev-server的热更新功能\n\n```js\ndevServer: {\n    host: 'localhost',\n    port: 3000,\n    historyApiFallback: true,\n    hot: true,\n  },\n```\n2. 使用`react-hot-loader`的AppContainer组件\n\n```js\nimport { AppContainer } from 'react-hot-loader';\n\nimport 'semantic-ui-css/semantic.min.css';\nimport './styles/public.css';\n\nimport App from './App';\n\nrender(\n  <AppContainer>\n    <App />\n  </AppContainer>,\n  document.getElementById('root')\n);\n```\n### Linux桌面客户端开发遇到的问题\n-------------------------------------------------------\n#### 使用node.js子进程child_process执行shell脚本时无法取得系统root权限\n项目中有的脚本需要使用root权限，比如安装和卸载软件、扫描系统关键路径，node.js里执行shell脚本可以使用child_process模块(node.js子进程)，child_process有几个方法，`spawn`、`exec`、`execFile`、`fork`，它们都能创建子进程以执行指定文件或命令，具体的使用方法见[Node API](http://nodejs.cn/api/child_process.html#child_process_asynchronous_process_creation)，如果我们的脚本或指令需要使用root权限那可就麻烦了，桌面应用又不是终端，不可能用着用着让用户去终端输入密码吧，况且只是在开发环境下能看到终端输出，应用打包安装运行起来后就是一个独立的应用程序了，根本没法输入终端密码，仔细查阅了Electron官网API发现electron官方并没有集成一个什么系统权限调用窗口之类的组件。没办法了，这种情况下手动写出了两种方法：\n1. 调用获取系统权限的系统自带组件来执行自定义命令和脚本\n2. 封装一个弹窗组件来获取用户首次输入的密码，然后手动把密码记录到文件中，应用启动的时候从文件中读出密码，在使用child_process创建子进程的时候再监听子进程的输出事件和错误事件，然后把读取到的保存在内存中的密码以输入流(input stream)的形式发送给child_process创建的子进程，子进程读取到输入流传入的密码后就能继续执行了。  \n\n![electron_pssword.png](/blogs/img/article/mobx9.png)\n\n![install_permission.png](/blogs/img/article/mobx10.png)\n\n\n__具体代码见__：[github/nojsja/electronux/app/utils/sudo-prompt.js](/blogs/img/article/mobx10.png)  \n\n_感谢阅读，文章中出现的错误之处还请多指正~_  \n\n### 未完待续\n","slug":"Electron+Mobx+React开发记录(一)","published":1,"updated":"2020-03-22T10:28:40.579Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxmw0006a895jzrkeofr","content":"<p><img src=\"/blogs/img/article/Fly.jpg\" alt=\"Hello World\"></p>\n<h3 id=\"contents\">Contents</h3>\n<ol>\n<li>前言</li>\n<li>开发环境搭建</li>\n<li>引入Webpack4.0前端打包工具</li>\n<li>Electron代码结构和代码热更新</li>\n<li>前端界面React + Mobx 代码结构和热更新</li>\n<li>Linux桌面客户端开发遇到的问题</li>\n</ol>\n<h3 id=\"前言\">前言</h3>\n<hr>\n<p>最近桌面系统从Ubuntu18.04切换到了Manjaro Linux 17，之前听说Manjaro的软件丰富，仓库更新及时，很多常用软件都能一键安装(比如QQ，微信)，同时也支持主流的Linux桌面环境：Gnome、KDE、Cinnamon、Mate、Deepin等等，安装了Gnome版本的Manjaro之后发现果然还不错。系统安装好后配置比较繁琐，就想给Manjaro写一个GUI客户端工具用于安装常用软件和作为简单的系统管理工具 - <a href=\"https://github.com/NoJsJa/electronux.git\" target=\"_blank\" rel=\"noopener\">electronux</a><br>\n作为一名正直的前端开发人员，理所应当地就准备使用Electron + Node.js + React + Mobx + Webpack + Shell 来进行开发啦 ~ 目前仍然在开发中，这篇文章用于记录自己的环境搭建过程、一些对Electron+React开发的理解以及谈谈自己遇到的一些Linux桌面软件开发时遇到的问题和解决办法。</p>\n<p><img src=\"/blogs/img/article/mobx1.png\" alt=\"clean_detail.png\"></p>\n<p><img src=\"/blogs/img/article/mobx2.png\" alt=\"clean_search.png\"></p>\n<p><img src=\"/blogs/img/article/mobx3.png\" alt=\"electron_pssword.png\"></p>\n<p><img src=\"/blogs/img/article/mobx4.png\" alt=\"info_total.png\"></p>\n<p><img src=\"/blogs/img/article/mobx5.png\" alt=\"install_detail.png\"></p>\n<p><img src=\"/blogs/img/article/mobx6.png\" alt=\"install_list.png\"></p>\n<p><img src=\"/blogs/img/article/mobx7.png\" alt=\"install_permission.png\"></p>\n<p><img src=\"/blogs/img/article/mobx8.png\" alt=\"startup_list.png\"></p>\n<h3 id=\"开发环境搭建\">开发环境搭建</h3>\n<hr>\n<h4 id=\"代码目录结构\">代码目录结构</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electronux  </span><br><span class=\"line\">|---- [dir ] app ( 主代码目录 )</span><br><span class=\"line\">|----------- [dir ] app/configure ( 应用配置更新 )</span><br><span class=\"line\">|----------- [dir ] app/runtime ( 运行数据文件 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/services ( 后台服务存放目录 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/middleware ( 一些中间处理件 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/shell ( shell脚本存放目录 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/main-serv ( 主进程服务 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/render-serv ( 渲染进程服务 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/stores ( 前端状态管理文件目录 )</span><br><span class=\"line\">|----------- [dir ] app/styles  ( 公用样式表文件 )</span><br><span class=\"line\">|----------- [dir ] app/utils  ( 公用工具函数 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/views  ( UI界面代码 )</span><br><span class=\"line\">|------------------------ [dir ] app/views/module1  ( 界面模块1 )</span><br><span class=\"line\">|------------------------ [dir ] app/views/module2  ( 界面模块2)</span><br><span class=\"line\">|------------------------ [dir ] app/views/module3  ( 界面模块3 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [file] app/App.js  ( 前端应用入口文件 )</span><br><span class=\"line\">|----------- [file] app/index.js ( 前端应用热加载文件 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|---- [dir ] dist ( 前端代码编译打包文件存放目录 )</span><br><span class=\"line\">|---- [dir ] resources ( 前端静态资源存放目录 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|---- [file] .babelrc ( babel配置文件 )</span><br><span class=\"line\">|---- [file] .editorconfig (编辑器编码规范文件)</span><br><span class=\"line\">|---- [file] .eslintrc ( 代码格式检查配置文件 )</span><br><span class=\"line\">|---- [file] .gitignore ( git忽略追踪配置文件 )</span><br><span class=\"line\">|---- [file] electron-builder.json ( electron-builder打包配置文件 )</span><br><span class=\"line\">|---- [file] index.html  ( 应用渲染入口页面 )</span><br><span class=\"line\">|---- [file] index.js ( 应用主进程入口文件 )</span><br><span class=\"line\">|---- [file] package.json (前端模块和框架配置文件)</span><br><span class=\"line\">|---- [file] webpack.config.js (webpack开发环境配置文件)</span><br><span class=\"line\">|---- [file] webpack.prod.config.js  ( webpack生产环境配置文件 )</span><br></pre></td></tr></table></figure>\n<h4 id=\"项目环境依赖配置文件\">项目环境依赖配置文件</h4>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"linux manager-software powered by electron &amp; react &amp; Mobx \"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"NoJsJa\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"yangwei020154@gmail.com\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-electron\"</span>: <span class=\"string\">\"nodemon --exec 'cross-env NODE_ENV=development electron --inspect=5858 index'\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-production\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production electron --inspect=5858 index\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build-all\"</span>: <span class=\"string\">\"npm run dist &amp;&amp; npm run build\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dist\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production webpack --config webpack.prod.config.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"electron-builder -l\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"keywords\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"electron\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"react\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"mobx\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"react-router\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"webpack4\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"nodemonConfig\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"ignore\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"resources/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"node_modules/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"dist/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"build/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/stores/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/styles/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/services/shell/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/configure/view.conf\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/views/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/App.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/main.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/index.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"electron-builder.yml\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"delay\"</span>: <span class=\"string\">\"1000\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"dependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"semantic-ui-css\"</span>: <span class=\"string\">\"^2.4.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"semantic-ui-react\"</span>: <span class=\"string\">\"^0.82.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"mobx\"</span>: <span class=\"string\">\"^4.4.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"mobx-react\"</span>: <span class=\"string\">\"^5.2.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"prop-types\"</span>: <span class=\"string\">\"^15.6.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react\"</span>: <span class=\"string\">\"^16.5.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-dom\"</span>: <span class=\"string\">\"^16.5.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-hot-loader\"</span>: <span class=\"string\">\"^4.3.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-router\"</span>: <span class=\"string\">\"^4.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-router-dom\"</span>: <span class=\"string\">\"^4.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"history\"</span>: <span class=\"string\">\"^4.7.2\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel-core\"</span>: <span class=\"string\">\"^6.26.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-eslint\"</span>: <span class=\"string\">\"^10.0.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-loader\"</span>: <span class=\"string\">\"^7.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-plugin-transform-decorators-legacy\"</span>: <span class=\"string\">\"^1.3.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-env\"</span>: <span class=\"string\">\"^1.7.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-es2015\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-react\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-stage-0\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"clean-webpack-plugin\"</span>: <span class=\"string\">\"^0.1.19\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"concurrently\"</span>: <span class=\"string\">\"^3.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"cross-env\"</span>: <span class=\"string\">\"^5.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"css-loader\"</span>: <span class=\"string\">\"^0.28.11\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron\"</span>: <span class=\"string\">\"^2.0.9\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron-builder\"</span>: <span class=\"string\">\"^20.28.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint\"</span>: <span class=\"string\">\"^5.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-config-airbnb\"</span>: <span class=\"string\">\"^17.1.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-import\"</span>: <span class=\"string\">\"^2.14.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-jsx-a11y\"</span>: <span class=\"string\">\"^6.1.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-react\"</span>: <span class=\"string\">\"^7.11.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"extract-text-webpack-plugin\"</span>: <span class=\"string\">\"^4.0.0-beta.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"file-loader\"</span>: <span class=\"string\">\"^2.0.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html-loader\"</span>: <span class=\"string\">\"^0.5.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html-webpack-plugin\"</span>: <span class=\"string\">\"^3.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"node-sass\"</span>: <span class=\"string\">\"^4.9.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"nodemon\"</span>: <span class=\"string\">\"^1.18.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sass-loader\"</span>: <span class=\"string\">\"^7.1.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"source-map-support\"</span>: <span class=\"string\">\"^0.5.9\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"style-loader\"</span>: <span class=\"string\">\"^0.21.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"url-loader\"</span>: <span class=\"string\">\"^1.1.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack\"</span>: <span class=\"string\">\"^4.19.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack-cli\"</span>: <span class=\"string\">\"^2.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack-dev-server\"</span>: <span class=\"string\">\"^3.1.8\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"引入webpack40前端打包工具\">引入Webpack4.0前端打包工具</h3>\n<hr>\n<h4 id=\"webpack开发环境配置文件\">webpack开发环境配置文件</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拆分样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractSass = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.scss.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractCss = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  devtool: <span class=\"string\">'source-map'</span>,</span><br><span class=\"line\">  entry: [</span><br><span class=\"line\">    <span class=\"string\">'react-hot-loader/patch'</span>,</span><br><span class=\"line\">    <span class=\"string\">'webpack-dev-server/client?http://localhost:3000'</span>,</span><br><span class=\"line\">    <span class=\"string\">'webpack/hot/only-dev-server'</span>,</span><br><span class=\"line\">    <span class=\"string\">'./app/index'</span>,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: <span class=\"string\">'bundle.js'</span>,</span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">    publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  resolve: &#123;</span><br><span class=\"line\">    alias: &#123;</span><br><span class=\"line\">      resources: path.resolve(__dirname, <span class=\"string\">'resources'</span>),</span><br><span class=\"line\">      app: path.resolve(__dirname, <span class=\"string\">'app'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'babel-loader'</span>],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">        use: &#123;</span><br><span class=\"line\">          loader: <span class=\"string\">'html-loader'</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(png|jpg|gif|svg|ico|woff|eot|ttf|woff2)$/</span>,</span><br><span class=\"line\">        use: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'file-loader'</span>,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">              name: <span class=\"string\">'[path][name].[ext]'</span>,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    extractSass,</span><br><span class=\"line\">    extractCss,</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">'dist'</span>]),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.NamedModulesPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.NoEmitOnErrorsPlugin(),</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: <span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    port: <span class=\"number\">3000</span>,</span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  target: <span class=\"string\">'electron-renderer'</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"electron基本原理和代码热更新\">Electron基本原理和代码热更新</h3>\n<hr>\n<blockquote>\n<p>Electron 运行 package.json 的 main 脚本的进程被称为主进程。 在主进程中运行的脚本通过创建web页面来展示用户界面。 一个 Electron 应用总是有且只有一个主进程。<br>\n由于 Electron 使用了 Chromium 来展示 web 页面，所以 Chromium 的多进程架构也被使用到。 每个 Electron 中的 web 页面运行在它自己的渲染进程中。<br>\n在普通的浏览器中，web页面通常在一个沙盒环境中运行，不被允许去接触原生的资源。 然而 Electron 的用户在 Node.js 的 API 支持下可以在页面中和操作系统进行一些底层交互。<br>\n进程使用 BrowserWindow 实例创建页面。 每个 BrowserWindow 实例都在自己的渲染进程里运行页面。 当一个 BrowserWindow 实例被销毁后，相应的渲染进程也会被终止。<br>\n主进程管理所有的web页面和它们对应的渲染进程。 每个渲染进程都是独立的，它只关心它所运行的 web 页面。<br>\n在页面中调用与 GUI 相关的原生 API 是不被允许的，因为在 web 页面里操作原生的 GUI 资源是非常危险的，而且容易造成资源泄露。 如果你想在 web 页面里使用 GUI 操作，其对应的渲染进程必须与主进程进行通讯，请求主进程进行相关的 GUI 操作。</p>\n</blockquote>\n<h4 id=\"创建主进程\">创建主进程</h4>\n<p>在index.js文件中我们引入electron和所有的自定义模块文件，并根据开发环境或是生产环境来进行主进程窗口加载，开发环境下使用<code>http协议</code>加载由webpack-dev-server启动的http服务，生产环境下使用<code>file协议</code>加载本地由webpack打包好的前端bundle.js文件，所以开发环境下<code>npm start</code>指令其实主要是执行了两步操作，一是启动webpack-dev-server，此时已经可以通过外部浏览器访问到localhost:3000的http服务，只不过我们实际是用electron之中的chromium浏览器来加载的，它与node.js主进程共享同一个chrome v8引擎，所以理论上，在页面加载后，你同样可以在渲染进程中使用node.js API，比如用使用fs模块访问文件系统。</p>\n<h4 id=\"主进程代码热更新\">主进程代码热更新</h4>\n<p>我用了nodemon工具实现了主进程代码热更新，如果不用nodemon工具那么 <code>npm start-electron</code>命令实际是执行<code>cross-env NODE_ENV=development electron index</code>，就是简单的用electron启动主进程文件，使用nodemon之后<code>npm start-electron</code>实际上是执行<code>nodemon --exec 'cross-env NODE_ENV=development electron index'</code>，最后在package.json文件中增加一个nodemonConfig字段用于指定哪些文件需要纳入nodemon监听即可。</p>\n<p>=&gt; package.json中定义的启动脚本：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\">  \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",</span><br><span class=\"line\">  \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",</span><br><span class=\"line\">  \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron index'\",</span><br><span class=\"line\">  \"build\": \"npm run dist &amp;&amp; npm run build-all\",</span><br><span class=\"line\">  \"dist\": \"cross-env NODE_ENV=production webpack  --config webpack.production.config.js\",</span><br><span class=\"line\">  \"build-all\": \"build -lmw\"</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>=&gt; package.json中nodemonConfig字段</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"nodemonConfig\": &#123;</span><br><span class=\"line\">    \"ignore\": [</span><br><span class=\"line\">      \"resources/*\",</span><br><span class=\"line\">      \"node_modules/*\",</span><br><span class=\"line\">      \"dist/*\",</span><br><span class=\"line\">      \"app/stores/*\",</span><br><span class=\"line\">      \"app/styles/*\",</span><br><span class=\"line\">      \"app/services/shell/*\",</span><br><span class=\"line\">      \"app/configure/view.conf\",</span><br><span class=\"line\">      \"app/views/*\",</span><br><span class=\"line\">      \"app/App.js\",</span><br><span class=\"line\">      \"app/main.js\",</span><br><span class=\"line\">      <span class=\"string\">\"app/index.js\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"delay\": \"1000\"</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<p>=&gt; 项目启动文件index.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\">// 根据运行环境加载窗口 //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadWindow</span>(<span class=\"params\">window, env</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (env === <span class=\"string\">'development'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// wait for webpack-dev-server start</span></span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">        pathname: <span class=\"string\">'localhost:3000'</span>,</span><br><span class=\"line\">        protocol: <span class=\"string\">'http:'</span>,</span><br><span class=\"line\">        slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      <span class=\"comment\">// window.webContents.openDevTools();</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">1e3</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">      pathname: path.join(path.resolve(__dirname, <span class=\"string\">'./dist'</span>), <span class=\"string\">'index.html'</span>),</span><br><span class=\"line\">      protocol: <span class=\"string\">'file:'</span>,</span><br><span class=\"line\">      slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- main window ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createWindow</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; width, height &#125; = getAppConf();</span><br><span class=\"line\">  win = <span class=\"keyword\">new</span> BrowserWindow(&#123;</span><br><span class=\"line\">    width,</span><br><span class=\"line\">    height,</span><br><span class=\"line\">    title: <span class=\"string\">'electronux'</span>,</span><br><span class=\"line\">    autoHideMenuBar: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  win.on(<span class=\"string\">'resize'</span>, () =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [_width, _height] = win.getContentSize();</span><br><span class=\"line\">    viewConf.set(&#123;</span><br><span class=\"line\">      width: _width,</span><br><span class=\"line\">      height: _height,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  loadWindow(win, nodeEnv);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- electron event ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nodeEnv === <span class=\"string\">'development'</span>) &#123;</span><br><span class=\"line\">    sourceMapSupport.install();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  createWindow();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.platform !== <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">    app.quit();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'will-quit'</span>, () =&gt; &#123;</span><br><span class=\"line\">  viewConf.write().then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"number\">0</span>, (err) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(err);</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'App quit: view-conf write error !'</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'activate'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (win === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    createWindow();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"前端界面react-mobx-代码结构和热更新\">前端界面React + Mobx 代码结构和热更新</h3>\n<hr>\n<h4 id=\"代码结构\">代码结构</h4>\n<ol>\n<li>App.js前端入口文件<br>\n入口文件基本是整个前端应用的关键点，我们使用<code>mobx-react</code>包提供的Provider组件加载整个应用，并把各个应用模块(按功能划分)的mobx store示例作为props属性传入Provider，在各个组建中使用修饰器<code>@inject</code>就能直接使用store实例了，页面层次比较多的话最好使用React Router进行路由管理，值得注意的是React Router V4版本跟之前版本的理念和使用方式有很大区别，可以去官网查阅相关文档<a href=\"https://reacttraining.com/react-router/web/guides/quick-start\" target=\"_blank\" rel=\"noopener\">react-router4</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ------------------- export global history ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> history = createHistory();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> stores = &#123;</span><br><span class=\"line\">  install: <span class=\"keyword\">new</span> InstallState(),</span><br><span class=\"line\">  startup: <span class=\"keyword\">new</span> StartupState(),</span><br><span class=\"line\">  info: <span class=\"keyword\">new</span> InfoState(),</span><br><span class=\"line\">  clean: <span class=\"keyword\">new</span> CleanState(),</span><br><span class=\"line\">  pub: <span class=\"keyword\">new</span> PublicState(),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;Provider &#123;...stores&#125;&gt;</span><br><span class=\"line\">      &lt;Router history=&#123;history&#125;&gt;</span><br><span class=\"line\">        &lt;Route path=<span class=\"string\">\"/\"</span> component=&#123;HomePage&#125; /&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/Router&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>Provider&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- export provider ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>mobx store 存储<br>\n这是项目其中一个系统清理模块的mobx store，在store中被mobx监听的属性最好结构层次简单、只有单一的功能划分，不要把一个属性对象的嵌套写得太深。开发时我们把UI界面的数据抽象成store中的数据时可能会下意识地根据页面显示状态而把单个属性对象写得过于复杂，但其实页面显示状态只是逻辑的数据结构，我们在store中存储的时候应该尽量将这种逻辑数据结构<code>翻译</code>成扁平化的数据结构，然后再在各个属性对象之间建立映射关系。<br>\n并且使用了mobx之后请尽量依赖mobx的数据引用监听自动更新特性，多写<code>computed</code>、<code>autorun</code>来自动生成数据，使用<code>action</code>修饰一些需要更改store属性的方法。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Clean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123; &#125;</span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- observable ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 所有检查项目 //</span></span><br><span class=\"line\">  @observable items = &#123;</span><br><span class=\"line\">    appCache: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    appLog: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    trash: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    packageCache: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 主界面加载 //</span></span><br><span class=\"line\">  @observable loadingMain = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理路径 //</span></span><br><span class=\"line\">  cleanPaths = &#123;</span><br><span class=\"line\">    appCache: [<span class=\"string\">`/home/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.userinfo.username&#125;</span>/.cache`</span>],</span><br><span class=\"line\">    appLog: [<span class=\"string\">'/var/log/'</span>],</span><br><span class=\"line\">    trash: [<span class=\"string\">`/home/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.userinfo.username&#125;</span>/.local/share/Trash/files`</span>],</span><br><span class=\"line\">    packageCache: [<span class=\"string\">'/var/cache/pacman/pkg'</span>],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 路径模块映射 //</span></span><br><span class=\"line\">  @observable cleanPathMap = &#123;</span><br><span class=\"line\">    appCache: [], <span class=\"comment\">// '/var/log/pacman.log'</span></span><br><span class=\"line\">    appLog: [],</span><br><span class=\"line\">    trash: [],</span><br><span class=\"line\">    packageCache: [],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理内容 //</span></span><br><span class=\"line\">  @observable cleanContents = observable.map(&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理大小 //</span></span><br><span class=\"line\">  cleanSizes = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// '/var/log//pacman.log': '10kb',</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ---- 清理选项细节-数据对象逻辑树结构 ---- //</span></span><br><span class=\"line\">  <span class=\"comment\">// @observable cleanDetails = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   appCache: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     url: [`/home/$&#123;this.userinfo.username&#125;/.cache`], // 指定扫描路径多个</span></span><br><span class=\"line\">  <span class=\"comment\">//     contents: &#123; // 绝对路径</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': false,</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//     size: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': '10kb',</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   appLog: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     url: ['/var/log/'],</span></span><br><span class=\"line\">  <span class=\"comment\">//     contents: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/log//pacman.log': false,</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//     size: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/log//pacman.log': '10kb',</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- static ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- computed ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 获取所有被选中的detail item //</span></span><br><span class=\"line\">  @computed get allCheckedDetail() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> a = [];</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cleanContents.forEach(<span class=\"function\">(<span class=\"params\">v, k</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (v) a.push(k);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理路径详细信息 //</span></span><br><span class=\"line\">  @computed get cleanDetail() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = [];</span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.cleanPathMap).forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.items[item]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oneResult = &#123;</span><br><span class=\"line\">          label: item,</span><br><span class=\"line\">          contents: [],</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.cleanPathMap[item].forEach(<span class=\"function\">(<span class=\"params\">it</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          oneResult.contents.push(&#123;</span><br><span class=\"line\">            content: it,</span><br><span class=\"line\">            size: <span class=\"keyword\">this</span>.cleanSizes[it] || <span class=\"number\">0</span>,</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        result.push(oneResult);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Clean;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>\n<p>页面组件划分<br>\n在views目录下创建的各个目录都是一个单独的组件目录，组件目录下有一个组件入口文件和css样式表文件以及其它子组件，入口文件载入css文件和子组件，使用<code>@inject</code>修饰器后各个组件都可以独立访问mobx store实例，不必在父和子组件之间通过props进行逐级参数传递，但是如果一个子组件依赖父组件来加工原始数据的话也可以使用props传递参数。<br>\n使用了mobx之后，并不是说每个页面需要使用的数据都有必要纳入mobx store的管理，在我的代码中只是把<code>关键性数据</code>以及<code>关键性数据加工方法</code>存入了store中，每个组件拿到store传递下来的数据后一些页面状态可能需要依赖组件各自的数据处理函数进行数据二次加工，我觉得这样应该会减轻store实例的负载压力，非绝对中心化。比如在一个列表菜单组件中，这个组件的列表数据可以切换显示和隐藏，但是控制这个列表显示/隐藏的参数状态<code>visible</code>没有必要纳入store实例管理，相对的管理这个列表组件的store实例只是存储了列表数据的数组，以及一些必要的数据加工方法。</p>\n</li>\n<li>\n<p>渲染进程和主进程ipc通信的问题<br>\n页面的每个渲染进程(ipcRender)，虽然说可以直接使用node.js原生模块和api，但是不建议在渲染进程中过度使用原生模块，一是因为一些node.js原生模块并没有考虑到进程安全的问题，第二个原因是渲染进程应该专注处理页面交互和数据处理问题，划清代码的功能区域，把和系统交互的问题交由主进程(ipcMain)处理，把网络数据请求也交由各自的service服务，减少不必要的模块和数据耦合。渲染进程通过ipc通信向主进程发送处理请求，主进程和service负责原始数据的获取和网络数据的传输，最后主进程通过ipc通信向对应的渲染进程返回处理结果，service拿到的网络数据也通过回调事件发送给渲染进程。项目中我把mobx store作为和主进程通信的桥梁，mobx store向主进程发送信号，同时也在接收到主进程的ipc通信事件后再把主进程发回来的数据更新到各个observer。总之主进程和service服务负责系统交互、原始数据获取和传输，渲染进程mobx store负责响应信号和事件进行业务数据更新，各个view子组件只负责页面渲染和用户交互。</p>\n</li>\n</ol>\n<h4 id=\"前端代码热更新\">前端代码热更新</h4>\n<ol>\n<li>webpack.config.js中启动webpack-dev-server的热更新功能</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devServer: &#123;</span><br><span class=\"line\">    host: <span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    port: <span class=\"number\">3000</span>,</span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>使用<code>react-hot-loader</code>的AppContainer组件</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppContainer &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-hot-loader'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'semantic-ui-css/semantic.min.css'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./styles/public.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./App'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">render(</span><br><span class=\"line\">  &lt;AppContainer&gt;</span><br><span class=\"line\">    &lt;App /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/AppContainer&gt;,</span></span><br><span class=\"line\"><span class=\"regexp\">  document.getElementById('root')</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"linux桌面客户端开发遇到的问题\">Linux桌面客户端开发遇到的问题</h3>\n<hr>\n<h4 id=\"使用nodejs子进程child_process执行shell脚本时无法取得系统root权限\">使用node.js子进程child_process执行shell脚本时无法取得系统root权限</h4>\n<p>项目中有的脚本需要使用root权限，比如安装和卸载软件、扫描系统关键路径，node.js里执行shell脚本可以使用child_process模块(node.js子进程)，child_process有几个方法，<code>spawn</code>、<code>exec</code>、<code>execFile</code>、<code>fork</code>，它们都能创建子进程以执行指定文件或命令，具体的使用方法见<a href=\"http://nodejs.cn/api/child_process.html#child_process_asynchronous_process_creation\" target=\"_blank\" rel=\"noopener\">Node API</a>，如果我们的脚本或指令需要使用root权限那可就麻烦了，桌面应用又不是终端，不可能用着用着让用户去终端输入密码吧，况且只是在开发环境下能看到终端输出，应用打包安装运行起来后就是一个独立的应用程序了，根本没法输入终端密码，仔细查阅了Electron官网API发现electron官方并没有集成一个什么系统权限调用窗口之类的组件。没办法了，这种情况下手动写出了两种方法：</p>\n<ol>\n<li>调用获取系统权限的系统自带组件来执行自定义命令和脚本</li>\n<li>封装一个弹窗组件来获取用户首次输入的密码，然后手动把密码记录到文件中，应用启动的时候从文件中读出密码，在使用child_process创建子进程的时候再监听子进程的输出事件和错误事件，然后把读取到的保存在内存中的密码以输入流(input stream)的形式发送给child_process创建的子进程，子进程读取到输入流传入的密码后就能继续执行了。</li>\n</ol>\n<p><img src=\"/blogs/img/article/mobx9.png\" alt=\"electron_pssword.png\"></p>\n<p><img src=\"/blogs/img/article/mobx10.png\" alt=\"install_permission.png\"></p>\n<p><strong>具体代码见</strong>：<a href=\"/blogs/img/article/mobx10.png\">github/nojsja/electronux/app/utils/sudo-prompt.js</a></p>\n<p><em>感谢阅读，文章中出现的错误之处还请多指正~</em></p>\n<h3 id=\"未完待续\">未完待续</h3>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/Fly.jpg\" alt=\"Hello World\"></p>\n<h3>Contents</h3>\n<ol>\n<li>前言</li>\n<li>开发环境搭建</li>\n<li>引入Webpack4.0前端打包工具</li>\n<li>Electron代码结构和代码热更新</li>\n<li>前端界面React + Mobx 代码结构和热更新</li>\n<li>Linux桌面客户端开发遇到的问题</li>\n</ol>\n<h3>前言</h3>\n<hr>\n<p>最近桌面系统从Ubuntu18.04切换到了Manjaro Linux 17，之前听说Manjaro的软件丰富，仓库更新及时，很多常用软件都能一键安装(比如QQ，微信)，同时也支持主流的Linux桌面环境：Gnome、KDE、Cinnamon、Mate、Deepin等等，安装了Gnome版本的Manjaro之后发现果然还不错。系统安装好后配置比较繁琐，就想给Manjaro写一个GUI客户端工具用于安装常用软件和作为简单的系统管理工具 - <a href=\"https://github.com/NoJsJa/electronux.git\" target=\"_blank\" rel=\"noopener\">electronux</a><br>\n作为一名正直的前端开发人员，理所应当地就准备使用Electron + Node.js + React + Mobx + Webpack + Shell 来进行开发啦 ~ 目前仍然在开发中，这篇文章用于记录自己的环境搭建过程、一些对Electron+React开发的理解以及谈谈自己遇到的一些Linux桌面软件开发时遇到的问题和解决办法。</p>\n<p><img src=\"/blogs/img/article/mobx1.png\" alt=\"clean_detail.png\"></p>\n<p><img src=\"/blogs/img/article/mobx2.png\" alt=\"clean_search.png\"></p>\n<p><img src=\"/blogs/img/article/mobx3.png\" alt=\"electron_pssword.png\"></p>\n<p><img src=\"/blogs/img/article/mobx4.png\" alt=\"info_total.png\"></p>\n<p><img src=\"/blogs/img/article/mobx5.png\" alt=\"install_detail.png\"></p>\n<p><img src=\"/blogs/img/article/mobx6.png\" alt=\"install_list.png\"></p>\n<p><img src=\"/blogs/img/article/mobx7.png\" alt=\"install_permission.png\"></p>\n<p><img src=\"/blogs/img/article/mobx8.png\" alt=\"startup_list.png\"></p>\n<h3>开发环境搭建</h3>\n<hr>\n<h4>代码目录结构</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electronux  </span><br><span class=\"line\">|---- [dir ] app ( 主代码目录 )</span><br><span class=\"line\">|----------- [dir ] app/configure ( 应用配置更新 )</span><br><span class=\"line\">|----------- [dir ] app/runtime ( 运行数据文件 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/services ( 后台服务存放目录 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/middleware ( 一些中间处理件 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/shell ( shell脚本存放目录 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/main-serv ( 主进程服务 )</span><br><span class=\"line\">|------------------------ [dir ] app/services/render-serv ( 渲染进程服务 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/stores ( 前端状态管理文件目录 )</span><br><span class=\"line\">|----------- [dir ] app/styles  ( 公用样式表文件 )</span><br><span class=\"line\">|----------- [dir ] app/utils  ( 公用工具函数 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [dir ] app/views  ( UI界面代码 )</span><br><span class=\"line\">|------------------------ [dir ] app/views/module1  ( 界面模块1 )</span><br><span class=\"line\">|------------------------ [dir ] app/views/module2  ( 界面模块2)</span><br><span class=\"line\">|------------------------ [dir ] app/views/module3  ( 界面模块3 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|----------- [file] app/App.js  ( 前端应用入口文件 )</span><br><span class=\"line\">|----------- [file] app/index.js ( 前端应用热加载文件 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|---- [dir ] dist ( 前端代码编译打包文件存放目录 )</span><br><span class=\"line\">|---- [dir ] resources ( 前端静态资源存放目录 )</span><br><span class=\"line\">|</span><br><span class=\"line\">|---- [file] .babelrc ( babel配置文件 )</span><br><span class=\"line\">|---- [file] .editorconfig (编辑器编码规范文件)</span><br><span class=\"line\">|---- [file] .eslintrc ( 代码格式检查配置文件 )</span><br><span class=\"line\">|---- [file] .gitignore ( git忽略追踪配置文件 )</span><br><span class=\"line\">|---- [file] electron-builder.json ( electron-builder打包配置文件 )</span><br><span class=\"line\">|---- [file] index.html  ( 应用渲染入口页面 )</span><br><span class=\"line\">|---- [file] index.js ( 应用主进程入口文件 )</span><br><span class=\"line\">|---- [file] package.json (前端模块和框架配置文件)</span><br><span class=\"line\">|---- [file] webpack.config.js (webpack开发环境配置文件)</span><br><span class=\"line\">|---- [file] webpack.prod.config.js  ( webpack生产环境配置文件 )</span><br></pre></td></tr></table></figure>\n<h4>项目环境依赖配置文件</h4>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"electronux\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"linux manager-software powered by electron &amp; react &amp; Mobx \"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"author\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"NoJsJa\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"yangwei020154@gmail.com\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-electron\"</span>: <span class=\"string\">\"nodemon --exec 'cross-env NODE_ENV=development electron --inspect=5858 index'\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start-production\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production electron --inspect=5858 index\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build-all\"</span>: <span class=\"string\">\"npm run dist &amp;&amp; npm run build\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dist\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production webpack --config webpack.prod.config.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"electron-builder -l\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"keywords\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"electron\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"react\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"mobx\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"react-router\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"webpack4\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"nodemonConfig\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"ignore\"</span>: [</span><br><span class=\"line\">      <span class=\"string\">\"resources/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"node_modules/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"dist/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"build/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/stores/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/styles/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/services/shell/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/configure/view.conf\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/views/*\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/App.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/main.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"app/index.js\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"electron-builder.yml\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"delay\"</span>: <span class=\"string\">\"1000\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"dependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"semantic-ui-css\"</span>: <span class=\"string\">\"^2.4.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"semantic-ui-react\"</span>: <span class=\"string\">\"^0.82.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"mobx\"</span>: <span class=\"string\">\"^4.4.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"mobx-react\"</span>: <span class=\"string\">\"^5.2.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"prop-types\"</span>: <span class=\"string\">\"^15.6.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react\"</span>: <span class=\"string\">\"^16.5.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-dom\"</span>: <span class=\"string\">\"^16.5.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-hot-loader\"</span>: <span class=\"string\">\"^4.3.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-router\"</span>: <span class=\"string\">\"^4.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"react-router-dom\"</span>: <span class=\"string\">\"^4.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"history\"</span>: <span class=\"string\">\"^4.7.2\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel-core\"</span>: <span class=\"string\">\"^6.26.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-eslint\"</span>: <span class=\"string\">\"^10.0.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-loader\"</span>: <span class=\"string\">\"^7.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-plugin-transform-decorators-legacy\"</span>: <span class=\"string\">\"^1.3.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-env\"</span>: <span class=\"string\">\"^1.7.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-es2015\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-react\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"babel-preset-stage-0\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"clean-webpack-plugin\"</span>: <span class=\"string\">\"^0.1.19\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"concurrently\"</span>: <span class=\"string\">\"^3.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"cross-env\"</span>: <span class=\"string\">\"^5.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"css-loader\"</span>: <span class=\"string\">\"^0.28.11\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron\"</span>: <span class=\"string\">\"^2.0.9\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron-builder\"</span>: <span class=\"string\">\"^20.28.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint\"</span>: <span class=\"string\">\"^5.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-config-airbnb\"</span>: <span class=\"string\">\"^17.1.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-import\"</span>: <span class=\"string\">\"^2.14.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-jsx-a11y\"</span>: <span class=\"string\">\"^6.1.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"eslint-plugin-react\"</span>: <span class=\"string\">\"^7.11.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"extract-text-webpack-plugin\"</span>: <span class=\"string\">\"^4.0.0-beta.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"file-loader\"</span>: <span class=\"string\">\"^2.0.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html-loader\"</span>: <span class=\"string\">\"^0.5.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"html-webpack-plugin\"</span>: <span class=\"string\">\"^3.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"node-sass\"</span>: <span class=\"string\">\"^4.9.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"nodemon\"</span>: <span class=\"string\">\"^1.18.4\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sass-loader\"</span>: <span class=\"string\">\"^7.1.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"source-map-support\"</span>: <span class=\"string\">\"^0.5.9\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"style-loader\"</span>: <span class=\"string\">\"^0.21.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"url-loader\"</span>: <span class=\"string\">\"^1.1.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack\"</span>: <span class=\"string\">\"^4.19.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack-cli\"</span>: <span class=\"string\">\"^2.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"webpack-dev-server\"</span>: <span class=\"string\">\"^3.1.8\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3>引入Webpack4.0前端打包工具</h3>\n<hr>\n<h4>webpack开发环境配置文件</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拆分样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractSass = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.scss.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> extractCss = <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">  filename: <span class=\"string\">'style.css'</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  devtool: <span class=\"string\">'source-map'</span>,</span><br><span class=\"line\">  entry: [</span><br><span class=\"line\">    <span class=\"string\">'react-hot-loader/patch'</span>,</span><br><span class=\"line\">    <span class=\"string\">'webpack-dev-server/client?http://localhost:3000'</span>,</span><br><span class=\"line\">    <span class=\"string\">'webpack/hot/only-dev-server'</span>,</span><br><span class=\"line\">    <span class=\"string\">'./app/index'</span>,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: <span class=\"string\">'bundle.js'</span>,</span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">    publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  resolve: &#123;</span><br><span class=\"line\">    alias: &#123;</span><br><span class=\"line\">      resources: path.resolve(__dirname, <span class=\"string\">'resources'</span>),</span><br><span class=\"line\">      app: path.resolve(__dirname, <span class=\"string\">'app'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'babel-loader'</span>],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: extractCss.extract(&#123;</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>,</span><br><span class=\"line\">          use: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        use: extractSass.extract(&#123;</span><br><span class=\"line\">          use: [&#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">          &#125;, &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'sass-loader'</span>,</span><br><span class=\"line\">          &#125;],</span><br><span class=\"line\">          fallback: <span class=\"string\">'style-loader'</span>, <span class=\"comment\">// 在开发环境使用 style-loader</span></span><br><span class=\"line\">          publicPath: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">        use: &#123;</span><br><span class=\"line\">          loader: <span class=\"string\">'html-loader'</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(png|jpg|gif|svg|ico|woff|eot|ttf|woff2)$/</span>,</span><br><span class=\"line\">        use: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            loader: <span class=\"string\">'file-loader'</span>,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">              name: <span class=\"string\">'[path][name].[ext]'</span>,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    extractSass,</span><br><span class=\"line\">    extractCss,</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">'dist'</span>]),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.NamedModulesPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.NoEmitOnErrorsPlugin(),</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: <span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    port: <span class=\"number\">3000</span>,</span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  target: <span class=\"string\">'electron-renderer'</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3>Electron基本原理和代码热更新</h3>\n<hr>\n<blockquote>\n<p>Electron 运行 package.json 的 main 脚本的进程被称为主进程。 在主进程中运行的脚本通过创建web页面来展示用户界面。 一个 Electron 应用总是有且只有一个主进程。<br>\n由于 Electron 使用了 Chromium 来展示 web 页面，所以 Chromium 的多进程架构也被使用到。 每个 Electron 中的 web 页面运行在它自己的渲染进程中。<br>\n在普通的浏览器中，web页面通常在一个沙盒环境中运行，不被允许去接触原生的资源。 然而 Electron 的用户在 Node.js 的 API 支持下可以在页面中和操作系统进行一些底层交互。<br>\n进程使用 BrowserWindow 实例创建页面。 每个 BrowserWindow 实例都在自己的渲染进程里运行页面。 当一个 BrowserWindow 实例被销毁后，相应的渲染进程也会被终止。<br>\n主进程管理所有的web页面和它们对应的渲染进程。 每个渲染进程都是独立的，它只关心它所运行的 web 页面。<br>\n在页面中调用与 GUI 相关的原生 API 是不被允许的，因为在 web 页面里操作原生的 GUI 资源是非常危险的，而且容易造成资源泄露。 如果你想在 web 页面里使用 GUI 操作，其对应的渲染进程必须与主进程进行通讯，请求主进程进行相关的 GUI 操作。</p>\n</blockquote>\n<h4>创建主进程</h4>\n<p>在index.js文件中我们引入electron和所有的自定义模块文件，并根据开发环境或是生产环境来进行主进程窗口加载，开发环境下使用<code>http协议</code>加载由webpack-dev-server启动的http服务，生产环境下使用<code>file协议</code>加载本地由webpack打包好的前端bundle.js文件，所以开发环境下<code>npm start</code>指令其实主要是执行了两步操作，一是启动webpack-dev-server，此时已经可以通过外部浏览器访问到localhost:3000的http服务，只不过我们实际是用electron之中的chromium浏览器来加载的，它与node.js主进程共享同一个chrome v8引擎，所以理论上，在页面加载后，你同样可以在渲染进程中使用node.js API，比如用使用fs模块访问文件系统。</p>\n<h4>主进程代码热更新</h4>\n<p>我用了nodemon工具实现了主进程代码热更新，如果不用nodemon工具那么 <code>npm start-electron</code>命令实际是执行<code>cross-env NODE_ENV=development electron index</code>，就是简单的用electron启动主进程文件，使用nodemon之后<code>npm start-electron</code>实际上是执行<code>nodemon --exec 'cross-env NODE_ENV=development electron index'</code>，最后在package.json文件中增加一个nodemonConfig字段用于指定哪些文件需要纳入nodemon监听即可。</p>\n<p>=&gt; package.json中定义的启动脚本：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\">  \"start\": \"concurrently \\\"npm run start-dev\\\" \\\"npm run start-electron\\\"\",</span><br><span class=\"line\">  \"start-dev\": \"cross-env NODE_ENV=development webpack-dev-server\",</span><br><span class=\"line\">  \"start-electron\": \"nodemon --exec 'cross-env NODE_ENV=development electron index'\",</span><br><span class=\"line\">  \"build\": \"npm run dist &amp;&amp; npm run build-all\",</span><br><span class=\"line\">  \"dist\": \"cross-env NODE_ENV=production webpack  --config webpack.production.config.js\",</span><br><span class=\"line\">  \"build-all\": \"build -lmw\"</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>=&gt; package.json中nodemonConfig字段</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"nodemonConfig\": &#123;</span><br><span class=\"line\">    \"ignore\": [</span><br><span class=\"line\">      \"resources/*\",</span><br><span class=\"line\">      \"node_modules/*\",</span><br><span class=\"line\">      \"dist/*\",</span><br><span class=\"line\">      \"app/stores/*\",</span><br><span class=\"line\">      \"app/styles/*\",</span><br><span class=\"line\">      \"app/services/shell/*\",</span><br><span class=\"line\">      \"app/configure/view.conf\",</span><br><span class=\"line\">      \"app/views/*\",</span><br><span class=\"line\">      \"app/App.js\",</span><br><span class=\"line\">      \"app/main.js\",</span><br><span class=\"line\">      <span class=\"string\">\"app/index.js\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"delay\": \"1000\"</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<p>=&gt; 项目启动文件index.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\">// 根据运行环境加载窗口 //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadWindow</span>(<span class=\"params\">window, env</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (env === <span class=\"string\">'development'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// wait for webpack-dev-server start</span></span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">        pathname: <span class=\"string\">'localhost:3000'</span>,</span><br><span class=\"line\">        protocol: <span class=\"string\">'http:'</span>,</span><br><span class=\"line\">        slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      <span class=\"comment\">// window.webContents.openDevTools();</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">1e3</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.loadURL(url.format(&#123;</span><br><span class=\"line\">      pathname: path.join(path.resolve(__dirname, <span class=\"string\">'./dist'</span>), <span class=\"string\">'index.html'</span>),</span><br><span class=\"line\">      protocol: <span class=\"string\">'file:'</span>,</span><br><span class=\"line\">      slashes: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- main window ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createWindow</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; width, height &#125; = getAppConf();</span><br><span class=\"line\">  win = <span class=\"keyword\">new</span> BrowserWindow(&#123;</span><br><span class=\"line\">    width,</span><br><span class=\"line\">    height,</span><br><span class=\"line\">    title: <span class=\"string\">'electronux'</span>,</span><br><span class=\"line\">    autoHideMenuBar: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  win.on(<span class=\"string\">'resize'</span>, () =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [_width, _height] = win.getContentSize();</span><br><span class=\"line\">    viewConf.set(&#123;</span><br><span class=\"line\">      width: _width,</span><br><span class=\"line\">      height: _height,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  loadWindow(win, nodeEnv);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- electron event ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nodeEnv === <span class=\"string\">'development'</span>) &#123;</span><br><span class=\"line\">    sourceMapSupport.install();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  createWindow();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.platform !== <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">    app.quit();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'will-quit'</span>, () =&gt; &#123;</span><br><span class=\"line\">  viewConf.write().then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"number\">0</span>, (err) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(err);</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'App quit: view-conf write error !'</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'activate'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (win === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    createWindow();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3>前端界面React + Mobx 代码结构和热更新</h3>\n<hr>\n<h4>代码结构</h4>\n<ol>\n<li>App.js前端入口文件<br>\n入口文件基本是整个前端应用的关键点，我们使用<code>mobx-react</code>包提供的Provider组件加载整个应用，并把各个应用模块(按功能划分)的mobx store示例作为props属性传入Provider，在各个组建中使用修饰器<code>@inject</code>就能直接使用store实例了，页面层次比较多的话最好使用React Router进行路由管理，值得注意的是React Router V4版本跟之前版本的理念和使用方式有很大区别，可以去官网查阅相关文档<a href=\"https://reacttraining.com/react-router/web/guides/quick-start\" target=\"_blank\" rel=\"noopener\">react-router4</a></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ------------------- export global history ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> history = createHistory();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> stores = &#123;</span><br><span class=\"line\">  install: <span class=\"keyword\">new</span> InstallState(),</span><br><span class=\"line\">  startup: <span class=\"keyword\">new</span> StartupState(),</span><br><span class=\"line\">  info: <span class=\"keyword\">new</span> InfoState(),</span><br><span class=\"line\">  clean: <span class=\"keyword\">new</span> CleanState(),</span><br><span class=\"line\">  pub: <span class=\"keyword\">new</span> PublicState(),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;Provider &#123;...stores&#125;&gt;</span><br><span class=\"line\">      &lt;Router history=&#123;history&#125;&gt;</span><br><span class=\"line\">        &lt;Route path=<span class=\"string\">\"/\"</span> component=&#123;HomePage&#125; /&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/Router&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>Provider&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- export provider ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>mobx store 存储<br>\n这是项目其中一个系统清理模块的mobx store，在store中被mobx监听的属性最好结构层次简单、只有单一的功能划分，不要把一个属性对象的嵌套写得太深。开发时我们把UI界面的数据抽象成store中的数据时可能会下意识地根据页面显示状态而把单个属性对象写得过于复杂，但其实页面显示状态只是逻辑的数据结构，我们在store中存储的时候应该尽量将这种逻辑数据结构<code>翻译</code>成扁平化的数据结构，然后再在各个属性对象之间建立映射关系。<br>\n并且使用了mobx之后请尽量依赖mobx的数据引用监听自动更新特性，多写<code>computed</code>、<code>autorun</code>来自动生成数据，使用<code>action</code>修饰一些需要更改store属性的方法。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Clean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123; &#125;</span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- observable ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 所有检查项目 //</span></span><br><span class=\"line\">  @observable items = &#123;</span><br><span class=\"line\">    appCache: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    appLog: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    trash: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    packageCache: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 主界面加载 //</span></span><br><span class=\"line\">  @observable loadingMain = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理路径 //</span></span><br><span class=\"line\">  cleanPaths = &#123;</span><br><span class=\"line\">    appCache: [<span class=\"string\">`/home/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.userinfo.username&#125;</span>/.cache`</span>],</span><br><span class=\"line\">    appLog: [<span class=\"string\">'/var/log/'</span>],</span><br><span class=\"line\">    trash: [<span class=\"string\">`/home/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.userinfo.username&#125;</span>/.local/share/Trash/files`</span>],</span><br><span class=\"line\">    packageCache: [<span class=\"string\">'/var/cache/pacman/pkg'</span>],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 路径模块映射 //</span></span><br><span class=\"line\">  @observable cleanPathMap = &#123;</span><br><span class=\"line\">    appCache: [], <span class=\"comment\">// '/var/log/pacman.log'</span></span><br><span class=\"line\">    appLog: [],</span><br><span class=\"line\">    trash: [],</span><br><span class=\"line\">    packageCache: [],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理内容 //</span></span><br><span class=\"line\">  @observable cleanContents = observable.map(&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理大小 //</span></span><br><span class=\"line\">  cleanSizes = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// '/var/log//pacman.log': '10kb',</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ---- 清理选项细节-数据对象逻辑树结构 ---- //</span></span><br><span class=\"line\">  <span class=\"comment\">// @observable cleanDetails = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   appCache: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     url: [`/home/$&#123;this.userinfo.username&#125;/.cache`], // 指定扫描路径多个</span></span><br><span class=\"line\">  <span class=\"comment\">//     contents: &#123; // 绝对路径</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': false,</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//     size: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/cache/pacman/pkg/zsh-5.6.2-1-x86_64.pkg.tar.xz': '10kb',</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   appLog: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     url: ['/var/log/'],</span></span><br><span class=\"line\">  <span class=\"comment\">//     contents: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/log//pacman.log': false,</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//     size: &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       // '/var/log//pacman.log': '10kb',</span></span><br><span class=\"line\">  <span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- static ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ------------------- computed ------------------- */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 获取所有被选中的detail item //</span></span><br><span class=\"line\">  @computed get allCheckedDetail() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> a = [];</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cleanContents.forEach(<span class=\"function\">(<span class=\"params\">v, k</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (v) a.push(k);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 清理路径详细信息 //</span></span><br><span class=\"line\">  @computed get cleanDetail() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = [];</span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.cleanPathMap).forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.items[item]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oneResult = &#123;</span><br><span class=\"line\">          label: item,</span><br><span class=\"line\">          contents: [],</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.cleanPathMap[item].forEach(<span class=\"function\">(<span class=\"params\">it</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          oneResult.contents.push(&#123;</span><br><span class=\"line\">            content: it,</span><br><span class=\"line\">            size: <span class=\"keyword\">this</span>.cleanSizes[it] || <span class=\"number\">0</span>,</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        result.push(oneResult);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Clean;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>\n<p>页面组件划分<br>\n在views目录下创建的各个目录都是一个单独的组件目录，组件目录下有一个组件入口文件和css样式表文件以及其它子组件，入口文件载入css文件和子组件，使用<code>@inject</code>修饰器后各个组件都可以独立访问mobx store实例，不必在父和子组件之间通过props进行逐级参数传递，但是如果一个子组件依赖父组件来加工原始数据的话也可以使用props传递参数。<br>\n使用了mobx之后，并不是说每个页面需要使用的数据都有必要纳入mobx store的管理，在我的代码中只是把<code>关键性数据</code>以及<code>关键性数据加工方法</code>存入了store中，每个组件拿到store传递下来的数据后一些页面状态可能需要依赖组件各自的数据处理函数进行数据二次加工，我觉得这样应该会减轻store实例的负载压力，非绝对中心化。比如在一个列表菜单组件中，这个组件的列表数据可以切换显示和隐藏，但是控制这个列表显示/隐藏的参数状态<code>visible</code>没有必要纳入store实例管理，相对的管理这个列表组件的store实例只是存储了列表数据的数组，以及一些必要的数据加工方法。</p>\n</li>\n<li>\n<p>渲染进程和主进程ipc通信的问题<br>\n页面的每个渲染进程(ipcRender)，虽然说可以直接使用node.js原生模块和api，但是不建议在渲染进程中过度使用原生模块，一是因为一些node.js原生模块并没有考虑到进程安全的问题，第二个原因是渲染进程应该专注处理页面交互和数据处理问题，划清代码的功能区域，把和系统交互的问题交由主进程(ipcMain)处理，把网络数据请求也交由各自的service服务，减少不必要的模块和数据耦合。渲染进程通过ipc通信向主进程发送处理请求，主进程和service负责原始数据的获取和网络数据的传输，最后主进程通过ipc通信向对应的渲染进程返回处理结果，service拿到的网络数据也通过回调事件发送给渲染进程。项目中我把mobx store作为和主进程通信的桥梁，mobx store向主进程发送信号，同时也在接收到主进程的ipc通信事件后再把主进程发回来的数据更新到各个observer。总之主进程和service服务负责系统交互、原始数据获取和传输，渲染进程mobx store负责响应信号和事件进行业务数据更新，各个view子组件只负责页面渲染和用户交互。</p>\n</li>\n</ol>\n<h4>前端代码热更新</h4>\n<ol>\n<li>webpack.config.js中启动webpack-dev-server的热更新功能</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devServer: &#123;</span><br><span class=\"line\">    host: <span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    port: <span class=\"number\">3000</span>,</span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>使用<code>react-hot-loader</code>的AppContainer组件</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppContainer &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-hot-loader'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'semantic-ui-css/semantic.min.css'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./styles/public.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./App'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">render(</span><br><span class=\"line\">  &lt;AppContainer&gt;</span><br><span class=\"line\">    &lt;App /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/AppContainer&gt;,</span></span><br><span class=\"line\"><span class=\"regexp\">  document.getElementById('root')</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br></pre></td></tr></table></figure>\n<h3>Linux桌面客户端开发遇到的问题</h3>\n<hr>\n<h4>使用node.js子进程child_process执行shell脚本时无法取得系统root权限</h4>\n<p>项目中有的脚本需要使用root权限，比如安装和卸载软件、扫描系统关键路径，node.js里执行shell脚本可以使用child_process模块(node.js子进程)，child_process有几个方法，<code>spawn</code>、<code>exec</code>、<code>execFile</code>、<code>fork</code>，它们都能创建子进程以执行指定文件或命令，具体的使用方法见<a href=\"http://nodejs.cn/api/child_process.html#child_process_asynchronous_process_creation\" target=\"_blank\" rel=\"noopener\">Node API</a>，如果我们的脚本或指令需要使用root权限那可就麻烦了，桌面应用又不是终端，不可能用着用着让用户去终端输入密码吧，况且只是在开发环境下能看到终端输出，应用打包安装运行起来后就是一个独立的应用程序了，根本没法输入终端密码，仔细查阅了Electron官网API发现electron官方并没有集成一个什么系统权限调用窗口之类的组件。没办法了，这种情况下手动写出了两种方法：</p>\n<ol>\n<li>调用获取系统权限的系统自带组件来执行自定义命令和脚本</li>\n<li>封装一个弹窗组件来获取用户首次输入的密码，然后手动把密码记录到文件中，应用启动的时候从文件中读出密码，在使用child_process创建子进程的时候再监听子进程的输出事件和错误事件，然后把读取到的保存在内存中的密码以输入流(input stream)的形式发送给child_process创建的子进程，子进程读取到输入流传入的密码后就能继续执行了。</li>\n</ol>\n<p><img src=\"/blogs/img/article/mobx9.png\" alt=\"electron_pssword.png\"></p>\n<p><img src=\"/blogs/img/article/mobx10.png\" alt=\"install_permission.png\"></p>\n<p><strong>具体代码见</strong>：<a href=\"/blogs/img/article/mobx10.png\">github/nojsja/electronux/app/utils/sudo-prompt.js</a></p>\n<p><em>感谢阅读，文章中出现的错误之处还请多指正~</em></p>\n<h3>未完待续</h3>\n"},{"title":"Ubuntu18.04踩坑记录","catalog":true,"toc_nav_num":true,"date":"2018-04-04T08:30:35.000Z","subtitle":"ubuntu18.04 linux","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2018-04-04T08:30:35.000Z","top":1,"_content":"\n![welcome / home](/blogs/img/article/Ubuntu18.04-1.jpg)\n\n#### Contents\n__________\n\n* Wine应用启动后出现WineSystemTray 托盘的问题\n* 中文环境下将Home目录下的文件夹切换为英文名\n* Ubuntu系发行版安装deepin wine QQ\n* 续：安装QQ/微信\n* Ubuntu 18.04开机启动特别慢的问题\n* 终端oh-my-zsh配置\n* 终端终结者Terminator配置\n* 禁用内核更新\n* 终端常用等宽字体\n* crossover18破解\n* vim插件配置\n* Ubuntu18.04 定制Mac主题\n* Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式\n* Ubuntu18.04 关于定制plymouth主题来更换开机动画\n* Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题\n* Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题\n* Ubuntu18.04 解决一些软件依赖不满足问题的问题\n* Linux分区过小导致后期容量不足解决方法\n* Shadowsocks-Qt5安装的问题\n* 使用polipo开启终端代理(需要先开启shadowsocks代理)\n* 将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表\n* 自定义shadowsocks服务开机自启动脚本\n* Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效\n* Atom编辑器内存占用过大的问题\n* Grub2 主题安装\n* Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer\n* Ubuntu18.04 WPS 提示字体缺失的解决方法\n* Ubuntu18.04 更新Gnome版本\n* Win10 + Ubuntu18.04 双系统时间显示不对\n* Ubuntu18.04 安装系统时说明(双硬盘)\n* Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题\n* Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法\n* Ubuntu18.04 Crossover17安装QQ后乱码的解决方法\n* Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错\n* Ubuntu18.04 Gnome-Shell 插件\n* Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置\n* Ubuntu18.04 主题\n* chrome实用插件整理\n* 实用程序和命令\n* 实用网站推荐\n\n#### Wine应用启动后出现WineSystemTray托盘的问题\n____________________________________________\n![wine_tray.png](/blogs/img/article/Ubuntu18.04-2.png)\n\n![tray.png](/blogs/img/article/Ubuntu18.04-3.png)\n1. 操作系统Linux Mint18.3\n右键点击面板(状态栏)，选择 - 向面板添加小程序，选择小程序 - 系统托盘，点击+号添加，之后Wine安装的应用和其它应用的图标就被系统托盘管理了。\n\n2. 操作系统Ubuntu 18.04\n安装gnome-shell插件 [TopIcons](https://extensions.gnome.org/extension/495/topicons/), 要想从浏览器上安装这个TopIcons需要先安装浏览器gnome交互插件chrome-gnome-shell (`sudo apt install chrome-gnome-shell` )，使用deepin QQ的时候可能需要重新启动TopIcons才能显示顶部QQ图标，如果遇到图标无故隐藏的问题那么可以再安装插件[Dash to Panel](https://extensions.gnome.org/extension/1160/dash-to-panel/)解决。\n\n#### 中文环境下将Home目录下的文件夹切换为英文名\n-------------------------------------------------------------------------\n1.  设置英文语言环境\n```sh\n$: export LANG=en_US(恢复-> zh_CN)\n```\n2. 更新目录\n```sh\n$: xdg-user-dirs-gtk-update\n```\n3. 弹出提示框点击 [确认]\n4. 重启后会再次弹出提示框是否将英文文件夹改回中文，选择 [不再提示] 并 [取消] 修改\n\n#### Ubuntu系发行版安装deepin wine QQ\n__________________________________\n\n1. 安装deepin-wine环境：上[https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu](https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu)页面下载zip包（或用git方式克隆），也可以[百度网盘](https://pan.baidu.com/s/120C5aHuqtyxQyn_fGTxHKg)下载，解压到本地文件夹，在文件夹中打开终端，输入`sudo sh ./install.sh`一键安装，如果你安装了这些依赖，在第二步的时候仍然报依赖错误，那就手动解压deb包，把那些依赖声明删除就行了(解压deb的方法下文中有提到)。\n\n2. 安装deepin.com应用容器：在[http://mirrors.aliyun.com/deepin/pool/non-free/d/](http://mirrors.aliyun.com/deepin/pool/non-free/d/)中下载想要的容器，点击deb安装即可，以下为推荐容器:\n*   QQ：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/)\n*   TIM：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/)\n*   QQ轻聊版：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/)\n*   微信：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/)\n*   Foxmail：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/)\n*   百度网盘：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/)\n*  360压缩：http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/\n*  迅雷急速版:  https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg\n* Ubuntu系发行版包括Ubuntu、LinuxMint、ZorinOS等。\n\n#### 续：安装QQ/微信\n______________________\n\n1.linux上的微信大部分都是网页版微信封装的: [electronic-wechat](https://github.com/geeeeeeeeek/electronic-wechat)、[weweChat](https://github.com/trazyn/weweChat)，网页版功能简单，每次登录都要扫码。而且现在腾讯好像开始禁用了微信网页版的登陆，如果发现不能登录网页版就只能使用crossover来安装windows版的微信。\n\n2.￥140可以买个CrossOver18正版，一次激活，永久使用，然后愉快地安装QQ8.9，喜欢TIM的也能用TIM， 不过目前这个基于crossover的QQ有些bug，也不能记住密码。使用crossover18安装微信，安装包直接下载windows版本的就行，然后使用crossover创建windowsXP 64位容器，在容器中安装微信即可，不过可能安装时会出现`\"WeChatWin.dll 缺失问题\"`报错信息，需要执行下面命令安装额外的环境：\n```sh\n$: apt-get install libldap-2.4-2:i386\n```\n\n3.使用docker安装[Tim](https://hub.docker.com/r/bestwu/qq) 和 [wechat](https://hub.docker.com/r/bestwu/wechat)，[docker环境安装教程](https://www.runoob.com/docker/ubuntu-docker-install.html)\n\n4.wine环境下(crossover/deepin)安装好微信后如果发现不能输入文字(其实可以输入和发送，只是文字透明的)，可以使用这个文件[riched20.dll](https://pan.baidu.com/s/1-ScZvkmR9oZPdiFurdKQdA)(提取密码：rofj)替换掉微信所在容器下的C盘的`/windows/system32/riched20.dll`，容器路径一般在：`~/.cxoffice/[你的容器名]/drive_c/`。\n\n5.wine环境下(crossover/deepin)如果运行微信时发现界面有一个黑框不能关闭，只需要在聊天输入框中键入中文“不”然后再删除即可让黑框消失(原因:微信会根据你输入的字作为关键字在你现有表情中找符合的表情并显示出来提示你可用,但并没有很好的兼容这个功能变成一个黑框了，所以手动消除黑框的办法只有打关键字然后删除)。\n\n6.wine环境下(crossover/deepin)如果运行微信的时候不能发送图片，尝试安装 `sudo apt install libjpeg62:i386`，临时解决办法是把图片文件拖动到`收藏`，然后从收藏转发即可。\n\n7.wine环境下(crossover/deepin)如果运行QQ发现收到的图片一直加载不出来(刚登录开始可以，过一会就不行了)，那么可以在QQ登录界面设置一下网络代理(http/socks)，注意本地代理情况下代理地址不能使用localhost/127.0.0.1此类的IP，使用0.0.0.0是可以的。\n\n#### Ubuntu 18.04开机启动特别慢的问题\n_________________________________\n=> 禁用不必要的开机服务：\n```sh\n# 列出程序开机占用时间排行\nsystemd-analyze blame\n# 禁用plymouth\nsudo systemctl mask plymouth-start.service\nsudo systemctl mask plymouth-read-write.service\n```\n#### 终端oh-my-zsh配置\n_________________________________\n1. 主题\n* gnzh(已使用))\n* ys \n* avit\n* af-magic\n2. 插件\n* git => 自带git状态插件\n* svn => svn状态插件\n* colored-man-pages => man帮助信息高亮\n* zsh-syntax-highlighting => 命令高亮和错误提示\n* z => 自动记录路径快捷跳转\n* zsh-autosuggestions => 根据输入记录自动建议可选输入命令\n\n#### 终端终结者Terminator配置\n---------------------------\n特性：浅色调、字体舒适、无滚动条、自定义快捷键和配色、自动设置窗口布局\n\n注意：可以配合`设置->设备->键盘->添加自定义快捷键`这样自定义快捷键来启动终端，\n比如设置`Ctrl+Alt+T`为`terminator --geometry=93x32+450+300`，geometry为窗口的布局配置。\n\n覆盖文件`~/.config/terminator/config`内容：\n\n```bash\n  [global_config]\n  enabled_plugins = CustomCommandsMenu, LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler\n  suppress_multiple_term_dialog = True\n  title_hide_sizetext = True\n[keybindings]\n  prev_tab = <Alt>1\n  reset_clear = <Primary><Shift>g\n  clear = <Primary>l\n  switch_to_tab_1 = <Alt>1\n  switch_to_tab_2 = <Alt>2\n  switch_to_tab_3 = <Alt>3\n  switch_to_tab_4 = <Alt>4\n  switch_to_tab_5 = <Alt>5\n  toggle_scrollbar = None\n  toggle_zoom = <Primary><Shift>x\n[layouts]\n  [[default]]\n    [[[child1]]]\n      parent = window0\n      profile = default\n      type = Terminal\n    [[[window0]]]\n      parent = \"\"\n      size = 925, 570\n      type = Window\n[plugins]\n  [[CustomCommandsMenu]]\n    [[[清屏]]]\n      command = clear\n      enabled = True\n      name = 清屏\n      position = 0\n[profiles]\n  [[default]]\n    allow_bold = False\n    background_color = \"#fbfbfb\"\n    background_darkness = 0.93\n    background_type = transparent\n    copy_on_selection = True\n    cursor_color = \"#aaaaaa\"\n    cursor_shape = ibeam\n    font = Ubuntu Light 12\n    foreground_color = \"#49494a\"\n    palette = \"#2e3436:#ee6a6a:#38690a:#b3adb0:#3465a4:#75507b:#06989a:#d3d7cf:#979b93:#fe5f5f:#7fd42c:#b7afb1:#729fcf:#ad7fa8:#34e2e2:#eeeeec\"\n    scroll_on_keystroke = False\n    scrollbar_position = hidden\n    show_titlebar = False\n```\n\n#### 禁用内核更新\n------------------------\n```sh\n# 查看已安装内核\n$: dpkg --get-selections |grep linux-image\n# 查看正在使用的内核\n$: uname -a\n# 删除旧内核\n$: sudo apt-get remove\n$: linux-image-x.xx.x-xx-generic\n$: sudo apt-get remove  \n$: linux-image-extra-x.xx.x-xx-generic  \n# 或用这个命令移除\n$: sudo dpkg --purge linux-image-x.x.x-xx-generic\n# 禁止更新内核，需时间来验证\n$: sudo apt-mark hold linux-image-x.xx.x-xx-generic\n$: sudo apt-mark hold linux-image-extra-x.xx.x-xx-generic\n# 如果需要恢复原来的设定的话即允许更新内核，执行如下命令即可：\n$: sudo apt-mark unhold linux-image-x.xx.x-xx-generic\n$: sudo apt-mark unhold linux-image-extra-x.xx.x-xx-generic\n```\n\n#### 终端常用等宽字体\n-----------------------------\n* AR PL UKai CN 12\n* Bitstream Vera Sans Mono 10\n* Courier 10 Pitch 11\n* DejaVu Sans Mono 10\n* FreeMono 11\n* Nimbus Mono L 12\n* TlwgMono 11 \n\n#### crossover18破解\n----------------------------\n下载 [CrossoverPatch](https://pan.baidu.com/s/1BnT-cAKf-SBp-6J4CQoo-g ) `密码: ffp0`，解压后替换文件：\n```sh\n#  备份原文件\n$: cp ~/cxoffice/lib/wine/winewrapper.exe.so ~/cxoffice/lib/wine/winewrapper.exe.so-bak\n# 替换文件\n$: cp CrossoverPatch/winewrapper.exe.so ~/cxoffice/lib/wine\n```\n\n#### vim插件配置\n______________\n1. [Vundle](https://github.com/VundleVim/Vundle.vim) => 插件管理器，编辑.vimrc，然后执行命令`vim +PluginInstall`即可安装  \n2. [vim-airline](https://github.com/vim-airline/vim-airline) => 底部状态栏  \n3. [其他配置](https://juejin.im/post/5a38c37f6fb9a0450909a151)\n\n#### Ubuntu18.04 定制Mac主题\n__________________________\n\n![overview.png](/blogs/img/article/Ubuntu18.04-5.png)\n\n![desktop.png](/blogs/img/article/Ubuntu18.04-6.png)\n\n\n1. 安装gnome-tweak-tool 和 chrome-gnome-shell 插件 (`sudo aptitude install [name]`)\n2. 安装GTK3主题 => [X-Arc-Collection](https://www.gnome-look.org/p/1167049/)\n3. 使用tweak载入应用程序主题 => tweak -- 外观 -- 应用程序 -- 选择X-Arc-Collection\n4. 安装gnome-shell 主题 => [macOS High Sierra](https://www.gnome-look.org/p/1167049/)\n5. 安装gnome-shell 插件 => [User Themes](https://extensions.gnome.org/extension/19/user-themes/) ( 之后重启Gnome => [Alt + F2] & [输入 r] & [点击 Enter] )\n6. 使用tweak载入shell主题 => tweak -- 外观 -- shell -- 选择Sierra shell主题\n7.  下载Mac图标主题 [la-capitaine-icon-theme](https://github.com/keeferrourke/la-capitaine-icon-theme/releases) 或 [McMojave-circle](https://www.pling.com/p/1305429/)\n8. 图标文件夹移动到 ~/.icons目录下(没有则新建目录)\n9. 使用tweak载入icon主题 => tweak -- 外观 -- 图标 -- 选择对应的图标主题\n10. 安装gnome-shell插件 => Dash to dock (将原生dock转变为可定制的浮动dock)\n11. 定制firefox主题 => [Majave-gtk-theme](https://github.com/vinceliuice/Mojave-gtk-theme)\n\n#### Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式\n--------------------------------------------------------------------------------------------\n![lockscreen.png](/blogs/img/article/Ubuntu18.04-7.png)\n\n![loginscreen.png](/blogs/img/article/Ubuntu18.04-8.png)\n\n1. 安装脚本 => [github / nojsja / login-manager-config-ubuntu](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/login-manager-config-ubuntu)  \n2. 说明=> 脚本通过更改/usr/share/gnome-shell/theme/ubuntu.css文件中声明的样式来修改系统登录页面按钮布局和背景图片的地址，使用ImageMagick包的`convert -blur`命令制作了毛玻璃效果的登录背景图片，最后还生成了一个SetAsWallpaper脚本，可以在文件夹中的图片文件上右键点击选择运行这个脚本(它会自动把目标图片更改成桌面壁纸和毛玻璃效果化的登录背景图)，最后锁屏壁纸需要用户手动安装`gnome-tweak-tool`进行更改。  \n3. 之前我想通过更改`/usr/share/gnome-shell/theme/gdm3.css`文件来修改样式，可是发现ubuntu18.04下总会有这样那样的问题。\n4. 注意=> 不要贸然尝试更改系统主题的CSS样式文件，如果修改的文件有语法错误或是其它原因，很可能会造成系统开机后无法登入图形界面(出现这种情况可以插入U盘登录PE系统然后挂载原系统的硬盘，最后将错误文件改回即可)。\n\n#### Ubuntu18.04 关于定制plymouth主题来更换开机动画\n-----------------------------------------------------------------------------\n>其实我不建议去改开机动画，一个原因是ubuntu自己的开机动画就挺美观简洁的，第二个原因是这个东西如果改出问题了卡在开机画面到时候恢复起来比较麻烦，如果执意想去折腾的话，可以去[gnome-look](https://www.gnome-look.org/browse/cat/108/)看看，这里提供一个苹果主题[darwin](https://pan.baidu.com/s/1qv3GZ_BE-jj2HIpiI2X7yQ)，密码: `rc6u`。\n1. 解压下载的plymouth主题到 `/usr/share/plymouth/themes`\n\n2. 执行安装\n```sh\n$: sudo update-alternatives --install /usr/share/plymouth/themes/ default.plymouth default.plymouth /usr/share/plymouth/themes/[THEME]/[THEME].plymouth 100\n```\n\n3. 更新配置，需要手动选择plymouth编号\n```sh\n$: sudo update-alternatives --config default.plymouth\n$: sudo update-initramfs -u\n```\n\n4. 手动更改错误路径参数\n```sh\n$: sudo gedit /usr/share/plymouth/themes/default.plymouth\n```\n替换`ImageDir`和`ScriptFile`为正确的plymouth文件存放路径，替换后：\n```sh\nImageDir=/usr/share/plymouth/themes/[THEME]\nScriptFile=/usr/share/plymouth/themes/[THEME]/[THEME].script\n```\n\n\n#### Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题\n---------------------------------------------------------------------------------------------\n>解决方法是去tweak设置里关闭[Dash to dock]的开关，别担心，关闭后，[Dash to dock]仍然正常工作，但是再也不会同时出现两个dock栏的尴尬情况了。  \n\n![dock-noise.png](/blogs/img/article/Ubuntu18.04-9.png)\n\n![dock-single.png](/blogs/img/article/Ubuntu18.04-10.png)\n\n\n\n#### Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题\n________________________________________________________\n![dock-tweak.png](/blogs/img/article/Ubuntu18.04-11.png)\n\n1. 打开 软件与更新\n2. 选择那个源点击编辑\n3. 更改 发行版 信息 (请在网页上查看这个源的仓库文件内的dists目录下有哪些发行版)\n\n#### Ubuntu18.04 解决一些软件依赖不满足问题的问题\n____________________________________________\n=> 以Ubuntu18.04安装16.04版本网易云音乐为例\n```ssh\n# gdebi安装包\n$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb\n$: Dependency is not satisfiable: libqt5libqgtk2\n# Ubuntu18.04报出依赖问题，原因是libqt5libqgtk2已经被新的库qt5-style-plugins替代，\n# 软件源里找不到这个库，当然我们也能手动安装libqt5libqgtk2，但是很可能会就此引出新的依赖问题\n```\n=> 方法：解压安装包修改依赖项并重新打包\n=> 步骤：\n1. deb包同级目录下创建文件夹\n```ssh\n$: mkdir netease-cloud-music\n```\n2. 解压安装包到这个文件夹中\n```ssh\n$: dpkg -X netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb netease-cloud-music\n```\n3. 解压控制信息\n ```ssh\n$: dpkg -e netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb neteas-cloud-music/DEBIAN/\n```\n4. 修改依赖文件(把libqt5libqgtk2修改为qt5-style-plugins)\n```ssh\n# vim编辑文件\n$: vim neteas-cloud-music/DEBIAN/control\n# 使用vim正则对libqt5libqgtk2进行搜索替换\n:1,$s/libqt5libqgtk2/qt5-style-plugins/g\n# 或是手动查找Depends那一行中声明的libqt5libqgtk2进行替换替换即可\n```\n5. 生成新的安装包\n```ssh\n$: dpkg-deb -b neteas-cloud-music\n$: mv neteas-cloud-music.deb netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n```\n6. 安装\n```ssh\n# 使用gdebi或dpkg进行安装即可\n$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n$: sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n```\n\n#### Linux分区过小导致后期容量不足解决方法\n=> 之前安装ubuntu 18.04的时候/var 分区只给了 1.5G，结果现在不够用了\n\n* 方法1\n```sh\n$: sudo apt-get clean\n$: sudo apt-get autoremove\n```\n如果仍然空间不足，使用方法2。\n* 方法2\n建立目录软链接解决(软链接和硬链接了解一下)：\n```sh\n# 以/var目录为例 将占用过大的文件夹移出\n$: mv /var/lib /opt\n# 建立opt下的lib内目录的软链接到var目录\n$: sudo ln -s /opt/lib /var\n```\n* 方法3\n如果/var没有单独分区，则系统默认共享使用/home目录，若此时提示/var空间不足，则说明/home空间不足，这种情况，建议重新安装系统，重新规划分区结构。一般来说，/var目录2G-4G为好，或者不分区，共享/home。\n\n#### Shadowsocks-Qt5安装的问题\n________________________\n> shadowsocks的GUI版本，用Qt写的，还行，不过我喜欢用sslocal命令脚本来连接服务器，开机自启动，很方便。顺带写个安装流程，不过会遇到我上面提到的 __软件源提示没有Release文件的问题__，可以通过上面的方法解决，这里需要将shadowdocks-Qt5发行版信息更改为`artful`，改为其它发行版可能会遇到依赖问题，遇到依赖问题多尝试几个，还有两行配置文件都要改额。  \n\n\\> sudo add-apt-repository ppa:hzwhuang/ss-qt5  \n\\> sudo apt update  \n\\> sudo apt-get install shadowsocks-qt5  \n\n#### 使用polipo开启终端代理(需要先开启shadowsocks代理)\n________________________________________________\n* 安装脚本(适合于bash和zsh终端) => [github / nojsja / polipo-install-config.sh\"](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks-terminal)\n* 使用方式  \n\\> 说明：' hp ' == ' http_proxy=http://localhost:8123 ' for any command  \n\\> 说明：' gp ' == 'http.proxy=localhost:8123' for git proxy config  \n\\> 使用1：`hp curl ip.gs`\n\\> 使用2：`git clone https://android.googlesource.com/tools/repo --config $gp`\n* 如果polipo启动报错的话(通过`systemctl status polipo`查看)，可能是你的垃圾清理软件删除了polipo的日志文件夹，你可以手动更改polipo配置文件(`/etc/polipo/config`)禁用日至记录功能\n#### 将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表\n_______________________________________________________\n>很多软件只有解压版，虽然可以解压后发送快捷方式到桌面，但是没有图标，应用列表也看不了。\n\n=> 安装脚本(测试环境ubuntu18.04) => [github / nojsja / makeIconLink](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/application)\n=> 使用方式\n* 安装之前：请先将需要作为图标的icon图片(比例1:1比较适合，分辨率最好大于64px % 64px)放入目标文件夹内\n* 查看说明：\n```sh\n$: bash makeIconLink --help\n```\n* 安装指令：\n```sh\n$: bash makeIconLink --dir /path/to/[exec-file] --target [exec-file-name] --icon [icon-file-name]\n```\n* 卸载指令：\n```sh\n$: bash makeIconLink --uninstall [exec-file-name]\n```\n\n#### 自定义shadowsocks服务开机自启动脚本\n-------------------------------------------------------------\n> 使用systemd来管理shadowsocks服务，开机自启动，不用打开shadowsocks-qt5软件，FQ了无痕 ~\n\n=> 我的服务脚本：[startup.sh](https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/startup.sh)、[shadowsocks](https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/shadowsocks)  \n=> 步骤：\n\n* 编写shadowsocks service脚本文件，比如shadow.service\n\n```sh\n[Unit]\n# 描述\nDescription=Shadowsocks Service\n\n[Service]\nType=oneshot\n# 服务 start/stop 执行脚本(具体执行路径根据自己的目录更改)\nExecStart=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh start\nExecStop=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh stop\nRemainAfterExit=yes\n\n[Install]\n# 一些简单的依赖信息\nWantedBy=multi-user.target\n```\n\n* 将服务配置文件放到`/etc/systemd/system`下  \n\\> sudo cp shadow.service /etc/systemd/system\n* 设置服务自启动  \n\\> systemctl enable shadow\n* 服务开启和关闭  \n\\> systemctl start shadow  \n\\> systemctl stop shadow\n\n#### Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效\n________________________\n=> 先来一个shadowsocks全局pac代理的步骤：\n```sh\n# pip需要先安装\n$: sudo apt-get install python-pip python-dev build-essential\n$: sudo pip install --upgrade pip\n$: sudo pip install --upgrade virtualenv\n# 安装pac自动生成程序\n$: sudo pip install genpac\n# 生成pac文件\n$: mkdir ~/shadowsocks\n$: cd shadowsocks\n# proxy配置中的地址和端口具体要看你的shadowsocks连接配置\n$: genpac --proxy=\"SOCKS5 127.0.0.1:1080\" --gfwlist-proxy=\"SOCKS5 127.0.0.1:1080\" -o autoproxy.pac --gfwlist-url=\"https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt\"\n```\n以上操作会在~/shadowsocks目录下生成autoproxy.pac配置文件，到系统设置 -> 网络 -> 网络代理 -> 自动 -> 填入file:///path/to/autoproxy.pac(上面我们生成的pac文件路径)，如果要新增被代理网站的话就自己编辑pac文件，在里面的域名列表里面再添加新的域名就好了。\n=> 再写一个脚本[genpac-command](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks/genpac)，可以用来添加用户过滤规则(user-rules.txt) 和在线更新autoproxy.pac代理文件\n```sh\n# # 在脚本目录下执行\n# 显示帮助信息\n$: bash genpac-command --help\n# 在线更新\n$: bash genpac-command --update-online\n# 从本地user-rules.txt文件读取更新\n$: bash genpac-command --update-local\n# 添加自定义规则\n$: bash genpac-command --add-rules opendesktop.org\n# 添加多个自定义规则\n$: bash genpac-command --add-rules opendesktop.org atom.io\n# 删除自定义规则\n$: bash genpac-command --del-rules opendesktop.org\n# 删除多个自定义规则\n$: bash genpac-command --del-rules opendesktop.org atom.io\n```\n=> __不过我遇到了代理pac文件配置好后，firefox和google浏览器仍然不能FQ的情况，仔细排查原因，我发现因为之前我不是用的pac全局代理，是通过浏览器的SwitchOmega插件来手动代理的，这个插件会接管浏览器的网络代理权限，我们需要到浏览器设置里面把网络代理设置为系统代理，以火狐浏览器为例：__\n\n#### Atom编辑器内存占用过大的问题\n______________________________\n>Atom、Vscode、Sublime、Bracks都用过，Atom用着最爽，可定制化程度最高。但是有时候用着Atom电脑呼呼作响，查看系统占用，Atom内存占用达到过4、5个G，我的天！其实Atom出现内存泄漏的问题都不是Atom本身的问题，一定是你安装的哪个插件导致了内存泄漏，查看占用信息后定位到atom的插件，然后把它禁用就可以了，比如之前导致我出现这个问题的插件就是：ide-typescript，禁用之后现在基本一个Atom进程只占用200~400Mb左右，取决于你安装的其它插件。还有Atom要经常手动更新啊，仓库里面更新不了的，直接去Atom git仓库下载release正式版本，基本上一个大版本就要更新一次。\n\n#### Grub2 主题安装\n_________________\n![source.png](/blogs/img/article/Ubuntu18.04-12.png)\n>Grub2就是引导操作系统启动的东西，开机的时候如果是多系统，就会显示多系统的启动菜单，如图，这个启动菜单可以自定义主题。\n\n1. 解压下载的主题文件 => [Vimix](https://pan.baidu.com/s/1ioMub2JmHlIzHJbS2_2gRQ)，得到Vimix文件夹(这里提供我用的一个主题，也可以自已去下载其它主题)\n2. 在/boot/grub里创建GRUB2主题目录themes\n\\> sudo mkdir -p /boot/grub/themes\n3. 将下载的Vimix文件夹整体复制到/boot/grub/themes文件夹下\n\\> sudo cp -r Vimix /boot/grub/themes\n4. 修改/etc/default/grub配置文件\n\\> sudo gedit /etc/default/grub\n在文件最后添加：GRUB_THEME=\"/boot/grub/themes/Vimix/theme.txt\" 并保存\n5. 更新GRUB\n\\> sudo update-grub\n6. 重启即生效(如果重启卡住请强制关机后再启动)\n\n#### Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer\n_________________________________________________________\n![firefox_proxy.png](/blogs/img/article/Ubuntu18.04-13.png)\n\n1. [sourceforge](http://sourceforge.net/projects/corefonts/files/the%20fonts/final/)下载如图所示11个exe文件并放入一个文件夹，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer\n2. 运行字体配置程序\n\\> sudo dpkg-reconfigure ttf-mscorefonts-installer\n3. 在配置窗口中输入刚才保存exe的路径确定即可，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer\n\n#### Ubuntu18.04 WPS 提示字体缺失的解决方法\n---------------------------------------\n下载缺失的字体文件[fonts](https://pan.baidu.com/s/10MushHhTXwfRIFkKGmwD7Q) (密码: 4jpo)，然后复制到Linux系统中的/usr/share/fonts文件夹中，再使用系统命令更新字体设置：\n```sh\n# 生成字体的索引信息\n$: sudo mkfontscale\n$: sudo mkfontdir\n# 更新字体缓存\n$: sudo fc-cache\n```\n\n#### Ubuntu18.04 更新Gnome版本\n---------------------------------------\n```sh\n# Upgrade\n#If you were using the gnome3-team/gnome3-staging PPA, run the following before upgrading:\n$: sudo ppa-purge ppa:gnome3-team/gnome3-staging\n$: sudo ppa-purge ppa:gnome3-team/gnome3\n$: sudo apt install ubuntu-gnome-desktop^\n# The included GUI update manager will offer you the latest release of Ubuntu GNOME. Access this via the terminal:\n$: update-manager -c\n# Alternatively, run the following command:\n$: sudo do-release-upgrade\n```\n\n\n#### Win10 + Ubuntu18.04 双系统时间显示不对\n______________________________________\n>Ubuntu和Windows默认的时间管理方式不同，所以双系统发生时间错乱是正常的。Ubuntu默认时间是把BIOS时间当成GMT+0时间，也就是世界标准时，而我国在东八区(GMT+8)，所以如果你的Ubuntu位置是中国的话你系统显示的时间就是BIOS时间+8小时。假如现在是早上8点，那么你Ubuntu会显示8点，这时BIOS中的时间是0点。而当你切换到Windows系统时就会发生时间错乱，因为Windows会认为BIOS时间就是你的本地时间，结果就是Windows显示时间为0点……而假如你在Windows下同步时间，恢复显示为8点，这时BIOS时间也会被Windows改写成8点，再次进入Ubuntu时显示时间又变成了8+8=16点。\n\n1. 先在Ubuntu下更新一下时间\n\\> sudo apt-get install ntpdate\n\\> sudo ntpdate time.windows.com\n2. 将时间更新到硬件上\n\\> sudo hwclock --localtime --systohc\n3. 关闭linux重新进入windows系统，发现时间正常了\n\n#### Ubuntu18.04 安装系统时说明(双硬盘)\n______________________________________________\n> 主要分为 [ _GPT磁盘分区+UEFI引导方案_ ] 和 [ _传统MBR磁盘分区 + LEGANCY引导方案_ ]\n1. 方案一(兼容方案 gpt+uefi / mbr+legancy)\n使用UEFI模式安装Ubuntu18.04时可以选择用 兼容bios启动方式 来安装系统(同时兼容传统启动方式和UEFI启动方式)，即不分配\"/boot \"分区，分配一个大小为1GB左右的\"保留bios启动区域\"(UEFI模式会自动挂载/boot和/boot/efi)，其它分区至少还需要一个根分区\"/\"，8G内存的情况下最好还是分配8G的swap交换分区，另外除了\"保留bios启动区域\"为主分区，其它分区均为逻辑分区，最后一步很重要 -- 格式化每个分区，要不然安装很可能会出错！[参考](https://blog.csdn.net/jesse_mx/article/details/61425361\n)\n2. 方案二(gpt+uefi 已使用方案)\n创建\"efi系统分区\"，同时不需要划分\"/boot\"分区(boot引导是grub由引导的，而efi显然是UEFI引导的)，其余至少还需要划分\"/\"根分区，除了根分区所有分区都为逻辑分区，最后选择\"安装启动引导器的设备\"为刚才创建的\"efit系统分区\"。\n3. 方案三(传统mbr+legancy方案)\n传统的legancy + mbr的安装，至少划分\"/boot\"分区(主分区) 和 \"/\"根分区，其余的分区按需划分，最后选择\"安装启动引导器的设备\"为创建的\"/boot\"挂载点。\n\n#### Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题\n[=> 原帖子](https://askubuntu.com/questions/1030867/how-to-diagnose-fix-very-slow-boot-on-ubuntu-18-04)\n1. 编辑文件 `/etc/default/grub` 的 `GRUB_CMDLINE_LINUX_DEFAULT` 这一行，加入一个参数__noresume__\n```sh\nGRUB_CMDLINE_LINUX_DEFAULT=\"quiet splash noresume\"\n```\n2. 更新grub\n```sh\n$: sudo update-grub\n```\n3. 重启电脑\n\n#### Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法\n_________________________________________________\n* 使用root权限命令行后台启动并且屏蔽输出\n\\> sudo netease-cloud-music > /dev/null 2>&1  &\n* 规避session-manager引起的bug\n\\> alias netease='unset SESSION_MANAGER && netease-cloud-music'\n\\> netease > /dev/null &\n* 别用那个鸡肋的客户端了，有bug也不更新，上这个酷酷的第三方客户端[ieaseMusic](https://github.com/trazyn/ieaseMusic)\n* 这里还有个别人做的针对ubuntu18.04的[重新构建版本](https://github.com/innoob/netease-cloud-music)，可以正常使用，也没有重复登录的bug\n\n\n#### Ubuntu18.04 Crossover17安装QQ后乱码的解决方法\n______________________________________________\n>原因：原来的ume-ui-gothic.ttf不支持很多简体中文字符  \n\n使用其它字体文件替换到目录 /opt/cxoffice/share/wine/fonts 下的[ume-ui-gothic.ttf](https://pan.baidu.com/s/13CDBKrvTAJOhrbuyLw96jA)字体文件 (同名)，记得将下好的文件重命名为ume-ui-gothic.ttf。\n\n#### Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错\n_______________________________________________________\n=> 错误信息：`Error: Requiring Clutter, version none: Typelib file for namespace 'Clutter' (any version) not found ...`  \n=> 原因分析：该插件需要的依赖Clutter尚未安装\n=> 解决方法：\n```sh\n# 安装依赖\n$: sudo apt-get install gir1.2-clutter-1.0 gir1.2-clutter-gst-3.0 gir1.2-gtkclutter-1.0\n```\n\n#### Ubuntu18.04 Gnome-Shell 插件\n______________________________________________\n* [CoverFlow Alt-Tab](https://extensions.gnome.org/extension/97/coverflow-alt-tab/) => 窗口Tab切换预览(★★★★☆)\n* [User Themes(必要)](https://extensions.gnome.org/extension/19/user-themes/) => 用户主题安装(★★★★★)\n* [Dash To Dock](https://extensions.gnome.org/extension/307/dash-to-dock/) => dock栏(★★★★★)\n* [Dash To Panel](https://extensions.gnome.org/extension/1160/dash-to-panel/) => 将dock和顶栏显示在一起(★★★★★)\n* [NoAnnoyance](https://extensions.gnome.org/extension/1236/noannoyance/) => 禁用多余的pop提示信息，直接提升活动窗口(★★★★★)\n* [Autohide Battery](https://extensions.gnome.org/extension/595/autohide-battery/) => 电池充满并连接电源时自动隐藏电池按钮(★★★★★)\n* [Places Status Indicator](https://extensions.gnome.org/extension/8/places-status-indicator/) => 顶部任务栏显示磁盘和卷的快捷入口(★★★★★)\n* [Removable Drive Menu](https://extensions.gnome.org/extension/7/removable-drive-menu/) => 顶部任务栏显示可移除的已挂载设备(★★★★★)\n* [Suspend Button](https://extensions.gnome.org/extension/826/suspend-button/) => 顶部菜单栏显示休眠按钮(★★★★★)\n* [TopIcons](https://extensions.gnome.org/extension/495/topicons/) => 顶部通知图标托盘(★★★★★)\n* [TopIconsPlus](https://extensions.gnome.org/extension/1031/topicons/) => 顶部通知图标托盘，自定义图标显示参数(★★★★☆)\n* [Blyr](https://extensions.gnome.org/extension/1251/blyr/) => 模糊应用预览背景图(★★★★★)\n* [Activities Configurator](https://extensions.gnome.org/extension/358/activities-configurator/) => 配置左上角活动按钮(★★★★☆)\n* [Workspace to Dock](https://extensions.gnome.org/extension/427/workspaces-to-dock/) => 将工作区转换为悬浮dock(★★★★★)\n* [Extensions](https://extensions.gnome.org/extension/1036/extensions/) => 在通知栏添加快捷开启和关闭gnome-shell插件的功能(★★★★★)\n* [Clipboard Indicator](https://extensions.gnome.org/extension/779/clipboard-indicator/) => 可视化剪贴板(★★★★★)\n* [Sound Input & Output Device Chooser](https://extensions.gnome.org/extension/906/sound-output-device-chooser/) => 声音输入和输入设备快速选择(★★★★★)\n* [NoAnnoyance](https://extensions.gnome.org/extension/1236/noannoyance/) => 取消“窗口已就绪”提示直接提升窗口(★★★★★)\n* [Bluetooth quick connect](https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/) => 蓝牙设备快速连接和断开(★★★★★)\n* [Remove Alt+Tab Delay](https://extensions.gnome.org/extension/1403/remove-alttab-delay/) => 移除【Alt + Tab】的开启应用预览延迟(★★★★★)\n* [Emoji Selector](https://extensions.gnome.org/extension/1162/emoji-selector/) => 快速选择Emoji表情(★★★★)\n\n#### Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置\n--------------------------------------------\n```sh\n#Use Custom Dock Indicator ( Optional )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-running-dots false\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-customize-running-dots false\n_______________________________________________________________________________________________\n\n# Disable Custom Dock Shrink ( Required for Good looking) (  Required )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-shrink false\n_______________________________________________________________________________________________\n\n# Dock Transparency mode ( Optional )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock transparency-mode DEFAULT\n_______________________________________________________________________________________________\n\n# Restore to Default\n$: dconf reset -f /org/gnome/shell/extensions/dash-to-dock/\n_______________________________________________________________________________________________\n```\n\n#### Ubuntu18.04 主题\n______________________________________________\n* GTK3主题(★★★★☆) => [X-Arc-Collection](https://www.gnome-look.org/p/1167049/)\n* GTK3主题(★★★★★) => [McOS-themes](https://www.gnome-look.org/p/1241688)\n* Gnome Shell主题(★★★★) => [Flat-Remix](https://github.com/daniruiz/flat-remix)\n* Gnome Shell主题(★★★☆) => [Human](https://www.gnome-look.org/p/1171095/)\n* Gnome Shell主题(★★★★★) => [macOS High Sierra](https://www.opendesktop.org/c/1460761561)\n* Gnome Shell主题(?) => [macOS High Sierra](https://www.gnome-look.org/p/1213208/)\n* Icon 主题(★★★★) => [flat-remix](https://github.com/daniruiz/flat-remix/releases)\n* Icon 主题(★★★★☆) => [Mac OS X Icon](https://www.gnome-look.org/p/1012200/)\n* Icon 主题(★★★★★) => [la-capitaine-icon-theme](https://github.com/keeferrourke/la-capitaine-icon-theme/releases)\n* Icon 主题(★★★★★) [McMojave-circle](https://www.pling.com/p/1305429/)\n* Icon 主题(★★★★☆) => [MacOS sierra ct](https://github.com/zayronxio/Macos-sierra-CT)\n* Cursor主题(★★★★☆) => [Capitaine Cursors](https://krourke.org/projects/art/capitaine-cursors)\n\n#### chrome实用插件整理\n-----------------------------------\n* [infinity pro 标签页](https://chrome.google.com/webstore/detail/infinity-new-tabproductiv/dbfmnekepjoapopniengjbcpnbljalfg?utm_source=InfinityNewtab) => 主页标签管理器(★★★★★)\n* [Octotree](https://chrome.google.com/webstore/detail/octotree/bkhaagjahfmjljalopjnoealnfndnagc?utm_source=InfinityNewtab) => github仓库文件资源浏览树(★★★★★)\n* [Postman](https://chrome.google.com/webstore/detail/postman-interceptor/aicmkgpgakddgnaphhhpliifpcfhicfo?utm_source=InfinityNewtab) => API测试和请求模拟器(★★★★★)\n* [SwitchyOmega](https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?utm_source=InfinityNewtab) => 大家都用的代理软件(★★★★★)\n* [印象笔记剪藏](https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?utm_source=InfinityNewtab) => 随时随地把网络资源保存到你的笔记本里(★★★★★)\n* [SimpRead](https://chrome.google.com/webstore/detail/simpread-reader-view/ijllcpnolfcooahcekpamkbidhejabll?utm_source=InfinityNewtab) => 让浏览器支持纯净的阅读模式(★★★★★)\n* [Full Page Screen Capture](https://chrome.google.com/webstore/detail/full-page-screen-capture/fdpohaocaechififmbbbbbknoalclacl?utm_source=InfinityNewtab) => 全屏截图(★★★★☆)\n* [油猴tampermonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=InfinityNewtab) => 用户脚本管理器，一个用例是破解badu网盘的限速(★★★★★)\n* [Checker Plus for Gmail](https://chrome.google.com/webstore/detail/checker-plus-for-gmail/oeopbcgkkoapgobdbedcemjljbihmemj?utm_source=InfinityNewtab) => Google邮件提示插件(★★★★☆)\n* [Vimium](https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=InfinityNewtab) => 让google浏览器支持vim模式(firefox也有)(★★★★★)\n* [拷贝为Markdown](https://chrome.google.com/webstore/detail/copy-as-markdown/dgoenpnkphkichnohepecnmpmihnabdg) => 将选中网页转化为markdown格式并发送到剪贴板(★★★★☆)\n\n#### 实用程序和命令\n_______________________________\n* [fonts-firacode编程字体](https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager) => 解决vscode字体间隙过小的问题`sudo apt install fonts-firacode`\n* [vivaldi浏览器](https://vivaldi.com) => 可定制化程度高的个性化浏览器(★★★★★)\n* Terminator => 默认gnome终端升级版(★★★★★)\n* Timeshift => 创建系统快照，增量备份(★★★★★)\n* ipython3(命令工具) => python交互解释器(★★★★★)\n* jupyter => 交互式数据分析和记录工具(★★★★☆)\n* pdb/ipdb(命令工具) => python调试器(★★★★☆)\n* trash-cli(命令工具) => 命令行回收站(★★★★★)\n* bat(命令工具) => cat升级版，支持语法高亮和git状态显示(★★★★★)\n* axel(命令工具) => 下载限速不存在的，如果存在那我就开100个下载线程 : )(★★★★☆)\n* [aria2(命令工具)](https://github.com/aria2/aria2) => 强大的命令行下载工具\n* [stacer](https://github.com/oguzhaninan/Stacer) => linux电脑管家(★★★★★)\n* [ieaseMusic](https://github.com/trazyn/ieaseMusic) => 网易云音乐第三方客户端，没有bug，不会退出后再打开就让重新登陆\\[注：网易云音乐官方已修复]，界面还很酷(★★★★★)\n* parallel(命令工具) => 利用系统的多核来并行执行你的程序(★★★★☆)\n* cheat(命令工具) => 类似man命令的功能，简洁高效(★★★★☆)\n* topgrade(命令工具) => 一个命令更新所有软件(★★★★)\n* [dbKoda](https://www.dbkoda.com/) => mongodb GUI工具(★★★★☆)\n* [mongodb compass](https://www.mongodb.com/products/compass) => mongodb GUI工具(★★★★)\n* [peek](https://github.com/phw/peek) => 屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件(★★★★☆)\n* tmux => 终端管理器(★★★★)\n* 深度终端(ubuntu商店下载) => 支持分屏，内置实用主题(★★★★☆)\n* 深度截图(ubuntu商店下载) => 支持截图编辑(★★★★★)\n* [WebTorrent](https://webtorrent.io/desktop/)、[FrostWire](https://www.frostwire.com/) => bt下载工具，支持边下边播(★★★★)\n* [SmartGit](https://www.syntevo.com/smartgit/) => linux平台免费的GIT GUI工具(★★★★★)\n* FileZilla => ftp工具(★★★★★)\n* [e-tools](https://github.com/Suremotoo/e-tools) => coder常用小工具(★★★★)\n* [WhatEver](https://electronjs.org/apps/whatever) => linux第三方印象笔记客户端，基于网页版(★★★★)\n* [wps](http://linux.wps.cn/) => linux office for free made by KingSoftware(★★★★★)\n* [Atom](https://atom.io/) => 我一直在用的编辑器，没有固态硬盘的不推荐使用(★★★★☆)\n* [vscode](https://code.visualstudio.com/) => 轻量化编辑器，没有Atom人性化，但是很快。都是JS写的，性能差距咋这么大呢 ? (★★★★★)\n* ndb => node.js/javascript 调试器(★★★★★)\n* [nvm](https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh) => nodejs版本管理器\n* albert (添加软件源 `ppa:noobslab/macbuntu` 安装 ) => 桌面全局搜索类似Mac系统的SpotLight(★★★★★)\n* [lftp](https://linux.cn/article-5460-1.html) => 一个基于命令行的文件传输软件，支持FTP，FTPS，HTTP，HTTPS，HFTP，FISH，以及SFTP等协议，也有许多高级特性比\n如：多线程下载、断点续传\n* [redshift-gtk](http://jonls.dk/redshift/) 护眼模式，自带的色彩太黄了\n* apt-fast => 比apt更快的包管理器，添加`ppa:apt-fast/stable`安装(★★★★★)\n* nautilus action configure tool => 资源管理器右键菜单自定义，添加`ppa:daniel-marynicz/filemanager-actions`安装(★★★★★)\n* tig => 可交互的命令行git命令(★★★★★)\n* shellcheck => shell脚本语法检查(★★★★★)\n* [Motrix](https://motrix.app/zh-CN/) => 全平台下载工具，用于替代迅雷(★★★★★)\n* [Insync](https://www.insynchq.com/) => 全平台同步工具，支持google云和onedrive(★★★★★)\n* [Timeshift](https://github.com/teejee2008/timeshift) => 创建系统增量备份计划(★★★★★)\n* dconf-editor => gnome桌面配置gui工具(★★★★)\n\n#### 实用网站推荐\n_______________\n![Vimix.png](/blogs/img/article/Ubuntu18.04-14.png)\n\n* [Wallpaper](https://wallpapershome.com/)  => 高清桌面壁纸下载，支持多种分辨率(★★★★★)\n* [flaticon](https://www.flaticon.com) => 免费图标下载网站，支持svg和png两种格式\n* [Electron Apps](https://electronjs.org/apps) => 有很多Electron 框架写的跨平台应用(Linux/Mac/Windows)(★★★★☆)\n* [Linux运维日志](https://www.centos.bz/) => 服务搭建、Linux技术之类的(★★★★☆)\n* [IBM Developer](https://www.ibm.com/developerworks/cn/) => 技术文档类的参考(★★★★★)\n* [Linux常用命令](https://www.lulinux.com/archives/2513#awk)  =>  常用命令速查(★★★★☆)\n* [bilibili工具网站](https://www.kanbilibili.com/) => 支持 视频/弹幕/封面 下载等骚操作(★★★★★)\n* [Linux中国](https://linux.cn/) => 没事儿就上去看看别人翻译转载的文章(★★★★☆)\n* [TinyPNG](https://tinypng.com/) => 免费的图片无损压缩网站(★★★★☆)\n* [iLoveIMG](https://www.iloveimg.com/zh-cn) => 在线图片编辑网站(★★★★★)\n* [savefrom](https://en.savefrom.net/) => 直接下载youtube视频(★★★★☆)\n* [撸Linux](https://www.lulinux.com/) => 好像还蛮有趣的额(★★★★☆)\n* [油猴脚本](https://greasyfork.org/zh-CN/scripts) => 你甚至可以用来破解百度云限速(★★★★★)\n\n_注：以上内容部分是从网络搜集，希望解决广大Linuxer的问题所以做了部分整合._","source":"_posts/Ubuntu18.04踩坑记录.md","raw":"---\ntitle: \"Ubuntu18.04踩坑记录\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-04 16:30:35\nsubtitle: \"ubuntu18.04 linux\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Ubuntu18.04\n- Linux\ncatagories:\n- Linux\nupdateDate: 2018-04-04 16:30:35\ntop: 1\n---\n\n![welcome / home](/blogs/img/article/Ubuntu18.04-1.jpg)\n\n#### Contents\n__________\n\n* Wine应用启动后出现WineSystemTray 托盘的问题\n* 中文环境下将Home目录下的文件夹切换为英文名\n* Ubuntu系发行版安装deepin wine QQ\n* 续：安装QQ/微信\n* Ubuntu 18.04开机启动特别慢的问题\n* 终端oh-my-zsh配置\n* 终端终结者Terminator配置\n* 禁用内核更新\n* 终端常用等宽字体\n* crossover18破解\n* vim插件配置\n* Ubuntu18.04 定制Mac主题\n* Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式\n* Ubuntu18.04 关于定制plymouth主题来更换开机动画\n* Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题\n* Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题\n* Ubuntu18.04 解决一些软件依赖不满足问题的问题\n* Linux分区过小导致后期容量不足解决方法\n* Shadowsocks-Qt5安装的问题\n* 使用polipo开启终端代理(需要先开启shadowsocks代理)\n* 将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表\n* 自定义shadowsocks服务开机自启动脚本\n* Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效\n* Atom编辑器内存占用过大的问题\n* Grub2 主题安装\n* Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer\n* Ubuntu18.04 WPS 提示字体缺失的解决方法\n* Ubuntu18.04 更新Gnome版本\n* Win10 + Ubuntu18.04 双系统时间显示不对\n* Ubuntu18.04 安装系统时说明(双硬盘)\n* Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题\n* Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法\n* Ubuntu18.04 Crossover17安装QQ后乱码的解决方法\n* Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错\n* Ubuntu18.04 Gnome-Shell 插件\n* Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置\n* Ubuntu18.04 主题\n* chrome实用插件整理\n* 实用程序和命令\n* 实用网站推荐\n\n#### Wine应用启动后出现WineSystemTray托盘的问题\n____________________________________________\n![wine_tray.png](/blogs/img/article/Ubuntu18.04-2.png)\n\n![tray.png](/blogs/img/article/Ubuntu18.04-3.png)\n1. 操作系统Linux Mint18.3\n右键点击面板(状态栏)，选择 - 向面板添加小程序，选择小程序 - 系统托盘，点击+号添加，之后Wine安装的应用和其它应用的图标就被系统托盘管理了。\n\n2. 操作系统Ubuntu 18.04\n安装gnome-shell插件 [TopIcons](https://extensions.gnome.org/extension/495/topicons/), 要想从浏览器上安装这个TopIcons需要先安装浏览器gnome交互插件chrome-gnome-shell (`sudo apt install chrome-gnome-shell` )，使用deepin QQ的时候可能需要重新启动TopIcons才能显示顶部QQ图标，如果遇到图标无故隐藏的问题那么可以再安装插件[Dash to Panel](https://extensions.gnome.org/extension/1160/dash-to-panel/)解决。\n\n#### 中文环境下将Home目录下的文件夹切换为英文名\n-------------------------------------------------------------------------\n1.  设置英文语言环境\n```sh\n$: export LANG=en_US(恢复-> zh_CN)\n```\n2. 更新目录\n```sh\n$: xdg-user-dirs-gtk-update\n```\n3. 弹出提示框点击 [确认]\n4. 重启后会再次弹出提示框是否将英文文件夹改回中文，选择 [不再提示] 并 [取消] 修改\n\n#### Ubuntu系发行版安装deepin wine QQ\n__________________________________\n\n1. 安装deepin-wine环境：上[https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu](https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu)页面下载zip包（或用git方式克隆），也可以[百度网盘](https://pan.baidu.com/s/120C5aHuqtyxQyn_fGTxHKg)下载，解压到本地文件夹，在文件夹中打开终端，输入`sudo sh ./install.sh`一键安装，如果你安装了这些依赖，在第二步的时候仍然报依赖错误，那就手动解压deb包，把那些依赖声明删除就行了(解压deb的方法下文中有提到)。\n\n2. 安装deepin.com应用容器：在[http://mirrors.aliyun.com/deepin/pool/non-free/d/](http://mirrors.aliyun.com/deepin/pool/non-free/d/)中下载想要的容器，点击deb安装即可，以下为推荐容器:\n*   QQ：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/)\n*   TIM：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/)\n*   QQ轻聊版：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/)\n*   微信：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/)\n*   Foxmail：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/)\n*   百度网盘：[http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/](http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/)\n*  360压缩：http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/\n*  迅雷急速版:  https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg\n* Ubuntu系发行版包括Ubuntu、LinuxMint、ZorinOS等。\n\n#### 续：安装QQ/微信\n______________________\n\n1.linux上的微信大部分都是网页版微信封装的: [electronic-wechat](https://github.com/geeeeeeeeek/electronic-wechat)、[weweChat](https://github.com/trazyn/weweChat)，网页版功能简单，每次登录都要扫码。而且现在腾讯好像开始禁用了微信网页版的登陆，如果发现不能登录网页版就只能使用crossover来安装windows版的微信。\n\n2.￥140可以买个CrossOver18正版，一次激活，永久使用，然后愉快地安装QQ8.9，喜欢TIM的也能用TIM， 不过目前这个基于crossover的QQ有些bug，也不能记住密码。使用crossover18安装微信，安装包直接下载windows版本的就行，然后使用crossover创建windowsXP 64位容器，在容器中安装微信即可，不过可能安装时会出现`\"WeChatWin.dll 缺失问题\"`报错信息，需要执行下面命令安装额外的环境：\n```sh\n$: apt-get install libldap-2.4-2:i386\n```\n\n3.使用docker安装[Tim](https://hub.docker.com/r/bestwu/qq) 和 [wechat](https://hub.docker.com/r/bestwu/wechat)，[docker环境安装教程](https://www.runoob.com/docker/ubuntu-docker-install.html)\n\n4.wine环境下(crossover/deepin)安装好微信后如果发现不能输入文字(其实可以输入和发送，只是文字透明的)，可以使用这个文件[riched20.dll](https://pan.baidu.com/s/1-ScZvkmR9oZPdiFurdKQdA)(提取密码：rofj)替换掉微信所在容器下的C盘的`/windows/system32/riched20.dll`，容器路径一般在：`~/.cxoffice/[你的容器名]/drive_c/`。\n\n5.wine环境下(crossover/deepin)如果运行微信时发现界面有一个黑框不能关闭，只需要在聊天输入框中键入中文“不”然后再删除即可让黑框消失(原因:微信会根据你输入的字作为关键字在你现有表情中找符合的表情并显示出来提示你可用,但并没有很好的兼容这个功能变成一个黑框了，所以手动消除黑框的办法只有打关键字然后删除)。\n\n6.wine环境下(crossover/deepin)如果运行微信的时候不能发送图片，尝试安装 `sudo apt install libjpeg62:i386`，临时解决办法是把图片文件拖动到`收藏`，然后从收藏转发即可。\n\n7.wine环境下(crossover/deepin)如果运行QQ发现收到的图片一直加载不出来(刚登录开始可以，过一会就不行了)，那么可以在QQ登录界面设置一下网络代理(http/socks)，注意本地代理情况下代理地址不能使用localhost/127.0.0.1此类的IP，使用0.0.0.0是可以的。\n\n#### Ubuntu 18.04开机启动特别慢的问题\n_________________________________\n=> 禁用不必要的开机服务：\n```sh\n# 列出程序开机占用时间排行\nsystemd-analyze blame\n# 禁用plymouth\nsudo systemctl mask plymouth-start.service\nsudo systemctl mask plymouth-read-write.service\n```\n#### 终端oh-my-zsh配置\n_________________________________\n1. 主题\n* gnzh(已使用))\n* ys \n* avit\n* af-magic\n2. 插件\n* git => 自带git状态插件\n* svn => svn状态插件\n* colored-man-pages => man帮助信息高亮\n* zsh-syntax-highlighting => 命令高亮和错误提示\n* z => 自动记录路径快捷跳转\n* zsh-autosuggestions => 根据输入记录自动建议可选输入命令\n\n#### 终端终结者Terminator配置\n---------------------------\n特性：浅色调、字体舒适、无滚动条、自定义快捷键和配色、自动设置窗口布局\n\n注意：可以配合`设置->设备->键盘->添加自定义快捷键`这样自定义快捷键来启动终端，\n比如设置`Ctrl+Alt+T`为`terminator --geometry=93x32+450+300`，geometry为窗口的布局配置。\n\n覆盖文件`~/.config/terminator/config`内容：\n\n```bash\n  [global_config]\n  enabled_plugins = CustomCommandsMenu, LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler\n  suppress_multiple_term_dialog = True\n  title_hide_sizetext = True\n[keybindings]\n  prev_tab = <Alt>1\n  reset_clear = <Primary><Shift>g\n  clear = <Primary>l\n  switch_to_tab_1 = <Alt>1\n  switch_to_tab_2 = <Alt>2\n  switch_to_tab_3 = <Alt>3\n  switch_to_tab_4 = <Alt>4\n  switch_to_tab_5 = <Alt>5\n  toggle_scrollbar = None\n  toggle_zoom = <Primary><Shift>x\n[layouts]\n  [[default]]\n    [[[child1]]]\n      parent = window0\n      profile = default\n      type = Terminal\n    [[[window0]]]\n      parent = \"\"\n      size = 925, 570\n      type = Window\n[plugins]\n  [[CustomCommandsMenu]]\n    [[[清屏]]]\n      command = clear\n      enabled = True\n      name = 清屏\n      position = 0\n[profiles]\n  [[default]]\n    allow_bold = False\n    background_color = \"#fbfbfb\"\n    background_darkness = 0.93\n    background_type = transparent\n    copy_on_selection = True\n    cursor_color = \"#aaaaaa\"\n    cursor_shape = ibeam\n    font = Ubuntu Light 12\n    foreground_color = \"#49494a\"\n    palette = \"#2e3436:#ee6a6a:#38690a:#b3adb0:#3465a4:#75507b:#06989a:#d3d7cf:#979b93:#fe5f5f:#7fd42c:#b7afb1:#729fcf:#ad7fa8:#34e2e2:#eeeeec\"\n    scroll_on_keystroke = False\n    scrollbar_position = hidden\n    show_titlebar = False\n```\n\n#### 禁用内核更新\n------------------------\n```sh\n# 查看已安装内核\n$: dpkg --get-selections |grep linux-image\n# 查看正在使用的内核\n$: uname -a\n# 删除旧内核\n$: sudo apt-get remove\n$: linux-image-x.xx.x-xx-generic\n$: sudo apt-get remove  \n$: linux-image-extra-x.xx.x-xx-generic  \n# 或用这个命令移除\n$: sudo dpkg --purge linux-image-x.x.x-xx-generic\n# 禁止更新内核，需时间来验证\n$: sudo apt-mark hold linux-image-x.xx.x-xx-generic\n$: sudo apt-mark hold linux-image-extra-x.xx.x-xx-generic\n# 如果需要恢复原来的设定的话即允许更新内核，执行如下命令即可：\n$: sudo apt-mark unhold linux-image-x.xx.x-xx-generic\n$: sudo apt-mark unhold linux-image-extra-x.xx.x-xx-generic\n```\n\n#### 终端常用等宽字体\n-----------------------------\n* AR PL UKai CN 12\n* Bitstream Vera Sans Mono 10\n* Courier 10 Pitch 11\n* DejaVu Sans Mono 10\n* FreeMono 11\n* Nimbus Mono L 12\n* TlwgMono 11 \n\n#### crossover18破解\n----------------------------\n下载 [CrossoverPatch](https://pan.baidu.com/s/1BnT-cAKf-SBp-6J4CQoo-g ) `密码: ffp0`，解压后替换文件：\n```sh\n#  备份原文件\n$: cp ~/cxoffice/lib/wine/winewrapper.exe.so ~/cxoffice/lib/wine/winewrapper.exe.so-bak\n# 替换文件\n$: cp CrossoverPatch/winewrapper.exe.so ~/cxoffice/lib/wine\n```\n\n#### vim插件配置\n______________\n1. [Vundle](https://github.com/VundleVim/Vundle.vim) => 插件管理器，编辑.vimrc，然后执行命令`vim +PluginInstall`即可安装  \n2. [vim-airline](https://github.com/vim-airline/vim-airline) => 底部状态栏  \n3. [其他配置](https://juejin.im/post/5a38c37f6fb9a0450909a151)\n\n#### Ubuntu18.04 定制Mac主题\n__________________________\n\n![overview.png](/blogs/img/article/Ubuntu18.04-5.png)\n\n![desktop.png](/blogs/img/article/Ubuntu18.04-6.png)\n\n\n1. 安装gnome-tweak-tool 和 chrome-gnome-shell 插件 (`sudo aptitude install [name]`)\n2. 安装GTK3主题 => [X-Arc-Collection](https://www.gnome-look.org/p/1167049/)\n3. 使用tweak载入应用程序主题 => tweak -- 外观 -- 应用程序 -- 选择X-Arc-Collection\n4. 安装gnome-shell 主题 => [macOS High Sierra](https://www.gnome-look.org/p/1167049/)\n5. 安装gnome-shell 插件 => [User Themes](https://extensions.gnome.org/extension/19/user-themes/) ( 之后重启Gnome => [Alt + F2] & [输入 r] & [点击 Enter] )\n6. 使用tweak载入shell主题 => tweak -- 外观 -- shell -- 选择Sierra shell主题\n7.  下载Mac图标主题 [la-capitaine-icon-theme](https://github.com/keeferrourke/la-capitaine-icon-theme/releases) 或 [McMojave-circle](https://www.pling.com/p/1305429/)\n8. 图标文件夹移动到 ~/.icons目录下(没有则新建目录)\n9. 使用tweak载入icon主题 => tweak -- 外观 -- 图标 -- 选择对应的图标主题\n10. 安装gnome-shell插件 => Dash to dock (将原生dock转变为可定制的浮动dock)\n11. 定制firefox主题 => [Majave-gtk-theme](https://github.com/vinceliuice/Mojave-gtk-theme)\n\n#### Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式\n--------------------------------------------------------------------------------------------\n![lockscreen.png](/blogs/img/article/Ubuntu18.04-7.png)\n\n![loginscreen.png](/blogs/img/article/Ubuntu18.04-8.png)\n\n1. 安装脚本 => [github / nojsja / login-manager-config-ubuntu](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/login-manager-config-ubuntu)  \n2. 说明=> 脚本通过更改/usr/share/gnome-shell/theme/ubuntu.css文件中声明的样式来修改系统登录页面按钮布局和背景图片的地址，使用ImageMagick包的`convert -blur`命令制作了毛玻璃效果的登录背景图片，最后还生成了一个SetAsWallpaper脚本，可以在文件夹中的图片文件上右键点击选择运行这个脚本(它会自动把目标图片更改成桌面壁纸和毛玻璃效果化的登录背景图)，最后锁屏壁纸需要用户手动安装`gnome-tweak-tool`进行更改。  \n3. 之前我想通过更改`/usr/share/gnome-shell/theme/gdm3.css`文件来修改样式，可是发现ubuntu18.04下总会有这样那样的问题。\n4. 注意=> 不要贸然尝试更改系统主题的CSS样式文件，如果修改的文件有语法错误或是其它原因，很可能会造成系统开机后无法登入图形界面(出现这种情况可以插入U盘登录PE系统然后挂载原系统的硬盘，最后将错误文件改回即可)。\n\n#### Ubuntu18.04 关于定制plymouth主题来更换开机动画\n-----------------------------------------------------------------------------\n>其实我不建议去改开机动画，一个原因是ubuntu自己的开机动画就挺美观简洁的，第二个原因是这个东西如果改出问题了卡在开机画面到时候恢复起来比较麻烦，如果执意想去折腾的话，可以去[gnome-look](https://www.gnome-look.org/browse/cat/108/)看看，这里提供一个苹果主题[darwin](https://pan.baidu.com/s/1qv3GZ_BE-jj2HIpiI2X7yQ)，密码: `rc6u`。\n1. 解压下载的plymouth主题到 `/usr/share/plymouth/themes`\n\n2. 执行安装\n```sh\n$: sudo update-alternatives --install /usr/share/plymouth/themes/ default.plymouth default.plymouth /usr/share/plymouth/themes/[THEME]/[THEME].plymouth 100\n```\n\n3. 更新配置，需要手动选择plymouth编号\n```sh\n$: sudo update-alternatives --config default.plymouth\n$: sudo update-initramfs -u\n```\n\n4. 手动更改错误路径参数\n```sh\n$: sudo gedit /usr/share/plymouth/themes/default.plymouth\n```\n替换`ImageDir`和`ScriptFile`为正确的plymouth文件存放路径，替换后：\n```sh\nImageDir=/usr/share/plymouth/themes/[THEME]\nScriptFile=/usr/share/plymouth/themes/[THEME]/[THEME].script\n```\n\n\n#### Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题\n---------------------------------------------------------------------------------------------\n>解决方法是去tweak设置里关闭[Dash to dock]的开关，别担心，关闭后，[Dash to dock]仍然正常工作，但是再也不会同时出现两个dock栏的尴尬情况了。  \n\n![dock-noise.png](/blogs/img/article/Ubuntu18.04-9.png)\n\n![dock-single.png](/blogs/img/article/Ubuntu18.04-10.png)\n\n\n\n#### Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题\n________________________________________________________\n![dock-tweak.png](/blogs/img/article/Ubuntu18.04-11.png)\n\n1. 打开 软件与更新\n2. 选择那个源点击编辑\n3. 更改 发行版 信息 (请在网页上查看这个源的仓库文件内的dists目录下有哪些发行版)\n\n#### Ubuntu18.04 解决一些软件依赖不满足问题的问题\n____________________________________________\n=> 以Ubuntu18.04安装16.04版本网易云音乐为例\n```ssh\n# gdebi安装包\n$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb\n$: Dependency is not satisfiable: libqt5libqgtk2\n# Ubuntu18.04报出依赖问题，原因是libqt5libqgtk2已经被新的库qt5-style-plugins替代，\n# 软件源里找不到这个库，当然我们也能手动安装libqt5libqgtk2，但是很可能会就此引出新的依赖问题\n```\n=> 方法：解压安装包修改依赖项并重新打包\n=> 步骤：\n1. deb包同级目录下创建文件夹\n```ssh\n$: mkdir netease-cloud-music\n```\n2. 解压安装包到这个文件夹中\n```ssh\n$: dpkg -X netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb netease-cloud-music\n```\n3. 解压控制信息\n ```ssh\n$: dpkg -e netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb neteas-cloud-music/DEBIAN/\n```\n4. 修改依赖文件(把libqt5libqgtk2修改为qt5-style-plugins)\n```ssh\n# vim编辑文件\n$: vim neteas-cloud-music/DEBIAN/control\n# 使用vim正则对libqt5libqgtk2进行搜索替换\n:1,$s/libqt5libqgtk2/qt5-style-plugins/g\n# 或是手动查找Depends那一行中声明的libqt5libqgtk2进行替换替换即可\n```\n5. 生成新的安装包\n```ssh\n$: dpkg-deb -b neteas-cloud-music\n$: mv neteas-cloud-music.deb netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n```\n6. 安装\n```ssh\n# 使用gdebi或dpkg进行安装即可\n$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n$: sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb\n```\n\n#### Linux分区过小导致后期容量不足解决方法\n=> 之前安装ubuntu 18.04的时候/var 分区只给了 1.5G，结果现在不够用了\n\n* 方法1\n```sh\n$: sudo apt-get clean\n$: sudo apt-get autoremove\n```\n如果仍然空间不足，使用方法2。\n* 方法2\n建立目录软链接解决(软链接和硬链接了解一下)：\n```sh\n# 以/var目录为例 将占用过大的文件夹移出\n$: mv /var/lib /opt\n# 建立opt下的lib内目录的软链接到var目录\n$: sudo ln -s /opt/lib /var\n```\n* 方法3\n如果/var没有单独分区，则系统默认共享使用/home目录，若此时提示/var空间不足，则说明/home空间不足，这种情况，建议重新安装系统，重新规划分区结构。一般来说，/var目录2G-4G为好，或者不分区，共享/home。\n\n#### Shadowsocks-Qt5安装的问题\n________________________\n> shadowsocks的GUI版本，用Qt写的，还行，不过我喜欢用sslocal命令脚本来连接服务器，开机自启动，很方便。顺带写个安装流程，不过会遇到我上面提到的 __软件源提示没有Release文件的问题__，可以通过上面的方法解决，这里需要将shadowdocks-Qt5发行版信息更改为`artful`，改为其它发行版可能会遇到依赖问题，遇到依赖问题多尝试几个，还有两行配置文件都要改额。  \n\n\\> sudo add-apt-repository ppa:hzwhuang/ss-qt5  \n\\> sudo apt update  \n\\> sudo apt-get install shadowsocks-qt5  \n\n#### 使用polipo开启终端代理(需要先开启shadowsocks代理)\n________________________________________________\n* 安装脚本(适合于bash和zsh终端) => [github / nojsja / polipo-install-config.sh\"](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks-terminal)\n* 使用方式  \n\\> 说明：' hp ' == ' http_proxy=http://localhost:8123 ' for any command  \n\\> 说明：' gp ' == 'http.proxy=localhost:8123' for git proxy config  \n\\> 使用1：`hp curl ip.gs`\n\\> 使用2：`git clone https://android.googlesource.com/tools/repo --config $gp`\n* 如果polipo启动报错的话(通过`systemctl status polipo`查看)，可能是你的垃圾清理软件删除了polipo的日志文件夹，你可以手动更改polipo配置文件(`/etc/polipo/config`)禁用日至记录功能\n#### 将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表\n_______________________________________________________\n>很多软件只有解压版，虽然可以解压后发送快捷方式到桌面，但是没有图标，应用列表也看不了。\n\n=> 安装脚本(测试环境ubuntu18.04) => [github / nojsja / makeIconLink](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/application)\n=> 使用方式\n* 安装之前：请先将需要作为图标的icon图片(比例1:1比较适合，分辨率最好大于64px % 64px)放入目标文件夹内\n* 查看说明：\n```sh\n$: bash makeIconLink --help\n```\n* 安装指令：\n```sh\n$: bash makeIconLink --dir /path/to/[exec-file] --target [exec-file-name] --icon [icon-file-name]\n```\n* 卸载指令：\n```sh\n$: bash makeIconLink --uninstall [exec-file-name]\n```\n\n#### 自定义shadowsocks服务开机自启动脚本\n-------------------------------------------------------------\n> 使用systemd来管理shadowsocks服务，开机自启动，不用打开shadowsocks-qt5软件，FQ了无痕 ~\n\n=> 我的服务脚本：[startup.sh](https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/startup.sh)、[shadowsocks](https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/shadowsocks)  \n=> 步骤：\n\n* 编写shadowsocks service脚本文件，比如shadow.service\n\n```sh\n[Unit]\n# 描述\nDescription=Shadowsocks Service\n\n[Service]\nType=oneshot\n# 服务 start/stop 执行脚本(具体执行路径根据自己的目录更改)\nExecStart=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh start\nExecStop=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh stop\nRemainAfterExit=yes\n\n[Install]\n# 一些简单的依赖信息\nWantedBy=multi-user.target\n```\n\n* 将服务配置文件放到`/etc/systemd/system`下  \n\\> sudo cp shadow.service /etc/systemd/system\n* 设置服务自启动  \n\\> systemctl enable shadow\n* 服务开启和关闭  \n\\> systemctl start shadow  \n\\> systemctl stop shadow\n\n#### Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效\n________________________\n=> 先来一个shadowsocks全局pac代理的步骤：\n```sh\n# pip需要先安装\n$: sudo apt-get install python-pip python-dev build-essential\n$: sudo pip install --upgrade pip\n$: sudo pip install --upgrade virtualenv\n# 安装pac自动生成程序\n$: sudo pip install genpac\n# 生成pac文件\n$: mkdir ~/shadowsocks\n$: cd shadowsocks\n# proxy配置中的地址和端口具体要看你的shadowsocks连接配置\n$: genpac --proxy=\"SOCKS5 127.0.0.1:1080\" --gfwlist-proxy=\"SOCKS5 127.0.0.1:1080\" -o autoproxy.pac --gfwlist-url=\"https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt\"\n```\n以上操作会在~/shadowsocks目录下生成autoproxy.pac配置文件，到系统设置 -> 网络 -> 网络代理 -> 自动 -> 填入file:///path/to/autoproxy.pac(上面我们生成的pac文件路径)，如果要新增被代理网站的话就自己编辑pac文件，在里面的域名列表里面再添加新的域名就好了。\n=> 再写一个脚本[genpac-command](https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks/genpac)，可以用来添加用户过滤规则(user-rules.txt) 和在线更新autoproxy.pac代理文件\n```sh\n# # 在脚本目录下执行\n# 显示帮助信息\n$: bash genpac-command --help\n# 在线更新\n$: bash genpac-command --update-online\n# 从本地user-rules.txt文件读取更新\n$: bash genpac-command --update-local\n# 添加自定义规则\n$: bash genpac-command --add-rules opendesktop.org\n# 添加多个自定义规则\n$: bash genpac-command --add-rules opendesktop.org atom.io\n# 删除自定义规则\n$: bash genpac-command --del-rules opendesktop.org\n# 删除多个自定义规则\n$: bash genpac-command --del-rules opendesktop.org atom.io\n```\n=> __不过我遇到了代理pac文件配置好后，firefox和google浏览器仍然不能FQ的情况，仔细排查原因，我发现因为之前我不是用的pac全局代理，是通过浏览器的SwitchOmega插件来手动代理的，这个插件会接管浏览器的网络代理权限，我们需要到浏览器设置里面把网络代理设置为系统代理，以火狐浏览器为例：__\n\n#### Atom编辑器内存占用过大的问题\n______________________________\n>Atom、Vscode、Sublime、Bracks都用过，Atom用着最爽，可定制化程度最高。但是有时候用着Atom电脑呼呼作响，查看系统占用，Atom内存占用达到过4、5个G，我的天！其实Atom出现内存泄漏的问题都不是Atom本身的问题，一定是你安装的哪个插件导致了内存泄漏，查看占用信息后定位到atom的插件，然后把它禁用就可以了，比如之前导致我出现这个问题的插件就是：ide-typescript，禁用之后现在基本一个Atom进程只占用200~400Mb左右，取决于你安装的其它插件。还有Atom要经常手动更新啊，仓库里面更新不了的，直接去Atom git仓库下载release正式版本，基本上一个大版本就要更新一次。\n\n#### Grub2 主题安装\n_________________\n![source.png](/blogs/img/article/Ubuntu18.04-12.png)\n>Grub2就是引导操作系统启动的东西，开机的时候如果是多系统，就会显示多系统的启动菜单，如图，这个启动菜单可以自定义主题。\n\n1. 解压下载的主题文件 => [Vimix](https://pan.baidu.com/s/1ioMub2JmHlIzHJbS2_2gRQ)，得到Vimix文件夹(这里提供我用的一个主题，也可以自已去下载其它主题)\n2. 在/boot/grub里创建GRUB2主题目录themes\n\\> sudo mkdir -p /boot/grub/themes\n3. 将下载的Vimix文件夹整体复制到/boot/grub/themes文件夹下\n\\> sudo cp -r Vimix /boot/grub/themes\n4. 修改/etc/default/grub配置文件\n\\> sudo gedit /etc/default/grub\n在文件最后添加：GRUB_THEME=\"/boot/grub/themes/Vimix/theme.txt\" 并保存\n5. 更新GRUB\n\\> sudo update-grub\n6. 重启即生效(如果重启卡住请强制关机后再启动)\n\n#### Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer\n_________________________________________________________\n![firefox_proxy.png](/blogs/img/article/Ubuntu18.04-13.png)\n\n1. [sourceforge](http://sourceforge.net/projects/corefonts/files/the%20fonts/final/)下载如图所示11个exe文件并放入一个文件夹，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer\n2. 运行字体配置程序\n\\> sudo dpkg-reconfigure ttf-mscorefonts-installer\n3. 在配置窗口中输入刚才保存exe的路径确定即可，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer\n\n#### Ubuntu18.04 WPS 提示字体缺失的解决方法\n---------------------------------------\n下载缺失的字体文件[fonts](https://pan.baidu.com/s/10MushHhTXwfRIFkKGmwD7Q) (密码: 4jpo)，然后复制到Linux系统中的/usr/share/fonts文件夹中，再使用系统命令更新字体设置：\n```sh\n# 生成字体的索引信息\n$: sudo mkfontscale\n$: sudo mkfontdir\n# 更新字体缓存\n$: sudo fc-cache\n```\n\n#### Ubuntu18.04 更新Gnome版本\n---------------------------------------\n```sh\n# Upgrade\n#If you were using the gnome3-team/gnome3-staging PPA, run the following before upgrading:\n$: sudo ppa-purge ppa:gnome3-team/gnome3-staging\n$: sudo ppa-purge ppa:gnome3-team/gnome3\n$: sudo apt install ubuntu-gnome-desktop^\n# The included GUI update manager will offer you the latest release of Ubuntu GNOME. Access this via the terminal:\n$: update-manager -c\n# Alternatively, run the following command:\n$: sudo do-release-upgrade\n```\n\n\n#### Win10 + Ubuntu18.04 双系统时间显示不对\n______________________________________\n>Ubuntu和Windows默认的时间管理方式不同，所以双系统发生时间错乱是正常的。Ubuntu默认时间是把BIOS时间当成GMT+0时间，也就是世界标准时，而我国在东八区(GMT+8)，所以如果你的Ubuntu位置是中国的话你系统显示的时间就是BIOS时间+8小时。假如现在是早上8点，那么你Ubuntu会显示8点，这时BIOS中的时间是0点。而当你切换到Windows系统时就会发生时间错乱，因为Windows会认为BIOS时间就是你的本地时间，结果就是Windows显示时间为0点……而假如你在Windows下同步时间，恢复显示为8点，这时BIOS时间也会被Windows改写成8点，再次进入Ubuntu时显示时间又变成了8+8=16点。\n\n1. 先在Ubuntu下更新一下时间\n\\> sudo apt-get install ntpdate\n\\> sudo ntpdate time.windows.com\n2. 将时间更新到硬件上\n\\> sudo hwclock --localtime --systohc\n3. 关闭linux重新进入windows系统，发现时间正常了\n\n#### Ubuntu18.04 安装系统时说明(双硬盘)\n______________________________________________\n> 主要分为 [ _GPT磁盘分区+UEFI引导方案_ ] 和 [ _传统MBR磁盘分区 + LEGANCY引导方案_ ]\n1. 方案一(兼容方案 gpt+uefi / mbr+legancy)\n使用UEFI模式安装Ubuntu18.04时可以选择用 兼容bios启动方式 来安装系统(同时兼容传统启动方式和UEFI启动方式)，即不分配\"/boot \"分区，分配一个大小为1GB左右的\"保留bios启动区域\"(UEFI模式会自动挂载/boot和/boot/efi)，其它分区至少还需要一个根分区\"/\"，8G内存的情况下最好还是分配8G的swap交换分区，另外除了\"保留bios启动区域\"为主分区，其它分区均为逻辑分区，最后一步很重要 -- 格式化每个分区，要不然安装很可能会出错！[参考](https://blog.csdn.net/jesse_mx/article/details/61425361\n)\n2. 方案二(gpt+uefi 已使用方案)\n创建\"efi系统分区\"，同时不需要划分\"/boot\"分区(boot引导是grub由引导的，而efi显然是UEFI引导的)，其余至少还需要划分\"/\"根分区，除了根分区所有分区都为逻辑分区，最后选择\"安装启动引导器的设备\"为刚才创建的\"efit系统分区\"。\n3. 方案三(传统mbr+legancy方案)\n传统的legancy + mbr的安装，至少划分\"/boot\"分区(主分区) 和 \"/\"根分区，其余的分区按需划分，最后选择\"安装启动引导器的设备\"为创建的\"/boot\"挂载点。\n\n#### Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题\n[=> 原帖子](https://askubuntu.com/questions/1030867/how-to-diagnose-fix-very-slow-boot-on-ubuntu-18-04)\n1. 编辑文件 `/etc/default/grub` 的 `GRUB_CMDLINE_LINUX_DEFAULT` 这一行，加入一个参数__noresume__\n```sh\nGRUB_CMDLINE_LINUX_DEFAULT=\"quiet splash noresume\"\n```\n2. 更新grub\n```sh\n$: sudo update-grub\n```\n3. 重启电脑\n\n#### Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法\n_________________________________________________\n* 使用root权限命令行后台启动并且屏蔽输出\n\\> sudo netease-cloud-music > /dev/null 2>&1  &\n* 规避session-manager引起的bug\n\\> alias netease='unset SESSION_MANAGER && netease-cloud-music'\n\\> netease > /dev/null &\n* 别用那个鸡肋的客户端了，有bug也不更新，上这个酷酷的第三方客户端[ieaseMusic](https://github.com/trazyn/ieaseMusic)\n* 这里还有个别人做的针对ubuntu18.04的[重新构建版本](https://github.com/innoob/netease-cloud-music)，可以正常使用，也没有重复登录的bug\n\n\n#### Ubuntu18.04 Crossover17安装QQ后乱码的解决方法\n______________________________________________\n>原因：原来的ume-ui-gothic.ttf不支持很多简体中文字符  \n\n使用其它字体文件替换到目录 /opt/cxoffice/share/wine/fonts 下的[ume-ui-gothic.ttf](https://pan.baidu.com/s/13CDBKrvTAJOhrbuyLw96jA)字体文件 (同名)，记得将下好的文件重命名为ume-ui-gothic.ttf。\n\n#### Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错\n_______________________________________________________\n=> 错误信息：`Error: Requiring Clutter, version none: Typelib file for namespace 'Clutter' (any version) not found ...`  \n=> 原因分析：该插件需要的依赖Clutter尚未安装\n=> 解决方法：\n```sh\n# 安装依赖\n$: sudo apt-get install gir1.2-clutter-1.0 gir1.2-clutter-gst-3.0 gir1.2-gtkclutter-1.0\n```\n\n#### Ubuntu18.04 Gnome-Shell 插件\n______________________________________________\n* [CoverFlow Alt-Tab](https://extensions.gnome.org/extension/97/coverflow-alt-tab/) => 窗口Tab切换预览(★★★★☆)\n* [User Themes(必要)](https://extensions.gnome.org/extension/19/user-themes/) => 用户主题安装(★★★★★)\n* [Dash To Dock](https://extensions.gnome.org/extension/307/dash-to-dock/) => dock栏(★★★★★)\n* [Dash To Panel](https://extensions.gnome.org/extension/1160/dash-to-panel/) => 将dock和顶栏显示在一起(★★★★★)\n* [NoAnnoyance](https://extensions.gnome.org/extension/1236/noannoyance/) => 禁用多余的pop提示信息，直接提升活动窗口(★★★★★)\n* [Autohide Battery](https://extensions.gnome.org/extension/595/autohide-battery/) => 电池充满并连接电源时自动隐藏电池按钮(★★★★★)\n* [Places Status Indicator](https://extensions.gnome.org/extension/8/places-status-indicator/) => 顶部任务栏显示磁盘和卷的快捷入口(★★★★★)\n* [Removable Drive Menu](https://extensions.gnome.org/extension/7/removable-drive-menu/) => 顶部任务栏显示可移除的已挂载设备(★★★★★)\n* [Suspend Button](https://extensions.gnome.org/extension/826/suspend-button/) => 顶部菜单栏显示休眠按钮(★★★★★)\n* [TopIcons](https://extensions.gnome.org/extension/495/topicons/) => 顶部通知图标托盘(★★★★★)\n* [TopIconsPlus](https://extensions.gnome.org/extension/1031/topicons/) => 顶部通知图标托盘，自定义图标显示参数(★★★★☆)\n* [Blyr](https://extensions.gnome.org/extension/1251/blyr/) => 模糊应用预览背景图(★★★★★)\n* [Activities Configurator](https://extensions.gnome.org/extension/358/activities-configurator/) => 配置左上角活动按钮(★★★★☆)\n* [Workspace to Dock](https://extensions.gnome.org/extension/427/workspaces-to-dock/) => 将工作区转换为悬浮dock(★★★★★)\n* [Extensions](https://extensions.gnome.org/extension/1036/extensions/) => 在通知栏添加快捷开启和关闭gnome-shell插件的功能(★★★★★)\n* [Clipboard Indicator](https://extensions.gnome.org/extension/779/clipboard-indicator/) => 可视化剪贴板(★★★★★)\n* [Sound Input & Output Device Chooser](https://extensions.gnome.org/extension/906/sound-output-device-chooser/) => 声音输入和输入设备快速选择(★★★★★)\n* [NoAnnoyance](https://extensions.gnome.org/extension/1236/noannoyance/) => 取消“窗口已就绪”提示直接提升窗口(★★★★★)\n* [Bluetooth quick connect](https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/) => 蓝牙设备快速连接和断开(★★★★★)\n* [Remove Alt+Tab Delay](https://extensions.gnome.org/extension/1403/remove-alttab-delay/) => 移除【Alt + Tab】的开启应用预览延迟(★★★★★)\n* [Emoji Selector](https://extensions.gnome.org/extension/1162/emoji-selector/) => 快速选择Emoji表情(★★★★)\n\n#### Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置\n--------------------------------------------\n```sh\n#Use Custom Dock Indicator ( Optional )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-running-dots false\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-customize-running-dots false\n_______________________________________________________________________________________________\n\n# Disable Custom Dock Shrink ( Required for Good looking) (  Required )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-shrink false\n_______________________________________________________________________________________________\n\n# Dock Transparency mode ( Optional )\n$: gsettings set org.gnome.shell.extensions.dash-to-dock transparency-mode DEFAULT\n_______________________________________________________________________________________________\n\n# Restore to Default\n$: dconf reset -f /org/gnome/shell/extensions/dash-to-dock/\n_______________________________________________________________________________________________\n```\n\n#### Ubuntu18.04 主题\n______________________________________________\n* GTK3主题(★★★★☆) => [X-Arc-Collection](https://www.gnome-look.org/p/1167049/)\n* GTK3主题(★★★★★) => [McOS-themes](https://www.gnome-look.org/p/1241688)\n* Gnome Shell主题(★★★★) => [Flat-Remix](https://github.com/daniruiz/flat-remix)\n* Gnome Shell主题(★★★☆) => [Human](https://www.gnome-look.org/p/1171095/)\n* Gnome Shell主题(★★★★★) => [macOS High Sierra](https://www.opendesktop.org/c/1460761561)\n* Gnome Shell主题(?) => [macOS High Sierra](https://www.gnome-look.org/p/1213208/)\n* Icon 主题(★★★★) => [flat-remix](https://github.com/daniruiz/flat-remix/releases)\n* Icon 主题(★★★★☆) => [Mac OS X Icon](https://www.gnome-look.org/p/1012200/)\n* Icon 主题(★★★★★) => [la-capitaine-icon-theme](https://github.com/keeferrourke/la-capitaine-icon-theme/releases)\n* Icon 主题(★★★★★) [McMojave-circle](https://www.pling.com/p/1305429/)\n* Icon 主题(★★★★☆) => [MacOS sierra ct](https://github.com/zayronxio/Macos-sierra-CT)\n* Cursor主题(★★★★☆) => [Capitaine Cursors](https://krourke.org/projects/art/capitaine-cursors)\n\n#### chrome实用插件整理\n-----------------------------------\n* [infinity pro 标签页](https://chrome.google.com/webstore/detail/infinity-new-tabproductiv/dbfmnekepjoapopniengjbcpnbljalfg?utm_source=InfinityNewtab) => 主页标签管理器(★★★★★)\n* [Octotree](https://chrome.google.com/webstore/detail/octotree/bkhaagjahfmjljalopjnoealnfndnagc?utm_source=InfinityNewtab) => github仓库文件资源浏览树(★★★★★)\n* [Postman](https://chrome.google.com/webstore/detail/postman-interceptor/aicmkgpgakddgnaphhhpliifpcfhicfo?utm_source=InfinityNewtab) => API测试和请求模拟器(★★★★★)\n* [SwitchyOmega](https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?utm_source=InfinityNewtab) => 大家都用的代理软件(★★★★★)\n* [印象笔记剪藏](https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?utm_source=InfinityNewtab) => 随时随地把网络资源保存到你的笔记本里(★★★★★)\n* [SimpRead](https://chrome.google.com/webstore/detail/simpread-reader-view/ijllcpnolfcooahcekpamkbidhejabll?utm_source=InfinityNewtab) => 让浏览器支持纯净的阅读模式(★★★★★)\n* [Full Page Screen Capture](https://chrome.google.com/webstore/detail/full-page-screen-capture/fdpohaocaechififmbbbbbknoalclacl?utm_source=InfinityNewtab) => 全屏截图(★★★★☆)\n* [油猴tampermonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=InfinityNewtab) => 用户脚本管理器，一个用例是破解badu网盘的限速(★★★★★)\n* [Checker Plus for Gmail](https://chrome.google.com/webstore/detail/checker-plus-for-gmail/oeopbcgkkoapgobdbedcemjljbihmemj?utm_source=InfinityNewtab) => Google邮件提示插件(★★★★☆)\n* [Vimium](https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=InfinityNewtab) => 让google浏览器支持vim模式(firefox也有)(★★★★★)\n* [拷贝为Markdown](https://chrome.google.com/webstore/detail/copy-as-markdown/dgoenpnkphkichnohepecnmpmihnabdg) => 将选中网页转化为markdown格式并发送到剪贴板(★★★★☆)\n\n#### 实用程序和命令\n_______________________________\n* [fonts-firacode编程字体](https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager) => 解决vscode字体间隙过小的问题`sudo apt install fonts-firacode`\n* [vivaldi浏览器](https://vivaldi.com) => 可定制化程度高的个性化浏览器(★★★★★)\n* Terminator => 默认gnome终端升级版(★★★★★)\n* Timeshift => 创建系统快照，增量备份(★★★★★)\n* ipython3(命令工具) => python交互解释器(★★★★★)\n* jupyter => 交互式数据分析和记录工具(★★★★☆)\n* pdb/ipdb(命令工具) => python调试器(★★★★☆)\n* trash-cli(命令工具) => 命令行回收站(★★★★★)\n* bat(命令工具) => cat升级版，支持语法高亮和git状态显示(★★★★★)\n* axel(命令工具) => 下载限速不存在的，如果存在那我就开100个下载线程 : )(★★★★☆)\n* [aria2(命令工具)](https://github.com/aria2/aria2) => 强大的命令行下载工具\n* [stacer](https://github.com/oguzhaninan/Stacer) => linux电脑管家(★★★★★)\n* [ieaseMusic](https://github.com/trazyn/ieaseMusic) => 网易云音乐第三方客户端，没有bug，不会退出后再打开就让重新登陆\\[注：网易云音乐官方已修复]，界面还很酷(★★★★★)\n* parallel(命令工具) => 利用系统的多核来并行执行你的程序(★★★★☆)\n* cheat(命令工具) => 类似man命令的功能，简洁高效(★★★★☆)\n* topgrade(命令工具) => 一个命令更新所有软件(★★★★)\n* [dbKoda](https://www.dbkoda.com/) => mongodb GUI工具(★★★★☆)\n* [mongodb compass](https://www.mongodb.com/products/compass) => mongodb GUI工具(★★★★)\n* [peek](https://github.com/phw/peek) => 屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件(★★★★☆)\n* tmux => 终端管理器(★★★★)\n* 深度终端(ubuntu商店下载) => 支持分屏，内置实用主题(★★★★☆)\n* 深度截图(ubuntu商店下载) => 支持截图编辑(★★★★★)\n* [WebTorrent](https://webtorrent.io/desktop/)、[FrostWire](https://www.frostwire.com/) => bt下载工具，支持边下边播(★★★★)\n* [SmartGit](https://www.syntevo.com/smartgit/) => linux平台免费的GIT GUI工具(★★★★★)\n* FileZilla => ftp工具(★★★★★)\n* [e-tools](https://github.com/Suremotoo/e-tools) => coder常用小工具(★★★★)\n* [WhatEver](https://electronjs.org/apps/whatever) => linux第三方印象笔记客户端，基于网页版(★★★★)\n* [wps](http://linux.wps.cn/) => linux office for free made by KingSoftware(★★★★★)\n* [Atom](https://atom.io/) => 我一直在用的编辑器，没有固态硬盘的不推荐使用(★★★★☆)\n* [vscode](https://code.visualstudio.com/) => 轻量化编辑器，没有Atom人性化，但是很快。都是JS写的，性能差距咋这么大呢 ? (★★★★★)\n* ndb => node.js/javascript 调试器(★★★★★)\n* [nvm](https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh) => nodejs版本管理器\n* albert (添加软件源 `ppa:noobslab/macbuntu` 安装 ) => 桌面全局搜索类似Mac系统的SpotLight(★★★★★)\n* [lftp](https://linux.cn/article-5460-1.html) => 一个基于命令行的文件传输软件，支持FTP，FTPS，HTTP，HTTPS，HFTP，FISH，以及SFTP等协议，也有许多高级特性比\n如：多线程下载、断点续传\n* [redshift-gtk](http://jonls.dk/redshift/) 护眼模式，自带的色彩太黄了\n* apt-fast => 比apt更快的包管理器，添加`ppa:apt-fast/stable`安装(★★★★★)\n* nautilus action configure tool => 资源管理器右键菜单自定义，添加`ppa:daniel-marynicz/filemanager-actions`安装(★★★★★)\n* tig => 可交互的命令行git命令(★★★★★)\n* shellcheck => shell脚本语法检查(★★★★★)\n* [Motrix](https://motrix.app/zh-CN/) => 全平台下载工具，用于替代迅雷(★★★★★)\n* [Insync](https://www.insynchq.com/) => 全平台同步工具，支持google云和onedrive(★★★★★)\n* [Timeshift](https://github.com/teejee2008/timeshift) => 创建系统增量备份计划(★★★★★)\n* dconf-editor => gnome桌面配置gui工具(★★★★)\n\n#### 实用网站推荐\n_______________\n![Vimix.png](/blogs/img/article/Ubuntu18.04-14.png)\n\n* [Wallpaper](https://wallpapershome.com/)  => 高清桌面壁纸下载，支持多种分辨率(★★★★★)\n* [flaticon](https://www.flaticon.com) => 免费图标下载网站，支持svg和png两种格式\n* [Electron Apps](https://electronjs.org/apps) => 有很多Electron 框架写的跨平台应用(Linux/Mac/Windows)(★★★★☆)\n* [Linux运维日志](https://www.centos.bz/) => 服务搭建、Linux技术之类的(★★★★☆)\n* [IBM Developer](https://www.ibm.com/developerworks/cn/) => 技术文档类的参考(★★★★★)\n* [Linux常用命令](https://www.lulinux.com/archives/2513#awk)  =>  常用命令速查(★★★★☆)\n* [bilibili工具网站](https://www.kanbilibili.com/) => 支持 视频/弹幕/封面 下载等骚操作(★★★★★)\n* [Linux中国](https://linux.cn/) => 没事儿就上去看看别人翻译转载的文章(★★★★☆)\n* [TinyPNG](https://tinypng.com/) => 免费的图片无损压缩网站(★★★★☆)\n* [iLoveIMG](https://www.iloveimg.com/zh-cn) => 在线图片编辑网站(★★★★★)\n* [savefrom](https://en.savefrom.net/) => 直接下载youtube视频(★★★★☆)\n* [撸Linux](https://www.lulinux.com/) => 好像还蛮有趣的额(★★★★☆)\n* [油猴脚本](https://greasyfork.org/zh-CN/scripts) => 你甚至可以用来破解百度云限速(★★★★★)\n\n_注：以上内容部分是从网络搜集，希望解决广大Linuxer的问题所以做了部分整合._","slug":"Ubuntu18.04踩坑记录","published":1,"updated":"2020-03-21T11:55:45.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxmx0008a895d91qzum8","content":"<p><img src=\"/blogs/img/article/Ubuntu18.04-1.jpg\" alt=\"welcome / home\"></p>\n<h4 id=\"contents\">Contents</h4>\n<hr>\n<ul>\n<li>Wine应用启动后出现WineSystemTray 托盘的问题</li>\n<li>中文环境下将Home目录下的文件夹切换为英文名</li>\n<li>Ubuntu系发行版安装deepin wine QQ</li>\n<li>续：安装QQ/微信</li>\n<li>Ubuntu 18.04开机启动特别慢的问题</li>\n<li>终端oh-my-zsh配置</li>\n<li>终端终结者Terminator配置</li>\n<li>禁用内核更新</li>\n<li>终端常用等宽字体</li>\n<li>crossover18破解</li>\n<li>vim插件配置</li>\n<li>Ubuntu18.04 定制Mac主题</li>\n<li>Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式</li>\n<li>Ubuntu18.04 关于定制plymouth主题来更换开机动画</li>\n<li>Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题</li>\n<li>Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题</li>\n<li>Ubuntu18.04 解决一些软件依赖不满足问题的问题</li>\n<li>Linux分区过小导致后期容量不足解决方法</li>\n<li>Shadowsocks-Qt5安装的问题</li>\n<li>使用polipo开启终端代理(需要先开启shadowsocks代理)</li>\n<li>将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表</li>\n<li>自定义shadowsocks服务开机自启动脚本</li>\n<li>Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效</li>\n<li>Atom编辑器内存占用过大的问题</li>\n<li>Grub2 主题安装</li>\n<li>Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer</li>\n<li>Ubuntu18.04 WPS 提示字体缺失的解决方法</li>\n<li>Ubuntu18.04 更新Gnome版本</li>\n<li>Win10 + Ubuntu18.04 双系统时间显示不对</li>\n<li>Ubuntu18.04 安装系统时说明(双硬盘)</li>\n<li>Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题</li>\n<li>Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法</li>\n<li>Ubuntu18.04 Crossover17安装QQ后乱码的解决方法</li>\n<li>Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错</li>\n<li>Ubuntu18.04 Gnome-Shell 插件</li>\n<li>Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置</li>\n<li>Ubuntu18.04 主题</li>\n<li>chrome实用插件整理</li>\n<li>实用程序和命令</li>\n<li>实用网站推荐</li>\n</ul>\n<h4 id=\"wine应用启动后出现winesystemtray托盘的问题\">Wine应用启动后出现WineSystemTray托盘的问题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-2.png\" alt=\"wine_tray.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-3.png\" alt=\"tray.png\"></p>\n<ol>\n<li>\n<p>操作系统Linux Mint18.3<br>\n右键点击面板(状态栏)，选择 - 向面板添加小程序，选择小程序 - 系统托盘，点击+号添加，之后Wine安装的应用和其它应用的图标就被系统托盘管理了。</p>\n</li>\n<li>\n<p>操作系统Ubuntu 18.04<br>\n安装gnome-shell插件 <a href=\"https://extensions.gnome.org/extension/495/topicons/\" target=\"_blank\" rel=\"noopener\">TopIcons</a>, 要想从浏览器上安装这个TopIcons需要先安装浏览器gnome交互插件chrome-gnome-shell (<code>sudo apt install chrome-gnome-shell</code> )，使用deepin QQ的时候可能需要重新启动TopIcons才能显示顶部QQ图标，如果遇到图标无故隐藏的问题那么可以再安装插件<a href=\"https://extensions.gnome.org/extension/1160/dash-to-panel/\" target=\"_blank\" rel=\"noopener\">Dash to Panel</a>解决。</p>\n</li>\n</ol>\n<h4 id=\"中文环境下将home目录下的文件夹切换为英文名\">中文环境下将Home目录下的文件夹切换为英文名</h4>\n<hr>\n<ol>\n<li>设置英文语言环境</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: <span class=\"built_in\">export</span> LANG=en_US(恢复-&gt; zh_CN)</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>更新目录</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>弹出提示框点击 [确认]</li>\n<li>重启后会再次弹出提示框是否将英文文件夹改回中文，选择 [不再提示] 并 [取消] 修改</li>\n</ol>\n<h4 id=\"ubuntu系发行版安装deepin-wine-qq\">Ubuntu系发行版安装deepin wine QQ</h4>\n<hr>\n<ol>\n<li>\n<p>安装deepin-wine环境：上<a href=\"https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu\" target=\"_blank\" rel=\"noopener\">https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu</a>页面下载zip包（或用git方式克隆），也可以<a href=\"https://pan.baidu.com/s/120C5aHuqtyxQyn_fGTxHKg\" target=\"_blank\" rel=\"noopener\">百度网盘</a>下载，解压到本地文件夹，在文件夹中打开终端，输入<code>sudo sh ./install.sh</code>一键安装，如果你安装了这些依赖，在第二步的时候仍然报依赖错误，那就手动解压deb包，把那些依赖声明删除就行了(解压deb的方法下文中有提到)。</p>\n</li>\n<li>\n<p>安装deepin.com应用容器：在<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/</a>中下载想要的容器，点击deb安装即可，以下为推荐容器:</p>\n</li>\n</ol>\n<ul>\n<li>QQ：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/</a></li>\n<li>TIM：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/</a></li>\n<li>QQ轻聊版：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/</a></li>\n<li>微信：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/</a></li>\n<li>Foxmail：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/</a></li>\n<li>百度网盘：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/</a></li>\n<li>360压缩：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/</a></li>\n<li>迅雷急速版:  <a href=\"https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg\" target=\"_blank\" rel=\"noopener\">https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg</a></li>\n<li>Ubuntu系发行版包括Ubuntu、LinuxMint、ZorinOS等。</li>\n</ul>\n<h4 id=\"续安装qq微信\">续：安装QQ/微信</h4>\n<hr>\n<p>1.linux上的微信大部分都是网页版微信封装的: <a href=\"https://github.com/geeeeeeeeek/electronic-wechat\" target=\"_blank\" rel=\"noopener\">electronic-wechat</a>、<a href=\"https://github.com/trazyn/weweChat\" target=\"_blank\" rel=\"noopener\">weweChat</a>，网页版功能简单，每次登录都要扫码。而且现在腾讯好像开始禁用了微信网页版的登陆，如果发现不能登录网页版就只能使用crossover来安装windows版的微信。</p>\n<p>2.￥140可以买个CrossOver18正版，一次激活，永久使用，然后愉快地安装QQ8.9，喜欢TIM的也能用TIM， 不过目前这个基于crossover的QQ有些bug，也不能记住密码。使用crossover18安装微信，安装包直接下载windows版本的就行，然后使用crossover创建windowsXP 64位容器，在容器中安装微信即可，不过可能安装时会出现<code>&quot;WeChatWin.dll 缺失问题&quot;</code>报错信息，需要执行下面命令安装额外的环境：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: apt-get install libldap-2.4-2:i386</span><br></pre></td></tr></table></figure>\n<p>3.使用docker安装<a href=\"https://hub.docker.com/r/bestwu/qq\" target=\"_blank\" rel=\"noopener\">Tim</a> 和 <a href=\"https://hub.docker.com/r/bestwu/wechat\" target=\"_blank\" rel=\"noopener\">wechat</a>，<a href=\"https://www.runoob.com/docker/ubuntu-docker-install.html\" target=\"_blank\" rel=\"noopener\">docker环境安装教程</a></p>\n<p>4.wine环境下(crossover/deepin)安装好微信后如果发现不能输入文字(其实可以输入和发送，只是文字透明的)，可以使用这个文件<a href=\"https://pan.baidu.com/s/1-ScZvkmR9oZPdiFurdKQdA\" target=\"_blank\" rel=\"noopener\">riched20.dll</a>(提取密码：rofj)替换掉微信所在容器下的C盘的<code>/windows/system32/riched20.dll</code>，容器路径一般在：<code>~/.cxoffice/[你的容器名]/drive_c/</code>。</p>\n<p>5.wine环境下(crossover/deepin)如果运行微信时发现界面有一个黑框不能关闭，只需要在聊天输入框中键入中文“不”然后再删除即可让黑框消失(原因:微信会根据你输入的字作为关键字在你现有表情中找符合的表情并显示出来提示你可用,但并没有很好的兼容这个功能变成一个黑框了，所以手动消除黑框的办法只有打关键字然后删除)。</p>\n<p>6.wine环境下(crossover/deepin)如果运行微信的时候不能发送图片，尝试安装 <code>sudo apt install libjpeg62:i386</code>，临时解决办法是把图片文件拖动到<code>收藏</code>，然后从收藏转发即可。</p>\n<p>7.wine环境下(crossover/deepin)如果运行QQ发现收到的图片一直加载不出来(刚登录开始可以，过一会就不行了)，那么可以在QQ登录界面设置一下网络代理(http/socks)，注意本地代理情况下代理地址不能使用localhost/127.0.0.1此类的IP，使用0.0.0.0是可以的。</p>\n<h4 id=\"ubuntu-1804开机启动特别慢的问题\">Ubuntu 18.04开机启动特别慢的问题</h4>\n<hr>\n<p>=&gt; 禁用不必要的开机服务：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出程序开机占用时间排行</span></span><br><span class=\"line\">systemd-analyze blame</span><br><span class=\"line\"><span class=\"comment\"># 禁用plymouth</span></span><br><span class=\"line\">sudo systemctl mask plymouth-start.service</span><br><span class=\"line\">sudo systemctl mask plymouth-read-write.service</span><br></pre></td></tr></table></figure>\n<h4 id=\"终端oh-my-zsh配置\">终端oh-my-zsh配置</h4>\n<hr>\n<ol>\n<li>主题</li>\n</ol>\n<ul>\n<li>gnzh(已使用))</li>\n<li>ys</li>\n<li>avit</li>\n<li>af-magic</li>\n</ul>\n<ol start=\"2\">\n<li>插件</li>\n</ol>\n<ul>\n<li>git =&gt; 自带git状态插件</li>\n<li>svn =&gt; svn状态插件</li>\n<li>colored-man-pages =&gt; man帮助信息高亮</li>\n<li>zsh-syntax-highlighting =&gt; 命令高亮和错误提示</li>\n<li>z =&gt; 自动记录路径快捷跳转</li>\n<li>zsh-autosuggestions =&gt; 根据输入记录自动建议可选输入命令</li>\n</ul>\n<h4 id=\"终端终结者terminator配置\">终端终结者Terminator配置</h4>\n<hr>\n<p>特性：浅色调、字体舒适、无滚动条、自定义快捷键和配色、自动设置窗口布局</p>\n<p>注意：可以配合<code>设置-&gt;设备-&gt;键盘-&gt;添加自定义快捷键</code>这样自定义快捷键来启动终端，<br>\n比如设置<code>Ctrl+Alt+T</code>为<code>terminator --geometry=93x32+450+300</code>，geometry为窗口的布局配置。</p>\n<p>覆盖文件<code>~/.config/terminator/config</code>内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  [global_config]</span><br><span class=\"line\">  enabled_plugins = CustomCommandsMenu, LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler</span><br><span class=\"line\">  suppress_multiple_term_dialog = True</span><br><span class=\"line\">  title_hide_sizetext = True</span><br><span class=\"line\">[keybindings]</span><br><span class=\"line\">  prev_tab = &lt;Alt&gt;1</span><br><span class=\"line\">  reset_clear = &lt;Primary&gt;&lt;Shift&gt;g</span><br><span class=\"line\">  clear = &lt;Primary&gt;l</span><br><span class=\"line\">  switch_to_tab_1 = &lt;Alt&gt;1</span><br><span class=\"line\">  switch_to_tab_2 = &lt;Alt&gt;2</span><br><span class=\"line\">  switch_to_tab_3 = &lt;Alt&gt;3</span><br><span class=\"line\">  switch_to_tab_4 = &lt;Alt&gt;4</span><br><span class=\"line\">  switch_to_tab_5 = &lt;Alt&gt;5</span><br><span class=\"line\">  toggle_scrollbar = None</span><br><span class=\"line\">  toggle_zoom = &lt;Primary&gt;&lt;Shift&gt;x</span><br><span class=\"line\">[layouts]</span><br><span class=\"line\">  [[default]]</span><br><span class=\"line\">    [[[child1]]]</span><br><span class=\"line\">      parent = window0</span><br><span class=\"line\">      profile = default</span><br><span class=\"line\">      <span class=\"built_in\">type</span> = Terminal</span><br><span class=\"line\">    [[[window0]]]</span><br><span class=\"line\">      parent = <span class=\"string\">\"\"</span></span><br><span class=\"line\">      size = 925, 570</span><br><span class=\"line\">      <span class=\"built_in\">type</span> = Window</span><br><span class=\"line\">[plugins]</span><br><span class=\"line\">  [[CustomCommandsMenu]]</span><br><span class=\"line\">    [[[清屏]]]</span><br><span class=\"line\">      <span class=\"built_in\">command</span> = clear</span><br><span class=\"line\">      enabled = True</span><br><span class=\"line\">      name = 清屏</span><br><span class=\"line\">      position = 0</span><br><span class=\"line\">[profiles]</span><br><span class=\"line\">  [[default]]</span><br><span class=\"line\">    allow_bold = False</span><br><span class=\"line\">    background_color = <span class=\"string\">\"#fbfbfb\"</span></span><br><span class=\"line\">    background_darkness = 0.93</span><br><span class=\"line\">    background_type = transparent</span><br><span class=\"line\">    copy_on_selection = True</span><br><span class=\"line\">    cursor_color = <span class=\"string\">\"#aaaaaa\"</span></span><br><span class=\"line\">    cursor_shape = ibeam</span><br><span class=\"line\">    font = Ubuntu Light 12</span><br><span class=\"line\">    foreground_color = <span class=\"string\">\"#49494a\"</span></span><br><span class=\"line\">    palette = <span class=\"string\">\"#2e3436:#ee6a6a:#38690a:#b3adb0:#3465a4:#75507b:#06989a:#d3d7cf:#979b93:#fe5f5f:#7fd42c:#b7afb1:#729fcf:#ad7fa8:#34e2e2:#eeeeec\"</span></span><br><span class=\"line\">    scroll_on_keystroke = False</span><br><span class=\"line\">    scrollbar_position = hidden</span><br><span class=\"line\">    show_titlebar = False</span><br></pre></td></tr></table></figure>\n<h4 id=\"禁用内核更新\">禁用内核更新</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看已安装内核</span></span><br><span class=\"line\">$: dpkg --get-selections |grep linux-image</span><br><span class=\"line\"><span class=\"comment\"># 查看正在使用的内核</span></span><br><span class=\"line\">$: uname -a</span><br><span class=\"line\"><span class=\"comment\"># 删除旧内核</span></span><br><span class=\"line\">$: sudo apt-get remove</span><br><span class=\"line\">$: linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-get remove  </span><br><span class=\"line\">$: linux-image-extra-x.xx.x-xx-generic  </span><br><span class=\"line\"><span class=\"comment\"># 或用这个命令移除</span></span><br><span class=\"line\">$: sudo dpkg --purge linux-image-x.x.x-xx-generic</span><br><span class=\"line\"><span class=\"comment\"># 禁止更新内核，需时间来验证</span></span><br><span class=\"line\">$: sudo apt-mark hold linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-mark hold linux-image-extra-x.xx.x-xx-generic</span><br><span class=\"line\"><span class=\"comment\"># 如果需要恢复原来的设定的话即允许更新内核，执行如下命令即可：</span></span><br><span class=\"line\">$: sudo apt-mark unhold linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-mark unhold linux-image-extra-x.xx.x-xx-generic</span><br></pre></td></tr></table></figure>\n<h4 id=\"终端常用等宽字体\">终端常用等宽字体</h4>\n<hr>\n<ul>\n<li>AR PL UKai CN 12</li>\n<li>Bitstream Vera Sans Mono 10</li>\n<li>Courier 10 Pitch 11</li>\n<li>DejaVu Sans Mono 10</li>\n<li>FreeMono 11</li>\n<li>Nimbus Mono L 12</li>\n<li>TlwgMono 11</li>\n</ul>\n<h4 id=\"crossover18破解\">crossover18破解</h4>\n<hr>\n<p>下载 <a href=\"https://pan.baidu.com/s/1BnT-cAKf-SBp-6J4CQoo-g\" target=\"_blank\" rel=\"noopener\">CrossoverPatch</a> <code>密码: ffp0</code>，解压后替换文件：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  备份原文件</span></span><br><span class=\"line\">$: cp ~/cxoffice/lib/wine/winewrapper.exe.so ~/cxoffice/lib/wine/winewrapper.exe.so-bak</span><br><span class=\"line\"><span class=\"comment\"># 替换文件</span></span><br><span class=\"line\">$: cp CrossoverPatch/winewrapper.exe.so ~/cxoffice/lib/wine</span><br></pre></td></tr></table></figure>\n<h4 id=\"vim插件配置\">vim插件配置</h4>\n<hr>\n<ol>\n<li><a href=\"https://github.com/VundleVim/Vundle.vim\" target=\"_blank\" rel=\"noopener\">Vundle</a> =&gt; 插件管理器，编辑.vimrc，然后执行命令<code>vim +PluginInstall</code>即可安装</li>\n<li><a href=\"https://github.com/vim-airline/vim-airline\" target=\"_blank\" rel=\"noopener\">vim-airline</a> =&gt; 底部状态栏</li>\n<li><a href=\"https://juejin.im/post/5a38c37f6fb9a0450909a151\" target=\"_blank\" rel=\"noopener\">其他配置</a></li>\n</ol>\n<h4 id=\"ubuntu1804-定制mac主题\">Ubuntu18.04 定制Mac主题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-5.png\" alt=\"overview.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-6.png\" alt=\"desktop.png\"></p>\n<ol>\n<li>安装gnome-tweak-tool 和 chrome-gnome-shell 插件 (<code>sudo aptitude install [name]</code>)</li>\n<li>安装GTK3主题 =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">X-Arc-Collection</a></li>\n<li>使用tweak载入应用程序主题 =&gt; tweak – 外观 – 应用程序 – 选择X-Arc-Collection</li>\n<li>安装gnome-shell 主题 =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>安装gnome-shell 插件 =&gt; <a href=\"https://extensions.gnome.org/extension/19/user-themes/\" target=\"_blank\" rel=\"noopener\">User Themes</a> ( 之后重启Gnome =&gt; [Alt + F2] &amp; [输入 r] &amp; [点击 Enter] )</li>\n<li>使用tweak载入shell主题 =&gt; tweak – 外观 – shell – 选择Sierra shell主题</li>\n<li>下载Mac图标主题 <a href=\"https://github.com/keeferrourke/la-capitaine-icon-theme/releases\" target=\"_blank\" rel=\"noopener\">la-capitaine-icon-theme</a> 或 <a href=\"https://www.pling.com/p/1305429/\" target=\"_blank\" rel=\"noopener\">McMojave-circle</a></li>\n<li>图标文件夹移动到 ~/.icons目录下(没有则新建目录)</li>\n<li>使用tweak载入icon主题 =&gt; tweak – 外观 – 图标 – 选择对应的图标主题</li>\n<li>安装gnome-shell插件 =&gt; Dash to dock (将原生dock转变为可定制的浮动dock)</li>\n<li>定制firefox主题 =&gt; <a href=\"https://github.com/vinceliuice/Mojave-gtk-theme\" target=\"_blank\" rel=\"noopener\">Majave-gtk-theme</a></li>\n</ol>\n<h4 id=\"ubuntu1804-自己定制-登录-锁屏界面的图片和样式\">Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-7.png\" alt=\"lockscreen.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-8.png\" alt=\"loginscreen.png\"></p>\n<ol>\n<li>安装脚本 =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/login-manager-config-ubuntu\" target=\"_blank\" rel=\"noopener\">github / nojsja / login-manager-config-ubuntu</a></li>\n<li>说明=&gt; 脚本通过更改/usr/share/gnome-shell/theme/ubuntu.css文件中声明的样式来修改系统登录页面按钮布局和背景图片的地址，使用ImageMagick包的<code>convert -blur</code>命令制作了毛玻璃效果的登录背景图片，最后还生成了一个SetAsWallpaper脚本，可以在文件夹中的图片文件上右键点击选择运行这个脚本(它会自动把目标图片更改成桌面壁纸和毛玻璃效果化的登录背景图)，最后锁屏壁纸需要用户手动安装<code>gnome-tweak-tool</code>进行更改。</li>\n<li>之前我想通过更改<code>/usr/share/gnome-shell/theme/gdm3.css</code>文件来修改样式，可是发现ubuntu18.04下总会有这样那样的问题。</li>\n<li>注意=&gt; 不要贸然尝试更改系统主题的CSS样式文件，如果修改的文件有语法错误或是其它原因，很可能会造成系统开机后无法登入图形界面(出现这种情况可以插入U盘登录PE系统然后挂载原系统的硬盘，最后将错误文件改回即可)。</li>\n</ol>\n<h4 id=\"ubuntu1804-关于定制plymouth主题来更换开机动画\">Ubuntu18.04 关于定制plymouth主题来更换开机动画</h4>\n<hr>\n<blockquote>\n<p>其实我不建议去改开机动画，一个原因是ubuntu自己的开机动画就挺美观简洁的，第二个原因是这个东西如果改出问题了卡在开机画面到时候恢复起来比较麻烦，如果执意想去折腾的话，可以去<a href=\"https://www.gnome-look.org/browse/cat/108/\" target=\"_blank\" rel=\"noopener\">gnome-look</a>看看，这里提供一个苹果主题<a href=\"https://pan.baidu.com/s/1qv3GZ_BE-jj2HIpiI2X7yQ\" target=\"_blank\" rel=\"noopener\">darwin</a>，密码: <code>rc6u</code>。</p>\n</blockquote>\n<ol>\n<li>\n<p>解压下载的plymouth主题到 <code>/usr/share/plymouth/themes</code></p>\n</li>\n<li>\n<p>执行安装</p>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-alternatives --install /usr/share/plymouth/themes/ default.plymouth default.plymouth /usr/share/plymouth/themes/[THEME]/[THEME].plymouth 100</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>更新配置，需要手动选择plymouth编号</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-alternatives --config default.plymouth</span><br><span class=\"line\">$: sudo update-initramfs -u</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>手动更改错误路径参数</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /usr/share/plymouth/themes/default.plymouth</span><br></pre></td></tr></table></figure>\n<p>替换<code>ImageDir</code>和<code>ScriptFile</code>为正确的plymouth文件存放路径，替换后：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ImageDir=/usr/share/plymouth/themes/[THEME]</span><br><span class=\"line\">ScriptFile=/usr/share/plymouth/themes/[THEME]/[THEME].script</span><br></pre></td></tr></table></figure>\n<h4 id=\"ubuntu1804-使用dash-to-dock插件时同时出现两个dock的问题\">Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题</h4>\n<hr>\n<blockquote>\n<p>解决方法是去tweak设置里关闭[Dash to dock]的开关，别担心，关闭后，[Dash to dock]仍然正常工作，但是再也不会同时出现两个dock栏的尴尬情况了。</p>\n</blockquote>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-9.png\" alt=\"dock-noise.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-10.png\" alt=\"dock-single.png\"></p>\n<h4 id=\"ubuntu1804-添加软件源提示没有release文件忽略源的问题\">Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-11.png\" alt=\"dock-tweak.png\"></p>\n<ol>\n<li>打开 软件与更新</li>\n<li>选择那个源点击编辑</li>\n<li>更改 发行版 信息 (请在网页上查看这个源的仓库文件内的dists目录下有哪些发行版)</li>\n</ol>\n<h4 id=\"ubuntu1804-解决一些软件依赖不满足问题的问题\">Ubuntu18.04 解决一些软件依赖不满足问题的问题</h4>\n<hr>\n<p>=&gt; 以Ubuntu18.04安装16.04版本网易云音乐为例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># gdebi安装包</span><br><span class=\"line\">$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb</span><br><span class=\"line\">$: Dependency is not satisfiable: libqt5libqgtk2</span><br><span class=\"line\"># Ubuntu18.04报出依赖问题，原因是libqt5libqgtk2已经被新的库qt5-style-plugins替代，</span><br><span class=\"line\"># 软件源里找不到这个库，当然我们也能手动安装libqt5libqgtk2，但是很可能会就此引出新的依赖问题</span><br></pre></td></tr></table></figure>\n<p>=&gt; 方法：解压安装包修改依赖项并重新打包<br>\n=&gt; 步骤：</p>\n<ol>\n<li>deb包同级目录下创建文件夹</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: mkdir netease-cloud-music</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>解压安装包到这个文件夹中</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg -X netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb netease-cloud-music</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>解压控制信息</li>\n</ol>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg -e netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb neteas-cloud-music/DEBIAN/</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>修改依赖文件(把libqt5libqgtk2修改为qt5-style-plugins)</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim编辑文件</span><br><span class=\"line\">$: vim neteas-cloud-music/DEBIAN/control</span><br><span class=\"line\"># 使用vim正则对libqt5libqgtk2进行搜索替换</span><br><span class=\"line\">:1,$s/libqt5libqgtk2/qt5-style-plugins/g</span><br><span class=\"line\"># 或是手动查找Depends那一行中声明的libqt5libqgtk2进行替换替换即可</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>生成新的安装包</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg-deb -b neteas-cloud-music</span><br><span class=\"line\">$: mv neteas-cloud-music.deb netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>安装</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用gdebi或dpkg进行安装即可</span><br><span class=\"line\">$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br><span class=\"line\">$: sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br></pre></td></tr></table></figure>\n<h4 id=\"linux分区过小导致后期容量不足解决方法\">Linux分区过小导致后期容量不足解决方法</h4>\n<p>=&gt; 之前安装ubuntu 18.04的时候/var 分区只给了 1.5G，结果现在不够用了</p>\n<ul>\n<li>方法1</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get clean</span><br><span class=\"line\">$: sudo apt-get autoremove</span><br></pre></td></tr></table></figure>\n<p>如果仍然空间不足，使用方法2。</p>\n<ul>\n<li>方法2<br>\n建立目录软链接解决(软链接和硬链接了解一下)：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以/var目录为例 将占用过大的文件夹移出</span></span><br><span class=\"line\">$: mv /var/lib /opt</span><br><span class=\"line\"><span class=\"comment\"># 建立opt下的lib内目录的软链接到var目录</span></span><br><span class=\"line\">$: sudo ln -s /opt/lib /var</span><br></pre></td></tr></table></figure>\n<ul>\n<li>方法3<br>\n如果/var没有单独分区，则系统默认共享使用/home目录，若此时提示/var空间不足，则说明/home空间不足，这种情况，建议重新安装系统，重新规划分区结构。一般来说，/var目录2G-4G为好，或者不分区，共享/home。</li>\n</ul>\n<h4 id=\"shadowsocks-qt5安装的问题\">Shadowsocks-Qt5安装的问题</h4>\n<hr>\n<blockquote>\n<p>shadowsocks的GUI版本，用Qt写的，还行，不过我喜欢用sslocal命令脚本来连接服务器，开机自启动，很方便。顺带写个安装流程，不过会遇到我上面提到的 <strong>软件源提示没有Release文件的问题</strong>，可以通过上面的方法解决，这里需要将shadowdocks-Qt5发行版信息更改为<code>artful</code>，改为其它发行版可能会遇到依赖问题，遇到依赖问题多尝试几个，还有两行配置文件都要改额。</p>\n</blockquote>\n<p>&gt; sudo add-apt-repository ppa:hzwhuang/ss-qt5<br>\n&gt; sudo apt update<br>\n&gt; sudo apt-get install shadowsocks-qt5</p>\n<h4 id=\"使用polipo开启终端代理需要先开启shadowsocks代理\">使用polipo开启终端代理(需要先开启shadowsocks代理)</h4>\n<hr>\n<ul>\n<li>安装脚本(适合于bash和zsh终端) =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks-terminal\" target=\"_blank\" rel=\"noopener\">github / nojsja / polipo-install-config.sh&quot;</a></li>\n<li>使用方式<br>\n&gt; 说明：’ hp ’ == ’ http_proxy=http://localhost:8123 ’ for any command<br>\n&gt; 说明：’ gp ’ == ‘http.proxy=localhost:8123’ for git proxy config<br>\n&gt; 使用1：<code>hp curl ip.gs</code><br>\n&gt; 使用2：<code>git clone https://android.googlesource.com/tools/repo --config $gp</code></li>\n<li>如果polipo启动报错的话(通过<code>systemctl status polipo</code>查看)，可能是你的垃圾清理软件删除了polipo的日志文件夹，你可以手动更改polipo配置文件(<code>/etc/polipo/config</code>)禁用日至记录功能</li>\n</ul>\n<h4 id=\"将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表\">将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表</h4>\n<hr>\n<blockquote>\n<p>很多软件只有解压版，虽然可以解压后发送快捷方式到桌面，但是没有图标，应用列表也看不了。</p>\n</blockquote>\n<p>=&gt; 安装脚本(测试环境ubuntu18.04) =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/application\" target=\"_blank\" rel=\"noopener\">github / nojsja / makeIconLink</a><br>\n=&gt; 使用方式</p>\n<ul>\n<li>安装之前：请先将需要作为图标的icon图片(比例1:1比较适合，分辨率最好大于64px % 64px)放入目标文件夹内</li>\n<li>查看说明：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装指令：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --dir /path/to/[<span class=\"built_in\">exec</span>-file] --target [<span class=\"built_in\">exec</span>-file-name] --icon [icon-file-name]</span><br></pre></td></tr></table></figure>\n<ul>\n<li>卸载指令：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --uninstall [<span class=\"built_in\">exec</span>-file-name]</span><br></pre></td></tr></table></figure>\n<h4 id=\"自定义shadowsocks服务开机自启动脚本\">自定义shadowsocks服务开机自启动脚本</h4>\n<hr>\n<blockquote>\n<p>使用systemd来管理shadowsocks服务，开机自启动，不用打开shadowsocks-qt5软件，FQ了无痕 ~</p>\n</blockquote>\n<p>=&gt; 我的服务脚本：<a href=\"https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/startup.sh\" target=\"_blank\" rel=\"noopener\">startup.sh</a>、<a href=\"https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/shadowsocks\" target=\"_blank\" rel=\"noopener\">shadowsocks</a><br>\n=&gt; 步骤：</p>\n<ul>\n<li>编写shadowsocks service脚本文件，比如shadow.service</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\"><span class=\"comment\"># 描述</span></span><br><span class=\"line\">Description=Shadowsocks Service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=oneshot</span><br><span class=\"line\"><span class=\"comment\"># 服务 start/stop 执行脚本(具体执行路径根据自己的目录更改)</span></span><br><span class=\"line\">ExecStart=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh start</span><br><span class=\"line\">ExecStop=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh stop</span><br><span class=\"line\">RemainAfterExit=yes</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\"><span class=\"comment\"># 一些简单的依赖信息</span></span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<ul>\n<li>将服务配置文件放到<code>/etc/systemd/system</code>下<br>\n&gt; sudo cp shadow.service /etc/systemd/system</li>\n<li>设置服务自启动<br>\n&gt; systemctl enable shadow</li>\n<li>服务开启和关闭<br>\n&gt; systemctl start shadow<br>\n&gt; systemctl stop shadow</li>\n</ul>\n<h4 id=\"ubuntu1804设置shadowsocks全局pac自动代理对浏览器无效\">Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效</h4>\n<hr>\n<p>=&gt; 先来一个shadowsocks全局pac代理的步骤：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pip需要先安装</span></span><br><span class=\"line\">$: sudo apt-get install python-pip python-dev build-essential</span><br><span class=\"line\">$: sudo pip install --upgrade pip</span><br><span class=\"line\">$: sudo pip install --upgrade virtualenv</span><br><span class=\"line\"><span class=\"comment\"># 安装pac自动生成程序</span></span><br><span class=\"line\">$: sudo pip install genpac</span><br><span class=\"line\"><span class=\"comment\"># 生成pac文件</span></span><br><span class=\"line\">$: mkdir ~/shadowsocks</span><br><span class=\"line\">$: <span class=\"built_in\">cd</span> shadowsocks</span><br><span class=\"line\"><span class=\"comment\"># proxy配置中的地址和端口具体要看你的shadowsocks连接配置</span></span><br><span class=\"line\">$: genpac --proxy=<span class=\"string\">\"SOCKS5 127.0.0.1:1080\"</span> --gfwlist-proxy=<span class=\"string\">\"SOCKS5 127.0.0.1:1080\"</span> -o autoproxy.pac --gfwlist-url=<span class=\"string\">\"https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt\"</span></span><br></pre></td></tr></table></figure>\n<p>以上操作会在~/shadowsocks目录下生成autoproxy.pac配置文件，到系统设置 -&gt; 网络 -&gt; 网络代理 -&gt; 自动 -&gt; 填入file:///path/to/autoproxy.pac(上面我们生成的pac文件路径)，如果要新增被代理网站的话就自己编辑pac文件，在里面的域名列表里面再添加新的域名就好了。<br>\n=&gt; 再写一个脚本<a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks/genpac\" target=\"_blank\" rel=\"noopener\">genpac-command</a>，可以用来添加用户过滤规则(user-rules.txt) 和在线更新autoproxy.pac代理文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># # 在脚本目录下执行</span></span><br><span class=\"line\"><span class=\"comment\"># 显示帮助信息</span></span><br><span class=\"line\">$: bash genpac-command --<span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"comment\"># 在线更新</span></span><br><span class=\"line\">$: bash genpac-command --update-online</span><br><span class=\"line\"><span class=\"comment\"># 从本地user-rules.txt文件读取更新</span></span><br><span class=\"line\">$: bash genpac-command --update-local</span><br><span class=\"line\"><span class=\"comment\"># 添加自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --add-rules opendesktop.org</span><br><span class=\"line\"><span class=\"comment\"># 添加多个自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --add-rules opendesktop.org atom.io</span><br><span class=\"line\"><span class=\"comment\"># 删除自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --del-rules opendesktop.org</span><br><span class=\"line\"><span class=\"comment\"># 删除多个自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --del-rules opendesktop.org atom.io</span><br></pre></td></tr></table></figure>\n<p>=&gt; <strong>不过我遇到了代理pac文件配置好后，firefox和google浏览器仍然不能FQ的情况，仔细排查原因，我发现因为之前我不是用的pac全局代理，是通过浏览器的SwitchOmega插件来手动代理的，这个插件会接管浏览器的网络代理权限，我们需要到浏览器设置里面把网络代理设置为系统代理，以火狐浏览器为例：</strong></p>\n<h4 id=\"atom编辑器内存占用过大的问题\">Atom编辑器内存占用过大的问题</h4>\n<hr>\n<blockquote>\n<p>Atom、Vscode、Sublime、Bracks都用过，Atom用着最爽，可定制化程度最高。但是有时候用着Atom电脑呼呼作响，查看系统占用，Atom内存占用达到过4、5个G，我的天！其实Atom出现内存泄漏的问题都不是Atom本身的问题，一定是你安装的哪个插件导致了内存泄漏，查看占用信息后定位到atom的插件，然后把它禁用就可以了，比如之前导致我出现这个问题的插件就是：ide-typescript，禁用之后现在基本一个Atom进程只占用200~400Mb左右，取决于你安装的其它插件。还有Atom要经常手动更新啊，仓库里面更新不了的，直接去Atom git仓库下载release正式版本，基本上一个大版本就要更新一次。</p>\n</blockquote>\n<h4 id=\"grub2-主题安装\">Grub2 主题安装</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-12.png\" alt=\"source.png\"></p>\n<blockquote>\n<p>Grub2就是引导操作系统启动的东西，开机的时候如果是多系统，就会显示多系统的启动菜单，如图，这个启动菜单可以自定义主题。</p>\n</blockquote>\n<ol>\n<li>解压下载的主题文件 =&gt; <a href=\"https://pan.baidu.com/s/1ioMub2JmHlIzHJbS2_2gRQ\" target=\"_blank\" rel=\"noopener\">Vimix</a>，得到Vimix文件夹(这里提供我用的一个主题，也可以自已去下载其它主题)</li>\n<li>在/boot/grub里创建GRUB2主题目录themes<br>\n&gt; sudo mkdir -p /boot/grub/themes</li>\n<li>将下载的Vimix文件夹整体复制到/boot/grub/themes文件夹下<br>\n&gt; sudo cp -r Vimix /boot/grub/themes</li>\n<li>修改/etc/default/grub配置文件<br>\n&gt; sudo gedit /etc/default/grub<br>\n在文件最后添加：GRUB_THEME=&quot;/boot/grub/themes/Vimix/theme.txt&quot; 并保存</li>\n<li>更新GRUB<br>\n&gt; sudo update-grub</li>\n<li>重启即生效(如果重启卡住请强制关机后再启动)</li>\n</ol>\n<h4 id=\"ubuntu1804-解决下载额外数据文件失败ttf-mscorefonts-installer\">Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-13.png\" alt=\"firefox_proxy.png\"></p>\n<ol>\n<li><a href=\"http://sourceforge.net/projects/corefonts/files/the%20fonts/final/\" target=\"_blank\" rel=\"noopener\">sourceforge</a>下载如图所示11个exe文件并放入一个文件夹，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer</li>\n<li>运行字体配置程序<br>\n&gt; sudo dpkg-reconfigure ttf-mscorefonts-installer</li>\n<li>在配置窗口中输入刚才保存exe的路径确定即可，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer</li>\n</ol>\n<h4 id=\"ubuntu1804-wps-提示字体缺失的解决方法\">Ubuntu18.04 WPS 提示字体缺失的解决方法</h4>\n<hr>\n<p>下载缺失的字体文件<a href=\"https://pan.baidu.com/s/10MushHhTXwfRIFkKGmwD7Q\" target=\"_blank\" rel=\"noopener\">fonts</a> (密码: 4jpo)，然后复制到Linux系统中的/usr/share/fonts文件夹中，再使用系统命令更新字体设置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成字体的索引信息</span></span><br><span class=\"line\">$: sudo mkfontscale</span><br><span class=\"line\">$: sudo mkfontdir</span><br><span class=\"line\"><span class=\"comment\"># 更新字体缓存</span></span><br><span class=\"line\">$: sudo <span class=\"built_in\">fc</span>-cache</span><br></pre></td></tr></table></figure>\n<h4 id=\"ubuntu1804-更新gnome版本\">Ubuntu18.04 更新Gnome版本</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Upgrade</span></span><br><span class=\"line\"><span class=\"comment\">#If you were using the gnome3-team/gnome3-staging PPA, run the following before upgrading:</span></span><br><span class=\"line\">$: sudo ppa-purge ppa:gnome3-team/gnome3-staging</span><br><span class=\"line\">$: sudo ppa-purge ppa:gnome3-team/gnome3</span><br><span class=\"line\">$: sudo apt install ubuntu-gnome-desktop^</span><br><span class=\"line\"><span class=\"comment\"># The included GUI update manager will offer you the latest release of Ubuntu GNOME. Access this via the terminal:</span></span><br><span class=\"line\">$: update-manager -c</span><br><span class=\"line\"><span class=\"comment\"># Alternatively, run the following command:</span></span><br><span class=\"line\">$: sudo <span class=\"keyword\">do</span>-release-upgrade</span><br></pre></td></tr></table></figure>\n<h4 id=\"win10-ubuntu1804-双系统时间显示不对\">Win10 + Ubuntu18.04 双系统时间显示不对</h4>\n<hr>\n<blockquote>\n<p>Ubuntu和Windows默认的时间管理方式不同，所以双系统发生时间错乱是正常的。Ubuntu默认时间是把BIOS时间当成GMT+0时间，也就是世界标准时，而我国在东八区(GMT+8)，所以如果你的Ubuntu位置是中国的话你系统显示的时间就是BIOS时间+8小时。假如现在是早上8点，那么你Ubuntu会显示8点，这时BIOS中的时间是0点。而当你切换到Windows系统时就会发生时间错乱，因为Windows会认为BIOS时间就是你的本地时间，结果就是Windows显示时间为0点……而假如你在Windows下同步时间，恢复显示为8点，这时BIOS时间也会被Windows改写成8点，再次进入Ubuntu时显示时间又变成了8+8=16点。</p>\n</blockquote>\n<ol>\n<li>先在Ubuntu下更新一下时间<br>\n&gt; sudo apt-get install ntpdate<br>\n&gt; sudo ntpdate <a href=\"http://time.windows.com\" target=\"_blank\" rel=\"noopener\">time.windows.com</a></li>\n<li>将时间更新到硬件上<br>\n&gt; sudo hwclock --localtime --systohc</li>\n<li>关闭linux重新进入windows系统，发现时间正常了</li>\n</ol>\n<h4 id=\"ubuntu1804-安装系统时说明双硬盘\">Ubuntu18.04 安装系统时说明(双硬盘)</h4>\n<hr>\n<blockquote>\n<p>主要分为 [ <em>GPT磁盘分区+UEFI引导方案</em> ] 和 [ <em>传统MBR磁盘分区 + LEGANCY引导方案</em> ]</p>\n</blockquote>\n<ol>\n<li>方案一(兼容方案 gpt+uefi / mbr+legancy)<br>\n使用UEFI模式安装Ubuntu18.04时可以选择用 兼容bios启动方式 来安装系统(同时兼容传统启动方式和UEFI启动方式)，即不分配&quot;/boot “分区，分配一个大小为1GB左右的&quot;保留bios启动区域”(UEFI模式会自动挂载/boot和/boot/efi)，其它分区至少还需要一个根分区&quot;/&quot;，8G内存的情况下最好还是分配8G的swap交换分区，另外除了&quot;保留bios启动区域&quot;为主分区，其它分区均为逻辑分区，最后一步很重要 – 格式化每个分区，要不然安装很可能会出错！<a href=\"https://blog.csdn.net/jesse_mx/article/details/61425361\" target=\"_blank\" rel=\"noopener\">参考</a></li>\n<li>方案二(gpt+uefi 已使用方案)<br>\n创建&quot;efi系统分区&quot;，同时不需要划分&quot;/boot&quot;分区(boot引导是grub由引导的，而efi显然是UEFI引导的)，其余至少还需要划分&quot;/“根分区，除了根分区所有分区都为逻辑分区，最后选择&quot;安装启动引导器的设备&quot;为刚才创建的&quot;efit系统分区”。</li>\n<li>方案三(传统mbr+legancy方案)<br>\n传统的legancy + mbr的安装，至少划分&quot;/boot&quot;分区(主分区) 和 &quot;/“根分区，其余的分区按需划分，最后选择&quot;安装启动引导器的设备&quot;为创建的”/boot&quot;挂载点。</li>\n</ol>\n<h4 id=\"ubuntu-1804-使用lvm逻辑卷管理方式安装后启动很慢的问题\">Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题</h4>\n<p><a href=\"https://askubuntu.com/questions/1030867/how-to-diagnose-fix-very-slow-boot-on-ubuntu-18-04\" target=\"_blank\" rel=\"noopener\">=&gt; 原帖子</a></p>\n<ol>\n<li>编辑文件 <code>/etc/default/grub</code> 的 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 这一行，加入一个参数__noresume__</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRUB_CMDLINE_LINUX_DEFAULT=<span class=\"string\">\"quiet splash noresume\"</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>更新grub</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>重启电脑</li>\n</ol>\n<h4 id=\"ubuntu1804-安装网易云音乐110后不能打开的解决方法\">Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法</h4>\n<hr>\n<ul>\n<li>使用root权限命令行后台启动并且屏蔽输出<br>\n&gt; sudo netease-cloud-music &gt; /dev/null 2&gt;&amp;1  &amp;</li>\n<li>规避session-manager引起的bug<br>\n&gt; alias netease=‘unset SESSION_MANAGER &amp;&amp; netease-cloud-music’<br>\n&gt; netease &gt; /dev/null &amp;</li>\n<li>别用那个鸡肋的客户端了，有bug也不更新，上这个酷酷的第三方客户端<a href=\"https://github.com/trazyn/ieaseMusic\" target=\"_blank\" rel=\"noopener\">ieaseMusic</a></li>\n<li>这里还有个别人做的针对ubuntu18.04的<a href=\"https://github.com/innoob/netease-cloud-music\" target=\"_blank\" rel=\"noopener\">重新构建版本</a>，可以正常使用，也没有重复登录的bug</li>\n</ul>\n<h4 id=\"ubuntu1804-crossover17安装qq后乱码的解决方法\">Ubuntu18.04 Crossover17安装QQ后乱码的解决方法</h4>\n<hr>\n<blockquote>\n<p>原因：原来的ume-ui-gothic.ttf不支持很多简体中文字符</p>\n</blockquote>\n<p>使用其它字体文件替换到目录 /opt/cxoffice/share/wine/fonts 下的<a href=\"https://pan.baidu.com/s/13CDBKrvTAJOhrbuyLw96jA\" target=\"_blank\" rel=\"noopener\">ume-ui-gothic.ttf</a>字体文件 (同名)，记得将下好的文件重命名为ume-ui-gothic.ttf。</p>\n<h4 id=\"ubuntu1804-通过tweak安装gnome插件blyr后设置插件报错\">Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错</h4>\n<hr>\n<p>=&gt; 错误信息：<code>Error: Requiring Clutter, version none: Typelib file for namespace 'Clutter' (any version) not found ...</code><br>\n=&gt; 原因分析：该插件需要的依赖Clutter尚未安装<br>\n=&gt; 解决方法：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">$: sudo apt-get install gir1.2-clutter-1.0 gir1.2-clutter-gst-3.0 gir1.2-gtkclutter-1.0</span><br></pre></td></tr></table></figure>\n<h4 id=\"ubuntu1804-gnome-shell-插件\">Ubuntu18.04 Gnome-Shell 插件</h4>\n<hr>\n<ul>\n<li><a href=\"https://extensions.gnome.org/extension/97/coverflow-alt-tab/\" target=\"_blank\" rel=\"noopener\">CoverFlow Alt-Tab</a> =&gt; 窗口Tab切换预览(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/19/user-themes/\" target=\"_blank\" rel=\"noopener\">User Themes(必要)</a> =&gt; 用户主题安装(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/307/dash-to-dock/\" target=\"_blank\" rel=\"noopener\">Dash To Dock</a> =&gt; dock栏(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1160/dash-to-panel/\" target=\"_blank\" rel=\"noopener\">Dash To Panel</a> =&gt; 将dock和顶栏显示在一起(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1236/noannoyance/\" target=\"_blank\" rel=\"noopener\">NoAnnoyance</a> =&gt; 禁用多余的pop提示信息，直接提升活动窗口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/595/autohide-battery/\" target=\"_blank\" rel=\"noopener\">Autohide Battery</a> =&gt; 电池充满并连接电源时自动隐藏电池按钮(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/8/places-status-indicator/\" target=\"_blank\" rel=\"noopener\">Places Status Indicator</a> =&gt; 顶部任务栏显示磁盘和卷的快捷入口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/7/removable-drive-menu/\" target=\"_blank\" rel=\"noopener\">Removable Drive Menu</a> =&gt; 顶部任务栏显示可移除的已挂载设备(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/826/suspend-button/\" target=\"_blank\" rel=\"noopener\">Suspend Button</a> =&gt; 顶部菜单栏显示休眠按钮(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/495/topicons/\" target=\"_blank\" rel=\"noopener\">TopIcons</a> =&gt; 顶部通知图标托盘(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1031/topicons/\" target=\"_blank\" rel=\"noopener\">TopIconsPlus</a> =&gt; 顶部通知图标托盘，自定义图标显示参数(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1251/blyr/\" target=\"_blank\" rel=\"noopener\">Blyr</a> =&gt; 模糊应用预览背景图(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/358/activities-configurator/\" target=\"_blank\" rel=\"noopener\">Activities Configurator</a> =&gt; 配置左上角活动按钮(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/427/workspaces-to-dock/\" target=\"_blank\" rel=\"noopener\">Workspace to Dock</a> =&gt; 将工作区转换为悬浮dock(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1036/extensions/\" target=\"_blank\" rel=\"noopener\">Extensions</a> =&gt; 在通知栏添加快捷开启和关闭gnome-shell插件的功能(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/779/clipboard-indicator/\" target=\"_blank\" rel=\"noopener\">Clipboard Indicator</a> =&gt; 可视化剪贴板(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/906/sound-output-device-chooser/\" target=\"_blank\" rel=\"noopener\">Sound Input &amp; Output Device Chooser</a> =&gt; 声音输入和输入设备快速选择(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1236/noannoyance/\" target=\"_blank\" rel=\"noopener\">NoAnnoyance</a> =&gt; 取消“窗口已就绪”提示直接提升窗口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/\" target=\"_blank\" rel=\"noopener\">Bluetooth quick connect</a> =&gt; 蓝牙设备快速连接和断开(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1403/remove-alttab-delay/\" target=\"_blank\" rel=\"noopener\">Remove Alt+Tab Delay</a> =&gt; 移除【Alt + Tab】的开启应用预览延迟(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1162/emoji-selector/\" target=\"_blank\" rel=\"noopener\">Emoji Selector</a> =&gt; 快速选择Emoji表情(★★★★)</li>\n</ul>\n<h4 id=\"ubuntu1804-插件-dash-to-dock-一些常用设置\">Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Use Custom Dock Indicator ( Optional )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-running-dots <span class=\"literal\">false</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-customize-running-dots <span class=\"literal\">false</span></span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Disable Custom Dock Shrink ( Required for Good looking) (  Required )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-shrink <span class=\"literal\">false</span></span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Dock Transparency mode ( Optional )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock transparency-mode DEFAULT</span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Restore to Default</span></span><br><span class=\"line\">$: dconf reset -f /org/gnome/shell/extensions/dash-to-dock/</span><br><span class=\"line\">_______________________________________________________________________________________________</span><br></pre></td></tr></table></figure>\n<h4 id=\"ubuntu1804-主题\">Ubuntu18.04 主题</h4>\n<hr>\n<ul>\n<li>GTK3主题(★★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">X-Arc-Collection</a></li>\n<li>GTK3主题(★★★★★) =&gt; <a href=\"https://www.gnome-look.org/p/1241688\" target=\"_blank\" rel=\"noopener\">McOS-themes</a></li>\n<li>Gnome Shell主题(★★★★) =&gt; <a href=\"https://github.com/daniruiz/flat-remix\" target=\"_blank\" rel=\"noopener\">Flat-Remix</a></li>\n<li>Gnome Shell主题(★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1171095/\" target=\"_blank\" rel=\"noopener\">Human</a></li>\n<li>Gnome Shell主题(★★★★★) =&gt; <a href=\"https://www.opendesktop.org/c/1460761561\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>Gnome Shell主题(?) =&gt; <a href=\"https://www.gnome-look.org/p/1213208/\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>Icon 主题(★★★★) =&gt; <a href=\"https://github.com/daniruiz/flat-remix/releases\" target=\"_blank\" rel=\"noopener\">flat-remix</a></li>\n<li>Icon 主题(★★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1012200/\" target=\"_blank\" rel=\"noopener\">Mac OS X Icon</a></li>\n<li>Icon 主题(★★★★★) =&gt; <a href=\"https://github.com/keeferrourke/la-capitaine-icon-theme/releases\" target=\"_blank\" rel=\"noopener\">la-capitaine-icon-theme</a></li>\n<li>Icon 主题(★★★★★) <a href=\"https://www.pling.com/p/1305429/\" target=\"_blank\" rel=\"noopener\">McMojave-circle</a></li>\n<li>Icon 主题(★★★★☆) =&gt; <a href=\"https://github.com/zayronxio/Macos-sierra-CT\" target=\"_blank\" rel=\"noopener\">MacOS sierra ct</a></li>\n<li>Cursor主题(★★★★☆) =&gt; <a href=\"https://krourke.org/projects/art/capitaine-cursors\" target=\"_blank\" rel=\"noopener\">Capitaine Cursors</a></li>\n</ul>\n<h4 id=\"chrome实用插件整理\">chrome实用插件整理</h4>\n<hr>\n<ul>\n<li><a href=\"https://chrome.google.com/webstore/detail/infinity-new-tabproductiv/dbfmnekepjoapopniengjbcpnbljalfg?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">infinity pro 标签页</a> =&gt; 主页标签管理器(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/octotree/bkhaagjahfmjljalopjnoealnfndnagc?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Octotree</a> =&gt; github仓库文件资源浏览树(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/postman-interceptor/aicmkgpgakddgnaphhhpliifpcfhicfo?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Postman</a> =&gt; API测试和请求模拟器(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">SwitchyOmega</a> =&gt; 大家都用的代理软件(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">印象笔记剪藏</a> =&gt; 随时随地把网络资源保存到你的笔记本里(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/simpread-reader-view/ijllcpnolfcooahcekpamkbidhejabll?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">SimpRead</a> =&gt; 让浏览器支持纯净的阅读模式(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/full-page-screen-capture/fdpohaocaechififmbbbbbknoalclacl?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Full Page Screen Capture</a> =&gt; 全屏截图(★★★★☆)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">油猴tampermonkey</a> =&gt; 用户脚本管理器，一个用例是破解badu网盘的限速(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/checker-plus-for-gmail/oeopbcgkkoapgobdbedcemjljbihmemj?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Checker Plus for Gmail</a> =&gt; Google邮件提示插件(★★★★☆)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Vimium</a> =&gt; 让google浏览器支持vim模式(firefox也有)(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/copy-as-markdown/dgoenpnkphkichnohepecnmpmihnabdg\" target=\"_blank\" rel=\"noopener\">拷贝为Markdown</a> =&gt; 将选中网页转化为markdown格式并发送到剪贴板(★★★★☆)</li>\n</ul>\n<h4 id=\"实用程序和命令\">实用程序和命令</h4>\n<hr>\n<ul>\n<li><a href=\"https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager\" target=\"_blank\" rel=\"noopener\">fonts-firacode编程字体</a> =&gt; 解决vscode字体间隙过小的问题<code>sudo apt install fonts-firacode</code></li>\n<li><a href=\"https://vivaldi.com\" target=\"_blank\" rel=\"noopener\">vivaldi浏览器</a> =&gt; 可定制化程度高的个性化浏览器(★★★★★)</li>\n<li>Terminator =&gt; 默认gnome终端升级版(★★★★★)</li>\n<li>Timeshift =&gt; 创建系统快照，增量备份(★★★★★)</li>\n<li>ipython3(命令工具) =&gt; python交互解释器(★★★★★)</li>\n<li>jupyter =&gt; 交互式数据分析和记录工具(★★★★☆)</li>\n<li>pdb/ipdb(命令工具) =&gt; python调试器(★★★★☆)</li>\n<li>trash-cli(命令工具) =&gt; 命令行回收站(★★★★★)</li>\n<li>bat(命令工具) =&gt; cat升级版，支持语法高亮和git状态显示(★★★★★)</li>\n<li>axel(命令工具) =&gt; 下载限速不存在的，如果存在那我就开100个下载线程 : )(★★★★☆)</li>\n<li><a href=\"https://github.com/aria2/aria2\" target=\"_blank\" rel=\"noopener\">aria2(命令工具)</a> =&gt; 强大的命令行下载工具</li>\n<li><a href=\"https://github.com/oguzhaninan/Stacer\" target=\"_blank\" rel=\"noopener\">stacer</a> =&gt; linux电脑管家(★★★★★)</li>\n<li><a href=\"https://github.com/trazyn/ieaseMusic\" target=\"_blank\" rel=\"noopener\">ieaseMusic</a> =&gt; 网易云音乐第三方客户端，没有bug，不会退出后再打开就让重新登陆[注：网易云音乐官方已修复]，界面还很酷(★★★★★)</li>\n<li>parallel(命令工具) =&gt; 利用系统的多核来并行执行你的程序(★★★★☆)</li>\n<li>cheat(命令工具) =&gt; 类似man命令的功能，简洁高效(★★★★☆)</li>\n<li>topgrade(命令工具) =&gt; 一个命令更新所有软件(★★★★)</li>\n<li><a href=\"https://www.dbkoda.com/\" target=\"_blank\" rel=\"noopener\">dbKoda</a> =&gt; mongodb GUI工具(★★★★☆)</li>\n<li><a href=\"https://www.mongodb.com/products/compass\" target=\"_blank\" rel=\"noopener\">mongodb compass</a> =&gt; mongodb GUI工具(★★★★)</li>\n<li><a href=\"https://github.com/phw/peek\" target=\"_blank\" rel=\"noopener\">peek</a> =&gt; 屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件(★★★★☆)</li>\n<li>tmux =&gt; 终端管理器(★★★★)</li>\n<li>深度终端(ubuntu商店下载) =&gt; 支持分屏，内置实用主题(★★★★☆)</li>\n<li>深度截图(ubuntu商店下载) =&gt; 支持截图编辑(★★★★★)</li>\n<li><a href=\"https://webtorrent.io/desktop/\" target=\"_blank\" rel=\"noopener\">WebTorrent</a>、<a href=\"https://www.frostwire.com/\" target=\"_blank\" rel=\"noopener\">FrostWire</a> =&gt; bt下载工具，支持边下边播(★★★★)</li>\n<li><a href=\"https://www.syntevo.com/smartgit/\" target=\"_blank\" rel=\"noopener\">SmartGit</a> =&gt; linux平台免费的GIT GUI工具(★★★★★)</li>\n<li>FileZilla =&gt; ftp工具(★★★★★)</li>\n<li><a href=\"https://github.com/Suremotoo/e-tools\" target=\"_blank\" rel=\"noopener\">e-tools</a> =&gt; coder常用小工具(★★★★)</li>\n<li><a href=\"https://electronjs.org/apps/whatever\" target=\"_blank\" rel=\"noopener\">WhatEver</a> =&gt; linux第三方印象笔记客户端，基于网页版(★★★★)</li>\n<li><a href=\"http://linux.wps.cn/\" target=\"_blank\" rel=\"noopener\">wps</a> =&gt; linux office for free made by KingSoftware(★★★★★)</li>\n<li><a href=\"https://atom.io/\" target=\"_blank\" rel=\"noopener\">Atom</a> =&gt; 我一直在用的编辑器，没有固态硬盘的不推荐使用(★★★★☆)</li>\n<li><a href=\"https://code.visualstudio.com/\" target=\"_blank\" rel=\"noopener\">vscode</a> =&gt; 轻量化编辑器，没有Atom人性化，但是很快。都是JS写的，性能差距咋这么大呢 ? (★★★★★)</li>\n<li>ndb =&gt; node.js/javascript 调试器(★★★★★)</li>\n<li><a href=\"https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh\" target=\"_blank\" rel=\"noopener\">nvm</a> =&gt; nodejs版本管理器</li>\n<li>albert (添加软件源 <code>ppa:noobslab/macbuntu</code> 安装 ) =&gt; 桌面全局搜索类似Mac系统的SpotLight(★★★★★)</li>\n<li><a href=\"https://linux.cn/article-5460-1.html\" target=\"_blank\" rel=\"noopener\">lftp</a> =&gt; 一个基于命令行的文件传输软件，支持FTP，FTPS，HTTP，HTTPS，HFTP，FISH，以及SFTP等协议，也有许多高级特性比<br>\n如：多线程下载、断点续传</li>\n<li><a href=\"http://jonls.dk/redshift/\" target=\"_blank\" rel=\"noopener\">redshift-gtk</a> 护眼模式，自带的色彩太黄了</li>\n<li>apt-fast =&gt; 比apt更快的包管理器，添加<code>ppa:apt-fast/stable</code>安装(★★★★★)</li>\n<li>nautilus action configure tool =&gt; 资源管理器右键菜单自定义，添加<code>ppa:daniel-marynicz/filemanager-actions</code>安装(★★★★★)</li>\n<li>tig =&gt; 可交互的命令行git命令(★★★★★)</li>\n<li>shellcheck =&gt; shell脚本语法检查(★★★★★)</li>\n<li><a href=\"https://motrix.app/zh-CN/\" target=\"_blank\" rel=\"noopener\">Motrix</a> =&gt; 全平台下载工具，用于替代迅雷(★★★★★)</li>\n<li><a href=\"https://www.insynchq.com/\" target=\"_blank\" rel=\"noopener\">Insync</a> =&gt; 全平台同步工具，支持google云和onedrive(★★★★★)</li>\n<li><a href=\"https://github.com/teejee2008/timeshift\" target=\"_blank\" rel=\"noopener\">Timeshift</a> =&gt; 创建系统增量备份计划(★★★★★)</li>\n<li>dconf-editor =&gt; gnome桌面配置gui工具(★★★★)</li>\n</ul>\n<h4 id=\"实用网站推荐\">实用网站推荐</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-14.png\" alt=\"Vimix.png\"></p>\n<ul>\n<li><a href=\"https://wallpapershome.com/\" target=\"_blank\" rel=\"noopener\">Wallpaper</a>  =&gt; 高清桌面壁纸下载，支持多种分辨率(★★★★★)</li>\n<li><a href=\"https://www.flaticon.com\" target=\"_blank\" rel=\"noopener\">flaticon</a> =&gt; 免费图标下载网站，支持svg和png两种格式</li>\n<li><a href=\"https://electronjs.org/apps\" target=\"_blank\" rel=\"noopener\">Electron Apps</a> =&gt; 有很多Electron 框架写的跨平台应用(Linux/Mac/Windows)(★★★★☆)</li>\n<li><a href=\"https://www.centos.bz/\" target=\"_blank\" rel=\"noopener\">Linux运维日志</a> =&gt; 服务搭建、Linux技术之类的(★★★★☆)</li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/\" target=\"_blank\" rel=\"noopener\">IBM Developer</a> =&gt; 技术文档类的参考(★★★★★)</li>\n<li><a href=\"https://www.lulinux.com/archives/2513#awk\" target=\"_blank\" rel=\"noopener\">Linux常用命令</a>  =&gt;  常用命令速查(★★★★☆)</li>\n<li><a href=\"https://www.kanbilibili.com/\" target=\"_blank\" rel=\"noopener\">bilibili工具网站</a> =&gt; 支持 视频/弹幕/封面 下载等骚操作(★★★★★)</li>\n<li><a href=\"https://linux.cn/\" target=\"_blank\" rel=\"noopener\">Linux中国</a> =&gt; 没事儿就上去看看别人翻译转载的文章(★★★★☆)</li>\n<li><a href=\"https://tinypng.com/\" target=\"_blank\" rel=\"noopener\">TinyPNG</a> =&gt; 免费的图片无损压缩网站(★★★★☆)</li>\n<li><a href=\"https://www.iloveimg.com/zh-cn\" target=\"_blank\" rel=\"noopener\">iLoveIMG</a> =&gt; 在线图片编辑网站(★★★★★)</li>\n<li><a href=\"https://en.savefrom.net/\" target=\"_blank\" rel=\"noopener\">savefrom</a> =&gt; 直接下载youtube视频(★★★★☆)</li>\n<li><a href=\"https://www.lulinux.com/\" target=\"_blank\" rel=\"noopener\">撸Linux</a> =&gt; 好像还蛮有趣的额(★★★★☆)</li>\n<li><a href=\"https://greasyfork.org/zh-CN/scripts\" target=\"_blank\" rel=\"noopener\">油猴脚本</a> =&gt; 你甚至可以用来破解百度云限速(★★★★★)</li>\n</ul>\n<p><em>注：以上内容部分是从网络搜集，希望解决广大Linuxer的问题所以做了部分整合.</em></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/Ubuntu18.04-1.jpg\" alt=\"welcome / home\"></p>\n<h4>Contents</h4>\n<hr>\n<ul>\n<li>Wine应用启动后出现WineSystemTray 托盘的问题</li>\n<li>中文环境下将Home目录下的文件夹切换为英文名</li>\n<li>Ubuntu系发行版安装deepin wine QQ</li>\n<li>续：安装QQ/微信</li>\n<li>Ubuntu 18.04开机启动特别慢的问题</li>\n<li>终端oh-my-zsh配置</li>\n<li>终端终结者Terminator配置</li>\n<li>禁用内核更新</li>\n<li>终端常用等宽字体</li>\n<li>crossover18破解</li>\n<li>vim插件配置</li>\n<li>Ubuntu18.04 定制Mac主题</li>\n<li>Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式</li>\n<li>Ubuntu18.04 关于定制plymouth主题来更换开机动画</li>\n<li>Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题</li>\n<li>Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题</li>\n<li>Ubuntu18.04 解决一些软件依赖不满足问题的问题</li>\n<li>Linux分区过小导致后期容量不足解决方法</li>\n<li>Shadowsocks-Qt5安装的问题</li>\n<li>使用polipo开启终端代理(需要先开启shadowsocks代理)</li>\n<li>将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表</li>\n<li>自定义shadowsocks服务开机自启动脚本</li>\n<li>Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效</li>\n<li>Atom编辑器内存占用过大的问题</li>\n<li>Grub2 主题安装</li>\n<li>Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer</li>\n<li>Ubuntu18.04 WPS 提示字体缺失的解决方法</li>\n<li>Ubuntu18.04 更新Gnome版本</li>\n<li>Win10 + Ubuntu18.04 双系统时间显示不对</li>\n<li>Ubuntu18.04 安装系统时说明(双硬盘)</li>\n<li>Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题</li>\n<li>Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法</li>\n<li>Ubuntu18.04 Crossover17安装QQ后乱码的解决方法</li>\n<li>Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错</li>\n<li>Ubuntu18.04 Gnome-Shell 插件</li>\n<li>Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置</li>\n<li>Ubuntu18.04 主题</li>\n<li>chrome实用插件整理</li>\n<li>实用程序和命令</li>\n<li>实用网站推荐</li>\n</ul>\n<h4>Wine应用启动后出现WineSystemTray托盘的问题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-2.png\" alt=\"wine_tray.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-3.png\" alt=\"tray.png\"></p>\n<ol>\n<li>\n<p>操作系统Linux Mint18.3<br>\n右键点击面板(状态栏)，选择 - 向面板添加小程序，选择小程序 - 系统托盘，点击+号添加，之后Wine安装的应用和其它应用的图标就被系统托盘管理了。</p>\n</li>\n<li>\n<p>操作系统Ubuntu 18.04<br>\n安装gnome-shell插件 <a href=\"https://extensions.gnome.org/extension/495/topicons/\" target=\"_blank\" rel=\"noopener\">TopIcons</a>, 要想从浏览器上安装这个TopIcons需要先安装浏览器gnome交互插件chrome-gnome-shell (<code>sudo apt install chrome-gnome-shell</code> )，使用deepin QQ的时候可能需要重新启动TopIcons才能显示顶部QQ图标，如果遇到图标无故隐藏的问题那么可以再安装插件<a href=\"https://extensions.gnome.org/extension/1160/dash-to-panel/\" target=\"_blank\" rel=\"noopener\">Dash to Panel</a>解决。</p>\n</li>\n</ol>\n<h4>中文环境下将Home目录下的文件夹切换为英文名</h4>\n<hr>\n<ol>\n<li>设置英文语言环境</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: <span class=\"built_in\">export</span> LANG=en_US(恢复-&gt; zh_CN)</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>更新目录</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>弹出提示框点击 [确认]</li>\n<li>重启后会再次弹出提示框是否将英文文件夹改回中文，选择 [不再提示] 并 [取消] 修改</li>\n</ol>\n<h4>Ubuntu系发行版安装deepin wine QQ</h4>\n<hr>\n<ol>\n<li>\n<p>安装deepin-wine环境：上<a href=\"https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu\" target=\"_blank\" rel=\"noopener\">https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu</a>页面下载zip包（或用git方式克隆），也可以<a href=\"https://pan.baidu.com/s/120C5aHuqtyxQyn_fGTxHKg\" target=\"_blank\" rel=\"noopener\">百度网盘</a>下载，解压到本地文件夹，在文件夹中打开终端，输入<code>sudo sh ./install.sh</code>一键安装，如果你安装了这些依赖，在第二步的时候仍然报依赖错误，那就手动解压deb包，把那些依赖声明删除就行了(解压deb的方法下文中有提到)。</p>\n</li>\n<li>\n<p>安装deepin.com应用容器：在<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/</a>中下载想要的容器，点击deb安装即可，以下为推荐容器:</p>\n</li>\n</ol>\n<ul>\n<li>QQ：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/</a></li>\n<li>TIM：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/</a></li>\n<li>QQ轻聊版：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/</a></li>\n<li>微信：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/</a></li>\n<li>Foxmail：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.foxmail/</a></li>\n<li>百度网盘：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/</a></li>\n<li>360压缩：<a href=\"http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.cn.360.yasuo/</a></li>\n<li>迅雷急速版:  <a href=\"https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg\" target=\"_blank\" rel=\"noopener\">https://pan.baidu.com/s/1cij1FhFeEn2sXdPtkJ3lSg</a></li>\n<li>Ubuntu系发行版包括Ubuntu、LinuxMint、ZorinOS等。</li>\n</ul>\n<h4>续：安装QQ/微信</h4>\n<hr>\n<p>1.linux上的微信大部分都是网页版微信封装的: <a href=\"https://github.com/geeeeeeeeek/electronic-wechat\" target=\"_blank\" rel=\"noopener\">electronic-wechat</a>、<a href=\"https://github.com/trazyn/weweChat\" target=\"_blank\" rel=\"noopener\">weweChat</a>，网页版功能简单，每次登录都要扫码。而且现在腾讯好像开始禁用了微信网页版的登陆，如果发现不能登录网页版就只能使用crossover来安装windows版的微信。</p>\n<p>2.￥140可以买个CrossOver18正版，一次激活，永久使用，然后愉快地安装QQ8.9，喜欢TIM的也能用TIM， 不过目前这个基于crossover的QQ有些bug，也不能记住密码。使用crossover18安装微信，安装包直接下载windows版本的就行，然后使用crossover创建windowsXP 64位容器，在容器中安装微信即可，不过可能安装时会出现<code>&quot;WeChatWin.dll 缺失问题&quot;</code>报错信息，需要执行下面命令安装额外的环境：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: apt-get install libldap-2.4-2:i386</span><br></pre></td></tr></table></figure>\n<p>3.使用docker安装<a href=\"https://hub.docker.com/r/bestwu/qq\" target=\"_blank\" rel=\"noopener\">Tim</a> 和 <a href=\"https://hub.docker.com/r/bestwu/wechat\" target=\"_blank\" rel=\"noopener\">wechat</a>，<a href=\"https://www.runoob.com/docker/ubuntu-docker-install.html\" target=\"_blank\" rel=\"noopener\">docker环境安装教程</a></p>\n<p>4.wine环境下(crossover/deepin)安装好微信后如果发现不能输入文字(其实可以输入和发送，只是文字透明的)，可以使用这个文件<a href=\"https://pan.baidu.com/s/1-ScZvkmR9oZPdiFurdKQdA\" target=\"_blank\" rel=\"noopener\">riched20.dll</a>(提取密码：rofj)替换掉微信所在容器下的C盘的<code>/windows/system32/riched20.dll</code>，容器路径一般在：<code>~/.cxoffice/[你的容器名]/drive_c/</code>。</p>\n<p>5.wine环境下(crossover/deepin)如果运行微信时发现界面有一个黑框不能关闭，只需要在聊天输入框中键入中文“不”然后再删除即可让黑框消失(原因:微信会根据你输入的字作为关键字在你现有表情中找符合的表情并显示出来提示你可用,但并没有很好的兼容这个功能变成一个黑框了，所以手动消除黑框的办法只有打关键字然后删除)。</p>\n<p>6.wine环境下(crossover/deepin)如果运行微信的时候不能发送图片，尝试安装 <code>sudo apt install libjpeg62:i386</code>，临时解决办法是把图片文件拖动到<code>收藏</code>，然后从收藏转发即可。</p>\n<p>7.wine环境下(crossover/deepin)如果运行QQ发现收到的图片一直加载不出来(刚登录开始可以，过一会就不行了)，那么可以在QQ登录界面设置一下网络代理(http/socks)，注意本地代理情况下代理地址不能使用localhost/127.0.0.1此类的IP，使用0.0.0.0是可以的。</p>\n<h4>Ubuntu 18.04开机启动特别慢的问题</h4>\n<hr>\n<p>=&gt; 禁用不必要的开机服务：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出程序开机占用时间排行</span></span><br><span class=\"line\">systemd-analyze blame</span><br><span class=\"line\"><span class=\"comment\"># 禁用plymouth</span></span><br><span class=\"line\">sudo systemctl mask plymouth-start.service</span><br><span class=\"line\">sudo systemctl mask plymouth-read-write.service</span><br></pre></td></tr></table></figure>\n<h4>终端oh-my-zsh配置</h4>\n<hr>\n<ol>\n<li>主题</li>\n</ol>\n<ul>\n<li>gnzh(已使用))</li>\n<li>ys</li>\n<li>avit</li>\n<li>af-magic</li>\n</ul>\n<ol start=\"2\">\n<li>插件</li>\n</ol>\n<ul>\n<li>git =&gt; 自带git状态插件</li>\n<li>svn =&gt; svn状态插件</li>\n<li>colored-man-pages =&gt; man帮助信息高亮</li>\n<li>zsh-syntax-highlighting =&gt; 命令高亮和错误提示</li>\n<li>z =&gt; 自动记录路径快捷跳转</li>\n<li>zsh-autosuggestions =&gt; 根据输入记录自动建议可选输入命令</li>\n</ul>\n<h4>终端终结者Terminator配置</h4>\n<hr>\n<p>特性：浅色调、字体舒适、无滚动条、自定义快捷键和配色、自动设置窗口布局</p>\n<p>注意：可以配合<code>设置-&gt;设备-&gt;键盘-&gt;添加自定义快捷键</code>这样自定义快捷键来启动终端，<br>\n比如设置<code>Ctrl+Alt+T</code>为<code>terminator --geometry=93x32+450+300</code>，geometry为窗口的布局配置。</p>\n<p>覆盖文件<code>~/.config/terminator/config</code>内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  [global_config]</span><br><span class=\"line\">  enabled_plugins = CustomCommandsMenu, LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler</span><br><span class=\"line\">  suppress_multiple_term_dialog = True</span><br><span class=\"line\">  title_hide_sizetext = True</span><br><span class=\"line\">[keybindings]</span><br><span class=\"line\">  prev_tab = &lt;Alt&gt;1</span><br><span class=\"line\">  reset_clear = &lt;Primary&gt;&lt;Shift&gt;g</span><br><span class=\"line\">  clear = &lt;Primary&gt;l</span><br><span class=\"line\">  switch_to_tab_1 = &lt;Alt&gt;1</span><br><span class=\"line\">  switch_to_tab_2 = &lt;Alt&gt;2</span><br><span class=\"line\">  switch_to_tab_3 = &lt;Alt&gt;3</span><br><span class=\"line\">  switch_to_tab_4 = &lt;Alt&gt;4</span><br><span class=\"line\">  switch_to_tab_5 = &lt;Alt&gt;5</span><br><span class=\"line\">  toggle_scrollbar = None</span><br><span class=\"line\">  toggle_zoom = &lt;Primary&gt;&lt;Shift&gt;x</span><br><span class=\"line\">[layouts]</span><br><span class=\"line\">  [[default]]</span><br><span class=\"line\">    [[[child1]]]</span><br><span class=\"line\">      parent = window0</span><br><span class=\"line\">      profile = default</span><br><span class=\"line\">      <span class=\"built_in\">type</span> = Terminal</span><br><span class=\"line\">    [[[window0]]]</span><br><span class=\"line\">      parent = <span class=\"string\">\"\"</span></span><br><span class=\"line\">      size = 925, 570</span><br><span class=\"line\">      <span class=\"built_in\">type</span> = Window</span><br><span class=\"line\">[plugins]</span><br><span class=\"line\">  [[CustomCommandsMenu]]</span><br><span class=\"line\">    [[[清屏]]]</span><br><span class=\"line\">      <span class=\"built_in\">command</span> = clear</span><br><span class=\"line\">      enabled = True</span><br><span class=\"line\">      name = 清屏</span><br><span class=\"line\">      position = 0</span><br><span class=\"line\">[profiles]</span><br><span class=\"line\">  [[default]]</span><br><span class=\"line\">    allow_bold = False</span><br><span class=\"line\">    background_color = <span class=\"string\">\"#fbfbfb\"</span></span><br><span class=\"line\">    background_darkness = 0.93</span><br><span class=\"line\">    background_type = transparent</span><br><span class=\"line\">    copy_on_selection = True</span><br><span class=\"line\">    cursor_color = <span class=\"string\">\"#aaaaaa\"</span></span><br><span class=\"line\">    cursor_shape = ibeam</span><br><span class=\"line\">    font = Ubuntu Light 12</span><br><span class=\"line\">    foreground_color = <span class=\"string\">\"#49494a\"</span></span><br><span class=\"line\">    palette = <span class=\"string\">\"#2e3436:#ee6a6a:#38690a:#b3adb0:#3465a4:#75507b:#06989a:#d3d7cf:#979b93:#fe5f5f:#7fd42c:#b7afb1:#729fcf:#ad7fa8:#34e2e2:#eeeeec\"</span></span><br><span class=\"line\">    scroll_on_keystroke = False</span><br><span class=\"line\">    scrollbar_position = hidden</span><br><span class=\"line\">    show_titlebar = False</span><br></pre></td></tr></table></figure>\n<h4>禁用内核更新</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看已安装内核</span></span><br><span class=\"line\">$: dpkg --get-selections |grep linux-image</span><br><span class=\"line\"><span class=\"comment\"># 查看正在使用的内核</span></span><br><span class=\"line\">$: uname -a</span><br><span class=\"line\"><span class=\"comment\"># 删除旧内核</span></span><br><span class=\"line\">$: sudo apt-get remove</span><br><span class=\"line\">$: linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-get remove  </span><br><span class=\"line\">$: linux-image-extra-x.xx.x-xx-generic  </span><br><span class=\"line\"><span class=\"comment\"># 或用这个命令移除</span></span><br><span class=\"line\">$: sudo dpkg --purge linux-image-x.x.x-xx-generic</span><br><span class=\"line\"><span class=\"comment\"># 禁止更新内核，需时间来验证</span></span><br><span class=\"line\">$: sudo apt-mark hold linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-mark hold linux-image-extra-x.xx.x-xx-generic</span><br><span class=\"line\"><span class=\"comment\"># 如果需要恢复原来的设定的话即允许更新内核，执行如下命令即可：</span></span><br><span class=\"line\">$: sudo apt-mark unhold linux-image-x.xx.x-xx-generic</span><br><span class=\"line\">$: sudo apt-mark unhold linux-image-extra-x.xx.x-xx-generic</span><br></pre></td></tr></table></figure>\n<h4>终端常用等宽字体</h4>\n<hr>\n<ul>\n<li>AR PL UKai CN 12</li>\n<li>Bitstream Vera Sans Mono 10</li>\n<li>Courier 10 Pitch 11</li>\n<li>DejaVu Sans Mono 10</li>\n<li>FreeMono 11</li>\n<li>Nimbus Mono L 12</li>\n<li>TlwgMono 11</li>\n</ul>\n<h4>crossover18破解</h4>\n<hr>\n<p>下载 <a href=\"https://pan.baidu.com/s/1BnT-cAKf-SBp-6J4CQoo-g\" target=\"_blank\" rel=\"noopener\">CrossoverPatch</a> <code>密码: ffp0</code>，解压后替换文件：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  备份原文件</span></span><br><span class=\"line\">$: cp ~/cxoffice/lib/wine/winewrapper.exe.so ~/cxoffice/lib/wine/winewrapper.exe.so-bak</span><br><span class=\"line\"><span class=\"comment\"># 替换文件</span></span><br><span class=\"line\">$: cp CrossoverPatch/winewrapper.exe.so ~/cxoffice/lib/wine</span><br></pre></td></tr></table></figure>\n<h4>vim插件配置</h4>\n<hr>\n<ol>\n<li><a href=\"https://github.com/VundleVim/Vundle.vim\" target=\"_blank\" rel=\"noopener\">Vundle</a> =&gt; 插件管理器，编辑.vimrc，然后执行命令<code>vim +PluginInstall</code>即可安装</li>\n<li><a href=\"https://github.com/vim-airline/vim-airline\" target=\"_blank\" rel=\"noopener\">vim-airline</a> =&gt; 底部状态栏</li>\n<li><a href=\"https://juejin.im/post/5a38c37f6fb9a0450909a151\" target=\"_blank\" rel=\"noopener\">其他配置</a></li>\n</ol>\n<h4>Ubuntu18.04 定制Mac主题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-5.png\" alt=\"overview.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-6.png\" alt=\"desktop.png\"></p>\n<ol>\n<li>安装gnome-tweak-tool 和 chrome-gnome-shell 插件 (<code>sudo aptitude install [name]</code>)</li>\n<li>安装GTK3主题 =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">X-Arc-Collection</a></li>\n<li>使用tweak载入应用程序主题 =&gt; tweak – 外观 – 应用程序 – 选择X-Arc-Collection</li>\n<li>安装gnome-shell 主题 =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>安装gnome-shell 插件 =&gt; <a href=\"https://extensions.gnome.org/extension/19/user-themes/\" target=\"_blank\" rel=\"noopener\">User Themes</a> ( 之后重启Gnome =&gt; [Alt + F2] &amp; [输入 r] &amp; [点击 Enter] )</li>\n<li>使用tweak载入shell主题 =&gt; tweak – 外观 – shell – 选择Sierra shell主题</li>\n<li>下载Mac图标主题 <a href=\"https://github.com/keeferrourke/la-capitaine-icon-theme/releases\" target=\"_blank\" rel=\"noopener\">la-capitaine-icon-theme</a> 或 <a href=\"https://www.pling.com/p/1305429/\" target=\"_blank\" rel=\"noopener\">McMojave-circle</a></li>\n<li>图标文件夹移动到 ~/.icons目录下(没有则新建目录)</li>\n<li>使用tweak载入icon主题 =&gt; tweak – 外观 – 图标 – 选择对应的图标主题</li>\n<li>安装gnome-shell插件 =&gt; Dash to dock (将原生dock转变为可定制的浮动dock)</li>\n<li>定制firefox主题 =&gt; <a href=\"https://github.com/vinceliuice/Mojave-gtk-theme\" target=\"_blank\" rel=\"noopener\">Majave-gtk-theme</a></li>\n</ol>\n<h4>Ubuntu18.04 自己定制 登录、锁屏界面的图片和样式</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-7.png\" alt=\"lockscreen.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-8.png\" alt=\"loginscreen.png\"></p>\n<ol>\n<li>安装脚本 =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/login-manager-config-ubuntu\" target=\"_blank\" rel=\"noopener\">github / nojsja / login-manager-config-ubuntu</a></li>\n<li>说明=&gt; 脚本通过更改/usr/share/gnome-shell/theme/ubuntu.css文件中声明的样式来修改系统登录页面按钮布局和背景图片的地址，使用ImageMagick包的<code>convert -blur</code>命令制作了毛玻璃效果的登录背景图片，最后还生成了一个SetAsWallpaper脚本，可以在文件夹中的图片文件上右键点击选择运行这个脚本(它会自动把目标图片更改成桌面壁纸和毛玻璃效果化的登录背景图)，最后锁屏壁纸需要用户手动安装<code>gnome-tweak-tool</code>进行更改。</li>\n<li>之前我想通过更改<code>/usr/share/gnome-shell/theme/gdm3.css</code>文件来修改样式，可是发现ubuntu18.04下总会有这样那样的问题。</li>\n<li>注意=&gt; 不要贸然尝试更改系统主题的CSS样式文件，如果修改的文件有语法错误或是其它原因，很可能会造成系统开机后无法登入图形界面(出现这种情况可以插入U盘登录PE系统然后挂载原系统的硬盘，最后将错误文件改回即可)。</li>\n</ol>\n<h4>Ubuntu18.04 关于定制plymouth主题来更换开机动画</h4>\n<hr>\n<blockquote>\n<p>其实我不建议去改开机动画，一个原因是ubuntu自己的开机动画就挺美观简洁的，第二个原因是这个东西如果改出问题了卡在开机画面到时候恢复起来比较麻烦，如果执意想去折腾的话，可以去<a href=\"https://www.gnome-look.org/browse/cat/108/\" target=\"_blank\" rel=\"noopener\">gnome-look</a>看看，这里提供一个苹果主题<a href=\"https://pan.baidu.com/s/1qv3GZ_BE-jj2HIpiI2X7yQ\" target=\"_blank\" rel=\"noopener\">darwin</a>，密码: <code>rc6u</code>。</p>\n</blockquote>\n<ol>\n<li>\n<p>解压下载的plymouth主题到 <code>/usr/share/plymouth/themes</code></p>\n</li>\n<li>\n<p>执行安装</p>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-alternatives --install /usr/share/plymouth/themes/ default.plymouth default.plymouth /usr/share/plymouth/themes/[THEME]/[THEME].plymouth 100</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>更新配置，需要手动选择plymouth编号</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-alternatives --config default.plymouth</span><br><span class=\"line\">$: sudo update-initramfs -u</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>手动更改错误路径参数</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /usr/share/plymouth/themes/default.plymouth</span><br></pre></td></tr></table></figure>\n<p>替换<code>ImageDir</code>和<code>ScriptFile</code>为正确的plymouth文件存放路径，替换后：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ImageDir=/usr/share/plymouth/themes/[THEME]</span><br><span class=\"line\">ScriptFile=/usr/share/plymouth/themes/[THEME]/[THEME].script</span><br></pre></td></tr></table></figure>\n<h4>Ubuntu18.04 使用[Dash to dock]插件时同时出现两个dock的问题</h4>\n<hr>\n<blockquote>\n<p>解决方法是去tweak设置里关闭[Dash to dock]的开关，别担心，关闭后，[Dash to dock]仍然正常工作，但是再也不会同时出现两个dock栏的尴尬情况了。</p>\n</blockquote>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-9.png\" alt=\"dock-noise.png\"></p>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-10.png\" alt=\"dock-single.png\"></p>\n<h4>Ubuntu18.04 添加软件源提示：没有Release文件，忽略源的问题</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-11.png\" alt=\"dock-tweak.png\"></p>\n<ol>\n<li>打开 软件与更新</li>\n<li>选择那个源点击编辑</li>\n<li>更改 发行版 信息 (请在网页上查看这个源的仓库文件内的dists目录下有哪些发行版)</li>\n</ol>\n<h4>Ubuntu18.04 解决一些软件依赖不满足问题的问题</h4>\n<hr>\n<p>=&gt; 以Ubuntu18.04安装16.04版本网易云音乐为例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># gdebi安装包</span><br><span class=\"line\">$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb</span><br><span class=\"line\">$: Dependency is not satisfiable: libqt5libqgtk2</span><br><span class=\"line\"># Ubuntu18.04报出依赖问题，原因是libqt5libqgtk2已经被新的库qt5-style-plugins替代，</span><br><span class=\"line\"># 软件源里找不到这个库，当然我们也能手动安装libqt5libqgtk2，但是很可能会就此引出新的依赖问题</span><br></pre></td></tr></table></figure>\n<p>=&gt; 方法：解压安装包修改依赖项并重新打包<br>\n=&gt; 步骤：</p>\n<ol>\n<li>deb包同级目录下创建文件夹</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: mkdir netease-cloud-music</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>解压安装包到这个文件夹中</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg -X netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb netease-cloud-music</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>解压控制信息</li>\n</ol>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg -e netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb neteas-cloud-music/DEBIAN/</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>修改依赖文件(把libqt5libqgtk2修改为qt5-style-plugins)</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim编辑文件</span><br><span class=\"line\">$: vim neteas-cloud-music/DEBIAN/control</span><br><span class=\"line\"># 使用vim正则对libqt5libqgtk2进行搜索替换</span><br><span class=\"line\">:1,$s/libqt5libqgtk2/qt5-style-plugins/g</span><br><span class=\"line\"># 或是手动查找Depends那一行中声明的libqt5libqgtk2进行替换替换即可</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>生成新的安装包</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: dpkg-deb -b neteas-cloud-music</span><br><span class=\"line\">$: mv neteas-cloud-music.deb netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>安装</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用gdebi或dpkg进行安装即可</span><br><span class=\"line\">$: sudo gdebi netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br><span class=\"line\">$: sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu18.04.deb</span><br></pre></td></tr></table></figure>\n<h4>Linux分区过小导致后期容量不足解决方法</h4>\n<p>=&gt; 之前安装ubuntu 18.04的时候/var 分区只给了 1.5G，结果现在不够用了</p>\n<ul>\n<li>方法1</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get clean</span><br><span class=\"line\">$: sudo apt-get autoremove</span><br></pre></td></tr></table></figure>\n<p>如果仍然空间不足，使用方法2。</p>\n<ul>\n<li>方法2<br>\n建立目录软链接解决(软链接和硬链接了解一下)：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以/var目录为例 将占用过大的文件夹移出</span></span><br><span class=\"line\">$: mv /var/lib /opt</span><br><span class=\"line\"><span class=\"comment\"># 建立opt下的lib内目录的软链接到var目录</span></span><br><span class=\"line\">$: sudo ln -s /opt/lib /var</span><br></pre></td></tr></table></figure>\n<ul>\n<li>方法3<br>\n如果/var没有单独分区，则系统默认共享使用/home目录，若此时提示/var空间不足，则说明/home空间不足，这种情况，建议重新安装系统，重新规划分区结构。一般来说，/var目录2G-4G为好，或者不分区，共享/home。</li>\n</ul>\n<h4>Shadowsocks-Qt5安装的问题</h4>\n<hr>\n<blockquote>\n<p>shadowsocks的GUI版本，用Qt写的，还行，不过我喜欢用sslocal命令脚本来连接服务器，开机自启动，很方便。顺带写个安装流程，不过会遇到我上面提到的 <strong>软件源提示没有Release文件的问题</strong>，可以通过上面的方法解决，这里需要将shadowdocks-Qt5发行版信息更改为<code>artful</code>，改为其它发行版可能会遇到依赖问题，遇到依赖问题多尝试几个，还有两行配置文件都要改额。</p>\n</blockquote>\n<p>&gt; sudo add-apt-repository ppa:hzwhuang/ss-qt5<br>\n&gt; sudo apt update<br>\n&gt; sudo apt-get install shadowsocks-qt5</p>\n<h4>使用polipo开启终端代理(需要先开启shadowsocks代理)</h4>\n<hr>\n<ul>\n<li>安装脚本(适合于bash和zsh终端) =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks-terminal\" target=\"_blank\" rel=\"noopener\">github / nojsja / polipo-install-config.sh&quot;</a></li>\n<li>使用方式<br>\n&gt; 说明：’ hp ’ == ’ http_proxy=http://localhost:8123 ’ for any command<br>\n&gt; 说明：’ gp ’ == ‘http.proxy=localhost:8123’ for git proxy config<br>\n&gt; 使用1：<code>hp curl ip.gs</code><br>\n&gt; 使用2：<code>git clone https://android.googlesource.com/tools/repo --config $gp</code></li>\n<li>如果polipo启动报错的话(通过<code>systemctl status polipo</code>查看)，可能是你的垃圾清理软件删除了polipo的日志文件夹，你可以手动更改polipo配置文件(<code>/etc/polipo/config</code>)禁用日至记录功能</li>\n</ul>\n<h4>将linux绿色解压版软件包或自定义脚本显示到应用菜单图标列表</h4>\n<hr>\n<blockquote>\n<p>很多软件只有解压版，虽然可以解压后发送快捷方式到桌面，但是没有图标，应用列表也看不了。</p>\n</blockquote>\n<p>=&gt; 安装脚本(测试环境ubuntu18.04) =&gt; <a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/application\" target=\"_blank\" rel=\"noopener\">github / nojsja / makeIconLink</a><br>\n=&gt; 使用方式</p>\n<ul>\n<li>安装之前：请先将需要作为图标的icon图片(比例1:1比较适合，分辨率最好大于64px % 64px)放入目标文件夹内</li>\n<li>查看说明：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装指令：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --dir /path/to/[<span class=\"built_in\">exec</span>-file] --target [<span class=\"built_in\">exec</span>-file-name] --icon [icon-file-name]</span><br></pre></td></tr></table></figure>\n<ul>\n<li>卸载指令：</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: bash makeIconLink --uninstall [<span class=\"built_in\">exec</span>-file-name]</span><br></pre></td></tr></table></figure>\n<h4>自定义shadowsocks服务开机自启动脚本</h4>\n<hr>\n<blockquote>\n<p>使用systemd来管理shadowsocks服务，开机自启动，不用打开shadowsocks-qt5软件，FQ了无痕 ~</p>\n</blockquote>\n<p>=&gt; 我的服务脚本：<a href=\"https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/startup.sh\" target=\"_blank\" rel=\"noopener\">startup.sh</a>、<a href=\"https://github.com/NoJsJa/maintenance/blob/master/code/shell/desktop/shadowsocks\" target=\"_blank\" rel=\"noopener\">shadowsocks</a><br>\n=&gt; 步骤：</p>\n<ul>\n<li>编写shadowsocks service脚本文件，比如shadow.service</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\"><span class=\"comment\"># 描述</span></span><br><span class=\"line\">Description=Shadowsocks Service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=oneshot</span><br><span class=\"line\"><span class=\"comment\"># 服务 start/stop 执行脚本(具体执行路径根据自己的目录更改)</span></span><br><span class=\"line\">ExecStart=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh start</span><br><span class=\"line\">ExecStop=/bin/bash /home/nojsja/github/maintenance/code/shell/desktop/startup.sh stop</span><br><span class=\"line\">RemainAfterExit=yes</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\"><span class=\"comment\"># 一些简单的依赖信息</span></span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<ul>\n<li>将服务配置文件放到<code>/etc/systemd/system</code>下<br>\n&gt; sudo cp shadow.service /etc/systemd/system</li>\n<li>设置服务自启动<br>\n&gt; systemctl enable shadow</li>\n<li>服务开启和关闭<br>\n&gt; systemctl start shadow<br>\n&gt; systemctl stop shadow</li>\n</ul>\n<h4>Ubuntu18.04设置shadowsocks全局pac自动代理对浏览器无效</h4>\n<hr>\n<p>=&gt; 先来一个shadowsocks全局pac代理的步骤：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pip需要先安装</span></span><br><span class=\"line\">$: sudo apt-get install python-pip python-dev build-essential</span><br><span class=\"line\">$: sudo pip install --upgrade pip</span><br><span class=\"line\">$: sudo pip install --upgrade virtualenv</span><br><span class=\"line\"><span class=\"comment\"># 安装pac自动生成程序</span></span><br><span class=\"line\">$: sudo pip install genpac</span><br><span class=\"line\"><span class=\"comment\"># 生成pac文件</span></span><br><span class=\"line\">$: mkdir ~/shadowsocks</span><br><span class=\"line\">$: <span class=\"built_in\">cd</span> shadowsocks</span><br><span class=\"line\"><span class=\"comment\"># proxy配置中的地址和端口具体要看你的shadowsocks连接配置</span></span><br><span class=\"line\">$: genpac --proxy=<span class=\"string\">\"SOCKS5 127.0.0.1:1080\"</span> --gfwlist-proxy=<span class=\"string\">\"SOCKS5 127.0.0.1:1080\"</span> -o autoproxy.pac --gfwlist-url=<span class=\"string\">\"https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt\"</span></span><br></pre></td></tr></table></figure>\n<p>以上操作会在~/shadowsocks目录下生成autoproxy.pac配置文件，到系统设置 -&gt; 网络 -&gt; 网络代理 -&gt; 自动 -&gt; 填入file:///path/to/autoproxy.pac(上面我们生成的pac文件路径)，如果要新增被代理网站的话就自己编辑pac文件，在里面的域名列表里面再添加新的域名就好了。<br>\n=&gt; 再写一个脚本<a href=\"https://github.com/NoJsJa/maintenance/tree/master/code/shell/desktop/shadowsocks/genpac\" target=\"_blank\" rel=\"noopener\">genpac-command</a>，可以用来添加用户过滤规则(user-rules.txt) 和在线更新autoproxy.pac代理文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># # 在脚本目录下执行</span></span><br><span class=\"line\"><span class=\"comment\"># 显示帮助信息</span></span><br><span class=\"line\">$: bash genpac-command --<span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"comment\"># 在线更新</span></span><br><span class=\"line\">$: bash genpac-command --update-online</span><br><span class=\"line\"><span class=\"comment\"># 从本地user-rules.txt文件读取更新</span></span><br><span class=\"line\">$: bash genpac-command --update-local</span><br><span class=\"line\"><span class=\"comment\"># 添加自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --add-rules opendesktop.org</span><br><span class=\"line\"><span class=\"comment\"># 添加多个自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --add-rules opendesktop.org atom.io</span><br><span class=\"line\"><span class=\"comment\"># 删除自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --del-rules opendesktop.org</span><br><span class=\"line\"><span class=\"comment\"># 删除多个自定义规则</span></span><br><span class=\"line\">$: bash genpac-command --del-rules opendesktop.org atom.io</span><br></pre></td></tr></table></figure>\n<p>=&gt; <strong>不过我遇到了代理pac文件配置好后，firefox和google浏览器仍然不能FQ的情况，仔细排查原因，我发现因为之前我不是用的pac全局代理，是通过浏览器的SwitchOmega插件来手动代理的，这个插件会接管浏览器的网络代理权限，我们需要到浏览器设置里面把网络代理设置为系统代理，以火狐浏览器为例：</strong></p>\n<h4>Atom编辑器内存占用过大的问题</h4>\n<hr>\n<blockquote>\n<p>Atom、Vscode、Sublime、Bracks都用过，Atom用着最爽，可定制化程度最高。但是有时候用着Atom电脑呼呼作响，查看系统占用，Atom内存占用达到过4、5个G，我的天！其实Atom出现内存泄漏的问题都不是Atom本身的问题，一定是你安装的哪个插件导致了内存泄漏，查看占用信息后定位到atom的插件，然后把它禁用就可以了，比如之前导致我出现这个问题的插件就是：ide-typescript，禁用之后现在基本一个Atom进程只占用200~400Mb左右，取决于你安装的其它插件。还有Atom要经常手动更新啊，仓库里面更新不了的，直接去Atom git仓库下载release正式版本，基本上一个大版本就要更新一次。</p>\n</blockquote>\n<h4>Grub2 主题安装</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-12.png\" alt=\"source.png\"></p>\n<blockquote>\n<p>Grub2就是引导操作系统启动的东西，开机的时候如果是多系统，就会显示多系统的启动菜单，如图，这个启动菜单可以自定义主题。</p>\n</blockquote>\n<ol>\n<li>解压下载的主题文件 =&gt; <a href=\"https://pan.baidu.com/s/1ioMub2JmHlIzHJbS2_2gRQ\" target=\"_blank\" rel=\"noopener\">Vimix</a>，得到Vimix文件夹(这里提供我用的一个主题，也可以自已去下载其它主题)</li>\n<li>在/boot/grub里创建GRUB2主题目录themes<br>\n&gt; sudo mkdir -p /boot/grub/themes</li>\n<li>将下载的Vimix文件夹整体复制到/boot/grub/themes文件夹下<br>\n&gt; sudo cp -r Vimix /boot/grub/themes</li>\n<li>修改/etc/default/grub配置文件<br>\n&gt; sudo gedit /etc/default/grub<br>\n在文件最后添加：GRUB_THEME=&quot;/boot/grub/themes/Vimix/theme.txt&quot; 并保存</li>\n<li>更新GRUB<br>\n&gt; sudo update-grub</li>\n<li>重启即生效(如果重启卡住请强制关机后再启动)</li>\n</ol>\n<h4>Ubuntu18.04 解决下载额外数据文件失败：ttf-mscorefonts-installer</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-13.png\" alt=\"firefox_proxy.png\"></p>\n<ol>\n<li><a href=\"http://sourceforge.net/projects/corefonts/files/the%20fonts/final/\" target=\"_blank\" rel=\"noopener\">sourceforge</a>下载如图所示11个exe文件并放入一个文件夹，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer</li>\n<li>运行字体配置程序<br>\n&gt; sudo dpkg-reconfigure ttf-mscorefonts-installer</li>\n<li>在配置窗口中输入刚才保存exe的路径确定即可，比如： /home/nojsja/Downloads/ttf-mscorefonts-installer</li>\n</ol>\n<h4>Ubuntu18.04 WPS 提示字体缺失的解决方法</h4>\n<hr>\n<p>下载缺失的字体文件<a href=\"https://pan.baidu.com/s/10MushHhTXwfRIFkKGmwD7Q\" target=\"_blank\" rel=\"noopener\">fonts</a> (密码: 4jpo)，然后复制到Linux系统中的/usr/share/fonts文件夹中，再使用系统命令更新字体设置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成字体的索引信息</span></span><br><span class=\"line\">$: sudo mkfontscale</span><br><span class=\"line\">$: sudo mkfontdir</span><br><span class=\"line\"><span class=\"comment\"># 更新字体缓存</span></span><br><span class=\"line\">$: sudo <span class=\"built_in\">fc</span>-cache</span><br></pre></td></tr></table></figure>\n<h4>Ubuntu18.04 更新Gnome版本</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Upgrade</span></span><br><span class=\"line\"><span class=\"comment\">#If you were using the gnome3-team/gnome3-staging PPA, run the following before upgrading:</span></span><br><span class=\"line\">$: sudo ppa-purge ppa:gnome3-team/gnome3-staging</span><br><span class=\"line\">$: sudo ppa-purge ppa:gnome3-team/gnome3</span><br><span class=\"line\">$: sudo apt install ubuntu-gnome-desktop^</span><br><span class=\"line\"><span class=\"comment\"># The included GUI update manager will offer you the latest release of Ubuntu GNOME. Access this via the terminal:</span></span><br><span class=\"line\">$: update-manager -c</span><br><span class=\"line\"><span class=\"comment\"># Alternatively, run the following command:</span></span><br><span class=\"line\">$: sudo <span class=\"keyword\">do</span>-release-upgrade</span><br></pre></td></tr></table></figure>\n<h4>Win10 + Ubuntu18.04 双系统时间显示不对</h4>\n<hr>\n<blockquote>\n<p>Ubuntu和Windows默认的时间管理方式不同，所以双系统发生时间错乱是正常的。Ubuntu默认时间是把BIOS时间当成GMT+0时间，也就是世界标准时，而我国在东八区(GMT+8)，所以如果你的Ubuntu位置是中国的话你系统显示的时间就是BIOS时间+8小时。假如现在是早上8点，那么你Ubuntu会显示8点，这时BIOS中的时间是0点。而当你切换到Windows系统时就会发生时间错乱，因为Windows会认为BIOS时间就是你的本地时间，结果就是Windows显示时间为0点……而假如你在Windows下同步时间，恢复显示为8点，这时BIOS时间也会被Windows改写成8点，再次进入Ubuntu时显示时间又变成了8+8=16点。</p>\n</blockquote>\n<ol>\n<li>先在Ubuntu下更新一下时间<br>\n&gt; sudo apt-get install ntpdate<br>\n&gt; sudo ntpdate <a href=\"http://time.windows.com\" target=\"_blank\" rel=\"noopener\">time.windows.com</a></li>\n<li>将时间更新到硬件上<br>\n&gt; sudo hwclock --localtime --systohc</li>\n<li>关闭linux重新进入windows系统，发现时间正常了</li>\n</ol>\n<h4>Ubuntu18.04 安装系统时说明(双硬盘)</h4>\n<hr>\n<blockquote>\n<p>主要分为 [ <em>GPT磁盘分区+UEFI引导方案</em> ] 和 [ <em>传统MBR磁盘分区 + LEGANCY引导方案</em> ]</p>\n</blockquote>\n<ol>\n<li>方案一(兼容方案 gpt+uefi / mbr+legancy)<br>\n使用UEFI模式安装Ubuntu18.04时可以选择用 兼容bios启动方式 来安装系统(同时兼容传统启动方式和UEFI启动方式)，即不分配&quot;/boot “分区，分配一个大小为1GB左右的&quot;保留bios启动区域”(UEFI模式会自动挂载/boot和/boot/efi)，其它分区至少还需要一个根分区&quot;/&quot;，8G内存的情况下最好还是分配8G的swap交换分区，另外除了&quot;保留bios启动区域&quot;为主分区，其它分区均为逻辑分区，最后一步很重要 – 格式化每个分区，要不然安装很可能会出错！<a href=\"https://blog.csdn.net/jesse_mx/article/details/61425361\" target=\"_blank\" rel=\"noopener\">参考</a></li>\n<li>方案二(gpt+uefi 已使用方案)<br>\n创建&quot;efi系统分区&quot;，同时不需要划分&quot;/boot&quot;分区(boot引导是grub由引导的，而efi显然是UEFI引导的)，其余至少还需要划分&quot;/“根分区，除了根分区所有分区都为逻辑分区，最后选择&quot;安装启动引导器的设备&quot;为刚才创建的&quot;efit系统分区”。</li>\n<li>方案三(传统mbr+legancy方案)<br>\n传统的legancy + mbr的安装，至少划分&quot;/boot&quot;分区(主分区) 和 &quot;/“根分区，其余的分区按需划分，最后选择&quot;安装启动引导器的设备&quot;为创建的”/boot&quot;挂载点。</li>\n</ol>\n<h4>Ubuntu 18.04 使用lvm逻辑卷管理方式安装后启动很慢的问题</h4>\n<p><a href=\"https://askubuntu.com/questions/1030867/how-to-diagnose-fix-very-slow-boot-on-ubuntu-18-04\" target=\"_blank\" rel=\"noopener\">=&gt; 原帖子</a></p>\n<ol>\n<li>编辑文件 <code>/etc/default/grub</code> 的 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 这一行，加入一个参数__noresume__</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRUB_CMDLINE_LINUX_DEFAULT=<span class=\"string\">\"quiet splash noresume\"</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>更新grub</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>重启电脑</li>\n</ol>\n<h4>Ubuntu18.04 安装网易云音乐1.1.0后不能打开的解决方法</h4>\n<hr>\n<ul>\n<li>使用root权限命令行后台启动并且屏蔽输出<br>\n&gt; sudo netease-cloud-music &gt; /dev/null 2&gt;&amp;1  &amp;</li>\n<li>规避session-manager引起的bug<br>\n&gt; alias netease=‘unset SESSION_MANAGER &amp;&amp; netease-cloud-music’<br>\n&gt; netease &gt; /dev/null &amp;</li>\n<li>别用那个鸡肋的客户端了，有bug也不更新，上这个酷酷的第三方客户端<a href=\"https://github.com/trazyn/ieaseMusic\" target=\"_blank\" rel=\"noopener\">ieaseMusic</a></li>\n<li>这里还有个别人做的针对ubuntu18.04的<a href=\"https://github.com/innoob/netease-cloud-music\" target=\"_blank\" rel=\"noopener\">重新构建版本</a>，可以正常使用，也没有重复登录的bug</li>\n</ul>\n<h4>Ubuntu18.04 Crossover17安装QQ后乱码的解决方法</h4>\n<hr>\n<blockquote>\n<p>原因：原来的ume-ui-gothic.ttf不支持很多简体中文字符</p>\n</blockquote>\n<p>使用其它字体文件替换到目录 /opt/cxoffice/share/wine/fonts 下的<a href=\"https://pan.baidu.com/s/13CDBKrvTAJOhrbuyLw96jA\" target=\"_blank\" rel=\"noopener\">ume-ui-gothic.ttf</a>字体文件 (同名)，记得将下好的文件重命名为ume-ui-gothic.ttf。</p>\n<h4>Ubuntu18.04 通过tweak安装gnome插件Blyr后设置插件报错</h4>\n<hr>\n<p>=&gt; 错误信息：<code>Error: Requiring Clutter, version none: Typelib file for namespace 'Clutter' (any version) not found ...</code><br>\n=&gt; 原因分析：该插件需要的依赖Clutter尚未安装<br>\n=&gt; 解决方法：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">$: sudo apt-get install gir1.2-clutter-1.0 gir1.2-clutter-gst-3.0 gir1.2-gtkclutter-1.0</span><br></pre></td></tr></table></figure>\n<h4>Ubuntu18.04 Gnome-Shell 插件</h4>\n<hr>\n<ul>\n<li><a href=\"https://extensions.gnome.org/extension/97/coverflow-alt-tab/\" target=\"_blank\" rel=\"noopener\">CoverFlow Alt-Tab</a> =&gt; 窗口Tab切换预览(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/19/user-themes/\" target=\"_blank\" rel=\"noopener\">User Themes(必要)</a> =&gt; 用户主题安装(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/307/dash-to-dock/\" target=\"_blank\" rel=\"noopener\">Dash To Dock</a> =&gt; dock栏(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1160/dash-to-panel/\" target=\"_blank\" rel=\"noopener\">Dash To Panel</a> =&gt; 将dock和顶栏显示在一起(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1236/noannoyance/\" target=\"_blank\" rel=\"noopener\">NoAnnoyance</a> =&gt; 禁用多余的pop提示信息，直接提升活动窗口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/595/autohide-battery/\" target=\"_blank\" rel=\"noopener\">Autohide Battery</a> =&gt; 电池充满并连接电源时自动隐藏电池按钮(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/8/places-status-indicator/\" target=\"_blank\" rel=\"noopener\">Places Status Indicator</a> =&gt; 顶部任务栏显示磁盘和卷的快捷入口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/7/removable-drive-menu/\" target=\"_blank\" rel=\"noopener\">Removable Drive Menu</a> =&gt; 顶部任务栏显示可移除的已挂载设备(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/826/suspend-button/\" target=\"_blank\" rel=\"noopener\">Suspend Button</a> =&gt; 顶部菜单栏显示休眠按钮(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/495/topicons/\" target=\"_blank\" rel=\"noopener\">TopIcons</a> =&gt; 顶部通知图标托盘(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1031/topicons/\" target=\"_blank\" rel=\"noopener\">TopIconsPlus</a> =&gt; 顶部通知图标托盘，自定义图标显示参数(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1251/blyr/\" target=\"_blank\" rel=\"noopener\">Blyr</a> =&gt; 模糊应用预览背景图(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/358/activities-configurator/\" target=\"_blank\" rel=\"noopener\">Activities Configurator</a> =&gt; 配置左上角活动按钮(★★★★☆)</li>\n<li><a href=\"https://extensions.gnome.org/extension/427/workspaces-to-dock/\" target=\"_blank\" rel=\"noopener\">Workspace to Dock</a> =&gt; 将工作区转换为悬浮dock(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1036/extensions/\" target=\"_blank\" rel=\"noopener\">Extensions</a> =&gt; 在通知栏添加快捷开启和关闭gnome-shell插件的功能(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/779/clipboard-indicator/\" target=\"_blank\" rel=\"noopener\">Clipboard Indicator</a> =&gt; 可视化剪贴板(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/906/sound-output-device-chooser/\" target=\"_blank\" rel=\"noopener\">Sound Input &amp; Output Device Chooser</a> =&gt; 声音输入和输入设备快速选择(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1236/noannoyance/\" target=\"_blank\" rel=\"noopener\">NoAnnoyance</a> =&gt; 取消“窗口已就绪”提示直接提升窗口(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/\" target=\"_blank\" rel=\"noopener\">Bluetooth quick connect</a> =&gt; 蓝牙设备快速连接和断开(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1403/remove-alttab-delay/\" target=\"_blank\" rel=\"noopener\">Remove Alt+Tab Delay</a> =&gt; 移除【Alt + Tab】的开启应用预览延迟(★★★★★)</li>\n<li><a href=\"https://extensions.gnome.org/extension/1162/emoji-selector/\" target=\"_blank\" rel=\"noopener\">Emoji Selector</a> =&gt; 快速选择Emoji表情(★★★★)</li>\n</ul>\n<h4>Ubuntu18.04 插件 [ Dash to dock ] 一些常用设置</h4>\n<hr>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Use Custom Dock Indicator ( Optional )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-running-dots <span class=\"literal\">false</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-customize-running-dots <span class=\"literal\">false</span></span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Disable Custom Dock Shrink ( Required for Good looking) (  Required )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock custom-theme-shrink <span class=\"literal\">false</span></span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Dock Transparency mode ( Optional )</span></span><br><span class=\"line\">$: gsettings <span class=\"built_in\">set</span> org.gnome.shell.extensions.dash-to-dock transparency-mode DEFAULT</span><br><span class=\"line\">_______________________________________________________________________________________________</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Restore to Default</span></span><br><span class=\"line\">$: dconf reset -f /org/gnome/shell/extensions/dash-to-dock/</span><br><span class=\"line\">_______________________________________________________________________________________________</span><br></pre></td></tr></table></figure>\n<h4>Ubuntu18.04 主题</h4>\n<hr>\n<ul>\n<li>GTK3主题(★★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1167049/\" target=\"_blank\" rel=\"noopener\">X-Arc-Collection</a></li>\n<li>GTK3主题(★★★★★) =&gt; <a href=\"https://www.gnome-look.org/p/1241688\" target=\"_blank\" rel=\"noopener\">McOS-themes</a></li>\n<li>Gnome Shell主题(★★★★) =&gt; <a href=\"https://github.com/daniruiz/flat-remix\" target=\"_blank\" rel=\"noopener\">Flat-Remix</a></li>\n<li>Gnome Shell主题(★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1171095/\" target=\"_blank\" rel=\"noopener\">Human</a></li>\n<li>Gnome Shell主题(★★★★★) =&gt; <a href=\"https://www.opendesktop.org/c/1460761561\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>Gnome Shell主题(?) =&gt; <a href=\"https://www.gnome-look.org/p/1213208/\" target=\"_blank\" rel=\"noopener\">macOS High Sierra</a></li>\n<li>Icon 主题(★★★★) =&gt; <a href=\"https://github.com/daniruiz/flat-remix/releases\" target=\"_blank\" rel=\"noopener\">flat-remix</a></li>\n<li>Icon 主题(★★★★☆) =&gt; <a href=\"https://www.gnome-look.org/p/1012200/\" target=\"_blank\" rel=\"noopener\">Mac OS X Icon</a></li>\n<li>Icon 主题(★★★★★) =&gt; <a href=\"https://github.com/keeferrourke/la-capitaine-icon-theme/releases\" target=\"_blank\" rel=\"noopener\">la-capitaine-icon-theme</a></li>\n<li>Icon 主题(★★★★★) <a href=\"https://www.pling.com/p/1305429/\" target=\"_blank\" rel=\"noopener\">McMojave-circle</a></li>\n<li>Icon 主题(★★★★☆) =&gt; <a href=\"https://github.com/zayronxio/Macos-sierra-CT\" target=\"_blank\" rel=\"noopener\">MacOS sierra ct</a></li>\n<li>Cursor主题(★★★★☆) =&gt; <a href=\"https://krourke.org/projects/art/capitaine-cursors\" target=\"_blank\" rel=\"noopener\">Capitaine Cursors</a></li>\n</ul>\n<h4>chrome实用插件整理</h4>\n<hr>\n<ul>\n<li><a href=\"https://chrome.google.com/webstore/detail/infinity-new-tabproductiv/dbfmnekepjoapopniengjbcpnbljalfg?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">infinity pro 标签页</a> =&gt; 主页标签管理器(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/octotree/bkhaagjahfmjljalopjnoealnfndnagc?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Octotree</a> =&gt; github仓库文件资源浏览树(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/postman-interceptor/aicmkgpgakddgnaphhhpliifpcfhicfo?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Postman</a> =&gt; API测试和请求模拟器(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">SwitchyOmega</a> =&gt; 大家都用的代理软件(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">印象笔记剪藏</a> =&gt; 随时随地把网络资源保存到你的笔记本里(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/simpread-reader-view/ijllcpnolfcooahcekpamkbidhejabll?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">SimpRead</a> =&gt; 让浏览器支持纯净的阅读模式(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/full-page-screen-capture/fdpohaocaechififmbbbbbknoalclacl?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Full Page Screen Capture</a> =&gt; 全屏截图(★★★★☆)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">油猴tampermonkey</a> =&gt; 用户脚本管理器，一个用例是破解badu网盘的限速(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/checker-plus-for-gmail/oeopbcgkkoapgobdbedcemjljbihmemj?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Checker Plus for Gmail</a> =&gt; Google邮件提示插件(★★★★☆)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=InfinityNewtab\" target=\"_blank\" rel=\"noopener\">Vimium</a> =&gt; 让google浏览器支持vim模式(firefox也有)(★★★★★)</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/copy-as-markdown/dgoenpnkphkichnohepecnmpmihnabdg\" target=\"_blank\" rel=\"noopener\">拷贝为Markdown</a> =&gt; 将选中网页转化为markdown格式并发送到剪贴板(★★★★☆)</li>\n</ul>\n<h4>实用程序和命令</h4>\n<hr>\n<ul>\n<li><a href=\"https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager\" target=\"_blank\" rel=\"noopener\">fonts-firacode编程字体</a> =&gt; 解决vscode字体间隙过小的问题<code>sudo apt install fonts-firacode</code></li>\n<li><a href=\"https://vivaldi.com\" target=\"_blank\" rel=\"noopener\">vivaldi浏览器</a> =&gt; 可定制化程度高的个性化浏览器(★★★★★)</li>\n<li>Terminator =&gt; 默认gnome终端升级版(★★★★★)</li>\n<li>Timeshift =&gt; 创建系统快照，增量备份(★★★★★)</li>\n<li>ipython3(命令工具) =&gt; python交互解释器(★★★★★)</li>\n<li>jupyter =&gt; 交互式数据分析和记录工具(★★★★☆)</li>\n<li>pdb/ipdb(命令工具) =&gt; python调试器(★★★★☆)</li>\n<li>trash-cli(命令工具) =&gt; 命令行回收站(★★★★★)</li>\n<li>bat(命令工具) =&gt; cat升级版，支持语法高亮和git状态显示(★★★★★)</li>\n<li>axel(命令工具) =&gt; 下载限速不存在的，如果存在那我就开100个下载线程 : )(★★★★☆)</li>\n<li><a href=\"https://github.com/aria2/aria2\" target=\"_blank\" rel=\"noopener\">aria2(命令工具)</a> =&gt; 强大的命令行下载工具</li>\n<li><a href=\"https://github.com/oguzhaninan/Stacer\" target=\"_blank\" rel=\"noopener\">stacer</a> =&gt; linux电脑管家(★★★★★)</li>\n<li><a href=\"https://github.com/trazyn/ieaseMusic\" target=\"_blank\" rel=\"noopener\">ieaseMusic</a> =&gt; 网易云音乐第三方客户端，没有bug，不会退出后再打开就让重新登陆[注：网易云音乐官方已修复]，界面还很酷(★★★★★)</li>\n<li>parallel(命令工具) =&gt; 利用系统的多核来并行执行你的程序(★★★★☆)</li>\n<li>cheat(命令工具) =&gt; 类似man命令的功能，简洁高效(★★★★☆)</li>\n<li>topgrade(命令工具) =&gt; 一个命令更新所有软件(★★★★)</li>\n<li><a href=\"https://www.dbkoda.com/\" target=\"_blank\" rel=\"noopener\">dbKoda</a> =&gt; mongodb GUI工具(★★★★☆)</li>\n<li><a href=\"https://www.mongodb.com/products/compass\" target=\"_blank\" rel=\"noopener\">mongodb compass</a> =&gt; mongodb GUI工具(★★★★)</li>\n<li><a href=\"https://github.com/phw/peek\" target=\"_blank\" rel=\"noopener\">peek</a> =&gt; 屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件(★★★★☆)</li>\n<li>tmux =&gt; 终端管理器(★★★★)</li>\n<li>深度终端(ubuntu商店下载) =&gt; 支持分屏，内置实用主题(★★★★☆)</li>\n<li>深度截图(ubuntu商店下载) =&gt; 支持截图编辑(★★★★★)</li>\n<li><a href=\"https://webtorrent.io/desktop/\" target=\"_blank\" rel=\"noopener\">WebTorrent</a>、<a href=\"https://www.frostwire.com/\" target=\"_blank\" rel=\"noopener\">FrostWire</a> =&gt; bt下载工具，支持边下边播(★★★★)</li>\n<li><a href=\"https://www.syntevo.com/smartgit/\" target=\"_blank\" rel=\"noopener\">SmartGit</a> =&gt; linux平台免费的GIT GUI工具(★★★★★)</li>\n<li>FileZilla =&gt; ftp工具(★★★★★)</li>\n<li><a href=\"https://github.com/Suremotoo/e-tools\" target=\"_blank\" rel=\"noopener\">e-tools</a> =&gt; coder常用小工具(★★★★)</li>\n<li><a href=\"https://electronjs.org/apps/whatever\" target=\"_blank\" rel=\"noopener\">WhatEver</a> =&gt; linux第三方印象笔记客户端，基于网页版(★★★★)</li>\n<li><a href=\"http://linux.wps.cn/\" target=\"_blank\" rel=\"noopener\">wps</a> =&gt; linux office for free made by KingSoftware(★★★★★)</li>\n<li><a href=\"https://atom.io/\" target=\"_blank\" rel=\"noopener\">Atom</a> =&gt; 我一直在用的编辑器，没有固态硬盘的不推荐使用(★★★★☆)</li>\n<li><a href=\"https://code.visualstudio.com/\" target=\"_blank\" rel=\"noopener\">vscode</a> =&gt; 轻量化编辑器，没有Atom人性化，但是很快。都是JS写的，性能差距咋这么大呢 ? (★★★★★)</li>\n<li>ndb =&gt; node.js/javascript 调试器(★★★★★)</li>\n<li><a href=\"https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh\" target=\"_blank\" rel=\"noopener\">nvm</a> =&gt; nodejs版本管理器</li>\n<li>albert (添加软件源 <code>ppa:noobslab/macbuntu</code> 安装 ) =&gt; 桌面全局搜索类似Mac系统的SpotLight(★★★★★)</li>\n<li><a href=\"https://linux.cn/article-5460-1.html\" target=\"_blank\" rel=\"noopener\">lftp</a> =&gt; 一个基于命令行的文件传输软件，支持FTP，FTPS，HTTP，HTTPS，HFTP，FISH，以及SFTP等协议，也有许多高级特性比<br>\n如：多线程下载、断点续传</li>\n<li><a href=\"http://jonls.dk/redshift/\" target=\"_blank\" rel=\"noopener\">redshift-gtk</a> 护眼模式，自带的色彩太黄了</li>\n<li>apt-fast =&gt; 比apt更快的包管理器，添加<code>ppa:apt-fast/stable</code>安装(★★★★★)</li>\n<li>nautilus action configure tool =&gt; 资源管理器右键菜单自定义，添加<code>ppa:daniel-marynicz/filemanager-actions</code>安装(★★★★★)</li>\n<li>tig =&gt; 可交互的命令行git命令(★★★★★)</li>\n<li>shellcheck =&gt; shell脚本语法检查(★★★★★)</li>\n<li><a href=\"https://motrix.app/zh-CN/\" target=\"_blank\" rel=\"noopener\">Motrix</a> =&gt; 全平台下载工具，用于替代迅雷(★★★★★)</li>\n<li><a href=\"https://www.insynchq.com/\" target=\"_blank\" rel=\"noopener\">Insync</a> =&gt; 全平台同步工具，支持google云和onedrive(★★★★★)</li>\n<li><a href=\"https://github.com/teejee2008/timeshift\" target=\"_blank\" rel=\"noopener\">Timeshift</a> =&gt; 创建系统增量备份计划(★★★★★)</li>\n<li>dconf-editor =&gt; gnome桌面配置gui工具(★★★★)</li>\n</ul>\n<h4>实用网站推荐</h4>\n<hr>\n<p><img src=\"/blogs/img/article/Ubuntu18.04-14.png\" alt=\"Vimix.png\"></p>\n<ul>\n<li><a href=\"https://wallpapershome.com/\" target=\"_blank\" rel=\"noopener\">Wallpaper</a>  =&gt; 高清桌面壁纸下载，支持多种分辨率(★★★★★)</li>\n<li><a href=\"https://www.flaticon.com\" target=\"_blank\" rel=\"noopener\">flaticon</a> =&gt; 免费图标下载网站，支持svg和png两种格式</li>\n<li><a href=\"https://electronjs.org/apps\" target=\"_blank\" rel=\"noopener\">Electron Apps</a> =&gt; 有很多Electron 框架写的跨平台应用(Linux/Mac/Windows)(★★★★☆)</li>\n<li><a href=\"https://www.centos.bz/\" target=\"_blank\" rel=\"noopener\">Linux运维日志</a> =&gt; 服务搭建、Linux技术之类的(★★★★☆)</li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/\" target=\"_blank\" rel=\"noopener\">IBM Developer</a> =&gt; 技术文档类的参考(★★★★★)</li>\n<li><a href=\"https://www.lulinux.com/archives/2513#awk\" target=\"_blank\" rel=\"noopener\">Linux常用命令</a>  =&gt;  常用命令速查(★★★★☆)</li>\n<li><a href=\"https://www.kanbilibili.com/\" target=\"_blank\" rel=\"noopener\">bilibili工具网站</a> =&gt; 支持 视频/弹幕/封面 下载等骚操作(★★★★★)</li>\n<li><a href=\"https://linux.cn/\" target=\"_blank\" rel=\"noopener\">Linux中国</a> =&gt; 没事儿就上去看看别人翻译转载的文章(★★★★☆)</li>\n<li><a href=\"https://tinypng.com/\" target=\"_blank\" rel=\"noopener\">TinyPNG</a> =&gt; 免费的图片无损压缩网站(★★★★☆)</li>\n<li><a href=\"https://www.iloveimg.com/zh-cn\" target=\"_blank\" rel=\"noopener\">iLoveIMG</a> =&gt; 在线图片编辑网站(★★★★★)</li>\n<li><a href=\"https://en.savefrom.net/\" target=\"_blank\" rel=\"noopener\">savefrom</a> =&gt; 直接下载youtube视频(★★★★☆)</li>\n<li><a href=\"https://www.lulinux.com/\" target=\"_blank\" rel=\"noopener\">撸Linux</a> =&gt; 好像还蛮有趣的额(★★★★☆)</li>\n<li><a href=\"https://greasyfork.org/zh-CN/scripts\" target=\"_blank\" rel=\"noopener\">油猴脚本</a> =&gt; 你甚至可以用来破解百度云限速(★★★★★)</li>\n</ul>\n<p><em>注：以上内容部分是从网络搜集，希望解决广大Linuxer的问题所以做了部分整合.</em></p>\n"},{"title":"echarts图表-树形图开发记录","catalog":true,"toc_nav_num":true,"date":"2020-03-22T10:24:00.000Z","subtitle":"Echarts Tree","header-img":"/blogs/img/article_header/article_header.png","catagories":["Echarts"],"updateDate":"2020-03-22T10:24:00.000Z","top":null,"_content":"\n### 前言\n\n-------------\nEcharts树形图Tree可以用来展示树形数据结构各节点的层级关系，比如一个使用情况就是文件系统存在多个快照，每一级快照基于上一级生成，存在父级和子级关系对应关系，且Root根只有一个，即文件系统本身，完全适用于树形图的使用场景。\n\n![snapshot](/blogs/img/article/snapshot.png)\n\n### 树形图功能需求以及遇到的问题分析\n\n-------------------------------\n\n1. 文件系统快照每一层级的节点支持单个选中，很多操作都是基于某一个快照节点的，比\n如快照的恢复、删除、设置，考虑选中效果的区别使用label自定义富文本样式实现，但是会遇到渲染的时侯echarts一些自己的状态更新和我们我们自定义的选中状态的更新冲突问题，且V4版本echarts tree的富文本配置后也并未生效。\n\n![snapshot_select](/blogs/img/article/snapshot_select.png)\n\n2. 文件系统快照每一层级的节点标识(Symbol)可能不同，需要支持使用自定义图片，echarts的symbol是直接支持使用img-src和base63 img-str的，但是会遇到图片在某些时候不能完全被渲染(图片像是被设置了半透明)或直接完全不能被渲染出来的问题。\n\n![tree-1](/blogs/img/article/tree-1.png)\n![tree-2](/blogs/img/article/tree-2.png)\n![tree-3](/blogs/img/article/tree-3.png)\n\n\n### 问题I：V4版本label自定义效果设置不生效\n\n-------------------------------\n\nseries-tree.label.formatter\n>标签内容格式器，支持字符串模板和回调函数两种形式，字符串模板与回调函数返回的字符串均支持用 \\n 换行。\n\n#### 字符串模板的使用  \n\n1. 模板变量有：  \n* {a}：系列名。\n* {b}：数据名。\n* {c}：数据值。\n* {d}：百分比。\n* {@xxx}：数据中名为'xxx'的维度的值，如{@product}表示名为'product'` 的维度的值。\n* {@[n]}：数据中维度n的值，如{@[3]}` 表示维度 3 的值，从 0 开始计数。\n\n2. 示例：  \nformatter: '{b}: {d}'\n\n3. 回调函数格式：  \n(params: Object|Array) => string，\n参数 params 是 formatter 需要的单个数据集，格式如下：\n```js\n{\n    componentType: 'series',\n    // 系列类型\n    seriesType: string,\n    // 系列在传入的 option.series 中的 index\n    seriesIndex: number,\n    // 系列名称\n    seriesName: string,\n    // 数据名，类目名\n    name: string,\n    // 数据在传入的 data 数组中的 index\n    dataIndex: number,\n    // 传入的原始数据项\n    data: Object,\n    // 传入的数据值。在多数系列下它和 data 相同。在一些系列下是 data 中的分量（如 map、radar 中）\n    value: number|Array|Object,\n    // 坐标轴 encode 映射信息，\n    // key 为坐标轴（如 'x' 'y' 'radius' 'angle' 等）\n    // value 必然为数组，不会为 null/undefied，表示 dimension index 。\n    // 其内容如：\n    // {\n    //     x: [2] // dimension index 为 2 的数据映射到 x 轴\n    //     y: [0] // dimension index 为 0 的数据映射到 y 轴\n    // }\n    encode: Object,\n    // 维度名列表\n    dimensionNames: Array<String>,\n    // 数据的维度 index，如 0 或 1 或 2 ...\n    // 仅在雷达图中使用。\n    dimensionIndex: number,\n    // 数据图形的颜色\n    color: string,\n}\n```\n\n#### 字符串模板不生效问题1\n直接将formatter自定义函数和富文本标识配置在`series[0].label`下，结果以上配置都无效，正确方法是在`series[0].label.normal`下配置富文本标识声明，而formatter需要定义在数据集data的各个数据项中，`normal`表示常规效果，与之对应的`emphasis`是鼠标划过高亮效果。\n![tree-4](/blogs/img/article/tree-4.png)\n\nseries-tree.label.rich支持的所有CSS属性：\n```js\n{\n  color , fontStyle , fontWeight , fontFamily , fontSize , align , verticalAlign , lineHeight , backgroundColor , borderColor , borderWidth , borderRadius , padding , shadowColor , shadowBlur , shadowOffsetX , shadowOffsetY , width , height , textBorderColor , textBorderWidth , textShadowColor , textShadowBlur , textShadowOffsetX , textShadowOffsetY\n} \n```\n\nseries-tree.data.label中配置label.formatter：\n\n```js\nconst rawTreeData = {\n          name: 'snapshotA',\n          selected: false, // 自定义选择控制属性selected\n          collapsed: false, // 覆盖组件自带的collapsed效果\n          label: {\n            // * 直接引用上层定义的formatter即可，复用函数对象\n            formatter: this.echartsInitData.series[0].label.normal.formatter,\n          },\n          children: [\n            ...\n          ],\n}\n```\n\n![tree-5](/blogs/img/article/tree-5.png)\n\n### 问题II：tree图使用自定义图片加载显示不完全\n\n-------------------------------\n\n#### 解决方案1(无效)：使用对象深比较函数避免多次渲染\n> 使用此方法在React生命周期componentDidUpdate里判断options是否发生改变，从而避免了echarts组件多次render的情况，但验证后发现避免了一些组件卡顿的情况，但也存在自定义tree 节点图片加载不完全的情况，此解决方案无效。\n\n1. Js对象深比较函数deepComparison定义\n\n```js\n/**\n * [deepComparison 深比较]\n * @param  {[any]} data [any]\n * @return {[Boolean]}      [是否相同]\n */\nexport function deepComparison(data1, data2) {\n  const { hasOwnProperty } = Object.prototype;\n  // 获取变量类型\n  const getType = (d) => {\n    if (typeof d === 'object') {\n      if (!(d instanceof Object)) {\n        return 'null';\n      }\n      if (d instanceof Date) {\n        return 'date';\n      }\n      if (d instanceof RegExp) {\n        return 'regexp';\n      }\n      // object / array //\n      return 'object';\n    }\n    if (d !== d) return 'nan';\n    return (typeof d).toLowerCase();\n  };\n  // 基本类型比较\n  const is = (d1, d2, type) => {\n    if (type === 'nan') return true;\n    if (type === 'date' || type === 'regexp') return d1.toString() === d2.toString();\n    return (d1 === d2);\n  };\n  // 递归比较\n  const compare = (d1, d2) => {\n    const type1 = getType(d1);\n    const type2 = getType(d2);\n    if (type1 !== type2) {\n      return false;\n    }\n    if (type1 === 'object') {\n      const keys1 = Object.keys(d1).filter(k => hasOwnProperty.call(d1, k));\n      const keys2 = Object.keys(d2).filter(k => hasOwnProperty.call(d2, k));\n      if (keys1.length !== keys2.length) {\n        return false;\n      }\n      for (let i = 0; i < keys1.length; i += 1) {\n        if (\n          !keys2.includes(keys1[i]) ||\n          !compare(d1[keys1[i]], d2[keys1[i]])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return is(d1, d2, type1);\n  };\n\n  return compare(data1, data2);\n}\n```\n\n2.深度比较函数使用\n\n```js\n  componentDidUpdate() {\n    console.log('update');\n    const { treeData } = this.props;\n    const rawTreeData = toJS(treeData);\n    if (!deepComparison(this.echartsTreeData, rawTreeData)) {\n      console.log('change');\n      this.echartsTreeData = rawTreeData;\n      const optionData = this.echartsElement.getOption();\n      optionData.series[0].data = [rawTreeData];\n      console.log(optionData);\n      // this.echartsElement.clear();\n      this.echartsElement.setOption(optionData, true);\n    }\n  }\n```\n\n#### 解决方案2(无效)：使用base64字符串替换img url\n>由于方案1无效，判断可能是由于图片异步加载引起的渲染问题，对小图片尝试直接使用base64硬编码在代码里，结果发现仍然无效。\n\n![tree-6](/blogs/img/article/tree-6.png)\n\n#### 解决方案3(有效)：禁用动画加载\n>由解决方案2可知，问题原因排除img异步加载的问题，问题定位到echarts组件自身的渲bug，通过多次设置setOption方法的参数，发现设置动画取消可以避免由于echarts图自身的渲染过程引起的图片加载不全问题。\n\n```js\nconst chartOption = {\n  animation: true, // 解决渲染不全的问题\n  tooltip: {\n    trigger: 'item',\n    triggerOn: 'mousemove',\n  },\n  series: [\n    ...\n  ],\n};\n```\n\n#### 解决方案4(有效)：组件渲染完成后重新手动渲染\n>echarts初始化后的组件可以挂载钩子函数和监听一些浏览器事件，其中有一个事件名为finished，表示echarts图表本次渲染完成。既然我们之前的最后一次渲染导致图片未完全加载，那么可以在最后这次渲染完成之后再读取echarts组件自带的options然后重新渲染一次，即可解决问题，需要注意的是，finished事件可能在短时间内被调用数次，在监听时注意使用函数防抖的思想让短时间内的多次finished事件回调只执行一次。\n\n1. 函数防抖声明  \n函数节流和函数防抖在浏览器渲染优化方面还是用得挺多：\n```js\n/**\n   * @param  {Function} fn         [回调函数]\n   * @param  {[Time]}   delayTime  [延迟时间(ms)]\n   * @param  {Boolean}  isImediate [是否需要立即调用]\n   * @param  {[type]}   args       [回调函数传入参数]\n  */\nexport function fnDebounce() {\n  const fnObject = {};\n  let timer;\n\n  return (fn, delayTime, isImediate, args) => {\n    // 设置定时器方法\n    const setTimer = () => {\n      timer = setTimeout(() => {\n        fn(args);\n        // 清除定时器\n        clearTimeout(timer);\n        delete (fnObject[fn]);\n      }, delayTime);\n\n      fnObject[fn] = {\n        delayTime,\n        timer,\n      };\n    };\n    // 立即调用\n    if (!delayTime || isImediate) return fn(args);\n    // 判断函数是否已经在调用中\n    if (fnObject[fn]) {\n      clearTimeout(timer);\n      setTimer(fn, delayTime, args);\n    } else {\n      setTimer(fn, delayTime, args);\n    }\n  };\n}\n```\n\n2. finished事件监听和函数防抖的应用  \n其实在此基础上还能做的优化就是在组件第一次加载自定义symbol图片后就将`finished`事件监听取消掉，减少渲染次数。\n```js\nclass FsPageSnapShotBody extends Component {\n  echartsElement= null\n  echartsTreeData = null;\n\n  // 初始化事件防抖\n  fnDebounce = fnDebounce();\n\n  pendingEventsTrigger = (nodeName) => {\n    const optionData = this.echartsElement.getOption();\n    this.echartsElement.setOption(optionData, true);\n  };\n\n  componentDidMount() {\n    const { snapshot } = this.props;\n    this.echartsElement = echarts.init(this.refs.fsSnapShot);\n    this.echartsElement.setOption(snapshot.echartsInitData);\n    // finished事件监听\n    this.echartsElement.on('finished', (params) => {\n      // 延迟时间设置为200ms\n      this.fnDebounce(this.pendingEventsTrigger, 200, false, null);\n    });\n    window.addEventListener('resize', this.resizeCharts);\n  }\n  componentDidUpdate() {\n    ...\n  }\n  resizeCharts = () => {\n    this.echartsElement.resize();\n  }\n  componentWillUnmount() {\n    echarts.dispose(this.echartsElement);\n    window.removeEventListener('resize', this.resizeCharts);\n  }\n  onClickChart = (e) => {\n    ...\n  }\n  onDoubleClickChart = (e) => {\n    ...\n  }\n  render() {\n    ...\n  }\n}\n```\n\n\n### 问题III：tree图自定义节点选中效果和组件自带渲染效果冲突\n\n-------------------------------\n节点选中效果原理是监听echarts的`dblclick`双击事件，双击后改变`options.series[0].data`数据项里的`selected`属性配置，然后label.formatter根据此属性能够应用富文本类名里声明的高亮或普通文本的类名。值得注意的是echarts渲染时自身已经对过长层级的tree数据做了渲染优化，导致过深层级的展开/折叠状态不被控制，每次重新渲染后会导致已经折叠的树层级展开或是已经展开的树层级折叠，非常影响用户操作，因此需要把树层级数据每一层的折叠纳入强制属性控制状态，即在`options.series[0].data`中额外声明`collapsed:[Boolean]`参数，同时禁用tree自带的折叠/展开控制。\n\n#### 冲突1：在设置了echarts渲染动画延迟更新的情况下节点选中效果无效\n如果直接通过dblclick双击事件触发函数设置某个节点选中状态的属性`selected:true`，那么表现为：`selected`状态不常驻，变成了类似`mouseover`的鼠标划过状态触发；\n1. 动画延迟更新属性声明  \n```js\n/* Tree的外层数据 */\nechartsInitData= {\n    tooltip: {\n      trigger: 'item',\n      triggerOn: 'mousemove',\n    },\n    series: [\n      {\n        {...},\n        leaves: {...},\n        expandAndCollapse: false,\n        animationDuration: 100,\n        animationDelayUpdate: 300, // 动画延迟更新\n        animationDurationUpdate: 400,\n      },\n    ],\n  }\n```\n\n2. 冲突效果表现\n\n![tree-bug1](/blogs/img/article/tree-bug1.gif)\n\n#### 冲突2：鼠标的悬浮操作导致选中效果无效\n按照上述表现，我尝试在触发函数更新tree节点选中状态之前设置一个延迟，延迟时间大于tree组件的动画延迟更新设置时间(上面设置为了`300ms`)，结果发现：如果在双击tree节点的时候鼠标一直放在节点上的话，鼠标移开后，表现和上面一样，如果双击了tree节点之后马上把鼠标从该节点移开的话则选中状态正常(太不容易了！)，推测是我们触发echarts组件更新的时候，echarts自身的组件状态管理和我们自定义的组件更新函数(以上表现为设置tree节点数据的`selected`属性触发label.formatter的渲染效果变化)两者冲突。\n\n1. 设置`selected`属性更改函数的延迟时间  \n```js\n/* React组件自定义方法-选中一个元素 */\nonDoubleClickChart = (e) => {\n    const { name } = e.data;\n    this.selectedNodeName = name;\n    setTimeout(() => {\n      this.props.snapshot.chooseSnapShot(name);\n    }, 400);\n  }\n```\n\n2. 冲突效果表现\n![tree-bug2](/blogs/img/article/tree-bug2.gif)\n\n#### 解决方法\n方法同于上面提到的`finished事件监听和函数防抖的应用`，在echarts组件最终渲染完成后增加一次额外渲染解决问题，但是也仍然会有`selected`状态稍稍延迟更新和`selected`状态闪烁一次的问题，不妨碍使用，但是应该有更优的解决办法尚待实现。\n\n1. 代码概览  \n```js\nclass FsPageSnapShotBody extends Component {\n  echartsElement= null\n  echartsTreeData = null;\n  selectedNodeName = null;\n\n  // 初始化事件防抖\n  dblclickFnDebounce = fnDebounce();\n\n  pendingEventsTrigger = (nodeName) => {\n    const optionData = this.echartsElement.getOption();\n    this.echartsElement.setOption(optionData, true);\n  };\n\n  componentDidMount() {\n    const { snapshot } = this.props;\n    this.echartsElement = echarts.init(this.refs.fsSnapShot);\n    this.echartsElement.setOption(snapshot.echartsInitData);\n    this.echartsElement.on('dblclick', this.onDoubleClickChart);\n    this.echartsElement.on('click', this.onClickChart);\n    // finished事件监听\n    this.echartsElement.on('finished', (params) => {\n      if (this.selectedNodeName) {\n        // 防抖延迟时间设置为200ms\n        this.dblclickFnDebounce(this.pendingEventsTrigger, 200, false, this.selectedNodeName);\n      }\n    });\n\n    snapshot.getSnapShotRequest();\n    window.addEventListener('resize', this.resizeCharts);\n  }\n  componentDidUpdate() {\n    ...\n  }\n  resizeCharts = () => {\n    this.echartsElement.resize();\n  }\n  componentWillUnmount() {\n    echarts.dispose(this.echartsElement);\n    window.removeEventListener('resize', this.resizeCharts);\n  }\n  onClickChart = (e) => {\n    ...\n  }\n  onDoubleClickChart = (e) => {\n    ...\n  }\n  render() {\n    ...\n  }\n}\n```\n\n2. 效果演示\n![tree-bug-fix](/blogs/img/article/tree-bug-fix.gif)","source":"_posts/echarts图表-树形图开发记录.md","raw":"---\ntitle: \"echarts图表-树形图开发记录\"\ncatalog: true\ntoc_nav_num: true\ndate:   2020-03-22 18:24:00\nsubtitle: \"Echarts Tree\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Echarts\n- React\ncatagories:\n- Echarts\nupdateDate: 2020-03-22 18:24:00\ntop: \n---\n\n### 前言\n\n-------------\nEcharts树形图Tree可以用来展示树形数据结构各节点的层级关系，比如一个使用情况就是文件系统存在多个快照，每一级快照基于上一级生成，存在父级和子级关系对应关系，且Root根只有一个，即文件系统本身，完全适用于树形图的使用场景。\n\n![snapshot](/blogs/img/article/snapshot.png)\n\n### 树形图功能需求以及遇到的问题分析\n\n-------------------------------\n\n1. 文件系统快照每一层级的节点支持单个选中，很多操作都是基于某一个快照节点的，比\n如快照的恢复、删除、设置，考虑选中效果的区别使用label自定义富文本样式实现，但是会遇到渲染的时侯echarts一些自己的状态更新和我们我们自定义的选中状态的更新冲突问题，且V4版本echarts tree的富文本配置后也并未生效。\n\n![snapshot_select](/blogs/img/article/snapshot_select.png)\n\n2. 文件系统快照每一层级的节点标识(Symbol)可能不同，需要支持使用自定义图片，echarts的symbol是直接支持使用img-src和base63 img-str的，但是会遇到图片在某些时候不能完全被渲染(图片像是被设置了半透明)或直接完全不能被渲染出来的问题。\n\n![tree-1](/blogs/img/article/tree-1.png)\n![tree-2](/blogs/img/article/tree-2.png)\n![tree-3](/blogs/img/article/tree-3.png)\n\n\n### 问题I：V4版本label自定义效果设置不生效\n\n-------------------------------\n\nseries-tree.label.formatter\n>标签内容格式器，支持字符串模板和回调函数两种形式，字符串模板与回调函数返回的字符串均支持用 \\n 换行。\n\n#### 字符串模板的使用  \n\n1. 模板变量有：  \n* {a}：系列名。\n* {b}：数据名。\n* {c}：数据值。\n* {d}：百分比。\n* {@xxx}：数据中名为'xxx'的维度的值，如{@product}表示名为'product'` 的维度的值。\n* {@[n]}：数据中维度n的值，如{@[3]}` 表示维度 3 的值，从 0 开始计数。\n\n2. 示例：  \nformatter: '{b}: {d}'\n\n3. 回调函数格式：  \n(params: Object|Array) => string，\n参数 params 是 formatter 需要的单个数据集，格式如下：\n```js\n{\n    componentType: 'series',\n    // 系列类型\n    seriesType: string,\n    // 系列在传入的 option.series 中的 index\n    seriesIndex: number,\n    // 系列名称\n    seriesName: string,\n    // 数据名，类目名\n    name: string,\n    // 数据在传入的 data 数组中的 index\n    dataIndex: number,\n    // 传入的原始数据项\n    data: Object,\n    // 传入的数据值。在多数系列下它和 data 相同。在一些系列下是 data 中的分量（如 map、radar 中）\n    value: number|Array|Object,\n    // 坐标轴 encode 映射信息，\n    // key 为坐标轴（如 'x' 'y' 'radius' 'angle' 等）\n    // value 必然为数组，不会为 null/undefied，表示 dimension index 。\n    // 其内容如：\n    // {\n    //     x: [2] // dimension index 为 2 的数据映射到 x 轴\n    //     y: [0] // dimension index 为 0 的数据映射到 y 轴\n    // }\n    encode: Object,\n    // 维度名列表\n    dimensionNames: Array<String>,\n    // 数据的维度 index，如 0 或 1 或 2 ...\n    // 仅在雷达图中使用。\n    dimensionIndex: number,\n    // 数据图形的颜色\n    color: string,\n}\n```\n\n#### 字符串模板不生效问题1\n直接将formatter自定义函数和富文本标识配置在`series[0].label`下，结果以上配置都无效，正确方法是在`series[0].label.normal`下配置富文本标识声明，而formatter需要定义在数据集data的各个数据项中，`normal`表示常规效果，与之对应的`emphasis`是鼠标划过高亮效果。\n![tree-4](/blogs/img/article/tree-4.png)\n\nseries-tree.label.rich支持的所有CSS属性：\n```js\n{\n  color , fontStyle , fontWeight , fontFamily , fontSize , align , verticalAlign , lineHeight , backgroundColor , borderColor , borderWidth , borderRadius , padding , shadowColor , shadowBlur , shadowOffsetX , shadowOffsetY , width , height , textBorderColor , textBorderWidth , textShadowColor , textShadowBlur , textShadowOffsetX , textShadowOffsetY\n} \n```\n\nseries-tree.data.label中配置label.formatter：\n\n```js\nconst rawTreeData = {\n          name: 'snapshotA',\n          selected: false, // 自定义选择控制属性selected\n          collapsed: false, // 覆盖组件自带的collapsed效果\n          label: {\n            // * 直接引用上层定义的formatter即可，复用函数对象\n            formatter: this.echartsInitData.series[0].label.normal.formatter,\n          },\n          children: [\n            ...\n          ],\n}\n```\n\n![tree-5](/blogs/img/article/tree-5.png)\n\n### 问题II：tree图使用自定义图片加载显示不完全\n\n-------------------------------\n\n#### 解决方案1(无效)：使用对象深比较函数避免多次渲染\n> 使用此方法在React生命周期componentDidUpdate里判断options是否发生改变，从而避免了echarts组件多次render的情况，但验证后发现避免了一些组件卡顿的情况，但也存在自定义tree 节点图片加载不完全的情况，此解决方案无效。\n\n1. Js对象深比较函数deepComparison定义\n\n```js\n/**\n * [deepComparison 深比较]\n * @param  {[any]} data [any]\n * @return {[Boolean]}      [是否相同]\n */\nexport function deepComparison(data1, data2) {\n  const { hasOwnProperty } = Object.prototype;\n  // 获取变量类型\n  const getType = (d) => {\n    if (typeof d === 'object') {\n      if (!(d instanceof Object)) {\n        return 'null';\n      }\n      if (d instanceof Date) {\n        return 'date';\n      }\n      if (d instanceof RegExp) {\n        return 'regexp';\n      }\n      // object / array //\n      return 'object';\n    }\n    if (d !== d) return 'nan';\n    return (typeof d).toLowerCase();\n  };\n  // 基本类型比较\n  const is = (d1, d2, type) => {\n    if (type === 'nan') return true;\n    if (type === 'date' || type === 'regexp') return d1.toString() === d2.toString();\n    return (d1 === d2);\n  };\n  // 递归比较\n  const compare = (d1, d2) => {\n    const type1 = getType(d1);\n    const type2 = getType(d2);\n    if (type1 !== type2) {\n      return false;\n    }\n    if (type1 === 'object') {\n      const keys1 = Object.keys(d1).filter(k => hasOwnProperty.call(d1, k));\n      const keys2 = Object.keys(d2).filter(k => hasOwnProperty.call(d2, k));\n      if (keys1.length !== keys2.length) {\n        return false;\n      }\n      for (let i = 0; i < keys1.length; i += 1) {\n        if (\n          !keys2.includes(keys1[i]) ||\n          !compare(d1[keys1[i]], d2[keys1[i]])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return is(d1, d2, type1);\n  };\n\n  return compare(data1, data2);\n}\n```\n\n2.深度比较函数使用\n\n```js\n  componentDidUpdate() {\n    console.log('update');\n    const { treeData } = this.props;\n    const rawTreeData = toJS(treeData);\n    if (!deepComparison(this.echartsTreeData, rawTreeData)) {\n      console.log('change');\n      this.echartsTreeData = rawTreeData;\n      const optionData = this.echartsElement.getOption();\n      optionData.series[0].data = [rawTreeData];\n      console.log(optionData);\n      // this.echartsElement.clear();\n      this.echartsElement.setOption(optionData, true);\n    }\n  }\n```\n\n#### 解决方案2(无效)：使用base64字符串替换img url\n>由于方案1无效，判断可能是由于图片异步加载引起的渲染问题，对小图片尝试直接使用base64硬编码在代码里，结果发现仍然无效。\n\n![tree-6](/blogs/img/article/tree-6.png)\n\n#### 解决方案3(有效)：禁用动画加载\n>由解决方案2可知，问题原因排除img异步加载的问题，问题定位到echarts组件自身的渲bug，通过多次设置setOption方法的参数，发现设置动画取消可以避免由于echarts图自身的渲染过程引起的图片加载不全问题。\n\n```js\nconst chartOption = {\n  animation: true, // 解决渲染不全的问题\n  tooltip: {\n    trigger: 'item',\n    triggerOn: 'mousemove',\n  },\n  series: [\n    ...\n  ],\n};\n```\n\n#### 解决方案4(有效)：组件渲染完成后重新手动渲染\n>echarts初始化后的组件可以挂载钩子函数和监听一些浏览器事件，其中有一个事件名为finished，表示echarts图表本次渲染完成。既然我们之前的最后一次渲染导致图片未完全加载，那么可以在最后这次渲染完成之后再读取echarts组件自带的options然后重新渲染一次，即可解决问题，需要注意的是，finished事件可能在短时间内被调用数次，在监听时注意使用函数防抖的思想让短时间内的多次finished事件回调只执行一次。\n\n1. 函数防抖声明  \n函数节流和函数防抖在浏览器渲染优化方面还是用得挺多：\n```js\n/**\n   * @param  {Function} fn         [回调函数]\n   * @param  {[Time]}   delayTime  [延迟时间(ms)]\n   * @param  {Boolean}  isImediate [是否需要立即调用]\n   * @param  {[type]}   args       [回调函数传入参数]\n  */\nexport function fnDebounce() {\n  const fnObject = {};\n  let timer;\n\n  return (fn, delayTime, isImediate, args) => {\n    // 设置定时器方法\n    const setTimer = () => {\n      timer = setTimeout(() => {\n        fn(args);\n        // 清除定时器\n        clearTimeout(timer);\n        delete (fnObject[fn]);\n      }, delayTime);\n\n      fnObject[fn] = {\n        delayTime,\n        timer,\n      };\n    };\n    // 立即调用\n    if (!delayTime || isImediate) return fn(args);\n    // 判断函数是否已经在调用中\n    if (fnObject[fn]) {\n      clearTimeout(timer);\n      setTimer(fn, delayTime, args);\n    } else {\n      setTimer(fn, delayTime, args);\n    }\n  };\n}\n```\n\n2. finished事件监听和函数防抖的应用  \n其实在此基础上还能做的优化就是在组件第一次加载自定义symbol图片后就将`finished`事件监听取消掉，减少渲染次数。\n```js\nclass FsPageSnapShotBody extends Component {\n  echartsElement= null\n  echartsTreeData = null;\n\n  // 初始化事件防抖\n  fnDebounce = fnDebounce();\n\n  pendingEventsTrigger = (nodeName) => {\n    const optionData = this.echartsElement.getOption();\n    this.echartsElement.setOption(optionData, true);\n  };\n\n  componentDidMount() {\n    const { snapshot } = this.props;\n    this.echartsElement = echarts.init(this.refs.fsSnapShot);\n    this.echartsElement.setOption(snapshot.echartsInitData);\n    // finished事件监听\n    this.echartsElement.on('finished', (params) => {\n      // 延迟时间设置为200ms\n      this.fnDebounce(this.pendingEventsTrigger, 200, false, null);\n    });\n    window.addEventListener('resize', this.resizeCharts);\n  }\n  componentDidUpdate() {\n    ...\n  }\n  resizeCharts = () => {\n    this.echartsElement.resize();\n  }\n  componentWillUnmount() {\n    echarts.dispose(this.echartsElement);\n    window.removeEventListener('resize', this.resizeCharts);\n  }\n  onClickChart = (e) => {\n    ...\n  }\n  onDoubleClickChart = (e) => {\n    ...\n  }\n  render() {\n    ...\n  }\n}\n```\n\n\n### 问题III：tree图自定义节点选中效果和组件自带渲染效果冲突\n\n-------------------------------\n节点选中效果原理是监听echarts的`dblclick`双击事件，双击后改变`options.series[0].data`数据项里的`selected`属性配置，然后label.formatter根据此属性能够应用富文本类名里声明的高亮或普通文本的类名。值得注意的是echarts渲染时自身已经对过长层级的tree数据做了渲染优化，导致过深层级的展开/折叠状态不被控制，每次重新渲染后会导致已经折叠的树层级展开或是已经展开的树层级折叠，非常影响用户操作，因此需要把树层级数据每一层的折叠纳入强制属性控制状态，即在`options.series[0].data`中额外声明`collapsed:[Boolean]`参数，同时禁用tree自带的折叠/展开控制。\n\n#### 冲突1：在设置了echarts渲染动画延迟更新的情况下节点选中效果无效\n如果直接通过dblclick双击事件触发函数设置某个节点选中状态的属性`selected:true`，那么表现为：`selected`状态不常驻，变成了类似`mouseover`的鼠标划过状态触发；\n1. 动画延迟更新属性声明  \n```js\n/* Tree的外层数据 */\nechartsInitData= {\n    tooltip: {\n      trigger: 'item',\n      triggerOn: 'mousemove',\n    },\n    series: [\n      {\n        {...},\n        leaves: {...},\n        expandAndCollapse: false,\n        animationDuration: 100,\n        animationDelayUpdate: 300, // 动画延迟更新\n        animationDurationUpdate: 400,\n      },\n    ],\n  }\n```\n\n2. 冲突效果表现\n\n![tree-bug1](/blogs/img/article/tree-bug1.gif)\n\n#### 冲突2：鼠标的悬浮操作导致选中效果无效\n按照上述表现，我尝试在触发函数更新tree节点选中状态之前设置一个延迟，延迟时间大于tree组件的动画延迟更新设置时间(上面设置为了`300ms`)，结果发现：如果在双击tree节点的时候鼠标一直放在节点上的话，鼠标移开后，表现和上面一样，如果双击了tree节点之后马上把鼠标从该节点移开的话则选中状态正常(太不容易了！)，推测是我们触发echarts组件更新的时候，echarts自身的组件状态管理和我们自定义的组件更新函数(以上表现为设置tree节点数据的`selected`属性触发label.formatter的渲染效果变化)两者冲突。\n\n1. 设置`selected`属性更改函数的延迟时间  \n```js\n/* React组件自定义方法-选中一个元素 */\nonDoubleClickChart = (e) => {\n    const { name } = e.data;\n    this.selectedNodeName = name;\n    setTimeout(() => {\n      this.props.snapshot.chooseSnapShot(name);\n    }, 400);\n  }\n```\n\n2. 冲突效果表现\n![tree-bug2](/blogs/img/article/tree-bug2.gif)\n\n#### 解决方法\n方法同于上面提到的`finished事件监听和函数防抖的应用`，在echarts组件最终渲染完成后增加一次额外渲染解决问题，但是也仍然会有`selected`状态稍稍延迟更新和`selected`状态闪烁一次的问题，不妨碍使用，但是应该有更优的解决办法尚待实现。\n\n1. 代码概览  \n```js\nclass FsPageSnapShotBody extends Component {\n  echartsElement= null\n  echartsTreeData = null;\n  selectedNodeName = null;\n\n  // 初始化事件防抖\n  dblclickFnDebounce = fnDebounce();\n\n  pendingEventsTrigger = (nodeName) => {\n    const optionData = this.echartsElement.getOption();\n    this.echartsElement.setOption(optionData, true);\n  };\n\n  componentDidMount() {\n    const { snapshot } = this.props;\n    this.echartsElement = echarts.init(this.refs.fsSnapShot);\n    this.echartsElement.setOption(snapshot.echartsInitData);\n    this.echartsElement.on('dblclick', this.onDoubleClickChart);\n    this.echartsElement.on('click', this.onClickChart);\n    // finished事件监听\n    this.echartsElement.on('finished', (params) => {\n      if (this.selectedNodeName) {\n        // 防抖延迟时间设置为200ms\n        this.dblclickFnDebounce(this.pendingEventsTrigger, 200, false, this.selectedNodeName);\n      }\n    });\n\n    snapshot.getSnapShotRequest();\n    window.addEventListener('resize', this.resizeCharts);\n  }\n  componentDidUpdate() {\n    ...\n  }\n  resizeCharts = () => {\n    this.echartsElement.resize();\n  }\n  componentWillUnmount() {\n    echarts.dispose(this.echartsElement);\n    window.removeEventListener('resize', this.resizeCharts);\n  }\n  onClickChart = (e) => {\n    ...\n  }\n  onDoubleClickChart = (e) => {\n    ...\n  }\n  render() {\n    ...\n  }\n}\n```\n\n2. 效果演示\n![tree-bug-fix](/blogs/img/article/tree-bug-fix.gif)","slug":"echarts图表-树形图开发记录","published":1,"updated":"2020-03-23T08:05:32.435Z","_id":"ck846hxmy0009a8957ly4c5js","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"前言\">前言</h3>\n<hr>\n<p>Echarts树形图Tree可以用来展示树形数据结构各节点的层级关系，比如一个使用情况就是文件系统存在多个快照，每一级快照基于上一级生成，存在父级和子级关系对应关系，且Root根只有一个，即文件系统本身，完全适用于树形图的使用场景。</p>\n<p><img src=\"/blogs/img/article/snapshot.png\" alt=\"snapshot\"></p>\n<h3 id=\"树形图功能需求以及遇到的问题分析\">树形图功能需求以及遇到的问题分析</h3>\n<hr>\n<ol>\n<li>文件系统快照每一层级的节点支持单个选中，很多操作都是基于某一个快照节点的，比<br>\n如快照的恢复、删除、设置，考虑选中效果的区别使用label自定义富文本样式实现，但是会遇到渲染的时侯echarts一些自己的状态更新和我们我们自定义的选中状态的更新冲突问题，且V4版本echarts tree的富文本配置后也并未生效。</li>\n</ol>\n<p><img src=\"/blogs/img/article/snapshot_select.png\" alt=\"snapshot_select\"></p>\n<ol start=\"2\">\n<li>文件系统快照每一层级的节点标识(Symbol)可能不同，需要支持使用自定义图片，echarts的symbol是直接支持使用img-src和base63 img-str的，但是会遇到图片在某些时候不能完全被渲染(图片像是被设置了半透明)或直接完全不能被渲染出来的问题。</li>\n</ol>\n<p><img src=\"/blogs/img/article/tree-1.png\" alt=\"tree-1\"><br>\n<img src=\"/blogs/img/article/tree-2.png\" alt=\"tree-2\"><br>\n<img src=\"/blogs/img/article/tree-3.png\" alt=\"tree-3\"></p>\n<h3 id=\"问题iv4版本label自定义效果设置不生效\">问题I：V4版本label自定义效果设置不生效</h3>\n<hr>\n<p>series-tree.label.formatter</p>\n<blockquote>\n<p>标签内容格式器，支持字符串模板和回调函数两种形式，字符串模板与回调函数返回的字符串均支持用 \\n 换行。</p>\n</blockquote>\n<h4 id=\"字符串模板的使用\">字符串模板的使用</h4>\n<ol>\n<li>模板变量有：</li>\n</ol>\n<ul>\n<li>{a}：系列名。</li>\n<li>{b}：数据名。</li>\n<li>{c}：数据值。</li>\n<li>{d}：百分比。</li>\n<li>{@xxx}：数据中名为’xxx’的维度的值，如{@product}表示名为’product’` 的维度的值。</li>\n<li>{@[n]}：数据中维度n的值，如{@[3]}` 表示维度 3 的值，从 0 开始计数。</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>示例：<br>\nformatter: ‘{b}: {d}’</p>\n</li>\n<li>\n<p>回调函数格式：<br>\n(params: Object|Array) =&gt; string，<br>\n参数 params 是 formatter 需要的单个数据集，格式如下：</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    componentType: <span class=\"string\">'series'</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 系列类型</span></span><br><span class=\"line\">    seriesType: string,</span><br><span class=\"line\">    <span class=\"comment\">// 系列在传入的 option.series 中的 index</span></span><br><span class=\"line\">    seriesIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 系列名称</span></span><br><span class=\"line\">    seriesName: string,</span><br><span class=\"line\">    <span class=\"comment\">// 数据名，类目名</span></span><br><span class=\"line\">    name: string,</span><br><span class=\"line\">    <span class=\"comment\">// 数据在传入的 data 数组中的 index</span></span><br><span class=\"line\">    dataIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 传入的原始数据项</span></span><br><span class=\"line\">    data: <span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 传入的数据值。在多数系列下它和 data 相同。在一些系列下是 data 中的分量（如 map、radar 中）</span></span><br><span class=\"line\">    value: number|<span class=\"built_in\">Array</span>|<span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 坐标轴 encode 映射信息，</span></span><br><span class=\"line\">    <span class=\"comment\">// key 为坐标轴（如 'x' 'y' 'radius' 'angle' 等）</span></span><br><span class=\"line\">    <span class=\"comment\">// value 必然为数组，不会为 null/undefied，表示 dimension index 。</span></span><br><span class=\"line\">    <span class=\"comment\">// 其内容如：</span></span><br><span class=\"line\">    <span class=\"comment\">// &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     x: [2] // dimension index 为 2 的数据映射到 x 轴</span></span><br><span class=\"line\">    <span class=\"comment\">//     y: [0] // dimension index 为 0 的数据映射到 y 轴</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    encode: <span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 维度名列表</span></span><br><span class=\"line\">    dimensionNames: <span class=\"built_in\">Array</span>&lt;<span class=\"built_in\">String</span>&gt;,</span><br><span class=\"line\">    <span class=\"comment\">// 数据的维度 index，如 0 或 1 或 2 ...</span></span><br><span class=\"line\">    <span class=\"comment\">// 仅在雷达图中使用。</span></span><br><span class=\"line\">    dimensionIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 数据图形的颜色</span></span><br><span class=\"line\">    color: string,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"字符串模板不生效问题1\">字符串模板不生效问题1</h4>\n<p>直接将formatter自定义函数和富文本标识配置在<code>series[0].label</code>下，结果以上配置都无效，正确方法是在<code>series[0].label.normal</code>下配置富文本标识声明，而formatter需要定义在数据集data的各个数据项中，<code>normal</code>表示常规效果，与之对应的<code>emphasis</code>是鼠标划过高亮效果。<br>\n<img src=\"/blogs/img/article/tree-4.png\" alt=\"tree-4\"></p>\n<p>series-tree.label.rich支持的所有CSS属性：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  color , fontStyle , fontWeight , fontFamily , fontSize , align , verticalAlign , lineHeight , backgroundColor , borderColor , borderWidth , borderRadius , padding , shadowColor , shadowBlur , shadowOffsetX , shadowOffsetY , width , height , textBorderColor , textBorderWidth , textShadowColor , textShadowBlur , textShadowOffsetX , textShadowOffsetY</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>series-tree.data.label中配置label.formatter：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> rawTreeData = &#123;</span><br><span class=\"line\">          name: <span class=\"string\">'snapshotA'</span>,</span><br><span class=\"line\">          selected: <span class=\"literal\">false</span>, <span class=\"comment\">// 自定义选择控制属性selected</span></span><br><span class=\"line\">          collapsed: <span class=\"literal\">false</span>, <span class=\"comment\">// 覆盖组件自带的collapsed效果</span></span><br><span class=\"line\">          label: &#123;</span><br><span class=\"line\">            <span class=\"comment\">// * 直接引用上层定义的formatter即可，复用函数对象</span></span><br><span class=\"line\">            formatter: <span class=\"keyword\">this</span>.echartsInitData.series[<span class=\"number\">0</span>].label.normal.formatter,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          children: [</span><br><span class=\"line\">            ...</span><br><span class=\"line\">          ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/blogs/img/article/tree-5.png\" alt=\"tree-5\"></p>\n<h3 id=\"问题iitree图使用自定义图片加载显示不完全\">问题II：tree图使用自定义图片加载显示不完全</h3>\n<hr>\n<h4 id=\"解决方案1无效使用对象深比较函数避免多次渲染\">解决方案1(无效)：使用对象深比较函数避免多次渲染</h4>\n<blockquote>\n<p>使用此方法在React生命周期componentDidUpdate里判断options是否发生改变，从而避免了echarts组件多次render的情况，但验证后发现避免了一些组件卡顿的情况，但也存在自定义tree 节点图片加载不完全的情况，此解决方案无效。</p>\n</blockquote>\n<ol>\n<li>Js对象深比较函数deepComparison定义</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [deepComparison 深比较]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[any]&#125; data [any]</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;[Boolean]&#125;      [是否相同]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepComparison</span>(<span class=\"params\">data1, data2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; hasOwnProperty &#125; = <span class=\"built_in\">Object</span>.prototype;</span><br><span class=\"line\">  <span class=\"comment\">// 获取变量类型</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getType = <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> d === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!(d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'null'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'date'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'regexp'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// object / array //</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'object'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d !== d) <span class=\"keyword\">return</span> <span class=\"string\">'nan'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"keyword\">typeof</span> d).toLowerCase();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 基本类型比较</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> is = <span class=\"function\">(<span class=\"params\">d1, d2, type</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'nan'</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'date'</span> || type === <span class=\"string\">'regexp'</span>) <span class=\"keyword\">return</span> d1.toString() === d2.toString();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (d1 === d2);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 递归比较</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> compare = <span class=\"function\">(<span class=\"params\">d1, d2</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type1 = getType(d1);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type2 = getType(d2);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type1 !== type2) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type1 === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> keys1 = <span class=\"built_in\">Object</span>.keys(d1).filter(<span class=\"function\"><span class=\"params\">k</span> =&gt;</span> hasOwnProperty.call(d1, k));</span><br><span class=\"line\">      <span class=\"keyword\">const</span> keys2 = <span class=\"built_in\">Object</span>.keys(d2).filter(<span class=\"function\"><span class=\"params\">k</span> =&gt;</span> hasOwnProperty.call(d2, k));</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (keys1.length !== keys2.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keys1.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (</span><br><span class=\"line\">          !keys2.includes(keys1[i]) ||</span><br><span class=\"line\">          !compare(d1[keys1[i]], d2[keys1[i]])) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> is(d1, d2, type1);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> compare(data1, data2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.深度比较函数使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidUpdate() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'update'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; treeData &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> rawTreeData = toJS(treeData);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!deepComparison(<span class=\"keyword\">this</span>.echartsTreeData, rawTreeData)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'change'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsTreeData = rawTreeData;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    optionData.series[<span class=\"number\">0</span>].data = [rawTreeData];</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(optionData);</span><br><span class=\"line\">    <span class=\"comment\">// this.echartsElement.clear();</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"解决方案2无效使用base64字符串替换img-url\">解决方案2(无效)：使用base64字符串替换img url</h4>\n<blockquote>\n<p>由于方案1无效，判断可能是由于图片异步加载引起的渲染问题，对小图片尝试直接使用base64硬编码在代码里，结果发现仍然无效。</p>\n</blockquote>\n<p><img src=\"/blogs/img/article/tree-6.png\" alt=\"tree-6\"></p>\n<h4 id=\"解决方案3有效禁用动画加载\">解决方案3(有效)：禁用动画加载</h4>\n<blockquote>\n<p>由解决方案2可知，问题原因排除img异步加载的问题，问题定位到echarts组件自身的渲bug，通过多次设置setOption方法的参数，发现设置动画取消可以避免由于echarts图自身的渲染过程引起的图片加载不全问题。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> chartOption = &#123;</span><br><span class=\"line\">  animation: <span class=\"literal\">true</span>, <span class=\"comment\">// 解决渲染不全的问题</span></span><br><span class=\"line\">  tooltip: &#123;</span><br><span class=\"line\">    trigger: <span class=\"string\">'item'</span>,</span><br><span class=\"line\">    triggerOn: <span class=\"string\">'mousemove'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  series: [</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"解决方案4有效组件渲染完成后重新手动渲染\">解决方案4(有效)：组件渲染完成后重新手动渲染</h4>\n<blockquote>\n<p>echarts初始化后的组件可以挂载钩子函数和监听一些浏览器事件，其中有一个事件名为finished，表示echarts图表本次渲染完成。既然我们之前的最后一次渲染导致图片未完全加载，那么可以在最后这次渲染完成之后再读取echarts组件自带的options然后重新渲染一次，即可解决问题，需要注意的是，finished事件可能在短时间内被调用数次，在监听时注意使用函数防抖的思想让短时间内的多次finished事件回调只执行一次。</p>\n</blockquote>\n<ol>\n<li>函数防抖声明<br>\n函数节流和函数防抖在浏览器渲染优化方面还是用得挺多：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;Function&#125; fn         [回调函数]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Time]&#125;   delayTime  [延迟时间(ms)]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;Boolean&#125;  isImediate [是否需要立即调用]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[type]&#125;   args       [回调函数传入参数]</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnDebounce</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fnObject = &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">fn, delayTime, isImediate, args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置定时器方法</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> setTimer = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        fn(args);</span><br><span class=\"line\">        <span class=\"comment\">// 清除定时器</span></span><br><span class=\"line\">        clearTimeout(timer);</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> (fnObject[fn]);</span><br><span class=\"line\">      &#125;, delayTime);</span><br><span class=\"line\"></span><br><span class=\"line\">      fnObject[fn] = &#123;</span><br><span class=\"line\">        delayTime,</span><br><span class=\"line\">        timer,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 立即调用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!delayTime || isImediate) <span class=\"keyword\">return</span> fn(args);</span><br><span class=\"line\">    <span class=\"comment\">// 判断函数是否已经在调用中</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fnObject[fn]) &#123;</span><br><span class=\"line\">      clearTimeout(timer);</span><br><span class=\"line\">      setTimer(fn, delayTime, args);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      setTimer(fn, delayTime, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>finished事件监听和函数防抖的应用<br>\n其实在此基础上还能做的优化就是在组件第一次加载自定义symbol图片后就将<code>finished</code>事件监听取消掉，减少渲染次数。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FsPageSnapShotBody</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  echartsElement= <span class=\"literal\">null</span></span><br><span class=\"line\">  echartsTreeData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 初始化事件防抖</span></span><br><span class=\"line\">  fnDebounce = fnDebounce();</span><br><span class=\"line\"></span><br><span class=\"line\">  pendingEventsTrigger = <span class=\"function\">(<span class=\"params\">nodeName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; snapshot &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement = echarts.init(<span class=\"keyword\">this</span>.refs.fsSnapShot);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(snapshot.echartsInitData);</span><br><span class=\"line\">    <span class=\"comment\">// finished事件监听</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'finished'</span>, (params) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 延迟时间设置为200ms</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fnDebounce(<span class=\"keyword\">this</span>.pendingEventsTrigger, <span class=\"number\">200</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentDidUpdate() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  resizeCharts = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.resize();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    echarts.dispose(<span class=\"keyword\">this</span>.echartsElement);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"问题iiitree图自定义节点选中效果和组件自带渲染效果冲突\">问题III：tree图自定义节点选中效果和组件自带渲染效果冲突</h3>\n<hr>\n<p>节点选中效果原理是监听echarts的<code>dblclick</code>双击事件，双击后改变<code>options.series[0].data</code>数据项里的<code>selected</code>属性配置，然后label.formatter根据此属性能够应用富文本类名里声明的高亮或普通文本的类名。值得注意的是echarts渲染时自身已经对过长层级的tree数据做了渲染优化，导致过深层级的展开/折叠状态不被控制，每次重新渲染后会导致已经折叠的树层级展开或是已经展开的树层级折叠，非常影响用户操作，因此需要把树层级数据每一层的折叠纳入强制属性控制状态，即在<code>options.series[0].data</code>中额外声明<code>collapsed:[Boolean]</code>参数，同时禁用tree自带的折叠/展开控制。</p>\n<h4 id=\"冲突1在设置了echarts渲染动画延迟更新的情况下节点选中效果无效\">冲突1：在设置了echarts渲染动画延迟更新的情况下节点选中效果无效</h4>\n<p>如果直接通过dblclick双击事件触发函数设置某个节点选中状态的属性<code>selected:true</code>，那么表现为：<code>selected</code>状态不常驻，变成了类似<code>mouseover</code>的鼠标划过状态触发；</p>\n<ol>\n<li>动画延迟更新属性声明</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Tree的外层数据 */</span></span><br><span class=\"line\">echartsInitData= &#123;</span><br><span class=\"line\">    tooltip: &#123;</span><br><span class=\"line\">      trigger: <span class=\"string\">'item'</span>,</span><br><span class=\"line\">      triggerOn: <span class=\"string\">'mousemove'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    series: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        &#123;...&#125;,</span><br><span class=\"line\">        leaves: &#123;...&#125;,</span><br><span class=\"line\">        expandAndCollapse: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        animationDuration: <span class=\"number\">100</span>,</span><br><span class=\"line\">        animationDelayUpdate: <span class=\"number\">300</span>, <span class=\"comment\">// 动画延迟更新</span></span><br><span class=\"line\">        animationDurationUpdate: <span class=\"number\">400</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>冲突效果表现</li>\n</ol>\n<p><img src=\"/blogs/img/article/tree-bug1.gif\" alt=\"tree-bug1\"></p>\n<h4 id=\"冲突2鼠标的悬浮操作导致选中效果无效\">冲突2：鼠标的悬浮操作导致选中效果无效</h4>\n<p>按照上述表现，我尝试在触发函数更新tree节点选中状态之前设置一个延迟，延迟时间大于tree组件的动画延迟更新设置时间(上面设置为了<code>300ms</code>)，结果发现：如果在双击tree节点的时候鼠标一直放在节点上的话，鼠标移开后，表现和上面一样，如果双击了tree节点之后马上把鼠标从该节点移开的话则选中状态正常(太不容易了！)，推测是我们触发echarts组件更新的时候，echarts自身的组件状态管理和我们自定义的组件更新函数(以上表现为设置tree节点数据的<code>selected</code>属性触发label.formatter的渲染效果变化)两者冲突。</p>\n<ol>\n<li>设置<code>selected</code>属性更改函数的延迟时间</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* React组件自定义方法-选中一个元素 */</span></span><br><span class=\"line\">onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name &#125; = e.data;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selectedNodeName = name;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.snapshot.chooseSnapShot(name);</span><br><span class=\"line\">    &#125;, <span class=\"number\">400</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>冲突效果表现<br>\n<img src=\"/blogs/img/article/tree-bug2.gif\" alt=\"tree-bug2\"></li>\n</ol>\n<h4 id=\"解决方法\">解决方法</h4>\n<p>方法同于上面提到的<code>finished事件监听和函数防抖的应用</code>，在echarts组件最终渲染完成后增加一次额外渲染解决问题，但是也仍然会有<code>selected</code>状态稍稍延迟更新和<code>selected</code>状态闪烁一次的问题，不妨碍使用，但是应该有更优的解决办法尚待实现。</p>\n<ol>\n<li>代码概览</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FsPageSnapShotBody</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  echartsElement= <span class=\"literal\">null</span></span><br><span class=\"line\">  echartsTreeData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  selectedNodeName = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 初始化事件防抖</span></span><br><span class=\"line\">  dblclickFnDebounce = fnDebounce();</span><br><span class=\"line\"></span><br><span class=\"line\">  pendingEventsTrigger = <span class=\"function\">(<span class=\"params\">nodeName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; snapshot &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement = echarts.init(<span class=\"keyword\">this</span>.refs.fsSnapShot);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(snapshot.echartsInitData);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'dblclick'</span>, <span class=\"keyword\">this</span>.onDoubleClickChart);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'click'</span>, <span class=\"keyword\">this</span>.onClickChart);</span><br><span class=\"line\">    <span class=\"comment\">// finished事件监听</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'finished'</span>, (params) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.selectedNodeName) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 防抖延迟时间设置为200ms</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dblclickFnDebounce(<span class=\"keyword\">this</span>.pendingEventsTrigger, <span class=\"number\">200</span>, <span class=\"literal\">false</span>, <span class=\"keyword\">this</span>.selectedNodeName);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    snapshot.getSnapShotRequest();</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentDidUpdate() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  resizeCharts = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.resize();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    echarts.dispose(<span class=\"keyword\">this</span>.echartsElement);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>效果演示<br>\n<img src=\"/blogs/img/article/tree-bug-fix.gif\" alt=\"tree-bug-fix\"></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h3>前言</h3>\n<hr>\n<p>Echarts树形图Tree可以用来展示树形数据结构各节点的层级关系，比如一个使用情况就是文件系统存在多个快照，每一级快照基于上一级生成，存在父级和子级关系对应关系，且Root根只有一个，即文件系统本身，完全适用于树形图的使用场景。</p>\n<p><img src=\"/blogs/img/article/snapshot.png\" alt=\"snapshot\"></p>\n<h3>树形图功能需求以及遇到的问题分析</h3>\n<hr>\n<ol>\n<li>文件系统快照每一层级的节点支持单个选中，很多操作都是基于某一个快照节点的，比<br>\n如快照的恢复、删除、设置，考虑选中效果的区别使用label自定义富文本样式实现，但是会遇到渲染的时侯echarts一些自己的状态更新和我们我们自定义的选中状态的更新冲突问题，且V4版本echarts tree的富文本配置后也并未生效。</li>\n</ol>\n<p><img src=\"/blogs/img/article/snapshot_select.png\" alt=\"snapshot_select\"></p>\n<ol start=\"2\">\n<li>文件系统快照每一层级的节点标识(Symbol)可能不同，需要支持使用自定义图片，echarts的symbol是直接支持使用img-src和base63 img-str的，但是会遇到图片在某些时候不能完全被渲染(图片像是被设置了半透明)或直接完全不能被渲染出来的问题。</li>\n</ol>\n<p><img src=\"/blogs/img/article/tree-1.png\" alt=\"tree-1\"><br>\n<img src=\"/blogs/img/article/tree-2.png\" alt=\"tree-2\"><br>\n<img src=\"/blogs/img/article/tree-3.png\" alt=\"tree-3\"></p>\n<h3>问题I：V4版本label自定义效果设置不生效</h3>\n<hr>\n<p>series-tree.label.formatter</p>\n<blockquote>\n<p>标签内容格式器，支持字符串模板和回调函数两种形式，字符串模板与回调函数返回的字符串均支持用 \\n 换行。</p>\n</blockquote>\n<h4>字符串模板的使用</h4>\n<ol>\n<li>模板变量有：</li>\n</ol>\n<ul>\n<li>{a}：系列名。</li>\n<li>{b}：数据名。</li>\n<li>{c}：数据值。</li>\n<li>{d}：百分比。</li>\n<li>{@xxx}：数据中名为’xxx’的维度的值，如{@product}表示名为’product’` 的维度的值。</li>\n<li>{@[n]}：数据中维度n的值，如{@[3]}` 表示维度 3 的值，从 0 开始计数。</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>示例：<br>\nformatter: ‘{b}: {d}’</p>\n</li>\n<li>\n<p>回调函数格式：<br>\n(params: Object|Array) =&gt; string，<br>\n参数 params 是 formatter 需要的单个数据集，格式如下：</p>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    componentType: <span class=\"string\">'series'</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 系列类型</span></span><br><span class=\"line\">    seriesType: string,</span><br><span class=\"line\">    <span class=\"comment\">// 系列在传入的 option.series 中的 index</span></span><br><span class=\"line\">    seriesIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 系列名称</span></span><br><span class=\"line\">    seriesName: string,</span><br><span class=\"line\">    <span class=\"comment\">// 数据名，类目名</span></span><br><span class=\"line\">    name: string,</span><br><span class=\"line\">    <span class=\"comment\">// 数据在传入的 data 数组中的 index</span></span><br><span class=\"line\">    dataIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 传入的原始数据项</span></span><br><span class=\"line\">    data: <span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 传入的数据值。在多数系列下它和 data 相同。在一些系列下是 data 中的分量（如 map、radar 中）</span></span><br><span class=\"line\">    value: number|<span class=\"built_in\">Array</span>|<span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 坐标轴 encode 映射信息，</span></span><br><span class=\"line\">    <span class=\"comment\">// key 为坐标轴（如 'x' 'y' 'radius' 'angle' 等）</span></span><br><span class=\"line\">    <span class=\"comment\">// value 必然为数组，不会为 null/undefied，表示 dimension index 。</span></span><br><span class=\"line\">    <span class=\"comment\">// 其内容如：</span></span><br><span class=\"line\">    <span class=\"comment\">// &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     x: [2] // dimension index 为 2 的数据映射到 x 轴</span></span><br><span class=\"line\">    <span class=\"comment\">//     y: [0] // dimension index 为 0 的数据映射到 y 轴</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    encode: <span class=\"built_in\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 维度名列表</span></span><br><span class=\"line\">    dimensionNames: <span class=\"built_in\">Array</span>&lt;<span class=\"built_in\">String</span>&gt;,</span><br><span class=\"line\">    <span class=\"comment\">// 数据的维度 index，如 0 或 1 或 2 ...</span></span><br><span class=\"line\">    <span class=\"comment\">// 仅在雷达图中使用。</span></span><br><span class=\"line\">    dimensionIndex: number,</span><br><span class=\"line\">    <span class=\"comment\">// 数据图形的颜色</span></span><br><span class=\"line\">    color: string,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>字符串模板不生效问题1</h4>\n<p>直接将formatter自定义函数和富文本标识配置在<code>series[0].label</code>下，结果以上配置都无效，正确方法是在<code>series[0].label.normal</code>下配置富文本标识声明，而formatter需要定义在数据集data的各个数据项中，<code>normal</code>表示常规效果，与之对应的<code>emphasis</code>是鼠标划过高亮效果。<br>\n<img src=\"/blogs/img/article/tree-4.png\" alt=\"tree-4\"></p>\n<p>series-tree.label.rich支持的所有CSS属性：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  color , fontStyle , fontWeight , fontFamily , fontSize , align , verticalAlign , lineHeight , backgroundColor , borderColor , borderWidth , borderRadius , padding , shadowColor , shadowBlur , shadowOffsetX , shadowOffsetY , width , height , textBorderColor , textBorderWidth , textShadowColor , textShadowBlur , textShadowOffsetX , textShadowOffsetY</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>series-tree.data.label中配置label.formatter：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> rawTreeData = &#123;</span><br><span class=\"line\">          name: <span class=\"string\">'snapshotA'</span>,</span><br><span class=\"line\">          selected: <span class=\"literal\">false</span>, <span class=\"comment\">// 自定义选择控制属性selected</span></span><br><span class=\"line\">          collapsed: <span class=\"literal\">false</span>, <span class=\"comment\">// 覆盖组件自带的collapsed效果</span></span><br><span class=\"line\">          label: &#123;</span><br><span class=\"line\">            <span class=\"comment\">// * 直接引用上层定义的formatter即可，复用函数对象</span></span><br><span class=\"line\">            formatter: <span class=\"keyword\">this</span>.echartsInitData.series[<span class=\"number\">0</span>].label.normal.formatter,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          children: [</span><br><span class=\"line\">            ...</span><br><span class=\"line\">          ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/blogs/img/article/tree-5.png\" alt=\"tree-5\"></p>\n<h3>问题II：tree图使用自定义图片加载显示不完全</h3>\n<hr>\n<h4>解决方案1(无效)：使用对象深比较函数避免多次渲染</h4>\n<blockquote>\n<p>使用此方法在React生命周期componentDidUpdate里判断options是否发生改变，从而避免了echarts组件多次render的情况，但验证后发现避免了一些组件卡顿的情况，但也存在自定义tree 节点图片加载不完全的情况，此解决方案无效。</p>\n</blockquote>\n<ol>\n<li>Js对象深比较函数deepComparison定义</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [deepComparison 深比较]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[any]&#125; data [any]</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;[Boolean]&#125;      [是否相同]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepComparison</span>(<span class=\"params\">data1, data2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; hasOwnProperty &#125; = <span class=\"built_in\">Object</span>.prototype;</span><br><span class=\"line\">  <span class=\"comment\">// 获取变量类型</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getType = <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> d === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!(d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'null'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'date'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'regexp'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// object / array //</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'object'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d !== d) <span class=\"keyword\">return</span> <span class=\"string\">'nan'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"keyword\">typeof</span> d).toLowerCase();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 基本类型比较</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> is = <span class=\"function\">(<span class=\"params\">d1, d2, type</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'nan'</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'date'</span> || type === <span class=\"string\">'regexp'</span>) <span class=\"keyword\">return</span> d1.toString() === d2.toString();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (d1 === d2);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 递归比较</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> compare = <span class=\"function\">(<span class=\"params\">d1, d2</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type1 = getType(d1);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type2 = getType(d2);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type1 !== type2) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type1 === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> keys1 = <span class=\"built_in\">Object</span>.keys(d1).filter(<span class=\"function\"><span class=\"params\">k</span> =&gt;</span> hasOwnProperty.call(d1, k));</span><br><span class=\"line\">      <span class=\"keyword\">const</span> keys2 = <span class=\"built_in\">Object</span>.keys(d2).filter(<span class=\"function\"><span class=\"params\">k</span> =&gt;</span> hasOwnProperty.call(d2, k));</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (keys1.length !== keys2.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keys1.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (</span><br><span class=\"line\">          !keys2.includes(keys1[i]) ||</span><br><span class=\"line\">          !compare(d1[keys1[i]], d2[keys1[i]])) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> is(d1, d2, type1);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> compare(data1, data2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.深度比较函数使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidUpdate() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'update'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; treeData &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> rawTreeData = toJS(treeData);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!deepComparison(<span class=\"keyword\">this</span>.echartsTreeData, rawTreeData)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'change'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsTreeData = rawTreeData;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    optionData.series[<span class=\"number\">0</span>].data = [rawTreeData];</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(optionData);</span><br><span class=\"line\">    <span class=\"comment\">// this.echartsElement.clear();</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>解决方案2(无效)：使用base64字符串替换img url</h4>\n<blockquote>\n<p>由于方案1无效，判断可能是由于图片异步加载引起的渲染问题，对小图片尝试直接使用base64硬编码在代码里，结果发现仍然无效。</p>\n</blockquote>\n<p><img src=\"/blogs/img/article/tree-6.png\" alt=\"tree-6\"></p>\n<h4>解决方案3(有效)：禁用动画加载</h4>\n<blockquote>\n<p>由解决方案2可知，问题原因排除img异步加载的问题，问题定位到echarts组件自身的渲bug，通过多次设置setOption方法的参数，发现设置动画取消可以避免由于echarts图自身的渲染过程引起的图片加载不全问题。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> chartOption = &#123;</span><br><span class=\"line\">  animation: <span class=\"literal\">true</span>, <span class=\"comment\">// 解决渲染不全的问题</span></span><br><span class=\"line\">  tooltip: &#123;</span><br><span class=\"line\">    trigger: <span class=\"string\">'item'</span>,</span><br><span class=\"line\">    triggerOn: <span class=\"string\">'mousemove'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  series: [</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4>解决方案4(有效)：组件渲染完成后重新手动渲染</h4>\n<blockquote>\n<p>echarts初始化后的组件可以挂载钩子函数和监听一些浏览器事件，其中有一个事件名为finished，表示echarts图表本次渲染完成。既然我们之前的最后一次渲染导致图片未完全加载，那么可以在最后这次渲染完成之后再读取echarts组件自带的options然后重新渲染一次，即可解决问题，需要注意的是，finished事件可能在短时间内被调用数次，在监听时注意使用函数防抖的思想让短时间内的多次finished事件回调只执行一次。</p>\n</blockquote>\n<ol>\n<li>函数防抖声明<br>\n函数节流和函数防抖在浏览器渲染优化方面还是用得挺多：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;Function&#125; fn         [回调函数]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Time]&#125;   delayTime  [延迟时间(ms)]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;Boolean&#125;  isImediate [是否需要立即调用]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[type]&#125;   args       [回调函数传入参数]</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnDebounce</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fnObject = &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">fn, delayTime, isImediate, args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置定时器方法</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> setTimer = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        fn(args);</span><br><span class=\"line\">        <span class=\"comment\">// 清除定时器</span></span><br><span class=\"line\">        clearTimeout(timer);</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> (fnObject[fn]);</span><br><span class=\"line\">      &#125;, delayTime);</span><br><span class=\"line\"></span><br><span class=\"line\">      fnObject[fn] = &#123;</span><br><span class=\"line\">        delayTime,</span><br><span class=\"line\">        timer,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 立即调用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!delayTime || isImediate) <span class=\"keyword\">return</span> fn(args);</span><br><span class=\"line\">    <span class=\"comment\">// 判断函数是否已经在调用中</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fnObject[fn]) &#123;</span><br><span class=\"line\">      clearTimeout(timer);</span><br><span class=\"line\">      setTimer(fn, delayTime, args);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      setTimer(fn, delayTime, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>finished事件监听和函数防抖的应用<br>\n其实在此基础上还能做的优化就是在组件第一次加载自定义symbol图片后就将<code>finished</code>事件监听取消掉，减少渲染次数。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FsPageSnapShotBody</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  echartsElement= <span class=\"literal\">null</span></span><br><span class=\"line\">  echartsTreeData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 初始化事件防抖</span></span><br><span class=\"line\">  fnDebounce = fnDebounce();</span><br><span class=\"line\"></span><br><span class=\"line\">  pendingEventsTrigger = <span class=\"function\">(<span class=\"params\">nodeName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; snapshot &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement = echarts.init(<span class=\"keyword\">this</span>.refs.fsSnapShot);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(snapshot.echartsInitData);</span><br><span class=\"line\">    <span class=\"comment\">// finished事件监听</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'finished'</span>, (params) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 延迟时间设置为200ms</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fnDebounce(<span class=\"keyword\">this</span>.pendingEventsTrigger, <span class=\"number\">200</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentDidUpdate() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  resizeCharts = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.resize();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    echarts.dispose(<span class=\"keyword\">this</span>.echartsElement);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3>问题III：tree图自定义节点选中效果和组件自带渲染效果冲突</h3>\n<hr>\n<p>节点选中效果原理是监听echarts的<code>dblclick</code>双击事件，双击后改变<code>options.series[0].data</code>数据项里的<code>selected</code>属性配置，然后label.formatter根据此属性能够应用富文本类名里声明的高亮或普通文本的类名。值得注意的是echarts渲染时自身已经对过长层级的tree数据做了渲染优化，导致过深层级的展开/折叠状态不被控制，每次重新渲染后会导致已经折叠的树层级展开或是已经展开的树层级折叠，非常影响用户操作，因此需要把树层级数据每一层的折叠纳入强制属性控制状态，即在<code>options.series[0].data</code>中额外声明<code>collapsed:[Boolean]</code>参数，同时禁用tree自带的折叠/展开控制。</p>\n<h4>冲突1：在设置了echarts渲染动画延迟更新的情况下节点选中效果无效</h4>\n<p>如果直接通过dblclick双击事件触发函数设置某个节点选中状态的属性<code>selected:true</code>，那么表现为：<code>selected</code>状态不常驻，变成了类似<code>mouseover</code>的鼠标划过状态触发；</p>\n<ol>\n<li>动画延迟更新属性声明</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Tree的外层数据 */</span></span><br><span class=\"line\">echartsInitData= &#123;</span><br><span class=\"line\">    tooltip: &#123;</span><br><span class=\"line\">      trigger: <span class=\"string\">'item'</span>,</span><br><span class=\"line\">      triggerOn: <span class=\"string\">'mousemove'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    series: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        &#123;...&#125;,</span><br><span class=\"line\">        leaves: &#123;...&#125;,</span><br><span class=\"line\">        expandAndCollapse: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        animationDuration: <span class=\"number\">100</span>,</span><br><span class=\"line\">        animationDelayUpdate: <span class=\"number\">300</span>, <span class=\"comment\">// 动画延迟更新</span></span><br><span class=\"line\">        animationDurationUpdate: <span class=\"number\">400</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>冲突效果表现</li>\n</ol>\n<p><img src=\"/blogs/img/article/tree-bug1.gif\" alt=\"tree-bug1\"></p>\n<h4>冲突2：鼠标的悬浮操作导致选中效果无效</h4>\n<p>按照上述表现，我尝试在触发函数更新tree节点选中状态之前设置一个延迟，延迟时间大于tree组件的动画延迟更新设置时间(上面设置为了<code>300ms</code>)，结果发现：如果在双击tree节点的时候鼠标一直放在节点上的话，鼠标移开后，表现和上面一样，如果双击了tree节点之后马上把鼠标从该节点移开的话则选中状态正常(太不容易了！)，推测是我们触发echarts组件更新的时候，echarts自身的组件状态管理和我们自定义的组件更新函数(以上表现为设置tree节点数据的<code>selected</code>属性触发label.formatter的渲染效果变化)两者冲突。</p>\n<ol>\n<li>设置<code>selected</code>属性更改函数的延迟时间</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* React组件自定义方法-选中一个元素 */</span></span><br><span class=\"line\">onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name &#125; = e.data;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selectedNodeName = name;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.snapshot.chooseSnapShot(name);</span><br><span class=\"line\">    &#125;, <span class=\"number\">400</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>冲突效果表现<br>\n<img src=\"/blogs/img/article/tree-bug2.gif\" alt=\"tree-bug2\"></li>\n</ol>\n<h4>解决方法</h4>\n<p>方法同于上面提到的<code>finished事件监听和函数防抖的应用</code>，在echarts组件最终渲染完成后增加一次额外渲染解决问题，但是也仍然会有<code>selected</code>状态稍稍延迟更新和<code>selected</code>状态闪烁一次的问题，不妨碍使用，但是应该有更优的解决办法尚待实现。</p>\n<ol>\n<li>代码概览</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FsPageSnapShotBody</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  echartsElement= <span class=\"literal\">null</span></span><br><span class=\"line\">  echartsTreeData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  selectedNodeName = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 初始化事件防抖</span></span><br><span class=\"line\">  dblclickFnDebounce = fnDebounce();</span><br><span class=\"line\"></span><br><span class=\"line\">  pendingEventsTrigger = <span class=\"function\">(<span class=\"params\">nodeName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> optionData = <span class=\"keyword\">this</span>.echartsElement.getOption();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(optionData, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; snapshot &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement = echarts.init(<span class=\"keyword\">this</span>.refs.fsSnapShot);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.setOption(snapshot.echartsInitData);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'dblclick'</span>, <span class=\"keyword\">this</span>.onDoubleClickChart);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'click'</span>, <span class=\"keyword\">this</span>.onClickChart);</span><br><span class=\"line\">    <span class=\"comment\">// finished事件监听</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.on(<span class=\"string\">'finished'</span>, (params) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.selectedNodeName) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 防抖延迟时间设置为200ms</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dblclickFnDebounce(<span class=\"keyword\">this</span>.pendingEventsTrigger, <span class=\"number\">200</span>, <span class=\"literal\">false</span>, <span class=\"keyword\">this</span>.selectedNodeName);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    snapshot.getSnapShotRequest();</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentDidUpdate() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  resizeCharts = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.echartsElement.resize();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    echarts.dispose(<span class=\"keyword\">this</span>.echartsElement);</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'resize'</span>, <span class=\"keyword\">this</span>.resizeCharts);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  onDoubleClickChart = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>效果演示<br>\n<img src=\"/blogs/img/article/tree-bug-fix.gif\" alt=\"tree-bug-fix\"></li>\n</ol>\n"},{"title":"Linux Mint18.3 日常软件安装配置","catalog":true,"toc_nav_num":true,"date":"2018-04-04T08:30:35.000Z","subtitle":"linux mint","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2018-04-04T08:30:35.000Z","top":null,"_content":"\n![city](/blogs/img/article/city.jpg)\n>实装机器是linux mint18.3，理论上也适用于ubuntu\n\n#### contents\n1. QQ 8.1 的 安装配置\n2. 微信的安装配置\n3. 印象笔记的安装配置\n4. 安装 Mac-os 主题\n5. 怎样自由上网(翻墙)\n6. 安装办公软件wps\n7. 实用工具推荐：tmux、stacer、oh-my-zsh、SmartGit、Docky\n8. chrome实用插件整理\n\n#### QQ 8.1 的 安装配置\n---------------------\n\n##### 方案一： Wine + deepingCrossover + deepinQQ 8.1\n>日常使用基本没有bug，能够保存密码自动登录  \n\n1. Wine安装  \nWine(Wine Is Not Emulator)，Wine是一个在x86、x86-64上容许类Unix操作系统在X Window System下运行Microsoft Windows程式的软件。  \n跟着执行几个命令即可，安装可能有点慢，一个小时内能搞定吧。[-->阅读安装步骤](https://wiki.winehq.org/Ubuntu)  \n\n2. deepinCrossover安装  \n如果是64位系统，先添加对32位库的支持：  \n~~~sh\nsudo dpkg --add-architecture i386\nsudo apt-get update\n~~~\n可能需要添加下列32位库：\n~~~sh\nsudo apt-get install lib32z1 lib32ncurses5  \n~~~\n[crossover下载地址](https://pan.baidu.com/disk/home?#/all?vmode=list&path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2Fcrossover-%E4%BB%A5%E5%8F%8Aqq%E5%AE%89%E8%A3%85)，到我的网盘下载crossover-15_15.0.3-1_all.deb、crossover-15_15.0.3-1_all-free.deb、deepin-crossover-helper_1.0deepin0_all.deb三个文件，在第一步的Wine安装完毕后按照以上下载说明的顺序依次安装三个deb包。\n\n3. deepinQQ 8.1安装  \ndeepinCrossover安装好后，到刚才下载三个deb包的地址那儿继续下载第四个deb包:apps.com.qq.im_8.1.17255deepin11_i386.deb，下载好后安装即可正常使用QQ。\n\n##### 方案二： 绿色无需安装精简版QQ\n> 缺点；不能保存密码，每次登录都要输入密码，优点：安装步骤忽略为零  \n\n* 下载地址：[QQ.AppImage](https://pan.baidu.com/disk/home?#/all?vmode=list&path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2FQQ_Linux)下载好后直接双击并允许可执行权限即可。\n\n#### 微信的安装配置\n----------------\n>微信官方没有客户端，都是第三方封装的网页版微信，够用了，发送文件都行  \n\n##### 方案一：electron-wechat\n[下载地址](https://github.com/geeeeeeeeek/electronic-wechat/releases)，到github找自己要安装的版本的tar包，下载好后，使用tar -xf 命令解压，在把解压目录内的 electronic-wechat 可执行程序 赋予可执行权限，相关命令是 sudo chmod 755 ./electronic-wechat，最后再建立两个软链接到 /usr/local/bin 和 /home/你的用户名/Desktop/ 目录即可，相关命令是： sudo ln -s path/to/electronic-wechat path/to/目标地址，这样做的目的是：让你可以从终端启动微信，并且在桌面建立了一个微信的快捷方式，直接点击即可运行微信。  \n\n##### 方案二：weweChat\n[下载地址](https://github.com/trazyn/weweChat/releases)，到这个地址找wewechat的相关deb包下载安装即可，我用的就是这个版本，UI和上面那个有点差别，还不错的。  \n\n#### 印象笔记的安装配置\n--------------------\n>印象笔记官方也没有开发Linux版本，说是维护成本太大，但是开放了API让第三方程序或是网页可以直接调用，所以有了我们下面这个使用Electron技术封装的网页版印象笔记Whatever，跟网页版看着一样，只不过有了一层桌面软件的壳，值得一提的是 我觉得网页版印象笔记更好用，界面也更现代化，这儿提供一个[Electron的应用中心](https://electronjs.org/apps)，里面很多第三方开发者的app，大部分可以Linux使用，自己找找，说不定有你喜欢的，最后附上Whatever的[下载地址](https://electronjs.org/apps/whatever)，选择适合你的版本下载安装即可。\n\n#### 安装 Mac-os 主题\n-------------------\n* 安装到Linux Mint  \n~~~sh\nsudo add-apt-repository ppa:noobslab/macbuntu\nsudo apt update\nsudo apt install macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts-v7\n~~~\n\n* 从Linux Mint卸载  \n~~~sh\nsudo add-apt-repository -r ppa:noobslab/macbuntu\nsudo apt update\nsudo apt remove macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts\n-v7\n~~~\n\n安装好了要自己去设置界面切换啊～\n\n#### 怎样自由上网(翻墙)\n--------------------\n1. 从vultr买外国云主机，最低$2.5一个月，基本上是所有服务商里面最便宜的了，配置也是最低[官方地址](https://my.vultr.com/)  \n2. 登录自己的服务器  \n3. 服务器一键安装shadowsocks服务 [参考地址](https://xyzardq.github.io/2017/03/07/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BAshadowsocks%E5%8F%8A%E4%BC%98%E5%8C%96/)  \n4. 自己电脑安装Shadowsocks-Qt5，设置好服务器地址，端口和本地代理地址和端口  \n~~~sh\nsudo add-apt-repository ppa:hzwhuang/ss-qt5\nsudo apt-get update\nsudo apt-get install shadowsocks-qt5\n~~~\n5. chrome安装SwitchyOmega插件，很方便的代理插件，Firefox上也有相应的版本，安装好后设置ip和端口 映射到第四步Shadowsocks-Qt5里设置的本地ip和端口即可享受自由的上网生活，附上一篇[教程](http://www.cylong.com/blog/2017/04/09/chrome-SwitchyOmega/)\n\n#### 安装办公软件wps\n------------------\n>Linux上最好用的办公软件，没有之一，无奈官方宣布暂时不更新了，linux mint自带的Liboffice不太好用，格式跟office不太兼容，[wps官网下载直达](http://linux.wps.cn/)\n\n#### 实用工具推荐\n---------------\n1. tmux终端工具\n>Tmux 简单来说就是终端里的『窗口管理器』，强烈推荐。附上\n[使用教程](http://wdxtub.com/2016/03/30/tmux-guide/)\n\n2. stacer系统管理工具\n>系统进程可视化管理和垃圾清理工具，就是相当于Linux上的电脑管家，还能查看系统占用，卸载软件包，配置开机启动，管理apt软件源等等，非常强大好用，附上[下载地址](https://sourceforge.net/projects/stacer/)\n\n3. oh-my-zsh终端模拟器\n>支持插件、主题、自定义配置的强大的终端模拟器，用来替代自带的bash，附上[安装教程](http://yijiebuyi.com/blog/b9b5e1ebb719f22475c38c4819ab8151.html)\n\n4. SmartGit仓库管理可视化工具\n>大名鼎鼎的分布式版本控制软件git的可视化工具，免费又强大，只是界面是英文的，不过我想你应该不太会介意\n\n5. Docky  \n>漂亮的dock工具栏，方便酷炫实用  \n\n6. Peek\n>强大的屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件  \n\n7. Inkscape\n>跨平台免费强大的svg图片绘制工具  \n\n#### chrome实用插件整理\n---------------------\n1. infinity标签页  \n>浏览器首页管理器，可以添加很多网站的快捷进入图标，方便美观\n2. Octotree  \n>让你在浏览github仓库时可以利用左侧的文件资源浏览树更方便地查看项目结构和页面跳转\n3. Postman  \n>api测试神器，很强大，甚至能发送带cookie的请求，各种请求、响应编辑功能也非常实用\n4. SwitchyOmega  \n>大家都用的代理软件，不说了\n5. 印象笔记剪藏  \n>随时随地把网络资源保存到你的笔记本里\n6. SimpRead - 简阅  \n>让浏览器支持纯净的阅读模式\n7. Full Page Screen Capture  \n>全屏截图，真的是全屏，你的浏览器标签页有多长，它就能截多长\n8. 高效网页截图编辑插件\n>另一个好用的截图插件\n\n#### 感谢阅读\n有时间还会继续更新本文\n","source":"_posts/linux-mint-configure.md","raw":"---\ntitle: \"Linux Mint18.3 日常软件安装配置\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-04 16:30:35\nsubtitle: \"linux mint\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Linux\n- Mint\ncatagories:\n- Linux\nupdateDate: 2018-04-04 16:30:35\ntop: \n---\n\n![city](/blogs/img/article/city.jpg)\n>实装机器是linux mint18.3，理论上也适用于ubuntu\n\n#### contents\n1. QQ 8.1 的 安装配置\n2. 微信的安装配置\n3. 印象笔记的安装配置\n4. 安装 Mac-os 主题\n5. 怎样自由上网(翻墙)\n6. 安装办公软件wps\n7. 实用工具推荐：tmux、stacer、oh-my-zsh、SmartGit、Docky\n8. chrome实用插件整理\n\n#### QQ 8.1 的 安装配置\n---------------------\n\n##### 方案一： Wine + deepingCrossover + deepinQQ 8.1\n>日常使用基本没有bug，能够保存密码自动登录  \n\n1. Wine安装  \nWine(Wine Is Not Emulator)，Wine是一个在x86、x86-64上容许类Unix操作系统在X Window System下运行Microsoft Windows程式的软件。  \n跟着执行几个命令即可，安装可能有点慢，一个小时内能搞定吧。[-->阅读安装步骤](https://wiki.winehq.org/Ubuntu)  \n\n2. deepinCrossover安装  \n如果是64位系统，先添加对32位库的支持：  \n~~~sh\nsudo dpkg --add-architecture i386\nsudo apt-get update\n~~~\n可能需要添加下列32位库：\n~~~sh\nsudo apt-get install lib32z1 lib32ncurses5  \n~~~\n[crossover下载地址](https://pan.baidu.com/disk/home?#/all?vmode=list&path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2Fcrossover-%E4%BB%A5%E5%8F%8Aqq%E5%AE%89%E8%A3%85)，到我的网盘下载crossover-15_15.0.3-1_all.deb、crossover-15_15.0.3-1_all-free.deb、deepin-crossover-helper_1.0deepin0_all.deb三个文件，在第一步的Wine安装完毕后按照以上下载说明的顺序依次安装三个deb包。\n\n3. deepinQQ 8.1安装  \ndeepinCrossover安装好后，到刚才下载三个deb包的地址那儿继续下载第四个deb包:apps.com.qq.im_8.1.17255deepin11_i386.deb，下载好后安装即可正常使用QQ。\n\n##### 方案二： 绿色无需安装精简版QQ\n> 缺点；不能保存密码，每次登录都要输入密码，优点：安装步骤忽略为零  \n\n* 下载地址：[QQ.AppImage](https://pan.baidu.com/disk/home?#/all?vmode=list&path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2FQQ_Linux)下载好后直接双击并允许可执行权限即可。\n\n#### 微信的安装配置\n----------------\n>微信官方没有客户端，都是第三方封装的网页版微信，够用了，发送文件都行  \n\n##### 方案一：electron-wechat\n[下载地址](https://github.com/geeeeeeeeek/electronic-wechat/releases)，到github找自己要安装的版本的tar包，下载好后，使用tar -xf 命令解压，在把解压目录内的 electronic-wechat 可执行程序 赋予可执行权限，相关命令是 sudo chmod 755 ./electronic-wechat，最后再建立两个软链接到 /usr/local/bin 和 /home/你的用户名/Desktop/ 目录即可，相关命令是： sudo ln -s path/to/electronic-wechat path/to/目标地址，这样做的目的是：让你可以从终端启动微信，并且在桌面建立了一个微信的快捷方式，直接点击即可运行微信。  \n\n##### 方案二：weweChat\n[下载地址](https://github.com/trazyn/weweChat/releases)，到这个地址找wewechat的相关deb包下载安装即可，我用的就是这个版本，UI和上面那个有点差别，还不错的。  \n\n#### 印象笔记的安装配置\n--------------------\n>印象笔记官方也没有开发Linux版本，说是维护成本太大，但是开放了API让第三方程序或是网页可以直接调用，所以有了我们下面这个使用Electron技术封装的网页版印象笔记Whatever，跟网页版看着一样，只不过有了一层桌面软件的壳，值得一提的是 我觉得网页版印象笔记更好用，界面也更现代化，这儿提供一个[Electron的应用中心](https://electronjs.org/apps)，里面很多第三方开发者的app，大部分可以Linux使用，自己找找，说不定有你喜欢的，最后附上Whatever的[下载地址](https://electronjs.org/apps/whatever)，选择适合你的版本下载安装即可。\n\n#### 安装 Mac-os 主题\n-------------------\n* 安装到Linux Mint  \n~~~sh\nsudo add-apt-repository ppa:noobslab/macbuntu\nsudo apt update\nsudo apt install macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts-v7\n~~~\n\n* 从Linux Mint卸载  \n~~~sh\nsudo add-apt-repository -r ppa:noobslab/macbuntu\nsudo apt update\nsudo apt remove macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts\n-v7\n~~~\n\n安装好了要自己去设置界面切换啊～\n\n#### 怎样自由上网(翻墙)\n--------------------\n1. 从vultr买外国云主机，最低$2.5一个月，基本上是所有服务商里面最便宜的了，配置也是最低[官方地址](https://my.vultr.com/)  \n2. 登录自己的服务器  \n3. 服务器一键安装shadowsocks服务 [参考地址](https://xyzardq.github.io/2017/03/07/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BAshadowsocks%E5%8F%8A%E4%BC%98%E5%8C%96/)  \n4. 自己电脑安装Shadowsocks-Qt5，设置好服务器地址，端口和本地代理地址和端口  \n~~~sh\nsudo add-apt-repository ppa:hzwhuang/ss-qt5\nsudo apt-get update\nsudo apt-get install shadowsocks-qt5\n~~~\n5. chrome安装SwitchyOmega插件，很方便的代理插件，Firefox上也有相应的版本，安装好后设置ip和端口 映射到第四步Shadowsocks-Qt5里设置的本地ip和端口即可享受自由的上网生活，附上一篇[教程](http://www.cylong.com/blog/2017/04/09/chrome-SwitchyOmega/)\n\n#### 安装办公软件wps\n------------------\n>Linux上最好用的办公软件，没有之一，无奈官方宣布暂时不更新了，linux mint自带的Liboffice不太好用，格式跟office不太兼容，[wps官网下载直达](http://linux.wps.cn/)\n\n#### 实用工具推荐\n---------------\n1. tmux终端工具\n>Tmux 简单来说就是终端里的『窗口管理器』，强烈推荐。附上\n[使用教程](http://wdxtub.com/2016/03/30/tmux-guide/)\n\n2. stacer系统管理工具\n>系统进程可视化管理和垃圾清理工具，就是相当于Linux上的电脑管家，还能查看系统占用，卸载软件包，配置开机启动，管理apt软件源等等，非常强大好用，附上[下载地址](https://sourceforge.net/projects/stacer/)\n\n3. oh-my-zsh终端模拟器\n>支持插件、主题、自定义配置的强大的终端模拟器，用来替代自带的bash，附上[安装教程](http://yijiebuyi.com/blog/b9b5e1ebb719f22475c38c4819ab8151.html)\n\n4. SmartGit仓库管理可视化工具\n>大名鼎鼎的分布式版本控制软件git的可视化工具，免费又强大，只是界面是英文的，不过我想你应该不太会介意\n\n5. Docky  \n>漂亮的dock工具栏，方便酷炫实用  \n\n6. Peek\n>强大的屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件  \n\n7. Inkscape\n>跨平台免费强大的svg图片绘制工具  \n\n#### chrome实用插件整理\n---------------------\n1. infinity标签页  \n>浏览器首页管理器，可以添加很多网站的快捷进入图标，方便美观\n2. Octotree  \n>让你在浏览github仓库时可以利用左侧的文件资源浏览树更方便地查看项目结构和页面跳转\n3. Postman  \n>api测试神器，很强大，甚至能发送带cookie的请求，各种请求、响应编辑功能也非常实用\n4. SwitchyOmega  \n>大家都用的代理软件，不说了\n5. 印象笔记剪藏  \n>随时随地把网络资源保存到你的笔记本里\n6. SimpRead - 简阅  \n>让浏览器支持纯净的阅读模式\n7. Full Page Screen Capture  \n>全屏截图，真的是全屏，你的浏览器标签页有多长，它就能截多长\n8. 高效网页截图编辑插件\n>另一个好用的截图插件\n\n#### 感谢阅读\n有时间还会继续更新本文\n","slug":"linux-mint-configure","published":1,"updated":"2020-03-10T16:51:27.253Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn0000ba8951uaik56x","content":"<p><img src=\"/blogs/img/article/city.jpg\" alt=\"city\"></p>\n<blockquote>\n<p>实装机器是linux mint18.3，理论上也适用于ubuntu</p>\n</blockquote>\n<h4 id=\"contents\">contents</h4>\n<ol>\n<li>QQ 8.1 的 安装配置</li>\n<li>微信的安装配置</li>\n<li>印象笔记的安装配置</li>\n<li>安装 Mac-os 主题</li>\n<li>怎样自由上网(翻墙)</li>\n<li>安装办公软件wps</li>\n<li>实用工具推荐：tmux、stacer、oh-my-zsh、SmartGit、Docky</li>\n<li>chrome实用插件整理</li>\n</ol>\n<h4 id=\"qq-81-的-安装配置\">QQ 8.1 的 安装配置</h4>\n<hr>\n<h5 id=\"方案一-wine-deepingcrossover-deepinqq-81\">方案一： Wine + deepingCrossover + deepinQQ 8.1</h5>\n<blockquote>\n<p>日常使用基本没有bug，能够保存密码自动登录</p>\n</blockquote>\n<ol>\n<li>\n<p>Wine安装<br>\nWine(Wine Is Not Emulator)，Wine是一个在x86、x86-64上容许类Unix操作系统在X Window System下运行Microsoft Windows程式的软件。<br>\n跟着执行几个命令即可，安装可能有点慢，一个小时内能搞定吧。<a href=\"https://wiki.winehq.org/Ubuntu\" target=\"_blank\" rel=\"noopener\">–&gt;阅读安装步骤</a></p>\n</li>\n<li>\n<p>deepinCrossover安装<br>\n如果是64位系统，先添加对32位库的支持：</p>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg --add-architecture i386</span><br><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>可能需要添加下列32位库：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install lib32z1 lib32ncurses5</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://pan.baidu.com/disk/home?#/all?vmode=list&amp;path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2Fcrossover-%E4%BB%A5%E5%8F%8Aqq%E5%AE%89%E8%A3%85\" target=\"_blank\" rel=\"noopener\">crossover下载地址</a>，到我的网盘下载crossover-15_15.0.3-1_all.deb、crossover-15_15.0.3-1_all-free.deb、deepin-crossover-helper_1.0deepin0_all.deb三个文件，在第一步的Wine安装完毕后按照以上下载说明的顺序依次安装三个deb包。</p>\n<ol start=\"3\">\n<li>deepinQQ 8.1安装<br>\ndeepinCrossover安装好后，到刚才下载三个deb包的地址那儿继续下载第四个deb包:apps.com.qq.im_8.1.17255deepin11_i386.deb，下载好后安装即可正常使用QQ。</li>\n</ol>\n<h5 id=\"方案二-绿色无需安装精简版qq\">方案二： 绿色无需安装精简版QQ</h5>\n<blockquote>\n<p>缺点；不能保存密码，每次登录都要输入密码，优点：安装步骤忽略为零</p>\n</blockquote>\n<ul>\n<li>下载地址：<a href=\"https://pan.baidu.com/disk/home?#/all?vmode=list&amp;path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2FQQ_Linux\" target=\"_blank\" rel=\"noopener\">QQ.AppImage</a>下载好后直接双击并允许可执行权限即可。</li>\n</ul>\n<h4 id=\"微信的安装配置\">微信的安装配置</h4>\n<hr>\n<blockquote>\n<p>微信官方没有客户端，都是第三方封装的网页版微信，够用了，发送文件都行</p>\n</blockquote>\n<h5 id=\"方案一electron-wechat\">方案一：electron-wechat</h5>\n<p><a href=\"https://github.com/geeeeeeeeek/electronic-wechat/releases\" target=\"_blank\" rel=\"noopener\">下载地址</a>，到github找自己要安装的版本的tar包，下载好后，使用tar -xf 命令解压，在把解压目录内的 electronic-wechat 可执行程序 赋予可执行权限，相关命令是 sudo chmod 755 ./electronic-wechat，最后再建立两个软链接到 /usr/local/bin 和 /home/你的用户名/Desktop/ 目录即可，相关命令是： sudo ln -s path/to/electronic-wechat path/to/目标地址，这样做的目的是：让你可以从终端启动微信，并且在桌面建立了一个微信的快捷方式，直接点击即可运行微信。</p>\n<h5 id=\"方案二wewechat\">方案二：weweChat</h5>\n<p><a href=\"https://github.com/trazyn/weweChat/releases\" target=\"_blank\" rel=\"noopener\">下载地址</a>，到这个地址找wewechat的相关deb包下载安装即可，我用的就是这个版本，UI和上面那个有点差别，还不错的。</p>\n<h4 id=\"印象笔记的安装配置\">印象笔记的安装配置</h4>\n<hr>\n<blockquote>\n<p>印象笔记官方也没有开发Linux版本，说是维护成本太大，但是开放了API让第三方程序或是网页可以直接调用，所以有了我们下面这个使用Electron技术封装的网页版印象笔记Whatever，跟网页版看着一样，只不过有了一层桌面软件的壳，值得一提的是 我觉得网页版印象笔记更好用，界面也更现代化，这儿提供一个<a href=\"https://electronjs.org/apps\" target=\"_blank\" rel=\"noopener\">Electron的应用中心</a>，里面很多第三方开发者的app，大部分可以Linux使用，自己找找，说不定有你喜欢的，最后附上Whatever的<a href=\"https://electronjs.org/apps/whatever\" target=\"_blank\" rel=\"noopener\">下载地址</a>，选择适合你的版本下载安装即可。</p>\n</blockquote>\n<h4 id=\"安装-mac-os-主题\">安装 Mac-os 主题</h4>\n<hr>\n<ul>\n<li>安装到Linux Mint</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:noobslab/macbuntu</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts-v7</span><br></pre></td></tr></table></figure>\n<ul>\n<li>从Linux Mint卸载</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository -r ppa:noobslab/macbuntu</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt remove macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts</span><br><span class=\"line\">-v7</span><br></pre></td></tr></table></figure>\n<p>安装好了要自己去设置界面切换啊～</p>\n<h4 id=\"怎样自由上网翻墙\">怎样自由上网(翻墙)</h4>\n<hr>\n<ol>\n<li>从vultr买外国云主机，最低$2.5一个月，基本上是所有服务商里面最便宜的了，配置也是最低<a href=\"https://my.vultr.com/\" target=\"_blank\" rel=\"noopener\">官方地址</a></li>\n<li>登录自己的服务器</li>\n<li>服务器一键安装shadowsocks服务 <a href=\"https://xyzardq.github.io/2017/03/07/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BAshadowsocks%E5%8F%8A%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"noopener\">参考地址</a></li>\n<li>自己电脑安装Shadowsocks-Qt5，设置好服务器地址，端口和本地代理地址和端口</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install shadowsocks-qt5</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>chrome安装SwitchyOmega插件，很方便的代理插件，Firefox上也有相应的版本，安装好后设置ip和端口 映射到第四步Shadowsocks-Qt5里设置的本地ip和端口即可享受自由的上网生活，附上一篇<a href=\"http://www.cylong.com/blog/2017/04/09/chrome-SwitchyOmega/\" target=\"_blank\" rel=\"noopener\">教程</a></li>\n</ol>\n<h4 id=\"安装办公软件wps\">安装办公软件wps</h4>\n<hr>\n<blockquote>\n<p>Linux上最好用的办公软件，没有之一，无奈官方宣布暂时不更新了，linux mint自带的Liboffice不太好用，格式跟office不太兼容，<a href=\"http://linux.wps.cn/\" target=\"_blank\" rel=\"noopener\">wps官网下载直达</a></p>\n</blockquote>\n<h4 id=\"实用工具推荐\">实用工具推荐</h4>\n<hr>\n<ol>\n<li>tmux终端工具</li>\n</ol>\n<blockquote>\n<p>Tmux 简单来说就是终端里的『窗口管理器』，强烈推荐。附上<br>\n<a href=\"http://wdxtub.com/2016/03/30/tmux-guide/\" target=\"_blank\" rel=\"noopener\">使用教程</a></p>\n</blockquote>\n<ol start=\"2\">\n<li>stacer系统管理工具</li>\n</ol>\n<blockquote>\n<p>系统进程可视化管理和垃圾清理工具，就是相当于Linux上的电脑管家，还能查看系统占用，卸载软件包，配置开机启动，管理apt软件源等等，非常强大好用，附上<a href=\"https://sourceforge.net/projects/stacer/\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n</blockquote>\n<ol start=\"3\">\n<li>oh-my-zsh终端模拟器</li>\n</ol>\n<blockquote>\n<p>支持插件、主题、自定义配置的强大的终端模拟器，用来替代自带的bash，附上<a href=\"http://yijiebuyi.com/blog/b9b5e1ebb719f22475c38c4819ab8151.html\" target=\"_blank\" rel=\"noopener\">安装教程</a></p>\n</blockquote>\n<ol start=\"4\">\n<li>SmartGit仓库管理可视化工具</li>\n</ol>\n<blockquote>\n<p>大名鼎鼎的分布式版本控制软件git的可视化工具，免费又强大，只是界面是英文的，不过我想你应该不太会介意</p>\n</blockquote>\n<ol start=\"5\">\n<li>Docky</li>\n</ol>\n<blockquote>\n<p>漂亮的dock工具栏，方便酷炫实用</p>\n</blockquote>\n<ol start=\"6\">\n<li>Peek</li>\n</ol>\n<blockquote>\n<p>强大的屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件</p>\n</blockquote>\n<ol start=\"7\">\n<li>Inkscape</li>\n</ol>\n<blockquote>\n<p>跨平台免费强大的svg图片绘制工具</p>\n</blockquote>\n<h4 id=\"chrome实用插件整理\">chrome实用插件整理</h4>\n<hr>\n<ol>\n<li>infinity标签页</li>\n</ol>\n<blockquote>\n<p>浏览器首页管理器，可以添加很多网站的快捷进入图标，方便美观</p>\n</blockquote>\n<ol start=\"2\">\n<li>Octotree</li>\n</ol>\n<blockquote>\n<p>让你在浏览github仓库时可以利用左侧的文件资源浏览树更方便地查看项目结构和页面跳转</p>\n</blockquote>\n<ol start=\"3\">\n<li>Postman</li>\n</ol>\n<blockquote>\n<p>api测试神器，很强大，甚至能发送带cookie的请求，各种请求、响应编辑功能也非常实用</p>\n</blockquote>\n<ol start=\"4\">\n<li>SwitchyOmega</li>\n</ol>\n<blockquote>\n<p>大家都用的代理软件，不说了</p>\n</blockquote>\n<ol start=\"5\">\n<li>印象笔记剪藏</li>\n</ol>\n<blockquote>\n<p>随时随地把网络资源保存到你的笔记本里</p>\n</blockquote>\n<ol start=\"6\">\n<li>SimpRead - 简阅</li>\n</ol>\n<blockquote>\n<p>让浏览器支持纯净的阅读模式</p>\n</blockquote>\n<ol start=\"7\">\n<li>Full Page Screen Capture</li>\n</ol>\n<blockquote>\n<p>全屏截图，真的是全屏，你的浏览器标签页有多长，它就能截多长</p>\n</blockquote>\n<ol start=\"8\">\n<li>高效网页截图编辑插件</li>\n</ol>\n<blockquote>\n<p>另一个好用的截图插件</p>\n</blockquote>\n<h4 id=\"感谢阅读\">感谢阅读</h4>\n<p>有时间还会继续更新本文</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/city.jpg\" alt=\"city\"></p>\n<blockquote>\n<p>实装机器是linux mint18.3，理论上也适用于ubuntu</p>\n</blockquote>\n<h4>contents</h4>\n<ol>\n<li>QQ 8.1 的 安装配置</li>\n<li>微信的安装配置</li>\n<li>印象笔记的安装配置</li>\n<li>安装 Mac-os 主题</li>\n<li>怎样自由上网(翻墙)</li>\n<li>安装办公软件wps</li>\n<li>实用工具推荐：tmux、stacer、oh-my-zsh、SmartGit、Docky</li>\n<li>chrome实用插件整理</li>\n</ol>\n<h4>QQ 8.1 的 安装配置</h4>\n<hr>\n<h5>方案一： Wine + deepingCrossover + deepinQQ 8.1</h5>\n<blockquote>\n<p>日常使用基本没有bug，能够保存密码自动登录</p>\n</blockquote>\n<ol>\n<li>\n<p>Wine安装<br>\nWine(Wine Is Not Emulator)，Wine是一个在x86、x86-64上容许类Unix操作系统在X Window System下运行Microsoft Windows程式的软件。<br>\n跟着执行几个命令即可，安装可能有点慢，一个小时内能搞定吧。<a href=\"https://wiki.winehq.org/Ubuntu\" target=\"_blank\" rel=\"noopener\">–&gt;阅读安装步骤</a></p>\n</li>\n<li>\n<p>deepinCrossover安装<br>\n如果是64位系统，先添加对32位库的支持：</p>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg --add-architecture i386</span><br><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>可能需要添加下列32位库：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install lib32z1 lib32ncurses5</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://pan.baidu.com/disk/home?#/all?vmode=list&amp;path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2Fcrossover-%E4%BB%A5%E5%8F%8Aqq%E5%AE%89%E8%A3%85\" target=\"_blank\" rel=\"noopener\">crossover下载地址</a>，到我的网盘下载crossover-15_15.0.3-1_all.deb、crossover-15_15.0.3-1_all-free.deb、deepin-crossover-helper_1.0deepin0_all.deb三个文件，在第一步的Wine安装完毕后按照以上下载说明的顺序依次安装三个deb包。</p>\n<ol start=\"3\">\n<li>deepinQQ 8.1安装<br>\ndeepinCrossover安装好后，到刚才下载三个deb包的地址那儿继续下载第四个deb包:apps.com.qq.im_8.1.17255deepin11_i386.deb，下载好后安装即可正常使用QQ。</li>\n</ol>\n<h5>方案二： 绿色无需安装精简版QQ</h5>\n<blockquote>\n<p>缺点；不能保存密码，每次登录都要输入密码，优点：安装步骤忽略为零</p>\n</blockquote>\n<ul>\n<li>下载地址：<a href=\"https://pan.baidu.com/disk/home?#/all?vmode=list&amp;path=%2F%E5%B7%A5%E5%85%B7%E5%92%8C%E8%BD%AF%E4%BB%B6%2FQQ_Linux\" target=\"_blank\" rel=\"noopener\">QQ.AppImage</a>下载好后直接双击并允许可执行权限即可。</li>\n</ul>\n<h4>微信的安装配置</h4>\n<hr>\n<blockquote>\n<p>微信官方没有客户端，都是第三方封装的网页版微信，够用了，发送文件都行</p>\n</blockquote>\n<h5>方案一：electron-wechat</h5>\n<p><a href=\"https://github.com/geeeeeeeeek/electronic-wechat/releases\" target=\"_blank\" rel=\"noopener\">下载地址</a>，到github找自己要安装的版本的tar包，下载好后，使用tar -xf 命令解压，在把解压目录内的 electronic-wechat 可执行程序 赋予可执行权限，相关命令是 sudo chmod 755 ./electronic-wechat，最后再建立两个软链接到 /usr/local/bin 和 /home/你的用户名/Desktop/ 目录即可，相关命令是： sudo ln -s path/to/electronic-wechat path/to/目标地址，这样做的目的是：让你可以从终端启动微信，并且在桌面建立了一个微信的快捷方式，直接点击即可运行微信。</p>\n<h5>方案二：weweChat</h5>\n<p><a href=\"https://github.com/trazyn/weweChat/releases\" target=\"_blank\" rel=\"noopener\">下载地址</a>，到这个地址找wewechat的相关deb包下载安装即可，我用的就是这个版本，UI和上面那个有点差别，还不错的。</p>\n<h4>印象笔记的安装配置</h4>\n<hr>\n<blockquote>\n<p>印象笔记官方也没有开发Linux版本，说是维护成本太大，但是开放了API让第三方程序或是网页可以直接调用，所以有了我们下面这个使用Electron技术封装的网页版印象笔记Whatever，跟网页版看着一样，只不过有了一层桌面软件的壳，值得一提的是 我觉得网页版印象笔记更好用，界面也更现代化，这儿提供一个<a href=\"https://electronjs.org/apps\" target=\"_blank\" rel=\"noopener\">Electron的应用中心</a>，里面很多第三方开发者的app，大部分可以Linux使用，自己找找，说不定有你喜欢的，最后附上Whatever的<a href=\"https://electronjs.org/apps/whatever\" target=\"_blank\" rel=\"noopener\">下载地址</a>，选择适合你的版本下载安装即可。</p>\n</blockquote>\n<h4>安装 Mac-os 主题</h4>\n<hr>\n<ul>\n<li>安装到Linux Mint</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:noobslab/macbuntu</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts-v7</span><br></pre></td></tr></table></figure>\n<ul>\n<li>从Linux Mint卸载</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository -r ppa:noobslab/macbuntu</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt remove macbuntu-os-icons-lts-v7 macbuntu-os-ithemes-lts</span><br><span class=\"line\">-v7</span><br></pre></td></tr></table></figure>\n<p>安装好了要自己去设置界面切换啊～</p>\n<h4>怎样自由上网(翻墙)</h4>\n<hr>\n<ol>\n<li>从vultr买外国云主机，最低$2.5一个月，基本上是所有服务商里面最便宜的了，配置也是最低<a href=\"https://my.vultr.com/\" target=\"_blank\" rel=\"noopener\">官方地址</a></li>\n<li>登录自己的服务器</li>\n<li>服务器一键安装shadowsocks服务 <a href=\"https://xyzardq.github.io/2017/03/07/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BAshadowsocks%E5%8F%8A%E4%BC%98%E5%8C%96/\" target=\"_blank\" rel=\"noopener\">参考地址</a></li>\n<li>自己电脑安装Shadowsocks-Qt5，设置好服务器地址，端口和本地代理地址和端口</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install shadowsocks-qt5</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>chrome安装SwitchyOmega插件，很方便的代理插件，Firefox上也有相应的版本，安装好后设置ip和端口 映射到第四步Shadowsocks-Qt5里设置的本地ip和端口即可享受自由的上网生活，附上一篇<a href=\"http://www.cylong.com/blog/2017/04/09/chrome-SwitchyOmega/\" target=\"_blank\" rel=\"noopener\">教程</a></li>\n</ol>\n<h4>安装办公软件wps</h4>\n<hr>\n<blockquote>\n<p>Linux上最好用的办公软件，没有之一，无奈官方宣布暂时不更新了，linux mint自带的Liboffice不太好用，格式跟office不太兼容，<a href=\"http://linux.wps.cn/\" target=\"_blank\" rel=\"noopener\">wps官网下载直达</a></p>\n</blockquote>\n<h4>实用工具推荐</h4>\n<hr>\n<ol>\n<li>tmux终端工具</li>\n</ol>\n<blockquote>\n<p>Tmux 简单来说就是终端里的『窗口管理器』，强烈推荐。附上<br>\n<a href=\"http://wdxtub.com/2016/03/30/tmux-guide/\" target=\"_blank\" rel=\"noopener\">使用教程</a></p>\n</blockquote>\n<ol start=\"2\">\n<li>stacer系统管理工具</li>\n</ol>\n<blockquote>\n<p>系统进程可视化管理和垃圾清理工具，就是相当于Linux上的电脑管家，还能查看系统占用，卸载软件包，配置开机启动，管理apt软件源等等，非常强大好用，附上<a href=\"https://sourceforge.net/projects/stacer/\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n</blockquote>\n<ol start=\"3\">\n<li>oh-my-zsh终端模拟器</li>\n</ol>\n<blockquote>\n<p>支持插件、主题、自定义配置的强大的终端模拟器，用来替代自带的bash，附上<a href=\"http://yijiebuyi.com/blog/b9b5e1ebb719f22475c38c4819ab8151.html\" target=\"_blank\" rel=\"noopener\">安装教程</a></p>\n</blockquote>\n<ol start=\"4\">\n<li>SmartGit仓库管理可视化工具</li>\n</ol>\n<blockquote>\n<p>大名鼎鼎的分布式版本控制软件git的可视化工具，免费又强大，只是界面是英文的，不过我想你应该不太会介意</p>\n</blockquote>\n<ol start=\"5\">\n<li>Docky</li>\n</ol>\n<blockquote>\n<p>漂亮的dock工具栏，方便酷炫实用</p>\n</blockquote>\n<ol start=\"6\">\n<li>Peek</li>\n</ol>\n<blockquote>\n<p>强大的屏幕录制工具，支持输出gif/webm/apng/webm格式的媒体文件</p>\n</blockquote>\n<ol start=\"7\">\n<li>Inkscape</li>\n</ol>\n<blockquote>\n<p>跨平台免费强大的svg图片绘制工具</p>\n</blockquote>\n<h4>chrome实用插件整理</h4>\n<hr>\n<ol>\n<li>infinity标签页</li>\n</ol>\n<blockquote>\n<p>浏览器首页管理器，可以添加很多网站的快捷进入图标，方便美观</p>\n</blockquote>\n<ol start=\"2\">\n<li>Octotree</li>\n</ol>\n<blockquote>\n<p>让你在浏览github仓库时可以利用左侧的文件资源浏览树更方便地查看项目结构和页面跳转</p>\n</blockquote>\n<ol start=\"3\">\n<li>Postman</li>\n</ol>\n<blockquote>\n<p>api测试神器，很强大，甚至能发送带cookie的请求，各种请求、响应编辑功能也非常实用</p>\n</blockquote>\n<ol start=\"4\">\n<li>SwitchyOmega</li>\n</ol>\n<blockquote>\n<p>大家都用的代理软件，不说了</p>\n</blockquote>\n<ol start=\"5\">\n<li>印象笔记剪藏</li>\n</ol>\n<blockquote>\n<p>随时随地把网络资源保存到你的笔记本里</p>\n</blockquote>\n<ol start=\"6\">\n<li>SimpRead - 简阅</li>\n</ol>\n<blockquote>\n<p>让浏览器支持纯净的阅读模式</p>\n</blockquote>\n<ol start=\"7\">\n<li>Full Page Screen Capture</li>\n</ol>\n<blockquote>\n<p>全屏截图，真的是全屏，你的浏览器标签页有多长，它就能截多长</p>\n</blockquote>\n<ol start=\"8\">\n<li>高效网页截图编辑插件</li>\n</ol>\n<blockquote>\n<p>另一个好用的截图插件</p>\n</blockquote>\n<h4>感谢阅读</h4>\n<p>有时间还会继续更新本文</p>\n"},{"title":"proxychains终端代理","catalog":true,"toc_nav_num":true,"date":"2018-04-04T08:30:35.000Z","subtitle":"proxy linux","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2018-04-04T08:30:35.000Z","top":null,"_content":"\n### proxychains安装  \n\n`sudo apt install proxychains`\n\n### 编辑proxychains配置  \n\n`vim /etc/proxychains.conf`\n\n### 将socks4 127.0.0.1 9095改为  \n\n`socks5 127.0.0.1 1080`\n\nps: 默认的socks4 127.0.0.1 9095是tor代理，而socks5 127.0.0.1 1080是shadowsocks的代理，proxychains.conf文件说明了代理配置格式,如下,这里根据自己使用的代理来配置就行了。  \n\n```bash\nProxyList format\n 94 #       type  ip  port  [user pass]\n 95 #       (values separated by 'tab' or 'blank')\n 96 #\n 97 #       only numeric ipv4 addresses are valid\n 98 #\n 99 #\n100 #        Examples:\n101 #\n102 #       socks5  192.168.67.78   1080    lamer   secret\n103 #       http    192.168.89.3    8080    justu   hidden\n104 #       socks4  192.168.1.49    1080\n105 #       http    192.168.39.93   8080\n```\n\n### 使用方法  \n在需要代理的命令前加上 proxychains ，如：\n```bash\nproxychains wget http://xxx.com/xxx.zip\nproxychains git clone https://xxxxxxxxx.git\n```","source":"_posts/proxychains终端代理.md","raw":"---\ntitle: \"proxychains终端代理\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-04 16:30:35\nsubtitle: \"proxy linux\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Proxy\n- Shadowsocks\ncatagories:\n- Linux\nupdateDate: 2018-04-04 16:30:35\ntop: \n---\n\n### proxychains安装  \n\n`sudo apt install proxychains`\n\n### 编辑proxychains配置  \n\n`vim /etc/proxychains.conf`\n\n### 将socks4 127.0.0.1 9095改为  \n\n`socks5 127.0.0.1 1080`\n\nps: 默认的socks4 127.0.0.1 9095是tor代理，而socks5 127.0.0.1 1080是shadowsocks的代理，proxychains.conf文件说明了代理配置格式,如下,这里根据自己使用的代理来配置就行了。  \n\n```bash\nProxyList format\n 94 #       type  ip  port  [user pass]\n 95 #       (values separated by 'tab' or 'blank')\n 96 #\n 97 #       only numeric ipv4 addresses are valid\n 98 #\n 99 #\n100 #        Examples:\n101 #\n102 #       socks5  192.168.67.78   1080    lamer   secret\n103 #       http    192.168.89.3    8080    justu   hidden\n104 #       socks4  192.168.1.49    1080\n105 #       http    192.168.39.93   8080\n```\n\n### 使用方法  \n在需要代理的命令前加上 proxychains ，如：\n```bash\nproxychains wget http://xxx.com/xxx.zip\nproxychains git clone https://xxxxxxxxx.git\n```","slug":"proxychains终端代理","published":1,"updated":"2020-03-12T02:23:09.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn2000ca89504lb9e7j","content":"<h3 id=\"proxychains安装\">proxychains安装</h3>\n<p><code>sudo apt install proxychains</code></p>\n<h3 id=\"编辑proxychains配置\">编辑proxychains配置</h3>\n<p><code>vim /etc/proxychains.conf</code></p>\n<h3 id=\"将socks4-127001-9095改为\">将socks4 127.0.0.1 9095改为</h3>\n<p><code>socks5 127.0.0.1 1080</code></p>\n<p>ps: 默认的socks4 127.0.0.1 9095是tor代理，而socks5 127.0.0.1 1080是shadowsocks的代理，proxychains.conf文件说明了代理配置格式,如下,这里根据自己使用的代理来配置就行了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProxyList format</span><br><span class=\"line\"> 94 <span class=\"comment\">#       type  ip  port  [user pass]</span></span><br><span class=\"line\"> 95 <span class=\"comment\">#       (values separated by 'tab' or 'blank')</span></span><br><span class=\"line\"> 96 <span class=\"comment\">#</span></span><br><span class=\"line\"> 97 <span class=\"comment\">#       only numeric ipv4 addresses are valid</span></span><br><span class=\"line\"> 98 <span class=\"comment\">#</span></span><br><span class=\"line\"> 99 <span class=\"comment\">#</span></span><br><span class=\"line\">100 <span class=\"comment\">#        Examples:</span></span><br><span class=\"line\">101 <span class=\"comment\">#</span></span><br><span class=\"line\">102 <span class=\"comment\">#       socks5  192.168.67.78   1080    lamer   secret</span></span><br><span class=\"line\">103 <span class=\"comment\">#       http    192.168.89.3    8080    justu   hidden</span></span><br><span class=\"line\">104 <span class=\"comment\">#       socks4  192.168.1.49    1080</span></span><br><span class=\"line\">105 <span class=\"comment\">#       http    192.168.39.93   8080</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用方法\">使用方法</h3>\n<p>在需要代理的命令前加上 proxychains ，如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxychains wget http://xxx.com/xxx.zip</span><br><span class=\"line\">proxychains git <span class=\"built_in\">clone</span> https://xxxxxxxxx.git</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3>proxychains安装</h3>\n<p><code>sudo apt install proxychains</code></p>\n<h3>编辑proxychains配置</h3>\n<p><code>vim /etc/proxychains.conf</code></p>\n<h3>将socks4 127.0.0.1 9095改为</h3>\n<p><code>socks5 127.0.0.1 1080</code></p>\n<p>ps: 默认的socks4 127.0.0.1 9095是tor代理，而socks5 127.0.0.1 1080是shadowsocks的代理，proxychains.conf文件说明了代理配置格式,如下,这里根据自己使用的代理来配置就行了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ProxyList format</span><br><span class=\"line\"> 94 <span class=\"comment\">#       type  ip  port  [user pass]</span></span><br><span class=\"line\"> 95 <span class=\"comment\">#       (values separated by 'tab' or 'blank')</span></span><br><span class=\"line\"> 96 <span class=\"comment\">#</span></span><br><span class=\"line\"> 97 <span class=\"comment\">#       only numeric ipv4 addresses are valid</span></span><br><span class=\"line\"> 98 <span class=\"comment\">#</span></span><br><span class=\"line\"> 99 <span class=\"comment\">#</span></span><br><span class=\"line\">100 <span class=\"comment\">#        Examples:</span></span><br><span class=\"line\">101 <span class=\"comment\">#</span></span><br><span class=\"line\">102 <span class=\"comment\">#       socks5  192.168.67.78   1080    lamer   secret</span></span><br><span class=\"line\">103 <span class=\"comment\">#       http    192.168.89.3    8080    justu   hidden</span></span><br><span class=\"line\">104 <span class=\"comment\">#       socks4  192.168.1.49    1080</span></span><br><span class=\"line\">105 <span class=\"comment\">#       http    192.168.39.93   8080</span></span><br></pre></td></tr></table></figure>\n<h3>使用方法</h3>\n<p>在需要代理的命令前加上 proxychains ，如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxychains wget http://xxx.com/xxx.zip</span><br><span class=\"line\">proxychains git <span class=\"built_in\">clone</span> https://xxxxxxxxx.git</span><br></pre></td></tr></table></figure>"},{"title":"sass开发规范","catalog":true,"toc_nav_num":true,"date":"2018-04-04T08:30:35.000Z","subtitle":"sass css","header-img":"/blogs/img/article_header/article_header.png","catagories":["Sass"],"updateDate":"2018-04-04T08:30:35.000Z","top":null,"_content":"\n>author: NoJsJa\n\n#### Contents\n---------------------------------\n\n1. sass语法  \n2. 命名  \n3. 书写顺序  \n4. 代码嵌套  \n5. 注释  \n\n#### sass语法\n---------------------------------\n\n>sass是一门编程语言，支持css语法以及一般编程语言中的函数、宏、变量和各种逻辑语法等等，sass文件最终会被编译成css文件。  \n\n1. 变量  \n2. 计算功能    \n3. 继承  \n4. Mixin  \n5. 函数  \n6. 高级用法  \n\n##### 变量  \n\nSass允许使用变量，所有变量以$开头：  \n\n```scss\n$blue: #1875e7;\n　div {\n　　　color: $blue;\n　}\n```\n\n内嵌到字符串中的变量需要写在 ' #{} ' 中间：  \n\n```scss\n$side: left;\n.rounded {\n　border-#{$side}-radius: 5px;\n}\n```\n\n##### 计算功能  \n\nSass允许在代码中使用算式：  \n\n```scss\nbody {\n　margin: (14px/2);\n　top: 50px + 100px;\n　right: $var * 10%;\n}\n```\n\n##### 继承  \n\nSass允许一个选择器使用关键字 @extend 继承另一个选择器：  \n\n```scss\n.class1 {\n　　border: 1px solid #ddd;\n}\n\n.class2 {\n　 @extend .class1;\n　 font-size:120%;\n}\n```\n\n##### Mixin  \n\nMixin是可以重用的代码块，使用 @mixin 关键字定义一个代码块：  \n\n```scss\n@mixin left {\n　float: left;\n　margin-left: 10px;\n}\n\n```\n\n使用 @include 调用这个mixin：  \n\n```scss\ndiv {\n　 @include left;\n}\n```\n\nmixin还能制定参数和参数默认值：  \n\n```scss\n@mixin left($value: 10px) {\n　 float: left;\n　 margin-right: $value;\n}\n```\n\n使用的时候可以直接使用默认值或是加入参数值：  \n\n```scss\ndiv {\n　　　　@include left(20px);\n　　}\n```\n\n##### 函数  \n\nSass允许用户使用 @function 关键字编写自己的函数，函数可以直接使用：  \n\n```scss\n@function double($n) {\n　 @return $n * 2;\n}\n\n#sidebar {\n　width: double(5px);\n}\n```\n\n##### 高级用法  \n\n* 引入外部文件  \n* 使用条件语句  \n* 使用循环语句  \n\n引入外部文件：  \n\n```scss\n@import \"../foo.css\";\n```\n\n使用条件语句：  \n```scss\np {\n　@if 1 + 1 == 2 { border: 1px solid; }\n　@if 5 < 3 { border: 2px dotted; }\n}\n\n@if $color == '#fff' {\n　background-color: #000;\n} @else {\n　background-color: #fff;\n}\n```\n\n使用循环语句，支持for和while循环：　\n\n```scss\n@for $i from 1 to 10 {\n　　.border-#{$i} {\n　　　　border: #{$i}px solid blue;\n　　}\n}\n\n$i: 6;\n　　@while $i > 0 {\n　　　　.item-#{$i} { width: 2em * $i; }\n　　　　$i: $i - 2;\n　　}\n```\n\n#### 命名\n---------------------------------\n\n1. ID命名  \n2. Class命名  \n3. 父元素和子元素的命名规则  \n\n##### ID命名  \n\n统一采用驼峰命名法(camelCase)，第一个首字母小写，其它单词的首字母大写：  \n\n```scss\n/* bad */\n#rootlistitem {...}\n#RootListItem {...}\n\n/* good */\n#rootListItem {...}\n```\n\n命名单词数最好不要超过3个：  \n\n```scss\n/* bad */\n#rootListItemWrapper {...}\n\n/* good */\n#rootListWrapper {...}\n```\n\n##### Class命名  \n\n类的命名统一使用连字符 '-' 连接各个单词，命名中不允许出现大写字母：  \n\n```\n/* bad */\n.contentWrapper {...}\n\n/* good */\n.content-wrapper {...}\n```\n\n类名最好使用三个及三个以下的单词，至多不超过四个：  \n\n```scss\n/* bad */\n.file-detail-list-item-wrapper {...}\n\n/* not-good */\n.file-detail-list-wrapper {...}\n\n/* good */\n.file-detail-wrapper {...}\n.file-wrapper {...}\n\n```\n\n##### 父元素和子元素的命名规则  \n\n父元素和多级子元素的命名需要体现元素在页面的功能、样式、或结构：  \n\n```scss\n.file-list-wrapper {\n\n  .file-list-header {...}\n\n  .file-list-body {\n\n    .list-body-aside {\n\n      .body-aside-left {...}\n      .body-aside-right {...}\n    }\n\n    .list-body-main {...}\n  }\n\n  .file-list-footer {...}\n}\n```\n\n#### 书写顺序\n---------------------------------\n\n内部属性书写顺序应该按照从上到下是 布局定位、盒模型属性、表现性属性和其它：  \n\n```scss\n.class {\n  /* 布局定位 */\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  /* 盒模型属性 */\n  display: block;\n  overflow: hidden;\n  box-sizing: border-box;\n  width: 1rem;\n  height: 1rem;\n  margin: 1em;\n  padding: 1em;\n  border: 3px solid #ddd;\n  border-radius: 5px;\n\n  /* 表现性属性 */\n  font-family: 'Arial', sans-serif;\n  font-size: 1.5rem;\n  font-weight: bold;\n  line-height: 1rem;\n  word-break: break-all;\n  word-wrap: break-word;\n  background-color: #eee;\n  color: #000;\n\n  /* 其它 */\n  z-index: 500;\n}\n\n```\n\n#### 代码缩进和嵌套\n---------------------------------\n\n1. 代码缩进  \n2. 多层嵌套  \n\n##### 代码缩进  \n\n代码缩进统一使用两个空格，不要用四个空格和tab(编辑器内可以自定义tab输出的空格数，不用手打两个空格)   \n\n```scss\n/* bad */\n.class {\n    position: fixed;\n}\n\n/* good */\n.class {\n  position: fixed;\n}\n```\n\n选择器与花括号之间要保留一个空格，属性名之后的冒号与属性值之间要保留一个空格，选择符号两边各保留一个空格    \n\n```scss\n/* bad */\n.class>div{\n  position:fixed;\n}\n\n/* good */\n.class > div {\n  position: fixed;\n}\n```\n\n##### 多层嵌套  \n\n在Sass中你可以嵌套选择器，这可以使代码变得更模块化和可读，嵌套所有的选择器，但尽量避免嵌套没有任何内容的选择器(优先使用子选择器' > '，提高css查询性能)  \n\n```scss\n/* bad */\n.content {\n  display: block;\n}\n\n.content > .news-article > .title {\n  font-size: 1.2em;\n\n/* bad */\n.content {\n  display: block;\n\n  > .news-article {\n    > .title {\n      font-size: 1.2em;\n    }\n  }\n\n/* good */\ncontent {\n  display: block;\n\n  > .news-article > .title {\n    font-size: 1.2em;\n  }\n}\n```\n\n在Sass中，当你嵌套你的选择器时也可以使用上下文媒体查询，你可以在任何给定的嵌套层次中使用媒体查询  \n\n```scss\n/* bad */\n.content-page {\n  font-size: 1.2rem;\n\n  > .main {\n    background-color: whitesmoke;\n\n    > .latest-news {\n      padding: 1rem;\n\n      > .news-article {\n        padding: 1rem;\n\n        > .title {\n          font-size: 2rem;\n        }\n      }\n    }\n\n    > .content {\n      margin-top: 2rem;\n      padding: 1rem;\n    }\n  }\n\n  > .page-footer {\n    margin-top: 2rem;\n    font-size: 1rem;\n  }\n}\n\n@media screen and (min-width: 641px) {\n  .content-page {\n    font-size: 1rem;\n\n    > .main > .latest-news > .news-article > .title {\n      font-size: 3rem;\n    }\n\n    > .page-footer {\n      font-size: 0.8rem;\n    }\n  }\n}\n\n\n\n/* good */\n.content-page {\n  font-size: 1.2rem;\n\n  @media screen and (min-width: 641px) {\n    font-size: 1rem;\n  }\n\n  > .main {\n    background-color: whitesmoke;\n\n    > .latest-news {\n      padding: 1rem;\n\n      > .news-article {\n        padding: 1rem;\n\n        > .title {\n          font-size: 2rem;\n\n          @media screen and (min-width: 641px) {\n            font-size: 3rem;\n          }\n        }\n      }\n    }\n\n    > .content {\n      margin-top: 2rem;\n      padding: 1rem;\n    }\n  }\n\n  > .page-footer {\n    margin-top: 2rem;\n    font-size: 1rem;\n\n    @media screen and (min-width: 641px) {\n      font-size: 0.8rem;\n    }\n  }\n}\n```\n\n嵌套顺序和选择器，以下是一个sass块应该具有的顺序：  \n\n1. 当前选择器的样式属性  \n2. 当前选择器的伪类选择器 (:first-letter, :hover, :active)伪类元素 (:before and :after)  \n3. 当前选择器的声明样式 (.selected, .active, .enlarged)  \n4. 用Sass的上下文媒体查询  \n5. 子选择器作为最后的部分  \n\n```scss\n.product-teaser {\n  /* 当前选择器的样式属性 */\n  display: inline-block;\n  padding: 1rem;\n  background-color: whitesmoke;\n  color: grey;\n\n  /* 当前选择器的伪类选择器 */\n  &:hover {\n    color: black;\n  }\n\n  &:before {\n    content: \"\";\n    display: block;\n    border-top: 1px solid grey;\n  }\n\n  &:after {\n    content: \"\";\n    display: block;\n    border-top: 1px solid grey;\n  }\n\n  /* 当前选择器的声明样式 */\n  &.active {\n    background-color: pink;\n    color: red;\n  }\n\n  /* 上下文媒体查询 */\n  @media screen and (max-width: 640px) {\n    display: block;\n    font-size: 2em;\n  }\n\n  /* 子选择器 */\n  > .content > .title {\n    font-size: 1.2em;\n\n    /* 子选择器上下文媒体查询 */\n    @media screen and (max-width: 640px) {\n      letter-spacing: 0.2em;\n      text-transform: uppercase;\n    }\n  }\n}\n```\n\n#### 注释  \n---------------------------------\n\n>代码编辑器一般都可以自定义代码段(snippets)，通过编辑自定义代码段配置文件将快捷键绑定到一段自定义代码可以实现快捷插入代码段  \n\n1. 组件注释  \n2. 子组件注释  \n3. 一般注释  \n\n##### 组件注释  \n\n一个大组件需要使用组件注释，体现页面结构。  \n\n```scss\n  /* ==========================================================\n  父组件 file-list\n  ============================================================= */\n  .file-list {...}\n\n```\n\n##### 子组件注释  \n\n一个组件的子组件需要使用子组件注释，体现组件整体结构。  \n\n```scss\n  /* 子组件 file-list-item\n  ============================================================= */\n  .file-list-item {...}\n\n```\n\n##### 一般注释  \n\n使用块注释和行注释都行，重要的是体现代码结构和代码简洁度  \n\n```scss\n/* 块注释 */\n.class1 {\n\n  // 行注释\n  .title {...}\n\n  .content {  // 行注释2\n    color: #fff;\n  }\n}\n```\n","source":"_posts/sass开发规范.md","raw":"---\ntitle: \"sass开发规范\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-04 16:30:35\nsubtitle: \"sass css\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Sass\n- Css\ncatagories:\n- Sass\nupdateDate: 2018-04-04 16:30:35\ntop: \n---\n\n>author: NoJsJa\n\n#### Contents\n---------------------------------\n\n1. sass语法  \n2. 命名  \n3. 书写顺序  \n4. 代码嵌套  \n5. 注释  \n\n#### sass语法\n---------------------------------\n\n>sass是一门编程语言，支持css语法以及一般编程语言中的函数、宏、变量和各种逻辑语法等等，sass文件最终会被编译成css文件。  \n\n1. 变量  \n2. 计算功能    \n3. 继承  \n4. Mixin  \n5. 函数  \n6. 高级用法  \n\n##### 变量  \n\nSass允许使用变量，所有变量以$开头：  \n\n```scss\n$blue: #1875e7;\n　div {\n　　　color: $blue;\n　}\n```\n\n内嵌到字符串中的变量需要写在 ' #{} ' 中间：  \n\n```scss\n$side: left;\n.rounded {\n　border-#{$side}-radius: 5px;\n}\n```\n\n##### 计算功能  \n\nSass允许在代码中使用算式：  \n\n```scss\nbody {\n　margin: (14px/2);\n　top: 50px + 100px;\n　right: $var * 10%;\n}\n```\n\n##### 继承  \n\nSass允许一个选择器使用关键字 @extend 继承另一个选择器：  \n\n```scss\n.class1 {\n　　border: 1px solid #ddd;\n}\n\n.class2 {\n　 @extend .class1;\n　 font-size:120%;\n}\n```\n\n##### Mixin  \n\nMixin是可以重用的代码块，使用 @mixin 关键字定义一个代码块：  \n\n```scss\n@mixin left {\n　float: left;\n　margin-left: 10px;\n}\n\n```\n\n使用 @include 调用这个mixin：  \n\n```scss\ndiv {\n　 @include left;\n}\n```\n\nmixin还能制定参数和参数默认值：  \n\n```scss\n@mixin left($value: 10px) {\n　 float: left;\n　 margin-right: $value;\n}\n```\n\n使用的时候可以直接使用默认值或是加入参数值：  \n\n```scss\ndiv {\n　　　　@include left(20px);\n　　}\n```\n\n##### 函数  \n\nSass允许用户使用 @function 关键字编写自己的函数，函数可以直接使用：  \n\n```scss\n@function double($n) {\n　 @return $n * 2;\n}\n\n#sidebar {\n　width: double(5px);\n}\n```\n\n##### 高级用法  \n\n* 引入外部文件  \n* 使用条件语句  \n* 使用循环语句  \n\n引入外部文件：  \n\n```scss\n@import \"../foo.css\";\n```\n\n使用条件语句：  \n```scss\np {\n　@if 1 + 1 == 2 { border: 1px solid; }\n　@if 5 < 3 { border: 2px dotted; }\n}\n\n@if $color == '#fff' {\n　background-color: #000;\n} @else {\n　background-color: #fff;\n}\n```\n\n使用循环语句，支持for和while循环：　\n\n```scss\n@for $i from 1 to 10 {\n　　.border-#{$i} {\n　　　　border: #{$i}px solid blue;\n　　}\n}\n\n$i: 6;\n　　@while $i > 0 {\n　　　　.item-#{$i} { width: 2em * $i; }\n　　　　$i: $i - 2;\n　　}\n```\n\n#### 命名\n---------------------------------\n\n1. ID命名  \n2. Class命名  \n3. 父元素和子元素的命名规则  \n\n##### ID命名  \n\n统一采用驼峰命名法(camelCase)，第一个首字母小写，其它单词的首字母大写：  \n\n```scss\n/* bad */\n#rootlistitem {...}\n#RootListItem {...}\n\n/* good */\n#rootListItem {...}\n```\n\n命名单词数最好不要超过3个：  \n\n```scss\n/* bad */\n#rootListItemWrapper {...}\n\n/* good */\n#rootListWrapper {...}\n```\n\n##### Class命名  \n\n类的命名统一使用连字符 '-' 连接各个单词，命名中不允许出现大写字母：  \n\n```\n/* bad */\n.contentWrapper {...}\n\n/* good */\n.content-wrapper {...}\n```\n\n类名最好使用三个及三个以下的单词，至多不超过四个：  \n\n```scss\n/* bad */\n.file-detail-list-item-wrapper {...}\n\n/* not-good */\n.file-detail-list-wrapper {...}\n\n/* good */\n.file-detail-wrapper {...}\n.file-wrapper {...}\n\n```\n\n##### 父元素和子元素的命名规则  \n\n父元素和多级子元素的命名需要体现元素在页面的功能、样式、或结构：  \n\n```scss\n.file-list-wrapper {\n\n  .file-list-header {...}\n\n  .file-list-body {\n\n    .list-body-aside {\n\n      .body-aside-left {...}\n      .body-aside-right {...}\n    }\n\n    .list-body-main {...}\n  }\n\n  .file-list-footer {...}\n}\n```\n\n#### 书写顺序\n---------------------------------\n\n内部属性书写顺序应该按照从上到下是 布局定位、盒模型属性、表现性属性和其它：  \n\n```scss\n.class {\n  /* 布局定位 */\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  /* 盒模型属性 */\n  display: block;\n  overflow: hidden;\n  box-sizing: border-box;\n  width: 1rem;\n  height: 1rem;\n  margin: 1em;\n  padding: 1em;\n  border: 3px solid #ddd;\n  border-radius: 5px;\n\n  /* 表现性属性 */\n  font-family: 'Arial', sans-serif;\n  font-size: 1.5rem;\n  font-weight: bold;\n  line-height: 1rem;\n  word-break: break-all;\n  word-wrap: break-word;\n  background-color: #eee;\n  color: #000;\n\n  /* 其它 */\n  z-index: 500;\n}\n\n```\n\n#### 代码缩进和嵌套\n---------------------------------\n\n1. 代码缩进  \n2. 多层嵌套  \n\n##### 代码缩进  \n\n代码缩进统一使用两个空格，不要用四个空格和tab(编辑器内可以自定义tab输出的空格数，不用手打两个空格)   \n\n```scss\n/* bad */\n.class {\n    position: fixed;\n}\n\n/* good */\n.class {\n  position: fixed;\n}\n```\n\n选择器与花括号之间要保留一个空格，属性名之后的冒号与属性值之间要保留一个空格，选择符号两边各保留一个空格    \n\n```scss\n/* bad */\n.class>div{\n  position:fixed;\n}\n\n/* good */\n.class > div {\n  position: fixed;\n}\n```\n\n##### 多层嵌套  \n\n在Sass中你可以嵌套选择器，这可以使代码变得更模块化和可读，嵌套所有的选择器，但尽量避免嵌套没有任何内容的选择器(优先使用子选择器' > '，提高css查询性能)  \n\n```scss\n/* bad */\n.content {\n  display: block;\n}\n\n.content > .news-article > .title {\n  font-size: 1.2em;\n\n/* bad */\n.content {\n  display: block;\n\n  > .news-article {\n    > .title {\n      font-size: 1.2em;\n    }\n  }\n\n/* good */\ncontent {\n  display: block;\n\n  > .news-article > .title {\n    font-size: 1.2em;\n  }\n}\n```\n\n在Sass中，当你嵌套你的选择器时也可以使用上下文媒体查询，你可以在任何给定的嵌套层次中使用媒体查询  \n\n```scss\n/* bad */\n.content-page {\n  font-size: 1.2rem;\n\n  > .main {\n    background-color: whitesmoke;\n\n    > .latest-news {\n      padding: 1rem;\n\n      > .news-article {\n        padding: 1rem;\n\n        > .title {\n          font-size: 2rem;\n        }\n      }\n    }\n\n    > .content {\n      margin-top: 2rem;\n      padding: 1rem;\n    }\n  }\n\n  > .page-footer {\n    margin-top: 2rem;\n    font-size: 1rem;\n  }\n}\n\n@media screen and (min-width: 641px) {\n  .content-page {\n    font-size: 1rem;\n\n    > .main > .latest-news > .news-article > .title {\n      font-size: 3rem;\n    }\n\n    > .page-footer {\n      font-size: 0.8rem;\n    }\n  }\n}\n\n\n\n/* good */\n.content-page {\n  font-size: 1.2rem;\n\n  @media screen and (min-width: 641px) {\n    font-size: 1rem;\n  }\n\n  > .main {\n    background-color: whitesmoke;\n\n    > .latest-news {\n      padding: 1rem;\n\n      > .news-article {\n        padding: 1rem;\n\n        > .title {\n          font-size: 2rem;\n\n          @media screen and (min-width: 641px) {\n            font-size: 3rem;\n          }\n        }\n      }\n    }\n\n    > .content {\n      margin-top: 2rem;\n      padding: 1rem;\n    }\n  }\n\n  > .page-footer {\n    margin-top: 2rem;\n    font-size: 1rem;\n\n    @media screen and (min-width: 641px) {\n      font-size: 0.8rem;\n    }\n  }\n}\n```\n\n嵌套顺序和选择器，以下是一个sass块应该具有的顺序：  \n\n1. 当前选择器的样式属性  \n2. 当前选择器的伪类选择器 (:first-letter, :hover, :active)伪类元素 (:before and :after)  \n3. 当前选择器的声明样式 (.selected, .active, .enlarged)  \n4. 用Sass的上下文媒体查询  \n5. 子选择器作为最后的部分  \n\n```scss\n.product-teaser {\n  /* 当前选择器的样式属性 */\n  display: inline-block;\n  padding: 1rem;\n  background-color: whitesmoke;\n  color: grey;\n\n  /* 当前选择器的伪类选择器 */\n  &:hover {\n    color: black;\n  }\n\n  &:before {\n    content: \"\";\n    display: block;\n    border-top: 1px solid grey;\n  }\n\n  &:after {\n    content: \"\";\n    display: block;\n    border-top: 1px solid grey;\n  }\n\n  /* 当前选择器的声明样式 */\n  &.active {\n    background-color: pink;\n    color: red;\n  }\n\n  /* 上下文媒体查询 */\n  @media screen and (max-width: 640px) {\n    display: block;\n    font-size: 2em;\n  }\n\n  /* 子选择器 */\n  > .content > .title {\n    font-size: 1.2em;\n\n    /* 子选择器上下文媒体查询 */\n    @media screen and (max-width: 640px) {\n      letter-spacing: 0.2em;\n      text-transform: uppercase;\n    }\n  }\n}\n```\n\n#### 注释  \n---------------------------------\n\n>代码编辑器一般都可以自定义代码段(snippets)，通过编辑自定义代码段配置文件将快捷键绑定到一段自定义代码可以实现快捷插入代码段  \n\n1. 组件注释  \n2. 子组件注释  \n3. 一般注释  \n\n##### 组件注释  \n\n一个大组件需要使用组件注释，体现页面结构。  \n\n```scss\n  /* ==========================================================\n  父组件 file-list\n  ============================================================= */\n  .file-list {...}\n\n```\n\n##### 子组件注释  \n\n一个组件的子组件需要使用子组件注释，体现组件整体结构。  \n\n```scss\n  /* 子组件 file-list-item\n  ============================================================= */\n  .file-list-item {...}\n\n```\n\n##### 一般注释  \n\n使用块注释和行注释都行，重要的是体现代码结构和代码简洁度  \n\n```scss\n/* 块注释 */\n.class1 {\n\n  // 行注释\n  .title {...}\n\n  .content {  // 行注释2\n    color: #fff;\n  }\n}\n```\n","slug":"sass开发规范","published":1,"updated":"2020-03-10T16:52:11.943Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn4000ea895lqxolntj","content":"<blockquote>\n<p>author: NoJsJa</p>\n</blockquote>\n<h4 id=\"contents\">Contents</h4>\n<hr>\n<ol>\n<li>sass语法</li>\n<li>命名</li>\n<li>书写顺序</li>\n<li>代码嵌套</li>\n<li>注释</li>\n</ol>\n<h4 id=\"sass语法\">sass语法</h4>\n<hr>\n<blockquote>\n<p>sass是一门编程语言，支持css语法以及一般编程语言中的函数、宏、变量和各种逻辑语法等等，sass文件最终会被编译成css文件。</p>\n</blockquote>\n<ol>\n<li>变量</li>\n<li>计算功能</li>\n<li>继承</li>\n<li>Mixin</li>\n<li>函数</li>\n<li>高级用法</li>\n</ol>\n<h5 id=\"变量\">变量</h5>\n<p>Sass允许使用变量，所有变量以$开头：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$blue</span>: <span class=\"number\">#1875e7</span>;</span><br><span class=\"line\">　<span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　　　<span class=\"attribute\">color</span>: <span class=\"variable\">$blue</span>;</span><br><span class=\"line\">　&#125;</span><br></pre></td></tr></table></figure>\n<p>内嵌到字符串中的变量需要写在 ’ #{} ’ 中间：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$side</span>: left;</span><br><span class=\"line\"><span class=\"selector-class\">.rounded</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$side</span>&#125;-radius: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"计算功能\">计算功能</h5>\n<p>Sass允许在代码中使用算式：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">margin</span>: (<span class=\"number\">14px</span>/<span class=\"number\">2</span>);</span><br><span class=\"line\">　<span class=\"attribute\">top</span>: <span class=\"number\">50px</span> + <span class=\"number\">100px</span>;</span><br><span class=\"line\">　<span class=\"attribute\">right</span>: <span class=\"variable\">$var</span> * <span class=\"number\">10%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"继承\">继承</h5>\n<p>Sass允许一个选择器使用关键字 @extend 继承另一个选择器：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class1</span> &#123;</span><br><span class=\"line\">　　<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.class2</span> &#123;</span><br><span class=\"line\">　 @<span class=\"keyword\">extend</span> .class1;</span><br><span class=\"line\">　 <span class=\"attribute\">font-size</span>:<span class=\"number\">120%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"mixin\">Mixin</h5>\n<p>Mixin是可以重用的代码块，使用 @mixin 关键字定义一个代码块：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> left &#123;</span><br><span class=\"line\">　<span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">　<span class=\"attribute\">margin-left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 @include 调用这个mixin：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　 @<span class=\"keyword\">include</span> left;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>mixin还能制定参数和参数默认值：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> left(<span class=\"variable\">$value</span>: 10px) &#123;</span><br><span class=\"line\">　 <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">　 <span class=\"attribute\">margin-right</span>: <span class=\"variable\">$value</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用的时候可以直接使用默认值或是加入参数值：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　　　　@<span class=\"keyword\">include</span> left(<span class=\"number\">20px</span>);</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"函数\">函数</h5>\n<p>Sass允许用户使用 @function 关键字编写自己的函数，函数可以直接使用：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@function double(<span class=\"variable\">$n</span>) &#123;</span><br><span class=\"line\">　 @return <span class=\"variable\">$n</span> * 2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#sidebar</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">width</span>: double(<span class=\"number\">5px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"高级用法\">高级用法</h5>\n<ul>\n<li>引入外部文件</li>\n<li>使用条件语句</li>\n<li>使用循环语句</li>\n</ul>\n<p>引入外部文件：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"../foo.css\"</span>;</span><br></pre></td></tr></table></figure>\n<p>使用条件语句：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">　@<span class=\"keyword\">if</span> 1 + 1 == 2 &#123; <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid; &#125;</span><br><span class=\"line\">　@<span class=\"keyword\">if</span> 5 &lt; 3 &#123; <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> dotted; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">if</span> <span class=\"variable\">$color</span> == <span class=\"string\">'#fff'</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">background-color</span>: <span class=\"number\">#000</span>;</span><br><span class=\"line\">&#125; @<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用循环语句，支持for和while循环：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 to 10 &#123;</span><br><span class=\"line\">　　<span class=\"selector-class\">.border-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123;</span><br><span class=\"line\">　　　　<span class=\"attribute\">border</span>: #&#123;<span class=\"variable\">$i</span>&#125;px solid blue;</span><br><span class=\"line\">　　&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$i</span>: <span class=\"number\">6</span>;</span><br><span class=\"line\">　　@<span class=\"keyword\">while</span> <span class=\"variable\">$i</span> &gt; 0 &#123;</span><br><span class=\"line\">　　　　<span class=\"selector-class\">.item-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123; <span class=\"attribute\">width</span>: <span class=\"number\">2em</span> * <span class=\"variable\">$i</span>; &#125;</span><br><span class=\"line\">　　　　<span class=\"variable\">$i</span>: <span class=\"variable\">$i</span> - <span class=\"number\">2</span>;</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"命名\">命名</h4>\n<hr>\n<ol>\n<li>ID命名</li>\n<li>Class命名</li>\n<li>父元素和子元素的命名规则</li>\n</ol>\n<h5 id=\"id命名\">ID命名</h5>\n<p>统一采用驼峰命名法(camelCase)，第一个首字母小写，其它单词的首字母大写：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootlistitem</span> &#123;...&#125;</span><br><span class=\"line\"><span class=\"selector-id\">#RootListItem</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListItem</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<p>命名单词数最好不要超过3个：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListItemWrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListWrapper</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"class命名\">Class命名</h5>\n<p>类的命名统一使用连字符 ‘-’ 连接各个单词，命名中不允许出现大写字母：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/* bad */</span><br><span class=\"line\">.contentWrapper &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/* good */</span><br><span class=\"line\">.content-wrapper &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<p>类名最好使用三个及三个以下的单词，至多不超过四个：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-list-item-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not-good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-list-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.file-wrapper</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"父元素和子元素的命名规则\">父元素和子元素的命名规则</h5>\n<p>父元素和多级子元素的命名需要体现元素在页面的功能、样式、或结构：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.file-list-wrapper</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-header</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-body</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.list-body-aside</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.body-aside-left</span> &#123;...&#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.body-aside-right</span> &#123;...&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.list-body-main</span> &#123;...&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-footer</span> &#123;...&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"书写顺序\">书写顺序</h4>\n<hr>\n<p>内部属性书写顺序应该按照从上到下是 布局定位、盒模型属性、表现性属性和其它：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* 布局定位 */</span></span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 盒模型属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 表现性属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Arial'</span>, sans-serif;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.5rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">word-break</span>: break-all;</span><br><span class=\"line\">  <span class=\"attribute\">word-wrap</span>: break-word;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#eee</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 其它 */</span></span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">500</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"代码缩进和嵌套\">代码缩进和嵌套</h4>\n<hr>\n<ol>\n<li>代码缩进</li>\n<li>多层嵌套</li>\n</ol>\n<h5 id=\"代码缩进\">代码缩进</h5>\n<p>代码缩进统一使用两个空格，不要用四个空格和tab(编辑器内可以自定义tab输出的空格数，不用手打两个空格)</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>选择器与花括号之间要保留一个空格，属性名之后的冒号与属性值之间要保留一个空格，选择符号两边各保留一个空格</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span>&gt;<span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>:fixed;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &gt; <span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"多层嵌套\">多层嵌套</h5>\n<p>在Sass中你可以嵌套选择器，这可以使代码变得更模块化和可读，嵌套所有的选择器，但尽量避免嵌套没有任何内容的选择器(优先使用子选择器’ &gt; '，提高css查询性能)</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"attribute\">content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在Sass中，当你嵌套你的选择器时也可以使用上下文媒体查询，你可以在任何给定的嵌套层次中使用媒体查询</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.latest-news</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">font-size</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">  <span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.main</span> &gt; <span class=\"selector-class\">.latest-news</span> &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">3rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">0.8rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.latest-news</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">font-size</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">          @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">3rem</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">0.8rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>嵌套顺序和选择器，以下是一个sass块应该具有的顺序：</p>\n<ol>\n<li>当前选择器的样式属性</li>\n<li>当前选择器的伪类选择器 (:first-letter, :hover, :active)伪类元素 (:before and :after)</li>\n<li>当前选择器的声明样式 (.selected, .active, .enlarged)</li>\n<li>用Sass的上下文媒体查询</li>\n<li>子选择器作为最后的部分</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.product-teaser</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的样式属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: grey;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的伪类选择器 */</span></span><br><span class=\"line\">  &amp;:hover &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;:before &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">1px</span> solid grey;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;:after &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">1px</span> solid grey;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的声明样式 */</span></span><br><span class=\"line\">  &amp;<span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: pink;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 上下文媒体查询 */</span></span><br><span class=\"line\">  @<span class=\"keyword\">media</span> screen and (max-width: 640px) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 子选择器 */</span></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.content</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 子选择器上下文媒体查询 */</span></span><br><span class=\"line\">    @<span class=\"keyword\">media</span> screen and (max-width: 640px) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">letter-spacing</span>: <span class=\"number\">0.2em</span>;</span><br><span class=\"line\">      <span class=\"attribute\">text-transform</span>: uppercase;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"注释\">注释</h4>\n<hr>\n<blockquote>\n<p>代码编辑器一般都可以自定义代码段(snippets)，通过编辑自定义代码段配置文件将快捷键绑定到一段自定义代码可以实现快捷插入代码段</p>\n</blockquote>\n<ol>\n<li>组件注释</li>\n<li>子组件注释</li>\n<li>一般注释</li>\n</ol>\n<h5 id=\"组件注释\">组件注释</h5>\n<p>一个大组件需要使用组件注释，体现页面结构。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ==========================================================</span></span><br><span class=\"line\"><span class=\"comment\">父组件 file-list</span></span><br><span class=\"line\"><span class=\"comment\">============================================================= */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-list</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"子组件注释\">子组件注释</h5>\n<p>一个组件的子组件需要使用子组件注释，体现组件整体结构。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 子组件 file-list-item</span></span><br><span class=\"line\"><span class=\"comment\">============================================================= */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-list-item</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"一般注释\">一般注释</h5>\n<p>使用块注释和行注释都行，重要的是体现代码结构和代码简洁度</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 块注释 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 行注释</span></span><br><span class=\"line\">  <span class=\"selector-class\">.title</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> &#123;  <span class=\"comment\">// 行注释2</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>author: NoJsJa</p>\n</blockquote>\n<h4>Contents</h4>\n<hr>\n<ol>\n<li>sass语法</li>\n<li>命名</li>\n<li>书写顺序</li>\n<li>代码嵌套</li>\n<li>注释</li>\n</ol>\n<h4>sass语法</h4>\n<hr>\n<blockquote>\n<p>sass是一门编程语言，支持css语法以及一般编程语言中的函数、宏、变量和各种逻辑语法等等，sass文件最终会被编译成css文件。</p>\n</blockquote>\n<ol>\n<li>变量</li>\n<li>计算功能</li>\n<li>继承</li>\n<li>Mixin</li>\n<li>函数</li>\n<li>高级用法</li>\n</ol>\n<h5>变量</h5>\n<p>Sass允许使用变量，所有变量以$开头：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$blue</span>: <span class=\"number\">#1875e7</span>;</span><br><span class=\"line\">　<span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　　　<span class=\"attribute\">color</span>: <span class=\"variable\">$blue</span>;</span><br><span class=\"line\">　&#125;</span><br></pre></td></tr></table></figure>\n<p>内嵌到字符串中的变量需要写在 ’ #{} ’ 中间：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$side</span>: left;</span><br><span class=\"line\"><span class=\"selector-class\">.rounded</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$side</span>&#125;-radius: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>计算功能</h5>\n<p>Sass允许在代码中使用算式：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">margin</span>: (<span class=\"number\">14px</span>/<span class=\"number\">2</span>);</span><br><span class=\"line\">　<span class=\"attribute\">top</span>: <span class=\"number\">50px</span> + <span class=\"number\">100px</span>;</span><br><span class=\"line\">　<span class=\"attribute\">right</span>: <span class=\"variable\">$var</span> * <span class=\"number\">10%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>继承</h5>\n<p>Sass允许一个选择器使用关键字 @extend 继承另一个选择器：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class1</span> &#123;</span><br><span class=\"line\">　　<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.class2</span> &#123;</span><br><span class=\"line\">　 @<span class=\"keyword\">extend</span> .class1;</span><br><span class=\"line\">　 <span class=\"attribute\">font-size</span>:<span class=\"number\">120%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>Mixin</h5>\n<p>Mixin是可以重用的代码块，使用 @mixin 关键字定义一个代码块：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> left &#123;</span><br><span class=\"line\">　<span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">　<span class=\"attribute\">margin-left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 @include 调用这个mixin：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　 @<span class=\"keyword\">include</span> left;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>mixin还能制定参数和参数默认值：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> left(<span class=\"variable\">$value</span>: 10px) &#123;</span><br><span class=\"line\">　 <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">　 <span class=\"attribute\">margin-right</span>: <span class=\"variable\">$value</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用的时候可以直接使用默认值或是加入参数值：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">　　　　@<span class=\"keyword\">include</span> left(<span class=\"number\">20px</span>);</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<h5>函数</h5>\n<p>Sass允许用户使用 @function 关键字编写自己的函数，函数可以直接使用：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@function double(<span class=\"variable\">$n</span>) &#123;</span><br><span class=\"line\">　 @return <span class=\"variable\">$n</span> * 2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#sidebar</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">width</span>: double(<span class=\"number\">5px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>高级用法</h5>\n<ul>\n<li>引入外部文件</li>\n<li>使用条件语句</li>\n<li>使用循环语句</li>\n</ul>\n<p>引入外部文件：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"../foo.css\"</span>;</span><br></pre></td></tr></table></figure>\n<p>使用条件语句：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">　@<span class=\"keyword\">if</span> 1 + 1 == 2 &#123; <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid; &#125;</span><br><span class=\"line\">　@<span class=\"keyword\">if</span> 5 &lt; 3 &#123; <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> dotted; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">if</span> <span class=\"variable\">$color</span> == <span class=\"string\">'#fff'</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">background-color</span>: <span class=\"number\">#000</span>;</span><br><span class=\"line\">&#125; @<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">　<span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用循环语句，支持for和while循环：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 to 10 &#123;</span><br><span class=\"line\">　　<span class=\"selector-class\">.border-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123;</span><br><span class=\"line\">　　　　<span class=\"attribute\">border</span>: #&#123;<span class=\"variable\">$i</span>&#125;px solid blue;</span><br><span class=\"line\">　　&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$i</span>: <span class=\"number\">6</span>;</span><br><span class=\"line\">　　@<span class=\"keyword\">while</span> <span class=\"variable\">$i</span> &gt; 0 &#123;</span><br><span class=\"line\">　　　　<span class=\"selector-class\">.item-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123; <span class=\"attribute\">width</span>: <span class=\"number\">2em</span> * <span class=\"variable\">$i</span>; &#125;</span><br><span class=\"line\">　　　　<span class=\"variable\">$i</span>: <span class=\"variable\">$i</span> - <span class=\"number\">2</span>;</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<h4>命名</h4>\n<hr>\n<ol>\n<li>ID命名</li>\n<li>Class命名</li>\n<li>父元素和子元素的命名规则</li>\n</ol>\n<h5>ID命名</h5>\n<p>统一采用驼峰命名法(camelCase)，第一个首字母小写，其它单词的首字母大写：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootlistitem</span> &#123;...&#125;</span><br><span class=\"line\"><span class=\"selector-id\">#RootListItem</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListItem</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<p>命名单词数最好不要超过3个：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListItemWrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-id\">#rootListWrapper</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5>Class命名</h5>\n<p>类的命名统一使用连字符 ‘-’ 连接各个单词，命名中不允许出现大写字母：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/* bad */</span><br><span class=\"line\">.contentWrapper &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/* good */</span><br><span class=\"line\">.content-wrapper &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<p>类名最好使用三个及三个以下的单词，至多不超过四个：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-list-item-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not-good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-list-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-detail-wrapper</span> &#123;...&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.file-wrapper</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5>父元素和子元素的命名规则</h5>\n<p>父元素和多级子元素的命名需要体现元素在页面的功能、样式、或结构：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.file-list-wrapper</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-header</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-body</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.list-body-aside</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.body-aside-left</span> &#123;...&#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.body-aside-right</span> &#123;...&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.list-body-main</span> &#123;...&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.file-list-footer</span> &#123;...&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>书写顺序</h4>\n<hr>\n<p>内部属性书写顺序应该按照从上到下是 布局定位、盒模型属性、表现性属性和其它：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* 布局定位 */</span></span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 盒模型属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 表现性属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Arial'</span>, sans-serif;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.5rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">word-break</span>: break-all;</span><br><span class=\"line\">  <span class=\"attribute\">word-wrap</span>: break-word;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#eee</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 其它 */</span></span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">500</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>代码缩进和嵌套</h4>\n<hr>\n<ol>\n<li>代码缩进</li>\n<li>多层嵌套</li>\n</ol>\n<h5>代码缩进</h5>\n<p>代码缩进统一使用两个空格，不要用四个空格和tab(编辑器内可以自定义tab输出的空格数，不用手打两个空格)</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>选择器与花括号之间要保留一个空格，属性名之后的冒号与属性值之间要保留一个空格，选择符号两边各保留一个空格</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span>&gt;<span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>:fixed;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &gt; <span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>多层嵌套</h5>\n<p>在Sass中你可以嵌套选择器，这可以使代码变得更模块化和可读，嵌套所有的选择器，但尽量避免嵌套没有任何内容的选择器(优先使用子选择器’ &gt; '，提高css查询性能)</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"attribute\">content</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在Sass中，当你嵌套你的选择器时也可以使用上下文媒体查询，你可以在任何给定的嵌套层次中使用媒体查询</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* bad */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.latest-news</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">font-size</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">  <span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.main</span> &gt; <span class=\"selector-class\">.latest-news</span> &gt; <span class=\"selector-class\">.news-article</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">3rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">0.8rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-page</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.latest-news</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt; <span class=\"selector-class\">.news-article</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">font-size</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">          @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">3rem</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &gt; <span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.page-footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    @<span class=\"keyword\">media</span> screen and (min-width: 641px) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">font-size</span>: <span class=\"number\">0.8rem</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>嵌套顺序和选择器，以下是一个sass块应该具有的顺序：</p>\n<ol>\n<li>当前选择器的样式属性</li>\n<li>当前选择器的伪类选择器 (:first-letter, :hover, :active)伪类元素 (:before and :after)</li>\n<li>当前选择器的声明样式 (.selected, .active, .enlarged)</li>\n<li>用Sass的上下文媒体查询</li>\n<li>子选择器作为最后的部分</li>\n</ol>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.product-teaser</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的样式属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: whitesmoke;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: grey;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的伪类选择器 */</span></span><br><span class=\"line\">  &amp;:hover &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;:before &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">1px</span> solid grey;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;:after &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">1px</span> solid grey;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 当前选择器的声明样式 */</span></span><br><span class=\"line\">  &amp;<span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: pink;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 上下文媒体查询 */</span></span><br><span class=\"line\">  @<span class=\"keyword\">media</span> screen and (max-width: 640px) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 子选择器 */</span></span><br><span class=\"line\">  &gt; <span class=\"selector-class\">.content</span> &gt; <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.2em</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 子选择器上下文媒体查询 */</span></span><br><span class=\"line\">    @<span class=\"keyword\">media</span> screen and (max-width: 640px) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">letter-spacing</span>: <span class=\"number\">0.2em</span>;</span><br><span class=\"line\">      <span class=\"attribute\">text-transform</span>: uppercase;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4>注释</h4>\n<hr>\n<blockquote>\n<p>代码编辑器一般都可以自定义代码段(snippets)，通过编辑自定义代码段配置文件将快捷键绑定到一段自定义代码可以实现快捷插入代码段</p>\n</blockquote>\n<ol>\n<li>组件注释</li>\n<li>子组件注释</li>\n<li>一般注释</li>\n</ol>\n<h5>组件注释</h5>\n<p>一个大组件需要使用组件注释，体现页面结构。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ==========================================================</span></span><br><span class=\"line\"><span class=\"comment\">父组件 file-list</span></span><br><span class=\"line\"><span class=\"comment\">============================================================= */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-list</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5>子组件注释</h5>\n<p>一个组件的子组件需要使用子组件注释，体现组件整体结构。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 子组件 file-list-item</span></span><br><span class=\"line\"><span class=\"comment\">============================================================= */</span></span><br><span class=\"line\"><span class=\"selector-class\">.file-list-item</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>\n<h5>一般注释</h5>\n<p>使用块注释和行注释都行，重要的是体现代码结构和代码简洁度</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 块注释 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.class1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 行注释</span></span><br><span class=\"line\">  <span class=\"selector-class\">.title</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> &#123;  <span class=\"comment\">// 行注释2</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"polipo服务配置shadowsocks终端代理","catalog":true,"toc_nav_num":true,"date":"2018-04-04T08:30:35.000Z","subtitle":"shadowsocks polipo","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2018-04-04T08:30:35.000Z","top":null,"_content":"\n在linux系统中，一般配置好shadowsocks之后，浏览器设置好代理，浏览器就可以翻墙。但是由于ss使用的是`socks5`协议，而大部分终端都只支持`http`和`https`等协议，终端是无法直接通过ss来翻墙。通过polipo这个轻量级的缓存web代理程序来转换，可实现终端翻墙。\n\n#### 安装shadowsocks[](http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85shadowsocks)\n\n通过pip可以非常简单地安装。需要安装ss需要的依赖。\n\n```\nsudo apt-get update\nsudo apt-get install python-pip\nsudo apt-get install python-setuptools m2crypto\n\npip install shadowsocks\n```\n\n#### 启动shadowsocks[](http://keliu.me/2018/12/08/ss/#%E5%90%AF%E5%8A%A8shadowsocks)\n\n使用`sslocal`命令来启动shadowsocks。\n\n一般在`/etc`目录下创建一个`shadowsocks.json`文件：\n\n```\nvi /etc/shadowsocks.json\n```\n\n保存如下形式的ss服务端信息：\n\n```\n{\n    \"server\":\"11.22.33.44\",\n    \"server_port\":6666,\n    \"local_port\":1080,\n    \"password\":\"123456\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\"\n}\n```\n\n启动ss。\n\n```\nsslocal -c /etc/shadowsocks.json\n```\n\n可以设置开机自动启动服务，还有浏览器代理的配置，此处也都暂时不讲。\n\n#### 安装配置polipo[](http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEpolipo)\n\n安装：\n\n```\nsudo apt-get install polipo\n```\n\npolio的配置文件在`/etc/polipo/config`目录。打开，编辑保存如下信息：\n\n```\n# This file only needs to list configuration variables that deviate\n# from the default values.  See /usr/share/doc/polipo/examples/config.sample\n# and \"polipo -v\" for variables you can tweak and further information.\n\nlogSyslog = true\nlogFile = /var/log/polipo/polipo.log\n\nproxyAddress = \"0.0.0.0\"\n\nsocksParentProxy = \"127.0.0.1:1080\"\nsocksProxyType = socks5\nproxyPort = 8123\n\nchunkHighMark = 50331648\nobjectHighMark = 16384\n\nserverMaxSlots = 64\nserverSlots = 16\nserverSlots1 = 32\n```\n\n重新启动polipo服务：\n\n```\n/etc/init.d/polipo restart\n```\n\n#### 使用代理[](http://keliu.me/2018/12/08/ss/#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86)\n\npolipo的默认端口号是 8123，**每次使用**代理前，**必须**进行如下操作：\n\n```\nexport http_proxy=http://127.0.0.1:8123\n```\n\n然后可以验证是否成功：\n\n```\ncurl www.google.com\n```\n\n**取消代理**：\n\n```\nunset http_proxy\n```\n\n如果想**持久化**运行，可以将` export http_proxy=http://127.0.0.1:8123`这个语句添加到` ~/.bashrc`文件内，并用`source ~/.bashrc`命令使之生效。\n","source":"_posts/shadowsocks_polipo.md","raw":"---\ntitle: \"polipo服务配置shadowsocks终端代理\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-04 16:30:35\nsubtitle: \"shadowsocks polipo\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Shadowsocks\n- Proxy\ncatagories:\n- Linux\nupdateDate: 2018-04-04 16:30:35\ntop: \n---\n\n在linux系统中，一般配置好shadowsocks之后，浏览器设置好代理，浏览器就可以翻墙。但是由于ss使用的是`socks5`协议，而大部分终端都只支持`http`和`https`等协议，终端是无法直接通过ss来翻墙。通过polipo这个轻量级的缓存web代理程序来转换，可实现终端翻墙。\n\n#### 安装shadowsocks[](http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85shadowsocks)\n\n通过pip可以非常简单地安装。需要安装ss需要的依赖。\n\n```\nsudo apt-get update\nsudo apt-get install python-pip\nsudo apt-get install python-setuptools m2crypto\n\npip install shadowsocks\n```\n\n#### 启动shadowsocks[](http://keliu.me/2018/12/08/ss/#%E5%90%AF%E5%8A%A8shadowsocks)\n\n使用`sslocal`命令来启动shadowsocks。\n\n一般在`/etc`目录下创建一个`shadowsocks.json`文件：\n\n```\nvi /etc/shadowsocks.json\n```\n\n保存如下形式的ss服务端信息：\n\n```\n{\n    \"server\":\"11.22.33.44\",\n    \"server_port\":6666,\n    \"local_port\":1080,\n    \"password\":\"123456\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\"\n}\n```\n\n启动ss。\n\n```\nsslocal -c /etc/shadowsocks.json\n```\n\n可以设置开机自动启动服务，还有浏览器代理的配置，此处也都暂时不讲。\n\n#### 安装配置polipo[](http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEpolipo)\n\n安装：\n\n```\nsudo apt-get install polipo\n```\n\npolio的配置文件在`/etc/polipo/config`目录。打开，编辑保存如下信息：\n\n```\n# This file only needs to list configuration variables that deviate\n# from the default values.  See /usr/share/doc/polipo/examples/config.sample\n# and \"polipo -v\" for variables you can tweak and further information.\n\nlogSyslog = true\nlogFile = /var/log/polipo/polipo.log\n\nproxyAddress = \"0.0.0.0\"\n\nsocksParentProxy = \"127.0.0.1:1080\"\nsocksProxyType = socks5\nproxyPort = 8123\n\nchunkHighMark = 50331648\nobjectHighMark = 16384\n\nserverMaxSlots = 64\nserverSlots = 16\nserverSlots1 = 32\n```\n\n重新启动polipo服务：\n\n```\n/etc/init.d/polipo restart\n```\n\n#### 使用代理[](http://keliu.me/2018/12/08/ss/#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86)\n\npolipo的默认端口号是 8123，**每次使用**代理前，**必须**进行如下操作：\n\n```\nexport http_proxy=http://127.0.0.1:8123\n```\n\n然后可以验证是否成功：\n\n```\ncurl www.google.com\n```\n\n**取消代理**：\n\n```\nunset http_proxy\n```\n\n如果想**持久化**运行，可以将` export http_proxy=http://127.0.0.1:8123`这个语句添加到` ~/.bashrc`文件内，并用`source ~/.bashrc`命令使之生效。\n","slug":"shadowsocks_polipo","published":1,"updated":"2020-03-12T02:22:53.471Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn5000ga8950o72748l","content":"<p>在linux系统中，一般配置好shadowsocks之后，浏览器设置好代理，浏览器就可以翻墙。但是由于ss使用的是<code>socks5</code>协议，而大部分终端都只支持<code>http</code>和<code>https</code>等协议，终端是无法直接通过ss来翻墙。通过polipo这个轻量级的缓存web代理程序来转换，可实现终端翻墙。</p>\n<h4 id=\"安装shadowsocks\">安装shadowsocks<a href=\"http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85shadowsocks\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>通过pip可以非常简单地安装。需要安装ss需要的依赖。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install python-pip</span><br><span class=\"line\">sudo apt-get install python-setuptools m2crypto</span><br><span class=\"line\"></span><br><span class=\"line\">pip install shadowsocks</span><br></pre></td></tr></table></figure>\n<h4 id=\"启动shadowsocks\">启动shadowsocks<a href=\"http://keliu.me/2018/12/08/ss/#%E5%90%AF%E5%8A%A8shadowsocks\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>使用<code>sslocal</code>命令来启动shadowsocks。</p>\n<p>一般在<code>/etc</code>目录下创建一个<code>shadowsocks.json</code>文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n<p>保存如下形式的ss服务端信息：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;:&quot;11.22.33.44&quot;,</span><br><span class=\"line\">    &quot;server_port&quot;:6666,</span><br><span class=\"line\">    &quot;local_port&quot;:1080,</span><br><span class=\"line\">    &quot;password&quot;:&quot;123456&quot;,</span><br><span class=\"line\">    &quot;timeout&quot;:300,</span><br><span class=\"line\">    &quot;method&quot;:&quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动ss。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sslocal -c /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n<p>可以设置开机自动启动服务，还有浏览器代理的配置，此处也都暂时不讲。</p>\n<h4 id=\"安装配置polipo\">安装配置polipo<a href=\"http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEpolipo\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>安装：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install polipo</span><br></pre></td></tr></table></figure>\n<p>polio的配置文件在<code>/etc/polipo/config</code>目录。打开，编辑保存如下信息：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># This file only needs to list configuration variables that deviate</span><br><span class=\"line\"># from the default values.  See /usr/share/doc/polipo/examples/config.sample</span><br><span class=\"line\"># and &quot;polipo -v&quot; for variables you can tweak and further information.</span><br><span class=\"line\"></span><br><span class=\"line\">logSyslog = true</span><br><span class=\"line\">logFile = /var/log/polipo/polipo.log</span><br><span class=\"line\"></span><br><span class=\"line\">proxyAddress = &quot;0.0.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">socksParentProxy = &quot;127.0.0.1:1080&quot;</span><br><span class=\"line\">socksProxyType = socks5</span><br><span class=\"line\">proxyPort = 8123</span><br><span class=\"line\"></span><br><span class=\"line\">chunkHighMark = 50331648</span><br><span class=\"line\">objectHighMark = 16384</span><br><span class=\"line\"></span><br><span class=\"line\">serverMaxSlots = 64</span><br><span class=\"line\">serverSlots = 16</span><br><span class=\"line\">serverSlots1 = 32</span><br></pre></td></tr></table></figure>\n<p>重新启动polipo服务：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/polipo restart</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用代理\">使用代理<a href=\"http://keliu.me/2018/12/08/ss/#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>polipo的默认端口号是 8123，<strong>每次使用</strong>代理前，<strong>必须</strong>进行如下操作：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export http_proxy=http://127.0.0.1:8123</span><br></pre></td></tr></table></figure>\n<p>然后可以验证是否成功：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl www.google.com</span><br></pre></td></tr></table></figure>\n<p><strong>取消代理</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unset http_proxy</span><br></pre></td></tr></table></figure>\n<p>如果想<strong>持久化</strong>运行，可以将<code>export http_proxy=http://127.0.0.1:8123</code>这个语句添加到<code>~/.bashrc</code>文件内，并用<code>source ~/.bashrc</code>命令使之生效。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在linux系统中，一般配置好shadowsocks之后，浏览器设置好代理，浏览器就可以翻墙。但是由于ss使用的是<code>socks5</code>协议，而大部分终端都只支持<code>http</code>和<code>https</code>等协议，终端是无法直接通过ss来翻墙。通过polipo这个轻量级的缓存web代理程序来转换，可实现终端翻墙。</p>\n<h4>安装shadowsocks<a href=\"http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85shadowsocks\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>通过pip可以非常简单地安装。需要安装ss需要的依赖。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install python-pip</span><br><span class=\"line\">sudo apt-get install python-setuptools m2crypto</span><br><span class=\"line\"></span><br><span class=\"line\">pip install shadowsocks</span><br></pre></td></tr></table></figure>\n<h4>启动shadowsocks<a href=\"http://keliu.me/2018/12/08/ss/#%E5%90%AF%E5%8A%A8shadowsocks\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>使用<code>sslocal</code>命令来启动shadowsocks。</p>\n<p>一般在<code>/etc</code>目录下创建一个<code>shadowsocks.json</code>文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n<p>保存如下形式的ss服务端信息：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;:&quot;11.22.33.44&quot;,</span><br><span class=\"line\">    &quot;server_port&quot;:6666,</span><br><span class=\"line\">    &quot;local_port&quot;:1080,</span><br><span class=\"line\">    &quot;password&quot;:&quot;123456&quot;,</span><br><span class=\"line\">    &quot;timeout&quot;:300,</span><br><span class=\"line\">    &quot;method&quot;:&quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动ss。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sslocal -c /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n<p>可以设置开机自动启动服务，还有浏览器代理的配置，此处也都暂时不讲。</p>\n<h4>安装配置polipo<a href=\"http://keliu.me/2018/12/08/ss/#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEpolipo\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>安装：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install polipo</span><br></pre></td></tr></table></figure>\n<p>polio的配置文件在<code>/etc/polipo/config</code>目录。打开，编辑保存如下信息：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># This file only needs to list configuration variables that deviate</span><br><span class=\"line\"># from the default values.  See /usr/share/doc/polipo/examples/config.sample</span><br><span class=\"line\"># and &quot;polipo -v&quot; for variables you can tweak and further information.</span><br><span class=\"line\"></span><br><span class=\"line\">logSyslog = true</span><br><span class=\"line\">logFile = /var/log/polipo/polipo.log</span><br><span class=\"line\"></span><br><span class=\"line\">proxyAddress = &quot;0.0.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">socksParentProxy = &quot;127.0.0.1:1080&quot;</span><br><span class=\"line\">socksProxyType = socks5</span><br><span class=\"line\">proxyPort = 8123</span><br><span class=\"line\"></span><br><span class=\"line\">chunkHighMark = 50331648</span><br><span class=\"line\">objectHighMark = 16384</span><br><span class=\"line\"></span><br><span class=\"line\">serverMaxSlots = 64</span><br><span class=\"line\">serverSlots = 16</span><br><span class=\"line\">serverSlots1 = 32</span><br></pre></td></tr></table></figure>\n<p>重新启动polipo服务：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/polipo restart</span><br></pre></td></tr></table></figure>\n<h4>使用代理<a href=\"http://keliu.me/2018/12/08/ss/#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86\" target=\"_blank\" rel=\"noopener\"></a></h4>\n<p>polipo的默认端口号是 8123，<strong>每次使用</strong>代理前，<strong>必须</strong>进行如下操作：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export http_proxy=http://127.0.0.1:8123</span><br></pre></td></tr></table></figure>\n<p>然后可以验证是否成功：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl www.google.com</span><br></pre></td></tr></table></figure>\n<p><strong>取消代理</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unset http_proxy</span><br></pre></td></tr></table></figure>\n<p>如果想<strong>持久化</strong>运行，可以将<code>export http_proxy=http://127.0.0.1:8123</code>这个语句添加到<code>~/.bashrc</code>文件内，并用<code>source ~/.bashrc</code>命令使之生效。</p>\n"},{"title":"原生Js实现瀑布流效果","catalog":true,"toc_nav_num":true,"date":"2018-04-01T08:01:26.000Z","subtitle":"javascript waterFall","header-img":"/blogs/img/article_header/article_header.png","catagories":["Javascript"],"updateDate":"2018-04-01T08:01:26.000Z","top":null,"_content":"\n#### 盗用的效果图\n![preview](/blogs/img/article/waterfall-1.gif)\n\n#### 效果分析\n瀑布流中图片的宽度都是固定的，但是高度需要设置为auto以使图片不变形，高度不固定。首先想到能不能用float属性让图片流动，想象中很美好，实际效果如下，可以看到因为第三个元素的高度问题，第二行元素流动时被第三个元素挡住，导致了布局错乱。\n\n![float](/blogs/img/article/waterfall-2.jpg)  \n\n看看百度图片是怎么实现图片布局的，如下图，可以看出百度用了讨巧的办法，图片跟我们这个瀑布流的图片的宽高设定正好相反，百度图片的列数同样固定，但是高度也固定，而宽度不固定，这样处理的话正好能避免上面那个float流动的问题，这个... 好吧 最后我们还是来说说怎样实现我们效果图中那样的瀑布流布局。\n\n![baidu](/blogs/img/article/waterfall-3.jpg)  \n\n#### 解决方法\n\n* html结构如下，需要说明的是container元素是相对定位，每个item元素都是绝对定位，这样我们通过设置item元素的top和left值就能改变它们的位置了，图片的宽度是100%(这儿思考一下为什么img的父级需要设置box-sizing: border-box)。\n\n```html\n<!-- 页面结构 -->\n<div class=\"water-fall-container\">\n  <div class=\"water-fall-item\">\n    <img src=\"url\">\n  </div>\n  ...\n  <div class=\"water-fall-item\">\n    <img src=\"url\">\n  </div>\n</div>\n\n```\n\n* 我把主要逻辑写成了构造函数的形式，这样一个页面中通过传入不同的参数就能创建多个瀑布流实例。构造函数中我们依次需要传入容器元素本身、子元素的选择器(.water-fall-item)、\n每一列自定义的宽度(单位是px)、图片之间间隔的距离(实际上是padding-right 和 padding-bottom 的值，单位px)，通过这些指标我们首先能够计算出容器元素的宽度，\n(容器宽度 / 列宽) === 总共的列数，最后在step函数里就是布局的代码了，step做的事儿就是遍历容器元素下的每个item元素，设置它们的宽度、高度、top值、left值以及padding值，\n其中第一行元素top值固定为零，left值依次根据数组下标再乘以列宽，到了第二行之后的元素就省事儿了，直接设置当前元素的top值为 对应的那个上一排元素的top值+上一排元素的高度值(clientHeight)，而left值每一排都相同，因为列宽和列数是固定的。\n\n```javascript\n\n/**\n * [WaterFall 图片瀑布流构造函数]\n * @param  {DomElement} father   [瀑布流的容器元素]\n * @param  {String} childClass   [瀑布流子元素类名选择器 如: .water-fall-item]\n * @param  {Number} columnWidth  [设定每一列的宽度，单位: px]\n * @param  {Number} paddingWidth [设定图片之间的间隔距离， 单位: px]\n */\nfunction WaterFall(father, childClass, columnWidth, paddingWidth) {\n  this.$container = father;  // 容器\n  this.childSelector = childClass;  // 子代img选择器\n  this.children = [];  // 子代img\n  this.columnWidth = columnWidth;  // 单列宽度\n  this.paddingWidth = paddingWidth + 'px';  // 图片之间的间隔距离\n\n  this.totalWidth = this.$container.clientWidth;  // 容器宽度\n  this.columnNum = ~~(this.totalWidth / this.columnWidth);  // 列数\n\n  // 调用多次\n  this.step = function () {\n    this.totalWidth = this.$container.clientWidth;\n    this.columnNum = ~~(this.totalWidth / this.columnWidth);\n    this.children = this.$container.querySelectorAll(this.childSelector);\n    for (var i = 0; i < this.children.length; i++) {\n      this.children[i].style.width = this.columnWidth + 'px';\n      this.children[i].style.height = 'auto';\n      this.children[i].style.paddingRight = this.paddingWidth;\n      this.children[i].style.paddingBottom = this.paddingWidth;\n\n      // 每行第一个设置左padding\n      if (i % this.columnNum === 0) {\n        this.children[i].style.paddingLeft = this.paddingWidth;\n      }\n\n      // 第一行 和 其它行的不同处理\n      if (i < this.columnNum) {\n        this.children[i].style.left = (i) * this.columnWidth + 'px';\n        this.children[i].style.top = (i) * 0 + 'px';\n      }else {\n        this.children[i].style.left = this.children[i - this.columnNum].style.left;\n        this.children[i].style.top = +this.children[i - this.columnNum].style.top.replace('px', '') +\n                                      this.children[i - this.columnNum].clientHeight + 'px';\n      }\n    }\n  };\n};\n\n```\n\n* 再看看从页面图片加载到生成瀑布流实例我是怎样处理的，前面部分先通过一组图片url地址将所有图片加载到页面上，中间设定参数后生成一个瀑布流实例，最后重点是\n弄清楚我们需要在什么时候调用waterfall.step()函数来处理页面中item元素的重排。我可能用了个比价笨的办法：在所有图片加载完成之前 使用定时器 轮询每个图片的加载情况，并进行布局，所有图片加载完后就取消定时器。最后别忘记 窗口拖动后也要重新布局，在这儿我用了一个函数节流的思想，防止resize短时间内多次触发，改善页面性能，至于节流函数怎么写，大家可以看看相关概念然后自己实现一个，so easy !\n\n```javascript\n\n/**\n * [waterFallInit 瀑布流初始化]\n * @param  {String} wData [图片url的数组]\n */\nvar waterFallInit = function (wData) {\n  var fragment = document.createDocumentFragment();\n  var div, img, timer, $imgs, length, index = 0;\n  // 载入图片\n  for (var i = 0; i < wData.length; i++) {\n    div = document.createElement('div');\n    img = document.createElement('img');\n    div.setAttribute('class', 'water-fall-item');\n    img.setAttribute('src', wData[i]);\n    div.appendChild(img);\n    fragment.appendChild(div);\n    if (i === wData.length - 1) {\n      domMap.$waterFall.appendChild(fragment);\n    }\n  }\n\n  // 一个瀑布流实例\n  var waterfall = new WaterFall(domMap.$waterFall, '.water-fall-item', 200, 5);\n\n  // 轮询所有图片的加载状态\n  timer = setInterval(function () {\n    index=0;\n    $imgs = domMap.$waterFall.querySelectorAll('.water-fall-item > img');\n    length = $imgs.length;\n    // 统计图片加载完成的数量\n    for (var i = 0; i < $imgs.length; i++) {\n      if ($imgs[i].complete) {\n        if (++index === length) clearInterval(timer);\n      }\n    }\n    waterfall.step();\n  }, 250);\n\n  // 窗口拖动\n   window.onresize =  function () {\n     Utils.FnDelay(function () {\n       waterfall.step();\n     }, 800);\n   }\n};\n\n```\n\n#### 感谢阅读\n_代码存放在github：[nojsja](https://github.com/NoJsJa/javascript-learning/tree/master/normal/water-fall-layout)_\n","source":"_posts/water-fall-layout.md","raw":"---\ntitle: \"原生Js实现瀑布流效果\"\ncatalog: true\ntoc_nav_num: true\ndate:   2018-04-01 16:01:26\nsubtitle: \"javascript waterFall\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Javascript\n- WaterFall\ncatagories:\n- Javascript\nupdateDate: 2018-04-01 16:01:26\ntop: \n---\n\n#### 盗用的效果图\n![preview](/blogs/img/article/waterfall-1.gif)\n\n#### 效果分析\n瀑布流中图片的宽度都是固定的，但是高度需要设置为auto以使图片不变形，高度不固定。首先想到能不能用float属性让图片流动，想象中很美好，实际效果如下，可以看到因为第三个元素的高度问题，第二行元素流动时被第三个元素挡住，导致了布局错乱。\n\n![float](/blogs/img/article/waterfall-2.jpg)  \n\n看看百度图片是怎么实现图片布局的，如下图，可以看出百度用了讨巧的办法，图片跟我们这个瀑布流的图片的宽高设定正好相反，百度图片的列数同样固定，但是高度也固定，而宽度不固定，这样处理的话正好能避免上面那个float流动的问题，这个... 好吧 最后我们还是来说说怎样实现我们效果图中那样的瀑布流布局。\n\n![baidu](/blogs/img/article/waterfall-3.jpg)  \n\n#### 解决方法\n\n* html结构如下，需要说明的是container元素是相对定位，每个item元素都是绝对定位，这样我们通过设置item元素的top和left值就能改变它们的位置了，图片的宽度是100%(这儿思考一下为什么img的父级需要设置box-sizing: border-box)。\n\n```html\n<!-- 页面结构 -->\n<div class=\"water-fall-container\">\n  <div class=\"water-fall-item\">\n    <img src=\"url\">\n  </div>\n  ...\n  <div class=\"water-fall-item\">\n    <img src=\"url\">\n  </div>\n</div>\n\n```\n\n* 我把主要逻辑写成了构造函数的形式，这样一个页面中通过传入不同的参数就能创建多个瀑布流实例。构造函数中我们依次需要传入容器元素本身、子元素的选择器(.water-fall-item)、\n每一列自定义的宽度(单位是px)、图片之间间隔的距离(实际上是padding-right 和 padding-bottom 的值，单位px)，通过这些指标我们首先能够计算出容器元素的宽度，\n(容器宽度 / 列宽) === 总共的列数，最后在step函数里就是布局的代码了，step做的事儿就是遍历容器元素下的每个item元素，设置它们的宽度、高度、top值、left值以及padding值，\n其中第一行元素top值固定为零，left值依次根据数组下标再乘以列宽，到了第二行之后的元素就省事儿了，直接设置当前元素的top值为 对应的那个上一排元素的top值+上一排元素的高度值(clientHeight)，而left值每一排都相同，因为列宽和列数是固定的。\n\n```javascript\n\n/**\n * [WaterFall 图片瀑布流构造函数]\n * @param  {DomElement} father   [瀑布流的容器元素]\n * @param  {String} childClass   [瀑布流子元素类名选择器 如: .water-fall-item]\n * @param  {Number} columnWidth  [设定每一列的宽度，单位: px]\n * @param  {Number} paddingWidth [设定图片之间的间隔距离， 单位: px]\n */\nfunction WaterFall(father, childClass, columnWidth, paddingWidth) {\n  this.$container = father;  // 容器\n  this.childSelector = childClass;  // 子代img选择器\n  this.children = [];  // 子代img\n  this.columnWidth = columnWidth;  // 单列宽度\n  this.paddingWidth = paddingWidth + 'px';  // 图片之间的间隔距离\n\n  this.totalWidth = this.$container.clientWidth;  // 容器宽度\n  this.columnNum = ~~(this.totalWidth / this.columnWidth);  // 列数\n\n  // 调用多次\n  this.step = function () {\n    this.totalWidth = this.$container.clientWidth;\n    this.columnNum = ~~(this.totalWidth / this.columnWidth);\n    this.children = this.$container.querySelectorAll(this.childSelector);\n    for (var i = 0; i < this.children.length; i++) {\n      this.children[i].style.width = this.columnWidth + 'px';\n      this.children[i].style.height = 'auto';\n      this.children[i].style.paddingRight = this.paddingWidth;\n      this.children[i].style.paddingBottom = this.paddingWidth;\n\n      // 每行第一个设置左padding\n      if (i % this.columnNum === 0) {\n        this.children[i].style.paddingLeft = this.paddingWidth;\n      }\n\n      // 第一行 和 其它行的不同处理\n      if (i < this.columnNum) {\n        this.children[i].style.left = (i) * this.columnWidth + 'px';\n        this.children[i].style.top = (i) * 0 + 'px';\n      }else {\n        this.children[i].style.left = this.children[i - this.columnNum].style.left;\n        this.children[i].style.top = +this.children[i - this.columnNum].style.top.replace('px', '') +\n                                      this.children[i - this.columnNum].clientHeight + 'px';\n      }\n    }\n  };\n};\n\n```\n\n* 再看看从页面图片加载到生成瀑布流实例我是怎样处理的，前面部分先通过一组图片url地址将所有图片加载到页面上，中间设定参数后生成一个瀑布流实例，最后重点是\n弄清楚我们需要在什么时候调用waterfall.step()函数来处理页面中item元素的重排。我可能用了个比价笨的办法：在所有图片加载完成之前 使用定时器 轮询每个图片的加载情况，并进行布局，所有图片加载完后就取消定时器。最后别忘记 窗口拖动后也要重新布局，在这儿我用了一个函数节流的思想，防止resize短时间内多次触发，改善页面性能，至于节流函数怎么写，大家可以看看相关概念然后自己实现一个，so easy !\n\n```javascript\n\n/**\n * [waterFallInit 瀑布流初始化]\n * @param  {String} wData [图片url的数组]\n */\nvar waterFallInit = function (wData) {\n  var fragment = document.createDocumentFragment();\n  var div, img, timer, $imgs, length, index = 0;\n  // 载入图片\n  for (var i = 0; i < wData.length; i++) {\n    div = document.createElement('div');\n    img = document.createElement('img');\n    div.setAttribute('class', 'water-fall-item');\n    img.setAttribute('src', wData[i]);\n    div.appendChild(img);\n    fragment.appendChild(div);\n    if (i === wData.length - 1) {\n      domMap.$waterFall.appendChild(fragment);\n    }\n  }\n\n  // 一个瀑布流实例\n  var waterfall = new WaterFall(domMap.$waterFall, '.water-fall-item', 200, 5);\n\n  // 轮询所有图片的加载状态\n  timer = setInterval(function () {\n    index=0;\n    $imgs = domMap.$waterFall.querySelectorAll('.water-fall-item > img');\n    length = $imgs.length;\n    // 统计图片加载完成的数量\n    for (var i = 0; i < $imgs.length; i++) {\n      if ($imgs[i].complete) {\n        if (++index === length) clearInterval(timer);\n      }\n    }\n    waterfall.step();\n  }, 250);\n\n  // 窗口拖动\n   window.onresize =  function () {\n     Utils.FnDelay(function () {\n       waterfall.step();\n     }, 800);\n   }\n};\n\n```\n\n#### 感谢阅读\n_代码存放在github：[nojsja](https://github.com/NoJsJa/javascript-learning/tree/master/normal/water-fall-layout)_\n","slug":"water-fall-layout","published":1,"updated":"2020-03-10T16:52:57.560Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn6000ja895euaponrl","content":"<h4 id=\"盗用的效果图\">盗用的效果图</h4>\n<p><img src=\"/blogs/img/article/waterfall-1.gif\" alt=\"preview\"></p>\n<h4 id=\"效果分析\">效果分析</h4>\n<p>瀑布流中图片的宽度都是固定的，但是高度需要设置为auto以使图片不变形，高度不固定。首先想到能不能用float属性让图片流动，想象中很美好，实际效果如下，可以看到因为第三个元素的高度问题，第二行元素流动时被第三个元素挡住，导致了布局错乱。</p>\n<p><img src=\"/blogs/img/article/waterfall-2.jpg\" alt=\"float\"></p>\n<p>看看百度图片是怎么实现图片布局的，如下图，可以看出百度用了讨巧的办法，图片跟我们这个瀑布流的图片的宽高设定正好相反，百度图片的列数同样固定，但是高度也固定，而宽度不固定，这样处理的话正好能避免上面那个float流动的问题，这个… 好吧 最后我们还是来说说怎样实现我们效果图中那样的瀑布流布局。</p>\n<p><img src=\"/blogs/img/article/waterfall-3.jpg\" alt=\"baidu\"></p>\n<h4 id=\"解决方法\">解决方法</h4>\n<ul>\n<li>html结构如下，需要说明的是container元素是相对定位，每个item元素都是绝对定位，这样我们通过设置item元素的top和left值就能改变它们的位置了，图片的宽度是100%(这儿思考一下为什么img的父级需要设置box-sizing: border-box)。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 页面结构 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-container\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"url\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"url\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>我把主要逻辑写成了构造函数的形式，这样一个页面中通过传入不同的参数就能创建多个瀑布流实例。构造函数中我们依次需要传入容器元素本身、子元素的选择器(.water-fall-item)、<br>\n每一列自定义的宽度(单位是px)、图片之间间隔的距离(实际上是padding-right 和 padding-bottom 的值，单位px)，通过这些指标我们首先能够计算出容器元素的宽度，<br>\n(容器宽度 / 列宽) === 总共的列数，最后在step函数里就是布局的代码了，step做的事儿就是遍历容器元素下的每个item元素，设置它们的宽度、高度、top值、left值以及padding值，<br>\n其中第一行元素top值固定为零，left值依次根据数组下标再乘以列宽，到了第二行之后的元素就省事儿了，直接设置当前元素的top值为 对应的那个上一排元素的top值+上一排元素的高度值(clientHeight)，而left值每一排都相同，因为列宽和列数是固定的。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [WaterFall 图片瀑布流构造函数]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;DomElement&#125; father   [瀑布流的容器元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;String&#125; childClass   [瀑布流子元素类名选择器 如: .water-fall-item]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;Number&#125; columnWidth  [设定每一列的宽度，单位: px]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;Number&#125; paddingWidth [设定图片之间的间隔距离， 单位: px]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">WaterFall</span>(<span class=\"params\">father, childClass, columnWidth, paddingWidth</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.$container = father;  <span class=\"comment\">// 容器</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.childSelector = childClass;  <span class=\"comment\">// 子代img选择器</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.children = [];  <span class=\"comment\">// 子代img</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.columnWidth = columnWidth;  <span class=\"comment\">// 单列宽度</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.paddingWidth = paddingWidth + <span class=\"string\">'px'</span>;  <span class=\"comment\">// 图片之间的间隔距离</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.totalWidth = <span class=\"keyword\">this</span>.$container.clientWidth;  <span class=\"comment\">// 容器宽度</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.columnNum = ~~(<span class=\"keyword\">this</span>.totalWidth / <span class=\"keyword\">this</span>.columnWidth);  <span class=\"comment\">// 列数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 调用多次</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.step = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.totalWidth = <span class=\"keyword\">this</span>.$container.clientWidth;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.columnNum = ~~(<span class=\"keyword\">this</span>.totalWidth / <span class=\"keyword\">this</span>.columnWidth);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.children = <span class=\"keyword\">this</span>.$container.querySelectorAll(<span class=\"keyword\">this</span>.childSelector);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.children.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.width = <span class=\"keyword\">this</span>.columnWidth + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.height = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.paddingRight = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.paddingBottom = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 每行第一个设置左padding</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i % <span class=\"keyword\">this</span>.columnNum === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.paddingLeft = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 第一行 和 其它行的不同处理</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i &lt; <span class=\"keyword\">this</span>.columnNum) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.left = (i) * <span class=\"keyword\">this</span>.columnWidth + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.top = (i) * <span class=\"number\">0</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.left = <span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].style.left;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.top = +<span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].style.top.replace(<span class=\"string\">'px'</span>, <span class=\"string\">''</span>) +</span><br><span class=\"line\">                                      <span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].clientHeight + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>再看看从页面图片加载到生成瀑布流实例我是怎样处理的，前面部分先通过一组图片url地址将所有图片加载到页面上，中间设定参数后生成一个瀑布流实例，最后重点是<br>\n弄清楚我们需要在什么时候调用waterfall.step()函数来处理页面中item元素的重排。我可能用了个比价笨的办法：在所有图片加载完成之前 使用定时器 轮询每个图片的加载情况，并进行布局，所有图片加载完后就取消定时器。最后别忘记 窗口拖动后也要重新布局，在这儿我用了一个函数节流的思想，防止resize短时间内多次触发，改善页面性能，至于节流函数怎么写，大家可以看看相关概念然后自己实现一个，so easy !</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [waterFallInit 瀑布流初始化]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;String&#125; wData [图片url的数组]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> waterFallInit = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wData</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> div, img, timer, $imgs, length, index = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 载入图片</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; wData.length; i++) &#123;</span><br><span class=\"line\">    div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    div.setAttribute(<span class=\"string\">'class'</span>, <span class=\"string\">'water-fall-item'</span>);</span><br><span class=\"line\">    img.setAttribute(<span class=\"string\">'src'</span>, wData[i]);</span><br><span class=\"line\">    div.appendChild(img);</span><br><span class=\"line\">    fragment.appendChild(div);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === wData.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      domMap.$waterFall.appendChild(fragment);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一个瀑布流实例</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> waterfall = <span class=\"keyword\">new</span> WaterFall(domMap.$waterFall, <span class=\"string\">'.water-fall-item'</span>, <span class=\"number\">200</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 轮询所有图片的加载状态</span></span><br><span class=\"line\">  timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    index=<span class=\"number\">0</span>;</span><br><span class=\"line\">    $imgs = domMap.$waterFall.querySelectorAll(<span class=\"string\">'.water-fall-item &gt; img'</span>);</span><br><span class=\"line\">    length = $imgs.length;</span><br><span class=\"line\">    <span class=\"comment\">// 统计图片加载完成的数量</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; $imgs.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($imgs[i].complete) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (++index === length) clearInterval(timer);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    waterfall.step();</span><br><span class=\"line\">  &#125;, <span class=\"number\">250</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 窗口拖动</span></span><br><span class=\"line\">   <span class=\"built_in\">window</span>.onresize =  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     Utils.FnDelay(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       waterfall.step();</span><br><span class=\"line\">     &#125;, <span class=\"number\">800</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"感谢阅读\">感谢阅读</h4>\n<p><em>代码存放在github：<a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/normal/water-fall-layout\" target=\"_blank\" rel=\"noopener\">nojsja</a></em></p>\n","site":{"data":{}},"excerpt":"","more":"<h4>盗用的效果图</h4>\n<p><img src=\"/blogs/img/article/waterfall-1.gif\" alt=\"preview\"></p>\n<h4>效果分析</h4>\n<p>瀑布流中图片的宽度都是固定的，但是高度需要设置为auto以使图片不变形，高度不固定。首先想到能不能用float属性让图片流动，想象中很美好，实际效果如下，可以看到因为第三个元素的高度问题，第二行元素流动时被第三个元素挡住，导致了布局错乱。</p>\n<p><img src=\"/blogs/img/article/waterfall-2.jpg\" alt=\"float\"></p>\n<p>看看百度图片是怎么实现图片布局的，如下图，可以看出百度用了讨巧的办法，图片跟我们这个瀑布流的图片的宽高设定正好相反，百度图片的列数同样固定，但是高度也固定，而宽度不固定，这样处理的话正好能避免上面那个float流动的问题，这个… 好吧 最后我们还是来说说怎样实现我们效果图中那样的瀑布流布局。</p>\n<p><img src=\"/blogs/img/article/waterfall-3.jpg\" alt=\"baidu\"></p>\n<h4>解决方法</h4>\n<ul>\n<li>html结构如下，需要说明的是container元素是相对定位，每个item元素都是绝对定位，这样我们通过设置item元素的top和left值就能改变它们的位置了，图片的宽度是100%(这儿思考一下为什么img的父级需要设置box-sizing: border-box)。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 页面结构 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-container\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"url\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"water-fall-item\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"url\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>我把主要逻辑写成了构造函数的形式，这样一个页面中通过传入不同的参数就能创建多个瀑布流实例。构造函数中我们依次需要传入容器元素本身、子元素的选择器(.water-fall-item)、<br>\n每一列自定义的宽度(单位是px)、图片之间间隔的距离(实际上是padding-right 和 padding-bottom 的值，单位px)，通过这些指标我们首先能够计算出容器元素的宽度，<br>\n(容器宽度 / 列宽) === 总共的列数，最后在step函数里就是布局的代码了，step做的事儿就是遍历容器元素下的每个item元素，设置它们的宽度、高度、top值、left值以及padding值，<br>\n其中第一行元素top值固定为零，left值依次根据数组下标再乘以列宽，到了第二行之后的元素就省事儿了，直接设置当前元素的top值为 对应的那个上一排元素的top值+上一排元素的高度值(clientHeight)，而left值每一排都相同，因为列宽和列数是固定的。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [WaterFall 图片瀑布流构造函数]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;DomElement&#125; father   [瀑布流的容器元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;String&#125; childClass   [瀑布流子元素类名选择器 如: .water-fall-item]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;Number&#125; columnWidth  [设定每一列的宽度，单位: px]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;Number&#125; paddingWidth [设定图片之间的间隔距离， 单位: px]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">WaterFall</span>(<span class=\"params\">father, childClass, columnWidth, paddingWidth</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.$container = father;  <span class=\"comment\">// 容器</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.childSelector = childClass;  <span class=\"comment\">// 子代img选择器</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.children = [];  <span class=\"comment\">// 子代img</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.columnWidth = columnWidth;  <span class=\"comment\">// 单列宽度</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.paddingWidth = paddingWidth + <span class=\"string\">'px'</span>;  <span class=\"comment\">// 图片之间的间隔距离</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.totalWidth = <span class=\"keyword\">this</span>.$container.clientWidth;  <span class=\"comment\">// 容器宽度</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.columnNum = ~~(<span class=\"keyword\">this</span>.totalWidth / <span class=\"keyword\">this</span>.columnWidth);  <span class=\"comment\">// 列数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 调用多次</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.step = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.totalWidth = <span class=\"keyword\">this</span>.$container.clientWidth;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.columnNum = ~~(<span class=\"keyword\">this</span>.totalWidth / <span class=\"keyword\">this</span>.columnWidth);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.children = <span class=\"keyword\">this</span>.$container.querySelectorAll(<span class=\"keyword\">this</span>.childSelector);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.children.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.width = <span class=\"keyword\">this</span>.columnWidth + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.height = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.paddingRight = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.children[i].style.paddingBottom = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 每行第一个设置左padding</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i % <span class=\"keyword\">this</span>.columnNum === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.paddingLeft = <span class=\"keyword\">this</span>.paddingWidth;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 第一行 和 其它行的不同处理</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i &lt; <span class=\"keyword\">this</span>.columnNum) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.left = (i) * <span class=\"keyword\">this</span>.columnWidth + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.top = (i) * <span class=\"number\">0</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.left = <span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].style.left;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.children[i].style.top = +<span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].style.top.replace(<span class=\"string\">'px'</span>, <span class=\"string\">''</span>) +</span><br><span class=\"line\">                                      <span class=\"keyword\">this</span>.children[i - <span class=\"keyword\">this</span>.columnNum].clientHeight + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>再看看从页面图片加载到生成瀑布流实例我是怎样处理的，前面部分先通过一组图片url地址将所有图片加载到页面上，中间设定参数后生成一个瀑布流实例，最后重点是<br>\n弄清楚我们需要在什么时候调用waterfall.step()函数来处理页面中item元素的重排。我可能用了个比价笨的办法：在所有图片加载完成之前 使用定时器 轮询每个图片的加载情况，并进行布局，所有图片加载完后就取消定时器。最后别忘记 窗口拖动后也要重新布局，在这儿我用了一个函数节流的思想，防止resize短时间内多次触发，改善页面性能，至于节流函数怎么写，大家可以看看相关概念然后自己实现一个，so easy !</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [waterFallInit 瀑布流初始化]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;String&#125; wData [图片url的数组]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> waterFallInit = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wData</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> div, img, timer, $imgs, length, index = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 载入图片</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; wData.length; i++) &#123;</span><br><span class=\"line\">    div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    div.setAttribute(<span class=\"string\">'class'</span>, <span class=\"string\">'water-fall-item'</span>);</span><br><span class=\"line\">    img.setAttribute(<span class=\"string\">'src'</span>, wData[i]);</span><br><span class=\"line\">    div.appendChild(img);</span><br><span class=\"line\">    fragment.appendChild(div);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === wData.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      domMap.$waterFall.appendChild(fragment);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一个瀑布流实例</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> waterfall = <span class=\"keyword\">new</span> WaterFall(domMap.$waterFall, <span class=\"string\">'.water-fall-item'</span>, <span class=\"number\">200</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 轮询所有图片的加载状态</span></span><br><span class=\"line\">  timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    index=<span class=\"number\">0</span>;</span><br><span class=\"line\">    $imgs = domMap.$waterFall.querySelectorAll(<span class=\"string\">'.water-fall-item &gt; img'</span>);</span><br><span class=\"line\">    length = $imgs.length;</span><br><span class=\"line\">    <span class=\"comment\">// 统计图片加载完成的数量</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; $imgs.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($imgs[i].complete) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (++index === length) clearInterval(timer);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    waterfall.step();</span><br><span class=\"line\">  &#125;, <span class=\"number\">250</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 窗口拖动</span></span><br><span class=\"line\">   <span class=\"built_in\">window</span>.onresize =  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     Utils.FnDelay(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       waterfall.step();</span><br><span class=\"line\">     &#125;, <span class=\"number\">800</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4>感谢阅读</h4>\n<p><em>代码存放在github：<a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/normal/water-fall-layout\" target=\"_blank\" rel=\"noopener\">nojsja</a></em></p>\n"},{"title":"使用ES5手动实现ES6中的Promise API","catalog":true,"toc_nav_num":true,"date":"2018-10-30T17:15:00.000Z","subtitle":"es6 promise","header-img":"/blogs/img/article_header/article_header.png","catagories":["Javascript"],"updateDate":"2018-10-30T17:15:00.000Z","top":1,"_content":"\n![life is strange](/blogs/img/article/lifeIsStrange.jpg)\n\n\n[源代码 => github / nojsja / promise-self](https://github.com/NoJsJa/promise-nojsja)\n\n### 谈谈Promise\n---------------\n\n>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。\n它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像\n同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象。  \n\n>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，\n也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的\nthen 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled\n和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的\nonfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法，\n所以在异步操作的完成和绑定处理方法之间不存在竞争）。  \n\n#### 一个 Promise有以下几种状态\n * pending: 初始状态，不是成功或失败状态。  \n * fulfilled: 意味着操作成功完成。  \n * rejected: 意味着操作失败。  \n\n#### Javascript事件循环\n关于js线程和事件循环可以看[这篇文章](https://zhuanlan.zhihu.com/p/33058983)\n * 创建Promise时传入的函数的执行应该延迟到下一次事件循环中，而不应该在主线程执行栈中被调用。\n * Promise.then传入的onResolve, onReject函数的执行也应该延迟到下一次事件循环。  \n\n具体表现可以看下一段代码，即使是promise对象中没有异步操作，控制台也会先打印b再打印a：\n```js\nvar p1 = new Promise(function (resolve, reject) {\n  resolve('a');\n}).then(function (value) {\n  console.log(value);\n});\n\nconsole.log('b');\n\n// result => b a\n\n```\n\n#### Promise.all(iterable)\n这个方法返回一个新的promise对象，该promise对象当iterable参数对象里所有的promise对象\n都成功的时候才会触发成功，一旦有任何一个iterable里面的promise对象失败则立即触发该promise\n对象的失败。这个新的promise对象在触发成功状态以后，会把一个包含iterable里所有promise返回值\n的数组作为成功回调的返回值，顺序跟iterable的顺序保持一致；如果这个新的promise对象触发了失败\n状态，它会把iterable里第一个触发失败的promise对象的错误信息作为它的失败错误信息。Promise.all方法常被用于处理多个promise对象的状态集合。\n\n#### Promise.race(iterable)\n当iterable参数里的任意一个子promise被成功或失败后，父promise马上也会用子promise的成功返回\n值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象。  \n\n#### Promise.reject(value) / Promise.resolve(value)\n返回一个状态为失败(成功)的Promise对象，并将给定的失败(成功)信息传递给对应的处理方法。\n如果该值是thenable(即，带有then方法的对象)，返回的Promise对象的最终状态由then方法执行决定；\n否则的话(该value为空，基本类型或者不带then方法的对象)，返回的Promise对象状态为fulfilled，\n并且将该value传递给对应的then方法。通常而言，如果你不知道一个值是否是Promise对象，\n使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。\n\n### Promise分析和实现\n--------------------\n\n#### 实现难点分析\n在思考实现原理的时候，Promise.then这个方法花了我最长的时间，一个Promise对象可以使用then方法接收一个成功的回调函数和一个错误的回调函数，哪个回调函数的最终被执行取决于当前Promise对象的最终状态，可以使用promise.then(fn1, fn2).then(fn3, fn4).then(fn5, fn6)这种链式回调连接无数个异步方法。如果前一个then方法中的 success callback 或 fail callback 也返回了一个Promise对象的话，那么当前Promise对象的状态最终还是要取决于返回的这个Promise对象，就像发生了状态之间的传递一样。并且在这样的条件下，各个then方法链接的函数仍然能保持顺序依次执行。\n\n#### 难点分析和解决\n通过以上对then方法的分析，我们可以看出，promise.then方法的状态都是独立的，promise.then的回调方法中可以再次返回一个Promise对象，我们姑且把这一过程称为父Promise和子Promise的状态传递和继承，所以在设计then方法时应当考虑then方法返回的其实应该是一个具有独立状态的Promise对象，只不过该Promise对象的状态还需要看then方法传入的两个回调函数是不是返回了另一个Promise对象，如果返回了，那么就要发生状态传递。我们可以用设计模式中观察者模式的思想来定义一个Promise对象，Promise对象可以有三种状态，成功和失败状态的变化会触发各自对应的观察者函数事件，所以每一个Promise.then方法其实就是在对一个Promise对象做状态事件注册，事件注册和状态改变这两个操作是相互独立的。那么如何把当前父Promise的对象状态和then函数中返回的Promise对象的状态联系起来呢？这个逻辑就是下面代码中的`analysisPromise`方法，它的作用就是分析一个回调的返回值，将当前Promise对象状态改变的方法`reject`和`resolve`递归传递下去，各个不同的调用栈对应各个不同的执行上下文，但是目的只有一个就是改变最初传入的那个Promise对象的状态。\n\n* promise.then的设计\n```js\n/**\n * [then 应该返回一个全新的Promise对象，不应该与当前Promise存在功能耦合]\n * @param  {[type]} successFn [description]\n * @param  {[type]} errorFn   [description]\n */\nPromise.prototype.then = function (successCallback, errorCallback) {\n\n  var promise, x;\n  var self = this;\n\n  if (self.status === 'fulfilled') {\n    promise = new Promise(function (resolve, reject) {\n      // delay to next event loop\n      setTimeout(function () {\n        try {\n          x = successCallback(self.value);\n          analysisPromise(x, resolve, reject);\n        } catch (e) {\n          reject(e);\n        }\n      });\n    });\n  }else if (self.status === 'rejected') {\n    promise = new Promise(function (resolve, reject) {\n      // delay to next event loop\n      setTimeout(function () {\n        try {\n          x = errorCallback(self.reason);\n          analysisPromise(x, resolve, reject);\n        } catch (e) {\n          reject(e);\n        }\n      });\n\n    });\n  }else if (self.status === 'pending') {\n    promise = new Promise(function (resolve, reject) {\n\n      // 延迟到下一个事件循环\n      setTimeout(function () {\n        self.onFulfilledCallbacks.push(function () {\n          try {\n            x = successCallback(self.value);\n            // 分析返回值 然后更改 当前promise状态\n            analysisPromise(x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        });\n\n        self.onRejectedCallbacks.push(function () {\n          try {\n            x = errorCallback ? errorCallback(self.reason) : undefined;\n            // 分析返回值 然后更改 当前promise状态\n            analysisPromise(x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        });\n      })\n    });\n\n  }\n\n  return promise;\n};\n```\n* analysisPromise方法的设计\n```js\n/**\n * [analysisPromise 使用递归将状态控制权转移]\n * @param  {[Any]} x        [value]\n * @param  {[Func]} resolve [get into success state]\n * @param  {[Func]} reject  [get into fail state]\n */\nvar analysisPromise = function (x, resolve, reject) {\n\n  var then, y;\n  if (x !== undefined && (typeof x === 'object' || typeof x === 'function')) {\n    then = x.then;\n    // obj Promise\n    if (then && typeof then === 'function') {\n      then.call(x, function (value) {\n        // callback return a promise\n        analysisPromise(value, resolve, reject);\n      }, function (error) {\n        reject(error);\n      });\n    // normal\n    }else {\n      resolve(x);\n    }\n  // normal\n  }else {\n    resolve(x);\n  }\n};\n```\n\n#### 其它部分的实现\n* catch方法  \n这边只是简单的捕获了一下错误然后调用回调函数即可。\n```js\nPromise.prototype.catch = function (handleError) {\n  if (this.status === 'pending') {\n    this.onRejectedCallbacks.push(handleError);\n  }else {\n    this.reason && handleError(this.reason);\n  }\n};\n```\n\n* all方法  \nall方法首先判断可以通过promise.all([promise]).then这种形式调用，那么all也应该返回一个Promise对象，这个对象的成功状态取决于传入的各个promise的成功状态，失败状态只取决于其中一个传入的最先失败的的promise，所以应该遍历和分析所有传入的promise的状态情况，和设计then方法的时候一样需要考虑状态传递的问题，将各个promise产生的计算值存入一个数组，一旦有promise失败，马上返回失败信息，结束整个promise对象的状态监听。\n```js\nPromise.all = function (pArray) {\n  var rArray = [];\n  var promise = new Promise(function (resolve, reject) {\n\n    pArray.forEach(function (pr, i) {\n\n        if (pr instanceof Promise) {\n          pr.then(function (value1) {\n            analysisPromise(value1, function (value2) {\n              rArray[i] = value2;\n              if (rArray.length === pArray.length) {\n                resolve(rArray);\n              }\n            }, reject);\n\n          }, function (error) {\n            reject(error);\n          });\n\n        }else {\n          rArray[i] = pr;\n          if (rArray.length === pArray.length) {\n            resolve(rArray);\n          }\n        }\n\n    });\n\n  });\n\n  return promise;\n};\n```\n\n* race方法  \nrace方法就更简单了，考虑状态的传递之后，传入的任意一个promise的状态改变都会直接表现为整个promise对象的状态最终值。all方法和race方法，前者是状态协同，后者状态竞争。\n```js\nPromise.race = function (pArray) {\n  var rArray = [];\n  var promise = new Promise(function (resolve, reject) {\n    pArray.forEach(function (pr, i) {\n        if (pr instanceof Promise) {\n          pr.then(function (value) {\n            analysisPromise(value, resolve, reject);\n          }, function (error) {\n            reject(error);\n          });\n        }else {\n          rArray[i] = pr;\n        }\n    });\n  });\n\n  return promise;\n};\n```\n\n* 静态方法 Promise.resolve 和 Promise.reject\n直接返回一个最终态为成功或失败的promise对象即可。\n```js\nPromise.resolve = function (value) {\n  return new Promise(function (resolve, reject) {\n      resolve(value);\n  });\n};\nPromise.reject = function (reason) {\n  return new Promise(function (resolve, reject) {\n      reject(reason);\n  });\n};\n```\n\n### 总结\n--------\nPromise实现的难点其实是怎样考虑那个状态传递的过程(`analysisPromise`方法的实现)，各种回调的设计容易让人混乱，需要考虑各个promise对象的`原子性`同时又要保持各个可能出现相互嵌套的promise对象之间的依赖和联系。如果结构设计地比较合理的话，`Promise.all`、`Promise.race`这两个方法是很容易被实现出来的，因为它们只是对多个promise对象的状态管理而已。\n","source":"_posts/使用ES5实现ES6中的Promise.md","raw":"---\ntitle: \"使用ES5手动实现ES6中的Promise API\"\ncatalog: true\ntoc_nav_num: true\ndate: 2018-10-31 01:15:00\nsubtitle: \"es6 promise\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Promise\n- ES6\ncatagories:\n- Javascript\nupdateDate: 2018-10-31 01:15:00\ntop: 1\n---\n\n![life is strange](/blogs/img/article/lifeIsStrange.jpg)\n\n\n[源代码 => github / nojsja / promise-self](https://github.com/NoJsJa/promise-nojsja)\n\n### 谈谈Promise\n---------------\n\n>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。\n它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像\n同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象。  \n\n>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，\n也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的\nthen 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled\n和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的\nonfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法，\n所以在异步操作的完成和绑定处理方法之间不存在竞争）。  \n\n#### 一个 Promise有以下几种状态\n * pending: 初始状态，不是成功或失败状态。  \n * fulfilled: 意味着操作成功完成。  \n * rejected: 意味着操作失败。  \n\n#### Javascript事件循环\n关于js线程和事件循环可以看[这篇文章](https://zhuanlan.zhihu.com/p/33058983)\n * 创建Promise时传入的函数的执行应该延迟到下一次事件循环中，而不应该在主线程执行栈中被调用。\n * Promise.then传入的onResolve, onReject函数的执行也应该延迟到下一次事件循环。  \n\n具体表现可以看下一段代码，即使是promise对象中没有异步操作，控制台也会先打印b再打印a：\n```js\nvar p1 = new Promise(function (resolve, reject) {\n  resolve('a');\n}).then(function (value) {\n  console.log(value);\n});\n\nconsole.log('b');\n\n// result => b a\n\n```\n\n#### Promise.all(iterable)\n这个方法返回一个新的promise对象，该promise对象当iterable参数对象里所有的promise对象\n都成功的时候才会触发成功，一旦有任何一个iterable里面的promise对象失败则立即触发该promise\n对象的失败。这个新的promise对象在触发成功状态以后，会把一个包含iterable里所有promise返回值\n的数组作为成功回调的返回值，顺序跟iterable的顺序保持一致；如果这个新的promise对象触发了失败\n状态，它会把iterable里第一个触发失败的promise对象的错误信息作为它的失败错误信息。Promise.all方法常被用于处理多个promise对象的状态集合。\n\n#### Promise.race(iterable)\n当iterable参数里的任意一个子promise被成功或失败后，父promise马上也会用子promise的成功返回\n值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象。  \n\n#### Promise.reject(value) / Promise.resolve(value)\n返回一个状态为失败(成功)的Promise对象，并将给定的失败(成功)信息传递给对应的处理方法。\n如果该值是thenable(即，带有then方法的对象)，返回的Promise对象的最终状态由then方法执行决定；\n否则的话(该value为空，基本类型或者不带then方法的对象)，返回的Promise对象状态为fulfilled，\n并且将该value传递给对应的then方法。通常而言，如果你不知道一个值是否是Promise对象，\n使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。\n\n### Promise分析和实现\n--------------------\n\n#### 实现难点分析\n在思考实现原理的时候，Promise.then这个方法花了我最长的时间，一个Promise对象可以使用then方法接收一个成功的回调函数和一个错误的回调函数，哪个回调函数的最终被执行取决于当前Promise对象的最终状态，可以使用promise.then(fn1, fn2).then(fn3, fn4).then(fn5, fn6)这种链式回调连接无数个异步方法。如果前一个then方法中的 success callback 或 fail callback 也返回了一个Promise对象的话，那么当前Promise对象的状态最终还是要取决于返回的这个Promise对象，就像发生了状态之间的传递一样。并且在这样的条件下，各个then方法链接的函数仍然能保持顺序依次执行。\n\n#### 难点分析和解决\n通过以上对then方法的分析，我们可以看出，promise.then方法的状态都是独立的，promise.then的回调方法中可以再次返回一个Promise对象，我们姑且把这一过程称为父Promise和子Promise的状态传递和继承，所以在设计then方法时应当考虑then方法返回的其实应该是一个具有独立状态的Promise对象，只不过该Promise对象的状态还需要看then方法传入的两个回调函数是不是返回了另一个Promise对象，如果返回了，那么就要发生状态传递。我们可以用设计模式中观察者模式的思想来定义一个Promise对象，Promise对象可以有三种状态，成功和失败状态的变化会触发各自对应的观察者函数事件，所以每一个Promise.then方法其实就是在对一个Promise对象做状态事件注册，事件注册和状态改变这两个操作是相互独立的。那么如何把当前父Promise的对象状态和then函数中返回的Promise对象的状态联系起来呢？这个逻辑就是下面代码中的`analysisPromise`方法，它的作用就是分析一个回调的返回值，将当前Promise对象状态改变的方法`reject`和`resolve`递归传递下去，各个不同的调用栈对应各个不同的执行上下文，但是目的只有一个就是改变最初传入的那个Promise对象的状态。\n\n* promise.then的设计\n```js\n/**\n * [then 应该返回一个全新的Promise对象，不应该与当前Promise存在功能耦合]\n * @param  {[type]} successFn [description]\n * @param  {[type]} errorFn   [description]\n */\nPromise.prototype.then = function (successCallback, errorCallback) {\n\n  var promise, x;\n  var self = this;\n\n  if (self.status === 'fulfilled') {\n    promise = new Promise(function (resolve, reject) {\n      // delay to next event loop\n      setTimeout(function () {\n        try {\n          x = successCallback(self.value);\n          analysisPromise(x, resolve, reject);\n        } catch (e) {\n          reject(e);\n        }\n      });\n    });\n  }else if (self.status === 'rejected') {\n    promise = new Promise(function (resolve, reject) {\n      // delay to next event loop\n      setTimeout(function () {\n        try {\n          x = errorCallback(self.reason);\n          analysisPromise(x, resolve, reject);\n        } catch (e) {\n          reject(e);\n        }\n      });\n\n    });\n  }else if (self.status === 'pending') {\n    promise = new Promise(function (resolve, reject) {\n\n      // 延迟到下一个事件循环\n      setTimeout(function () {\n        self.onFulfilledCallbacks.push(function () {\n          try {\n            x = successCallback(self.value);\n            // 分析返回值 然后更改 当前promise状态\n            analysisPromise(x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        });\n\n        self.onRejectedCallbacks.push(function () {\n          try {\n            x = errorCallback ? errorCallback(self.reason) : undefined;\n            // 分析返回值 然后更改 当前promise状态\n            analysisPromise(x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        });\n      })\n    });\n\n  }\n\n  return promise;\n};\n```\n* analysisPromise方法的设计\n```js\n/**\n * [analysisPromise 使用递归将状态控制权转移]\n * @param  {[Any]} x        [value]\n * @param  {[Func]} resolve [get into success state]\n * @param  {[Func]} reject  [get into fail state]\n */\nvar analysisPromise = function (x, resolve, reject) {\n\n  var then, y;\n  if (x !== undefined && (typeof x === 'object' || typeof x === 'function')) {\n    then = x.then;\n    // obj Promise\n    if (then && typeof then === 'function') {\n      then.call(x, function (value) {\n        // callback return a promise\n        analysisPromise(value, resolve, reject);\n      }, function (error) {\n        reject(error);\n      });\n    // normal\n    }else {\n      resolve(x);\n    }\n  // normal\n  }else {\n    resolve(x);\n  }\n};\n```\n\n#### 其它部分的实现\n* catch方法  \n这边只是简单的捕获了一下错误然后调用回调函数即可。\n```js\nPromise.prototype.catch = function (handleError) {\n  if (this.status === 'pending') {\n    this.onRejectedCallbacks.push(handleError);\n  }else {\n    this.reason && handleError(this.reason);\n  }\n};\n```\n\n* all方法  \nall方法首先判断可以通过promise.all([promise]).then这种形式调用，那么all也应该返回一个Promise对象，这个对象的成功状态取决于传入的各个promise的成功状态，失败状态只取决于其中一个传入的最先失败的的promise，所以应该遍历和分析所有传入的promise的状态情况，和设计then方法的时候一样需要考虑状态传递的问题，将各个promise产生的计算值存入一个数组，一旦有promise失败，马上返回失败信息，结束整个promise对象的状态监听。\n```js\nPromise.all = function (pArray) {\n  var rArray = [];\n  var promise = new Promise(function (resolve, reject) {\n\n    pArray.forEach(function (pr, i) {\n\n        if (pr instanceof Promise) {\n          pr.then(function (value1) {\n            analysisPromise(value1, function (value2) {\n              rArray[i] = value2;\n              if (rArray.length === pArray.length) {\n                resolve(rArray);\n              }\n            }, reject);\n\n          }, function (error) {\n            reject(error);\n          });\n\n        }else {\n          rArray[i] = pr;\n          if (rArray.length === pArray.length) {\n            resolve(rArray);\n          }\n        }\n\n    });\n\n  });\n\n  return promise;\n};\n```\n\n* race方法  \nrace方法就更简单了，考虑状态的传递之后，传入的任意一个promise的状态改变都会直接表现为整个promise对象的状态最终值。all方法和race方法，前者是状态协同，后者状态竞争。\n```js\nPromise.race = function (pArray) {\n  var rArray = [];\n  var promise = new Promise(function (resolve, reject) {\n    pArray.forEach(function (pr, i) {\n        if (pr instanceof Promise) {\n          pr.then(function (value) {\n            analysisPromise(value, resolve, reject);\n          }, function (error) {\n            reject(error);\n          });\n        }else {\n          rArray[i] = pr;\n        }\n    });\n  });\n\n  return promise;\n};\n```\n\n* 静态方法 Promise.resolve 和 Promise.reject\n直接返回一个最终态为成功或失败的promise对象即可。\n```js\nPromise.resolve = function (value) {\n  return new Promise(function (resolve, reject) {\n      resolve(value);\n  });\n};\nPromise.reject = function (reason) {\n  return new Promise(function (resolve, reject) {\n      reject(reason);\n  });\n};\n```\n\n### 总结\n--------\nPromise实现的难点其实是怎样考虑那个状态传递的过程(`analysisPromise`方法的实现)，各种回调的设计容易让人混乱，需要考虑各个promise对象的`原子性`同时又要保持各个可能出现相互嵌套的promise对象之间的依赖和联系。如果结构设计地比较合理的话，`Promise.all`、`Promise.race`这两个方法是很容易被实现出来的，因为它们只是对多个promise对象的状态管理而已。\n","slug":"使用ES5实现ES6中的Promise","published":1,"updated":"2020-03-12T02:02:53.019Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn7000ka89584sf0dzn","content":"<p><img src=\"/blogs/img/article/lifeIsStrange.jpg\" alt=\"life is strange\"></p>\n<p><a href=\"https://github.com/NoJsJa/promise-nojsja\" target=\"_blank\" rel=\"noopener\">源代码 =&gt; github / nojsja / promise-self</a></p>\n<h3 id=\"谈谈promise\">谈谈Promise</h3>\n<hr>\n<blockquote>\n<p>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。<br>\n它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像<br>\n同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象。</p>\n</blockquote>\n<blockquote>\n<p>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，<br>\n也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的<br>\nthen 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled<br>\n和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的<br>\nonfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法，<br>\n所以在异步操作的完成和绑定处理方法之间不存在竞争）。</p>\n</blockquote>\n<h4 id=\"一个-promise有以下几种状态\">一个 Promise有以下几种状态</h4>\n<ul>\n<li>pending: 初始状态，不是成功或失败状态。</li>\n<li>fulfilled: 意味着操作成功完成。</li>\n<li>rejected: 意味着操作失败。</li>\n</ul>\n<h4 id=\"javascript事件循环\">Javascript事件循环</h4>\n<p>关于js线程和事件循环可以看<a href=\"https://zhuanlan.zhihu.com/p/33058983\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<ul>\n<li>创建Promise时传入的函数的执行应该延迟到下一次事件循环中，而不应该在主线程执行栈中被调用。</li>\n<li>Promise.then传入的onResolve, onReject函数的执行也应该延迟到下一次事件循环。</li>\n</ul>\n<p>具体表现可以看下一段代码，即使是promise对象中没有异步操作，控制台也会先打印b再打印a：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// result =&gt; b a</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"promisealliterable\">Promise.all(iterable)</h4>\n<p>这个方法返回一个新的promise对象，该promise对象当iterable参数对象里所有的promise对象<br>\n都成功的时候才会触发成功，一旦有任何一个iterable里面的promise对象失败则立即触发该promise<br>\n对象的失败。这个新的promise对象在触发成功状态以后，会把一个包含iterable里所有promise返回值<br>\n的数组作为成功回调的返回值，顺序跟iterable的顺序保持一致；如果这个新的promise对象触发了失败<br>\n状态，它会把iterable里第一个触发失败的promise对象的错误信息作为它的失败错误信息。Promise.all方法常被用于处理多个promise对象的状态集合。</p>\n<h4 id=\"promiseraceiterable\">Promise.race(iterable)</h4>\n<p>当iterable参数里的任意一个子promise被成功或失败后，父promise马上也会用子promise的成功返回<br>\n值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象。</p>\n<h4 id=\"promiserejectvalue-promiseresolvevalue\">Promise.reject(value) / Promise.resolve(value)</h4>\n<p>返回一个状态为失败(成功)的Promise对象，并将给定的失败(成功)信息传递给对应的处理方法。<br>\n如果该值是thenable(即，带有then方法的对象)，返回的Promise对象的最终状态由then方法执行决定；<br>\n否则的话(该value为空，基本类型或者不带then方法的对象)，返回的Promise对象状态为fulfilled，<br>\n并且将该value传递给对应的then方法。通常而言，如果你不知道一个值是否是Promise对象，<br>\n使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。</p>\n<h3 id=\"promise分析和实现\">Promise分析和实现</h3>\n<hr>\n<h4 id=\"实现难点分析\">实现难点分析</h4>\n<p>在思考实现原理的时候，Promise.then这个方法花了我最长的时间，一个Promise对象可以使用then方法接收一个成功的回调函数和一个错误的回调函数，哪个回调函数的最终被执行取决于当前Promise对象的最终状态，可以使用promise.then(fn1, fn2).then(fn3, fn4).then(fn5, fn6)这种链式回调连接无数个异步方法。如果前一个then方法中的 success callback 或 fail callback 也返回了一个Promise对象的话，那么当前Promise对象的状态最终还是要取决于返回的这个Promise对象，就像发生了状态之间的传递一样。并且在这样的条件下，各个then方法链接的函数仍然能保持顺序依次执行。</p>\n<h4 id=\"难点分析和解决\">难点分析和解决</h4>\n<p>通过以上对then方法的分析，我们可以看出，promise.then方法的状态都是独立的，promise.then的回调方法中可以再次返回一个Promise对象，我们姑且把这一过程称为父Promise和子Promise的状态传递和继承，所以在设计then方法时应当考虑then方法返回的其实应该是一个具有独立状态的Promise对象，只不过该Promise对象的状态还需要看then方法传入的两个回调函数是不是返回了另一个Promise对象，如果返回了，那么就要发生状态传递。我们可以用设计模式中观察者模式的思想来定义一个Promise对象，Promise对象可以有三种状态，成功和失败状态的变化会触发各自对应的观察者函数事件，所以每一个Promise.then方法其实就是在对一个Promise对象做状态事件注册，事件注册和状态改变这两个操作是相互独立的。那么如何把当前父Promise的对象状态和then函数中返回的Promise对象的状态联系起来呢？这个逻辑就是下面代码中的<code>analysisPromise</code>方法，它的作用就是分析一个回调的返回值，将当前Promise对象状态改变的方法<code>reject</code>和<code>resolve</code>递归传递下去，各个不同的调用栈对应各个不同的执行上下文，但是目的只有一个就是改变最初传入的那个Promise对象的状态。</p>\n<ul>\n<li>promise.then的设计</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [then 应该返回一个全新的Promise对象，不应该与当前Promise存在功能耦合]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; successFn [description]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; errorFn   [description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">successCallback, errorCallback</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise, x;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// delay to next event loop</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          x = successCallback(self.value);</span><br><span class=\"line\">          analysisPromise(x, resolve, reject);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">          reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// delay to next event loop</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          x = errorCallback(self.reason);</span><br><span class=\"line\">          analysisPromise(x, resolve, reject);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">          reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 延迟到下一个事件循环</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        self.onFulfilledCallbacks.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            x = successCallback(self.value);</span><br><span class=\"line\">            <span class=\"comment\">// 分析返回值 然后更改 当前promise状态</span></span><br><span class=\"line\">            analysisPromise(x, resolve, reject);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        self.onRejectedCallbacks.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            x = errorCallback ? errorCallback(self.reason) : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 分析返回值 然后更改 当前promise状态</span></span><br><span class=\"line\">            analysisPromise(x, resolve, reject);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>analysisPromise方法的设计</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [analysisPromise 使用递归将状态控制权转移]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Any]&#125; x        [value]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Func]&#125; resolve [get into success state]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Func]&#125; reject  [get into fail state]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> analysisPromise = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> then, y;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x !== <span class=\"literal\">undefined</span> &amp;&amp; (<span class=\"keyword\">typeof</span> x === <span class=\"string\">'object'</span> || <span class=\"keyword\">typeof</span> x === <span class=\"string\">'function'</span>)) &#123;</span><br><span class=\"line\">    then = x.then;</span><br><span class=\"line\">    <span class=\"comment\">// obj Promise</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (then &amp;&amp; <span class=\"keyword\">typeof</span> then === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      then.call(x, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// callback return a promise</span></span><br><span class=\"line\">        analysisPromise(value, resolve, reject);</span><br><span class=\"line\">      &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// normal</span></span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      resolve(x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"comment\">// normal</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    resolve(x);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"其它部分的实现\">其它部分的实现</h4>\n<ul>\n<li>catch方法<br>\n这边只是简单的捕获了一下错误然后调用回调函数即可。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.catch = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">handleError</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onRejectedCallbacks.push(handleError);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.reason &amp;&amp; handleError(<span class=\"keyword\">this</span>.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>all方法<br>\nall方法首先判断可以通过promise.all([promise]).then这种形式调用，那么all也应该返回一个Promise对象，这个对象的成功状态取决于传入的各个promise的成功状态，失败状态只取决于其中一个传入的最先失败的的promise，所以应该遍历和分析所有传入的promise的状态情况，和设计then方法的时候一样需要考虑状态传递的问题，将各个promise产生的计算值存入一个数组，一旦有promise失败，马上返回失败信息，结束整个promise对象的状态监听。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pArray</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rArray = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    pArray.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pr, i</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>) &#123;</span><br><span class=\"line\">          pr.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value1</span>) </span>&#123;</span><br><span class=\"line\">            analysisPromise(value1, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value2</span>) </span>&#123;</span><br><span class=\"line\">              rArray[i] = value2;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (rArray.length === pArray.length) &#123;</span><br><span class=\"line\">                resolve(rArray);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;, reject);</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">            reject(error);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          rArray[i] = pr;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (rArray.length === pArray.length) &#123;</span><br><span class=\"line\">            resolve(rArray);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>race方法<br>\nrace方法就更简单了，考虑状态的传递之后，传入的任意一个promise的状态改变都会直接表现为整个promise对象的状态最终值。all方法和race方法，前者是状态协同，后者状态竞争。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.race = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pArray</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rArray = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    pArray.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pr, i</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>) &#123;</span><br><span class=\"line\">          pr.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">            analysisPromise(value, resolve, reject);</span><br><span class=\"line\">          &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">            reject(error);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          rArray[i] = pr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>静态方法 Promise.resolve 和 Promise.reject<br>\n直接返回一个最终态为成功或失败的promise对象即可。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      resolve(value);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.reject = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      reject(reason);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\">总结</h3>\n<hr>\n<p>Promise实现的难点其实是怎样考虑那个状态传递的过程(<code>analysisPromise</code>方法的实现)，各种回调的设计容易让人混乱，需要考虑各个promise对象的<code>原子性</code>同时又要保持各个可能出现相互嵌套的promise对象之间的依赖和联系。如果结构设计地比较合理的话，<code>Promise.all</code>、<code>Promise.race</code>这两个方法是很容易被实现出来的，因为它们只是对多个promise对象的状态管理而已。</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/lifeIsStrange.jpg\" alt=\"life is strange\"></p>\n<p><a href=\"https://github.com/NoJsJa/promise-nojsja\" target=\"_blank\" rel=\"noopener\">源代码 =&gt; github / nojsja / promise-self</a></p>\n<h3>谈谈Promise</h3>\n<hr>\n<blockquote>\n<p>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。<br>\n它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像<br>\n同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象。</p>\n</blockquote>\n<blockquote>\n<p>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，<br>\n也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的<br>\nthen 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled<br>\n和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的<br>\nonfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法，<br>\n所以在异步操作的完成和绑定处理方法之间不存在竞争）。</p>\n</blockquote>\n<h4>一个 Promise有以下几种状态</h4>\n<ul>\n<li>pending: 初始状态，不是成功或失败状态。</li>\n<li>fulfilled: 意味着操作成功完成。</li>\n<li>rejected: 意味着操作失败。</li>\n</ul>\n<h4>Javascript事件循环</h4>\n<p>关于js线程和事件循环可以看<a href=\"https://zhuanlan.zhihu.com/p/33058983\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<ul>\n<li>创建Promise时传入的函数的执行应该延迟到下一次事件循环中，而不应该在主线程执行栈中被调用。</li>\n<li>Promise.then传入的onResolve, onReject函数的执行也应该延迟到下一次事件循环。</li>\n</ul>\n<p>具体表现可以看下一段代码，即使是promise对象中没有异步操作，控制台也会先打印b再打印a：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// result =&gt; b a</span></span><br></pre></td></tr></table></figure>\n<h4>Promise.all(iterable)</h4>\n<p>这个方法返回一个新的promise对象，该promise对象当iterable参数对象里所有的promise对象<br>\n都成功的时候才会触发成功，一旦有任何一个iterable里面的promise对象失败则立即触发该promise<br>\n对象的失败。这个新的promise对象在触发成功状态以后，会把一个包含iterable里所有promise返回值<br>\n的数组作为成功回调的返回值，顺序跟iterable的顺序保持一致；如果这个新的promise对象触发了失败<br>\n状态，它会把iterable里第一个触发失败的promise对象的错误信息作为它的失败错误信息。Promise.all方法常被用于处理多个promise对象的状态集合。</p>\n<h4>Promise.race(iterable)</h4>\n<p>当iterable参数里的任意一个子promise被成功或失败后，父promise马上也会用子promise的成功返回<br>\n值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象。</p>\n<h4>Promise.reject(value) / Promise.resolve(value)</h4>\n<p>返回一个状态为失败(成功)的Promise对象，并将给定的失败(成功)信息传递给对应的处理方法。<br>\n如果该值是thenable(即，带有then方法的对象)，返回的Promise对象的最终状态由then方法执行决定；<br>\n否则的话(该value为空，基本类型或者不带then方法的对象)，返回的Promise对象状态为fulfilled，<br>\n并且将该value传递给对应的then方法。通常而言，如果你不知道一个值是否是Promise对象，<br>\n使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。</p>\n<h3>Promise分析和实现</h3>\n<hr>\n<h4>实现难点分析</h4>\n<p>在思考实现原理的时候，Promise.then这个方法花了我最长的时间，一个Promise对象可以使用then方法接收一个成功的回调函数和一个错误的回调函数，哪个回调函数的最终被执行取决于当前Promise对象的最终状态，可以使用promise.then(fn1, fn2).then(fn3, fn4).then(fn5, fn6)这种链式回调连接无数个异步方法。如果前一个then方法中的 success callback 或 fail callback 也返回了一个Promise对象的话，那么当前Promise对象的状态最终还是要取决于返回的这个Promise对象，就像发生了状态之间的传递一样。并且在这样的条件下，各个then方法链接的函数仍然能保持顺序依次执行。</p>\n<h4>难点分析和解决</h4>\n<p>通过以上对then方法的分析，我们可以看出，promise.then方法的状态都是独立的，promise.then的回调方法中可以再次返回一个Promise对象，我们姑且把这一过程称为父Promise和子Promise的状态传递和继承，所以在设计then方法时应当考虑then方法返回的其实应该是一个具有独立状态的Promise对象，只不过该Promise对象的状态还需要看then方法传入的两个回调函数是不是返回了另一个Promise对象，如果返回了，那么就要发生状态传递。我们可以用设计模式中观察者模式的思想来定义一个Promise对象，Promise对象可以有三种状态，成功和失败状态的变化会触发各自对应的观察者函数事件，所以每一个Promise.then方法其实就是在对一个Promise对象做状态事件注册，事件注册和状态改变这两个操作是相互独立的。那么如何把当前父Promise的对象状态和then函数中返回的Promise对象的状态联系起来呢？这个逻辑就是下面代码中的<code>analysisPromise</code>方法，它的作用就是分析一个回调的返回值，将当前Promise对象状态改变的方法<code>reject</code>和<code>resolve</code>递归传递下去，各个不同的调用栈对应各个不同的执行上下文，但是目的只有一个就是改变最初传入的那个Promise对象的状态。</p>\n<ul>\n<li>promise.then的设计</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [then 应该返回一个全新的Promise对象，不应该与当前Promise存在功能耦合]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; successFn [description]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; errorFn   [description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">successCallback, errorCallback</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise, x;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// delay to next event loop</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          x = successCallback(self.value);</span><br><span class=\"line\">          analysisPromise(x, resolve, reject);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">          reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// delay to next event loop</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          x = errorCallback(self.reason);</span><br><span class=\"line\">          analysisPromise(x, resolve, reject);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">          reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 延迟到下一个事件循环</span></span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        self.onFulfilledCallbacks.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            x = successCallback(self.value);</span><br><span class=\"line\">            <span class=\"comment\">// 分析返回值 然后更改 当前promise状态</span></span><br><span class=\"line\">            analysisPromise(x, resolve, reject);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        self.onRejectedCallbacks.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            x = errorCallback ? errorCallback(self.reason) : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 分析返回值 然后更改 当前promise状态</span></span><br><span class=\"line\">            analysisPromise(x, resolve, reject);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>analysisPromise方法的设计</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [analysisPromise 使用递归将状态控制权转移]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Any]&#125; x        [value]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Func]&#125; resolve [get into success state]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Func]&#125; reject  [get into fail state]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> analysisPromise = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> then, y;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x !== <span class=\"literal\">undefined</span> &amp;&amp; (<span class=\"keyword\">typeof</span> x === <span class=\"string\">'object'</span> || <span class=\"keyword\">typeof</span> x === <span class=\"string\">'function'</span>)) &#123;</span><br><span class=\"line\">    then = x.then;</span><br><span class=\"line\">    <span class=\"comment\">// obj Promise</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (then &amp;&amp; <span class=\"keyword\">typeof</span> then === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      then.call(x, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// callback return a promise</span></span><br><span class=\"line\">        analysisPromise(value, resolve, reject);</span><br><span class=\"line\">      &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// normal</span></span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      resolve(x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"comment\">// normal</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    resolve(x);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4>其它部分的实现</h4>\n<ul>\n<li>catch方法<br>\n这边只是简单的捕获了一下错误然后调用回调函数即可。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.catch = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">handleError</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onRejectedCallbacks.push(handleError);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.reason &amp;&amp; handleError(<span class=\"keyword\">this</span>.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>all方法<br>\nall方法首先判断可以通过promise.all([promise]).then这种形式调用，那么all也应该返回一个Promise对象，这个对象的成功状态取决于传入的各个promise的成功状态，失败状态只取决于其中一个传入的最先失败的的promise，所以应该遍历和分析所有传入的promise的状态情况，和设计then方法的时候一样需要考虑状态传递的问题，将各个promise产生的计算值存入一个数组，一旦有promise失败，马上返回失败信息，结束整个promise对象的状态监听。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pArray</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rArray = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    pArray.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pr, i</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>) &#123;</span><br><span class=\"line\">          pr.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value1</span>) </span>&#123;</span><br><span class=\"line\">            analysisPromise(value1, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value2</span>) </span>&#123;</span><br><span class=\"line\">              rArray[i] = value2;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (rArray.length === pArray.length) &#123;</span><br><span class=\"line\">                resolve(rArray);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;, reject);</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">            reject(error);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          rArray[i] = pr;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (rArray.length === pArray.length) &#123;</span><br><span class=\"line\">            resolve(rArray);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>race方法<br>\nrace方法就更简单了，考虑状态的传递之后，传入的任意一个promise的状态改变都会直接表现为整个promise对象的状态最终值。all方法和race方法，前者是状态协同，后者状态竞争。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.race = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pArray</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rArray = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    pArray.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pr, i</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>) &#123;</span><br><span class=\"line\">          pr.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">            analysisPromise(value, resolve, reject);</span><br><span class=\"line\">          &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">            reject(error);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          rArray[i] = pr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>静态方法 Promise.resolve 和 Promise.reject<br>\n直接返回一个最终态为成功或失败的promise对象即可。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      resolve(value);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.reject = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      reject(reason);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3>总结</h3>\n<hr>\n<p>Promise实现的难点其实是怎样考虑那个状态传递的过程(<code>analysisPromise</code>方法的实现)，各种回调的设计容易让人混乱，需要考虑各个promise对象的<code>原子性</code>同时又要保持各个可能出现相互嵌套的promise对象之间的依赖和联系。如果结构设计地比较合理的话，<code>Promise.all</code>、<code>Promise.race</code>这两个方法是很容易被实现出来的，因为它们只是对多个promise对象的状态管理而已。</p>\n"},{"title":"用Javascript实现一个可自定义样式的tootips组件","catalog":true,"toc_nav_num":true,"date":"2018-11-06T11:16:00.000Z","subtitle":"animation javascript","header-img":"/blogs/img/article_header/article_header.png","catagories":["Javascript"],"updateDate":"2018-11-06T11:16:00.000Z","top":null,"_content":"\n#### 前言\n\n> 最近做的一个jQuery老项目经常会用tootips组件在一个html元素周围显示提示信息，虽然有现成的组件可以使用，但是很多tootips组件处理起来并不灵活，不能够自定义tootips样式和显示的内容及布局等等，而且tootips组件本身的样式可能会被目标组件的样式影响，所以想自己实现一个tootips组件：可以自定义显示内容，并且tootips的位置和布局完全不受页面元素影响。\n\n#### 预览图\n----------------\n\n[=> 源代码](https://github.com/NoJsJa/javascript-learning/tree/master/normal/js-tooltips)\n\n![animation.gif](/blogs/img/article/tootips.gif)\n\n#### 代码实现\n------------\n\n##### 组件结构\n```js\n var Tootips = (function () {\n\n   /**\n    * [renderPage 构造html]\n    */\n   function renderPage($selector) {\n     ...\n     return $wrapper;\n   };\n\n   /**\n    * [renderHtml 使用html字符串进行初始化]\n    */\n   function init(_$selector, _options) {\n     ...\n     eventListen($selector, trigger);\n   }\n\n   /**\n    * [eventListen 进行事件监听]\n    */\n   function eventListen($selector, trigger) {\n     // 显示\n     var showTootips = function ($selector) {\n     };\n     // 隐藏\n     var hideTooTips = function ($selector) {\n     };\n     // click事件监听\n     (trigger === 'click') &&  $selector.on(trigger, function () {\n       if (!$selector.data('isActivated')) {\n         showTootips($selector);\n       }else {\n         hideTooTips($selector);\n       }\n     });\n     // 鼠标事件监听\n     (trigger === 'mouseover') &&\n        $selector.on('mouseout', function () {\n          hideTooTips($selector);\n        }).on('mouseover', function () {\n          showTootips($selector);\n     });\n   }\n\n   return {\n     init: init,\n   }\n })();\n\n```\n\n##### 初始化一个元素\n> 对一个html元素进行初始化，在元素上绑定数据和设置事件监听器\n\n```js\n/**\n * [renderHtml 使用html字符串进行初始化]\n * @param  {[$Object]} $selector [一个页面元素]\n * @param  {[String]} htmlstr   [html字符串]\n * @param  {[Object]} options   [自定义参数]\n */\nfunction init(_$selector, _options) {\n\n  var $selector = (typeof _$selector === 'object') ? _$selector : $(_$selector);\n  var trigger = _options['trigger'] ? _options['trigger'] : 'mouseover'; // click | hover\n  $selector\n   .data('tootip-target', _options.value)\n   .data('tootip-type', _options.type)\n   .data('tootip-options', _options)\n   .css('cursor', 'pointer');\n\n  eventListen($selector, trigger);\n}\n```\n\n##### 根据传入属性创建tootips组件\n* 使用`getBoundingClientRect()`方法获取目标组件的位置和宽高\n* tootips组件根据获取的位置和宽高进行窗口定位(`position: fixed`)\n* 根据传入的属性设置tootips组件的样式\n* 返回一个jQuery元素\n\n```js\n/**\n * [renderPage 构造html]\n * @param  {[Object]} options   [自定义参数]\n * @param  {[String]} type   [渲染类型 -> text | html]\n * @param  {[String]} target   [渲染字符串]\n */\nfunction renderPage($selector) {\n  var type = $selector.data('tootip-type'),\n     options = $selector.data('tootip-options'),\n     target = $selector.data('tootip-target');\n  // 提取属性\n  var randomKey = String(Math.random() + Math.random()).split('.').pop();\n  var $wrapper = $('<div></div>');\n  var cssStyle = options.style || {};\n  var styleSheet = options.css || '';\n  var direction = options.direction || 'top';\n  var rect = $selector[0].getBoundingClientRect();\n\n  // 根据宿主元素第一次计算横坐标和纵坐标\n  var renderX = function (r, d) {\n    if (d === 'top' || d === 'bottom')\n      return (r.x + r.width / 2 + 'px');\n    if (d === 'left')\n      return (r.x - 6 + 'px');\n    if (d === 'right')\n      return (r.x + r.width + 6 + 'px');\n  };\n\n  var renderY = function (r, d) {\n    if (d === 'top')\n      return (r.y - 6 + 'px');\n    if (d === 'left' || d === 'right')\n      return (r.y + r.height / 2 + 'px');\n    if (d === 'bottom')\n      return (r.y + r.height + 6 + 'px');\n  };\n\n  $wrapper\n   .css('position', 'fixed')\n   .css('left', renderX(rect, direction))\n   .css('top', renderY(rect, direction))\n   .attr('key', randomKey)\n   .addClass(styleSheet);\n  $selector.attr('key', randomKey);\n\n  Object.keys(cssStyle).forEach(function (attr) {\n    $wrapper.css(attr, cssStyle[attr]);\n  });\n\n  $wrapper.append(type === 'html' ? $(target) : $('<span>' + target +'</span>'));\n\n  return $wrapper;\n};\n```\n\n##### 绑定事件监听器\n> 对一个元素进行初始化后需要给tooltips组件绑定监听器(`click`或`mouse`事件)，让tootips组件能够响应鼠标的点击或是划过\n\n* 实现showTootips方法  \n在tootips组件中可以自定义显示html内容或text内容，tootips组件被添加到页面之前，tootips组件的宽度和高度是不可获取的，所以在show方法中需要对tootips元素进行二次定位，同样使用`getBoundingClientRect()`方法获取tootips元素坐标和宽高。\n\n* 实现hideTootips方法  \nhide方法的作用是将当前元素对应的tootips组件从页面移出，之前初始化的时候在目标元素和生成的tootips元素上设置了同一个`key`属性，现在可以根据`key`来移除每个目标元素对应的tootips元素。\n\n```js\n/**\n * [eventListen 进行事件监听]\n * @param  {[$Object]} $selector [一个页面元素]\n * @param  {[String]} trigger [触发事件监听类型]\n */\nfunction eventListen($selector, trigger) {\n\n  // 显示\n  var showTootips = function ($selector) {\n    var $dom = renderPage($selector);\n    $('body').append($dom[0]);\n    $selector.data('isActivated', true);\n\n    // 根据生成的tootips元素第二次计算横坐标和纵坐标\n    var options = $selector.data('tootip-options');\n    var rect = $dom[0].getBoundingClientRect();\n\n    var renderX = function (r, d) {\n      if (d === 'top' || d === 'bottom')\n        return (r.x - r.width / 2 + 'px');\n      if (d === 'left')\n        return (r.x - r.width + 'px');\n      if (d === 'right')\n        return (r.x + 'px');\n    };\n\n    var renderY = function (r, d) {\n      if (d === 'top')\n        return (r.y - r.height + 'px');\n      if (d === 'left' || d === 'right')\n        return (r.y - r.height / 2 + 'px');\n      if (d === 'bottom')\n        return (r.y + 'px');\n    };\n\n    $dom.css('top', renderY(rect, options.direction));\n    $dom.css('left', renderX(rect, options.direction));\n  };\n\n  // 隐藏\n  var hideTooTips = function ($selector) {\n    var key = $selector.attr('key');\n    $('div[key='+key+']').remove();\n    $selector.data('isActivated', '');\n  };\n\n  // click事件监听\n  (trigger === 'click') &&  $selector.on(trigger, function () {\n    if (!$selector.data('isActivated')) {\n      showTootips($selector);\n    }else {\n      hideTooTips($selector);\n    }\n  });\n\n  // 鼠标事件监听\n  (trigger === 'mouseover') &&\n     $selector.on('mouseout', function () {\n       hideTooTips($selector);\n     }).on('mouseover', function () {\n       showTootips($selector);\n  });\n}\n```\n\n##### 使用方式\n> 设置tootips方向、显示内容字符串(可以是html字符串)、触发方式(click / mouseover)、自定义css属性、自定义样式表。\n\n```js\nTootips.init($('#t1'), {\n  trigger: 'mouseover', // 触发方式\n  type: 'html', // 内容显示类型\n  value: '<h3>header</h3><p>body</p>', // 内容显示值\n  direction: 'top', // 显示方向\n  style: { // tootips组件自定义样式\n    'font-size': '1rem',\n    'color': 'red',\n    'min-width': '5rem',\n    'border': 'solid 1px grey',\n    'padding': '5px 10px',\n    'border-radius': '5px',\n    'background-color': 'white',\n  },\n  css: 'triangle-bottom', // tootips组件自定义样式表\n});\n```\n\n#### 总结\n--------\n* tootips组件的坐标完全使用javasript来获取和设置\n* tootips组件的定位类型为`position: fixed`，不受页面布局影响\n* `getBoundingClientRect()`方法可以获取目标元素的坐标、宽高等数据\n* tootips组件支持传入自定义样式\n* tootips组件支持显示含有html标签的字符串和普通字符串\n* tootips组件支持设置触发方式(`click` / `mouseover`)\n\n实现方式可能还需要优化，但暂时能够满足项目需求 ...\n\n##### 感谢阅读\n","source":"_posts/用Javascript实现一个可自定义样式的tootips组件.md","raw":"---\ntitle: \"用Javascript实现一个可自定义样式的tootips组件\"\ncatalog: true\ntoc_nav_num: true\ndate:  2018-11-06 19:16:00\nsubtitle: \"animation javascript\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Javascript\n- ES5\ncatagories:\n- Javascript\nupdateDate: 2018-11-06 19:16:00\ntop: \n---\n\n#### 前言\n\n> 最近做的一个jQuery老项目经常会用tootips组件在一个html元素周围显示提示信息，虽然有现成的组件可以使用，但是很多tootips组件处理起来并不灵活，不能够自定义tootips样式和显示的内容及布局等等，而且tootips组件本身的样式可能会被目标组件的样式影响，所以想自己实现一个tootips组件：可以自定义显示内容，并且tootips的位置和布局完全不受页面元素影响。\n\n#### 预览图\n----------------\n\n[=> 源代码](https://github.com/NoJsJa/javascript-learning/tree/master/normal/js-tooltips)\n\n![animation.gif](/blogs/img/article/tootips.gif)\n\n#### 代码实现\n------------\n\n##### 组件结构\n```js\n var Tootips = (function () {\n\n   /**\n    * [renderPage 构造html]\n    */\n   function renderPage($selector) {\n     ...\n     return $wrapper;\n   };\n\n   /**\n    * [renderHtml 使用html字符串进行初始化]\n    */\n   function init(_$selector, _options) {\n     ...\n     eventListen($selector, trigger);\n   }\n\n   /**\n    * [eventListen 进行事件监听]\n    */\n   function eventListen($selector, trigger) {\n     // 显示\n     var showTootips = function ($selector) {\n     };\n     // 隐藏\n     var hideTooTips = function ($selector) {\n     };\n     // click事件监听\n     (trigger === 'click') &&  $selector.on(trigger, function () {\n       if (!$selector.data('isActivated')) {\n         showTootips($selector);\n       }else {\n         hideTooTips($selector);\n       }\n     });\n     // 鼠标事件监听\n     (trigger === 'mouseover') &&\n        $selector.on('mouseout', function () {\n          hideTooTips($selector);\n        }).on('mouseover', function () {\n          showTootips($selector);\n     });\n   }\n\n   return {\n     init: init,\n   }\n })();\n\n```\n\n##### 初始化一个元素\n> 对一个html元素进行初始化，在元素上绑定数据和设置事件监听器\n\n```js\n/**\n * [renderHtml 使用html字符串进行初始化]\n * @param  {[$Object]} $selector [一个页面元素]\n * @param  {[String]} htmlstr   [html字符串]\n * @param  {[Object]} options   [自定义参数]\n */\nfunction init(_$selector, _options) {\n\n  var $selector = (typeof _$selector === 'object') ? _$selector : $(_$selector);\n  var trigger = _options['trigger'] ? _options['trigger'] : 'mouseover'; // click | hover\n  $selector\n   .data('tootip-target', _options.value)\n   .data('tootip-type', _options.type)\n   .data('tootip-options', _options)\n   .css('cursor', 'pointer');\n\n  eventListen($selector, trigger);\n}\n```\n\n##### 根据传入属性创建tootips组件\n* 使用`getBoundingClientRect()`方法获取目标组件的位置和宽高\n* tootips组件根据获取的位置和宽高进行窗口定位(`position: fixed`)\n* 根据传入的属性设置tootips组件的样式\n* 返回一个jQuery元素\n\n```js\n/**\n * [renderPage 构造html]\n * @param  {[Object]} options   [自定义参数]\n * @param  {[String]} type   [渲染类型 -> text | html]\n * @param  {[String]} target   [渲染字符串]\n */\nfunction renderPage($selector) {\n  var type = $selector.data('tootip-type'),\n     options = $selector.data('tootip-options'),\n     target = $selector.data('tootip-target');\n  // 提取属性\n  var randomKey = String(Math.random() + Math.random()).split('.').pop();\n  var $wrapper = $('<div></div>');\n  var cssStyle = options.style || {};\n  var styleSheet = options.css || '';\n  var direction = options.direction || 'top';\n  var rect = $selector[0].getBoundingClientRect();\n\n  // 根据宿主元素第一次计算横坐标和纵坐标\n  var renderX = function (r, d) {\n    if (d === 'top' || d === 'bottom')\n      return (r.x + r.width / 2 + 'px');\n    if (d === 'left')\n      return (r.x - 6 + 'px');\n    if (d === 'right')\n      return (r.x + r.width + 6 + 'px');\n  };\n\n  var renderY = function (r, d) {\n    if (d === 'top')\n      return (r.y - 6 + 'px');\n    if (d === 'left' || d === 'right')\n      return (r.y + r.height / 2 + 'px');\n    if (d === 'bottom')\n      return (r.y + r.height + 6 + 'px');\n  };\n\n  $wrapper\n   .css('position', 'fixed')\n   .css('left', renderX(rect, direction))\n   .css('top', renderY(rect, direction))\n   .attr('key', randomKey)\n   .addClass(styleSheet);\n  $selector.attr('key', randomKey);\n\n  Object.keys(cssStyle).forEach(function (attr) {\n    $wrapper.css(attr, cssStyle[attr]);\n  });\n\n  $wrapper.append(type === 'html' ? $(target) : $('<span>' + target +'</span>'));\n\n  return $wrapper;\n};\n```\n\n##### 绑定事件监听器\n> 对一个元素进行初始化后需要给tooltips组件绑定监听器(`click`或`mouse`事件)，让tootips组件能够响应鼠标的点击或是划过\n\n* 实现showTootips方法  \n在tootips组件中可以自定义显示html内容或text内容，tootips组件被添加到页面之前，tootips组件的宽度和高度是不可获取的，所以在show方法中需要对tootips元素进行二次定位，同样使用`getBoundingClientRect()`方法获取tootips元素坐标和宽高。\n\n* 实现hideTootips方法  \nhide方法的作用是将当前元素对应的tootips组件从页面移出，之前初始化的时候在目标元素和生成的tootips元素上设置了同一个`key`属性，现在可以根据`key`来移除每个目标元素对应的tootips元素。\n\n```js\n/**\n * [eventListen 进行事件监听]\n * @param  {[$Object]} $selector [一个页面元素]\n * @param  {[String]} trigger [触发事件监听类型]\n */\nfunction eventListen($selector, trigger) {\n\n  // 显示\n  var showTootips = function ($selector) {\n    var $dom = renderPage($selector);\n    $('body').append($dom[0]);\n    $selector.data('isActivated', true);\n\n    // 根据生成的tootips元素第二次计算横坐标和纵坐标\n    var options = $selector.data('tootip-options');\n    var rect = $dom[0].getBoundingClientRect();\n\n    var renderX = function (r, d) {\n      if (d === 'top' || d === 'bottom')\n        return (r.x - r.width / 2 + 'px');\n      if (d === 'left')\n        return (r.x - r.width + 'px');\n      if (d === 'right')\n        return (r.x + 'px');\n    };\n\n    var renderY = function (r, d) {\n      if (d === 'top')\n        return (r.y - r.height + 'px');\n      if (d === 'left' || d === 'right')\n        return (r.y - r.height / 2 + 'px');\n      if (d === 'bottom')\n        return (r.y + 'px');\n    };\n\n    $dom.css('top', renderY(rect, options.direction));\n    $dom.css('left', renderX(rect, options.direction));\n  };\n\n  // 隐藏\n  var hideTooTips = function ($selector) {\n    var key = $selector.attr('key');\n    $('div[key='+key+']').remove();\n    $selector.data('isActivated', '');\n  };\n\n  // click事件监听\n  (trigger === 'click') &&  $selector.on(trigger, function () {\n    if (!$selector.data('isActivated')) {\n      showTootips($selector);\n    }else {\n      hideTooTips($selector);\n    }\n  });\n\n  // 鼠标事件监听\n  (trigger === 'mouseover') &&\n     $selector.on('mouseout', function () {\n       hideTooTips($selector);\n     }).on('mouseover', function () {\n       showTootips($selector);\n  });\n}\n```\n\n##### 使用方式\n> 设置tootips方向、显示内容字符串(可以是html字符串)、触发方式(click / mouseover)、自定义css属性、自定义样式表。\n\n```js\nTootips.init($('#t1'), {\n  trigger: 'mouseover', // 触发方式\n  type: 'html', // 内容显示类型\n  value: '<h3>header</h3><p>body</p>', // 内容显示值\n  direction: 'top', // 显示方向\n  style: { // tootips组件自定义样式\n    'font-size': '1rem',\n    'color': 'red',\n    'min-width': '5rem',\n    'border': 'solid 1px grey',\n    'padding': '5px 10px',\n    'border-radius': '5px',\n    'background-color': 'white',\n  },\n  css: 'triangle-bottom', // tootips组件自定义样式表\n});\n```\n\n#### 总结\n--------\n* tootips组件的坐标完全使用javasript来获取和设置\n* tootips组件的定位类型为`position: fixed`，不受页面布局影响\n* `getBoundingClientRect()`方法可以获取目标元素的坐标、宽高等数据\n* tootips组件支持传入自定义样式\n* tootips组件支持显示含有html标签的字符串和普通字符串\n* tootips组件支持设置触发方式(`click` / `mouseover`)\n\n实现方式可能还需要优化，但暂时能够满足项目需求 ...\n\n##### 感谢阅读\n","slug":"用Javascript实现一个可自定义样式的tootips组件","published":1,"updated":"2020-03-10T16:49:40.630Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxn9000ma895uz53o355","content":"<h4 id=\"前言\">前言</h4>\n<blockquote>\n<p>最近做的一个jQuery老项目经常会用tootips组件在一个html元素周围显示提示信息，虽然有现成的组件可以使用，但是很多tootips组件处理起来并不灵活，不能够自定义tootips样式和显示的内容及布局等等，而且tootips组件本身的样式可能会被目标组件的样式影响，所以想自己实现一个tootips组件：可以自定义显示内容，并且tootips的位置和布局完全不受页面元素影响。</p>\n</blockquote>\n<h4 id=\"预览图\">预览图</h4>\n<hr>\n<p><a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/normal/js-tooltips\" target=\"_blank\" rel=\"noopener\">=&gt; 源代码</a></p>\n<p><img src=\"/blogs/img/article/tootips.gif\" alt=\"animation.gif\"></p>\n<h4 id=\"代码实现\">代码实现</h4>\n<hr>\n<h5 id=\"组件结构\">组件结构</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tootips = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [renderPage 构造html]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $wrapper;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [renderHtml 使用html字符串进行初始化]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\">_$selector, _options</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    eventListen($selector, trigger);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [eventListen 进行事件监听]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eventListen</span>(<span class=\"params\">$selector, trigger</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 显示</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> showTootips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> hideTooTips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// click事件监听</span></span><br><span class=\"line\">    (trigger === <span class=\"string\">'click'</span>) &amp;&amp;  $selector.on(trigger, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!$selector.data(<span class=\"string\">'isActivated'</span>)) &#123;</span><br><span class=\"line\">        showTootips($selector);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        hideTooTips($selector);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// 鼠标事件监听</span></span><br><span class=\"line\">    (trigger === <span class=\"string\">'mouseover'</span>) &amp;&amp;</span><br><span class=\"line\">       $selector.on(<span class=\"string\">'mouseout'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         hideTooTips($selector);</span><br><span class=\"line\">       &#125;).on(<span class=\"string\">'mouseover'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         showTootips($selector);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    init: init,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h5 id=\"初始化一个元素\">初始化一个元素</h5>\n<blockquote>\n<p>对一个html元素进行初始化，在元素上绑定数据和设置事件监听器</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [renderHtml 使用html字符串进行初始化]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[$Object]&#125; $selector [一个页面元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; htmlstr   [html字符串]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; options   [自定义参数]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\">_$selector, _options</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> $selector = (<span class=\"keyword\">typeof</span> _$selector === <span class=\"string\">'object'</span>) ? _$selector : $(_$selector);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> trigger = _options[<span class=\"string\">'trigger'</span>] ? _options[<span class=\"string\">'trigger'</span>] : <span class=\"string\">'mouseover'</span>; <span class=\"comment\">// click | hover</span></span><br><span class=\"line\">  $selector</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-target'</span>, _options.value)</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-type'</span>, _options.type)</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-options'</span>, _options)</span><br><span class=\"line\">   .css(<span class=\"string\">'cursor'</span>, <span class=\"string\">'pointer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  eventListen($selector, trigger);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"根据传入属性创建tootips组件\">根据传入属性创建tootips组件</h5>\n<ul>\n<li>使用<code>getBoundingClientRect()</code>方法获取目标组件的位置和宽高</li>\n<li>tootips组件根据获取的位置和宽高进行窗口定位(<code>position: fixed</code>)</li>\n<li>根据传入的属性设置tootips组件的样式</li>\n<li>返回一个jQuery元素</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [renderPage 构造html]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; options   [自定义参数]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; type   [渲染类型 -&gt; text | html]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; target   [渲染字符串]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> type = $selector.data(<span class=\"string\">'tootip-type'</span>),</span><br><span class=\"line\">     options = $selector.data(<span class=\"string\">'tootip-options'</span>),</span><br><span class=\"line\">     target = $selector.data(<span class=\"string\">'tootip-target'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 提取属性</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> randomKey = <span class=\"built_in\">String</span>(<span class=\"built_in\">Math</span>.random() + <span class=\"built_in\">Math</span>.random()).split(<span class=\"string\">'.'</span>).pop();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $wrapper = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cssStyle = options.style || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> styleSheet = options.css || <span class=\"string\">''</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> direction = options.direction || <span class=\"string\">'top'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rect = $selector[<span class=\"number\">0</span>].getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 根据宿主元素第一次计算横坐标和纵坐标</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> renderX = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span> || d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x + r.width / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x - <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x + r.width + <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> renderY = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y - <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span> || d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y + r.height / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y + r.height + <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  $wrapper</span><br><span class=\"line\">   .css(<span class=\"string\">'position'</span>, <span class=\"string\">'fixed'</span>)</span><br><span class=\"line\">   .css(<span class=\"string\">'left'</span>, renderX(rect, direction))</span><br><span class=\"line\">   .css(<span class=\"string\">'top'</span>, renderY(rect, direction))</span><br><span class=\"line\">   .attr(<span class=\"string\">'key'</span>, randomKey)</span><br><span class=\"line\">   .addClass(styleSheet);</span><br><span class=\"line\">  $selector.attr(<span class=\"string\">'key'</span>, randomKey);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys(cssStyle).forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">attr</span>) </span>&#123;</span><br><span class=\"line\">    $wrapper.css(attr, cssStyle[attr]);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  $wrapper.append(type === <span class=\"string\">'html'</span> ? $(target) : $(<span class=\"string\">'&lt;span&gt;'</span> + target +<span class=\"string\">'&lt;/span&gt;'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $wrapper;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"绑定事件监听器\">绑定事件监听器</h5>\n<blockquote>\n<p>对一个元素进行初始化后需要给tooltips组件绑定监听器(<code>click</code>或<code>mouse</code>事件)，让tootips组件能够响应鼠标的点击或是划过</p>\n</blockquote>\n<ul>\n<li>\n<p>实现showTootips方法<br>\n在tootips组件中可以自定义显示html内容或text内容，tootips组件被添加到页面之前，tootips组件的宽度和高度是不可获取的，所以在show方法中需要对tootips元素进行二次定位，同样使用<code>getBoundingClientRect()</code>方法获取tootips元素坐标和宽高。</p>\n</li>\n<li>\n<p>实现hideTootips方法<br>\nhide方法的作用是将当前元素对应的tootips组件从页面移出，之前初始化的时候在目标元素和生成的tootips元素上设置了同一个<code>key</code>属性，现在可以根据<code>key</code>来移除每个目标元素对应的tootips元素。</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [eventListen 进行事件监听]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[$Object]&#125; $selector [一个页面元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; trigger [触发事件监听类型]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eventListen</span>(<span class=\"params\">$selector, trigger</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 显示</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> showTootips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> $dom = renderPage($selector);</span><br><span class=\"line\">    $(<span class=\"string\">'body'</span>).append($dom[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    $selector.data(<span class=\"string\">'isActivated'</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根据生成的tootips元素第二次计算横坐标和纵坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> options = $selector.data(<span class=\"string\">'tootip-options'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rect = $dom[<span class=\"number\">0</span>].getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderX = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span> || d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x - r.width / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x - r.width + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderY = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y - r.height + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span> || d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y - r.height / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    $dom.css(<span class=\"string\">'top'</span>, renderY(rect, options.direction));</span><br><span class=\"line\">    $dom.css(<span class=\"string\">'left'</span>, renderX(rect, options.direction));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> hideTooTips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> key = $selector.attr(<span class=\"string\">'key'</span>);</span><br><span class=\"line\">    $(<span class=\"string\">'div[key='</span>+key+<span class=\"string\">']'</span>).remove();</span><br><span class=\"line\">    $selector.data(<span class=\"string\">'isActivated'</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// click事件监听</span></span><br><span class=\"line\">  (trigger === <span class=\"string\">'click'</span>) &amp;&amp;  $selector.on(trigger, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!$selector.data(<span class=\"string\">'isActivated'</span>)) &#123;</span><br><span class=\"line\">      showTootips($selector);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      hideTooTips($selector);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 鼠标事件监听</span></span><br><span class=\"line\">  (trigger === <span class=\"string\">'mouseover'</span>) &amp;&amp;</span><br><span class=\"line\">     $selector.on(<span class=\"string\">'mouseout'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       hideTooTips($selector);</span><br><span class=\"line\">     &#125;).on(<span class=\"string\">'mouseover'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       showTootips($selector);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"使用方式\">使用方式</h5>\n<blockquote>\n<p>设置tootips方向、显示内容字符串(可以是html字符串)、触发方式(click / mouseover)、自定义css属性、自定义样式表。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tootips.init($(<span class=\"string\">'#t1'</span>), &#123;</span><br><span class=\"line\">  trigger: <span class=\"string\">'mouseover'</span>, <span class=\"comment\">// 触发方式</span></span><br><span class=\"line\">  type: <span class=\"string\">'html'</span>, <span class=\"comment\">// 内容显示类型</span></span><br><span class=\"line\">  value: <span class=\"string\">'&lt;h3&gt;header&lt;/h3&gt;&lt;p&gt;body&lt;/p&gt;'</span>, <span class=\"comment\">// 内容显示值</span></span><br><span class=\"line\">  direction: <span class=\"string\">'top'</span>, <span class=\"comment\">// 显示方向</span></span><br><span class=\"line\">  style: &#123; <span class=\"comment\">// tootips组件自定义样式</span></span><br><span class=\"line\">    <span class=\"string\">'font-size'</span>: <span class=\"string\">'1rem'</span>,</span><br><span class=\"line\">    <span class=\"string\">'color'</span>: <span class=\"string\">'red'</span>,</span><br><span class=\"line\">    <span class=\"string\">'min-width'</span>: <span class=\"string\">'5rem'</span>,</span><br><span class=\"line\">    <span class=\"string\">'border'</span>: <span class=\"string\">'solid 1px grey'</span>,</span><br><span class=\"line\">    <span class=\"string\">'padding'</span>: <span class=\"string\">'5px 10px'</span>,</span><br><span class=\"line\">    <span class=\"string\">'border-radius'</span>: <span class=\"string\">'5px'</span>,</span><br><span class=\"line\">    <span class=\"string\">'background-color'</span>: <span class=\"string\">'white'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  css: <span class=\"string\">'triangle-bottom'</span>, <span class=\"comment\">// tootips组件自定义样式表</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"总结\">总结</h4>\n<hr>\n<ul>\n<li>tootips组件的坐标完全使用javasript来获取和设置</li>\n<li>tootips组件的定位类型为<code>position: fixed</code>，不受页面布局影响</li>\n<li><code>getBoundingClientRect()</code>方法可以获取目标元素的坐标、宽高等数据</li>\n<li>tootips组件支持传入自定义样式</li>\n<li>tootips组件支持显示含有html标签的字符串和普通字符串</li>\n<li>tootips组件支持设置触发方式(<code>click</code> / <code>mouseover</code>)</li>\n</ul>\n<p>实现方式可能还需要优化，但暂时能够满足项目需求 …</p>\n<h5 id=\"感谢阅读\">感谢阅读</h5>\n","site":{"data":{}},"excerpt":"","more":"<h4>前言</h4>\n<blockquote>\n<p>最近做的一个jQuery老项目经常会用tootips组件在一个html元素周围显示提示信息，虽然有现成的组件可以使用，但是很多tootips组件处理起来并不灵活，不能够自定义tootips样式和显示的内容及布局等等，而且tootips组件本身的样式可能会被目标组件的样式影响，所以想自己实现一个tootips组件：可以自定义显示内容，并且tootips的位置和布局完全不受页面元素影响。</p>\n</blockquote>\n<h4>预览图</h4>\n<hr>\n<p><a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/normal/js-tooltips\" target=\"_blank\" rel=\"noopener\">=&gt; 源代码</a></p>\n<p><img src=\"/blogs/img/article/tootips.gif\" alt=\"animation.gif\"></p>\n<h4>代码实现</h4>\n<hr>\n<h5>组件结构</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tootips = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [renderPage 构造html]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $wrapper;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [renderHtml 使用html字符串进行初始化]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\">_$selector, _options</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    eventListen($selector, trigger);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [eventListen 进行事件监听]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eventListen</span>(<span class=\"params\">$selector, trigger</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 显示</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> showTootips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> hideTooTips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// click事件监听</span></span><br><span class=\"line\">    (trigger === <span class=\"string\">'click'</span>) &amp;&amp;  $selector.on(trigger, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!$selector.data(<span class=\"string\">'isActivated'</span>)) &#123;</span><br><span class=\"line\">        showTootips($selector);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        hideTooTips($selector);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// 鼠标事件监听</span></span><br><span class=\"line\">    (trigger === <span class=\"string\">'mouseover'</span>) &amp;&amp;</span><br><span class=\"line\">       $selector.on(<span class=\"string\">'mouseout'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         hideTooTips($selector);</span><br><span class=\"line\">       &#125;).on(<span class=\"string\">'mouseover'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         showTootips($selector);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    init: init,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h5>初始化一个元素</h5>\n<blockquote>\n<p>对一个html元素进行初始化，在元素上绑定数据和设置事件监听器</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [renderHtml 使用html字符串进行初始化]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[$Object]&#125; $selector [一个页面元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; htmlstr   [html字符串]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; options   [自定义参数]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\">_$selector, _options</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> $selector = (<span class=\"keyword\">typeof</span> _$selector === <span class=\"string\">'object'</span>) ? _$selector : $(_$selector);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> trigger = _options[<span class=\"string\">'trigger'</span>] ? _options[<span class=\"string\">'trigger'</span>] : <span class=\"string\">'mouseover'</span>; <span class=\"comment\">// click | hover</span></span><br><span class=\"line\">  $selector</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-target'</span>, _options.value)</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-type'</span>, _options.type)</span><br><span class=\"line\">   .data(<span class=\"string\">'tootip-options'</span>, _options)</span><br><span class=\"line\">   .css(<span class=\"string\">'cursor'</span>, <span class=\"string\">'pointer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  eventListen($selector, trigger);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>根据传入属性创建tootips组件</h5>\n<ul>\n<li>使用<code>getBoundingClientRect()</code>方法获取目标组件的位置和宽高</li>\n<li>tootips组件根据获取的位置和宽高进行窗口定位(<code>position: fixed</code>)</li>\n<li>根据传入的属性设置tootips组件的样式</li>\n<li>返回一个jQuery元素</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [renderPage 构造html]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; options   [自定义参数]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; type   [渲染类型 -&gt; text | html]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; target   [渲染字符串]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> type = $selector.data(<span class=\"string\">'tootip-type'</span>),</span><br><span class=\"line\">     options = $selector.data(<span class=\"string\">'tootip-options'</span>),</span><br><span class=\"line\">     target = $selector.data(<span class=\"string\">'tootip-target'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 提取属性</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> randomKey = <span class=\"built_in\">String</span>(<span class=\"built_in\">Math</span>.random() + <span class=\"built_in\">Math</span>.random()).split(<span class=\"string\">'.'</span>).pop();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $wrapper = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cssStyle = options.style || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> styleSheet = options.css || <span class=\"string\">''</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> direction = options.direction || <span class=\"string\">'top'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> rect = $selector[<span class=\"number\">0</span>].getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 根据宿主元素第一次计算横坐标和纵坐标</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> renderX = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span> || d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x + r.width / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x - <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.x + r.width + <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> renderY = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y - <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span> || d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y + r.height / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (r.y + r.height + <span class=\"number\">6</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  $wrapper</span><br><span class=\"line\">   .css(<span class=\"string\">'position'</span>, <span class=\"string\">'fixed'</span>)</span><br><span class=\"line\">   .css(<span class=\"string\">'left'</span>, renderX(rect, direction))</span><br><span class=\"line\">   .css(<span class=\"string\">'top'</span>, renderY(rect, direction))</span><br><span class=\"line\">   .attr(<span class=\"string\">'key'</span>, randomKey)</span><br><span class=\"line\">   .addClass(styleSheet);</span><br><span class=\"line\">  $selector.attr(<span class=\"string\">'key'</span>, randomKey);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys(cssStyle).forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">attr</span>) </span>&#123;</span><br><span class=\"line\">    $wrapper.css(attr, cssStyle[attr]);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  $wrapper.append(type === <span class=\"string\">'html'</span> ? $(target) : $(<span class=\"string\">'&lt;span&gt;'</span> + target +<span class=\"string\">'&lt;/span&gt;'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $wrapper;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5>绑定事件监听器</h5>\n<blockquote>\n<p>对一个元素进行初始化后需要给tooltips组件绑定监听器(<code>click</code>或<code>mouse</code>事件)，让tootips组件能够响应鼠标的点击或是划过</p>\n</blockquote>\n<ul>\n<li>\n<p>实现showTootips方法<br>\n在tootips组件中可以自定义显示html内容或text内容，tootips组件被添加到页面之前，tootips组件的宽度和高度是不可获取的，所以在show方法中需要对tootips元素进行二次定位，同样使用<code>getBoundingClientRect()</code>方法获取tootips元素坐标和宽高。</p>\n</li>\n<li>\n<p>实现hideTootips方法<br>\nhide方法的作用是将当前元素对应的tootips组件从页面移出，之前初始化的时候在目标元素和生成的tootips元素上设置了同一个<code>key</code>属性，现在可以根据<code>key</code>来移除每个目标元素对应的tootips元素。</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [eventListen 进行事件监听]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[$Object]&#125; $selector [一个页面元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; trigger [触发事件监听类型]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eventListen</span>(<span class=\"params\">$selector, trigger</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 显示</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> showTootips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> $dom = renderPage($selector);</span><br><span class=\"line\">    $(<span class=\"string\">'body'</span>).append($dom[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    $selector.data(<span class=\"string\">'isActivated'</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根据生成的tootips元素第二次计算横坐标和纵坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> options = $selector.data(<span class=\"string\">'tootip-options'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rect = $dom[<span class=\"number\">0</span>].getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderX = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span> || d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x - r.width / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x - r.width + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.x + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderY = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">r, d</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'top'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y - r.height + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'left'</span> || d === <span class=\"string\">'right'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y - r.height / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (d === <span class=\"string\">'bottom'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (r.y + <span class=\"string\">'px'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    $dom.css(<span class=\"string\">'top'</span>, renderY(rect, options.direction));</span><br><span class=\"line\">    $dom.css(<span class=\"string\">'left'</span>, renderX(rect, options.direction));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> hideTooTips = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> key = $selector.attr(<span class=\"string\">'key'</span>);</span><br><span class=\"line\">    $(<span class=\"string\">'div[key='</span>+key+<span class=\"string\">']'</span>).remove();</span><br><span class=\"line\">    $selector.data(<span class=\"string\">'isActivated'</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// click事件监听</span></span><br><span class=\"line\">  (trigger === <span class=\"string\">'click'</span>) &amp;&amp;  $selector.on(trigger, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!$selector.data(<span class=\"string\">'isActivated'</span>)) &#123;</span><br><span class=\"line\">      showTootips($selector);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      hideTooTips($selector);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 鼠标事件监听</span></span><br><span class=\"line\">  (trigger === <span class=\"string\">'mouseover'</span>) &amp;&amp;</span><br><span class=\"line\">     $selector.on(<span class=\"string\">'mouseout'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       hideTooTips($selector);</span><br><span class=\"line\">     &#125;).on(<span class=\"string\">'mouseover'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       showTootips($selector);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5>使用方式</h5>\n<blockquote>\n<p>设置tootips方向、显示内容字符串(可以是html字符串)、触发方式(click / mouseover)、自定义css属性、自定义样式表。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tootips.init($(<span class=\"string\">'#t1'</span>), &#123;</span><br><span class=\"line\">  trigger: <span class=\"string\">'mouseover'</span>, <span class=\"comment\">// 触发方式</span></span><br><span class=\"line\">  type: <span class=\"string\">'html'</span>, <span class=\"comment\">// 内容显示类型</span></span><br><span class=\"line\">  value: <span class=\"string\">'&lt;h3&gt;header&lt;/h3&gt;&lt;p&gt;body&lt;/p&gt;'</span>, <span class=\"comment\">// 内容显示值</span></span><br><span class=\"line\">  direction: <span class=\"string\">'top'</span>, <span class=\"comment\">// 显示方向</span></span><br><span class=\"line\">  style: &#123; <span class=\"comment\">// tootips组件自定义样式</span></span><br><span class=\"line\">    <span class=\"string\">'font-size'</span>: <span class=\"string\">'1rem'</span>,</span><br><span class=\"line\">    <span class=\"string\">'color'</span>: <span class=\"string\">'red'</span>,</span><br><span class=\"line\">    <span class=\"string\">'min-width'</span>: <span class=\"string\">'5rem'</span>,</span><br><span class=\"line\">    <span class=\"string\">'border'</span>: <span class=\"string\">'solid 1px grey'</span>,</span><br><span class=\"line\">    <span class=\"string\">'padding'</span>: <span class=\"string\">'5px 10px'</span>,</span><br><span class=\"line\">    <span class=\"string\">'border-radius'</span>: <span class=\"string\">'5px'</span>,</span><br><span class=\"line\">    <span class=\"string\">'background-color'</span>: <span class=\"string\">'white'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  css: <span class=\"string\">'triangle-bottom'</span>, <span class=\"comment\">// tootips组件自定义样式表</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4>总结</h4>\n<hr>\n<ul>\n<li>tootips组件的坐标完全使用javasript来获取和设置</li>\n<li>tootips组件的定位类型为<code>position: fixed</code>，不受页面布局影响</li>\n<li><code>getBoundingClientRect()</code>方法可以获取目标元素的坐标、宽高等数据</li>\n<li>tootips组件支持传入自定义样式</li>\n<li>tootips组件支持显示含有html标签的字符串和普通字符串</li>\n<li>tootips组件支持设置触发方式(<code>click</code> / <code>mouseover</code>)</li>\n</ul>\n<p>实现方式可能还需要优化，但暂时能够满足项目需求 …</p>\n<h5>感谢阅读</h5>\n"},{"title":"基于s3对象存储多文件分片上传的Javascript实现","catalog":true,"toc_nav_num":true,"date":"2020-03-07T08:18:00.000Z","subtitle":"aws s3 javascript","header-img":"/blogs/img/article_header/article_header.png","catagories":["Javascript"],"updateDate":"2020-03-07T08:18:00.000Z","top":1,"_content":"\n### Contents\n\n1. 概述\n\n2. 浏览器文件操作限制\n\n3. 前端多文件分片上传的原理和实现\n\n### 预览\n\n![upload](/blogs/img/article/upload.png)\n\n### 概述\n\nAmazon S3 提供了一个简单 Web 服务接口，可用于随时在 Web 上的任何位置存储和检索任何数量的数据。此服务让所有开发人员都能访问同一个具备高扩展性、可靠性、安全性和快速价廉的数据存储基础设施， Amazon 用它来运行其全球的网站网络。此服务旨在为开发人员带来最大化的规模效益。  \n本文主要针对兼容aws-s3接口的第三方存储服务，在不使用官方sdk的情况下直接使用Restful接口进行存储桶多文件分片上传，主要包含浏览器端的多文件分片上传逻辑的Javascript代码实现。\n\n### 浏览器文件操作限制\n\n* HTML5新特性`input[type=file]`支持调用浏览器文件访问窗口来获取文件数据，实际上JS代码使用此特性访问本地文件系统后拿到的是一个指向文件的引用地址，且如果页面刷新了那么这个地址不可复用，JS代码并没有实际操作文件本身。前端上传数据时根据这个指向文件的地址把文件的一小块分片数据载入到内存并通过Ajax请求发送到中间件进行处理。\n* 浏览器JS代码没有文件系统操作权限，不能任意存储和读取文件，因此不支持刷新浏览器后上传进度断点恢复，刷新之后断点恢复的前提是能拿到文件数据，但是JS代码没权限访问之前拿到的文件引用地址，并且存储之前上传过的文件分片数据这一做法也不合理。 \n* 相对于文件上传，文件下载则完全不可控，由于文件操作权限，所以整个下载文件操作都是由浏览器自带的的下载任务管理器控制的，没有浏览器接口能拿到这些下载任务进度，所以下载任务进度也是不能获取的。\n\n### 前端多文件分片上传的原理和实现\n\n_完整Github[源码](https://github.com/NoJsJa/javascript-learning/tree/master/file-slice-upload)_\n\n> 使用了React16/Webpack4/Mobx状态管理库\n\n* 支持批量文件分割并行上传\n* 多文件操作：暂停/恢复/终止/续传/重传\n* 自定义上传任务数目、单个分片大小\n\n#### 运行流程图\n\n![upload](/blogs/img/article/shards_upload.jpg)\n\n#### 主要流程\n\n1. cacheFile  \n前端通过input组件拿到所有文件地址并缓存起来。\n```js\n /**\n   * [cacheFile 缓存即将注册的文件]\n   */\n  @action\n  cacheFile = (files, bucket) => {\n    const symbolArr = this.filesCache.map(file => this.getSymbol(file));\n    const filtedFiles = [];\n    let uploadingFileFound = false;\n    files.forEach((file) => {\n      if (!symbolArr.includes(this.getSymbol(file))) {\n        if (this.findIsUploading(this.getSymbol(file), bucket)) {\n          uploadingFileFound = true;\n          filtedFiles.push(file.name);\n        } else {\n          this.filesCache.push(file);\n          symbolArr.push(this.getSymbol(file));\n        }\n      }\n    });\n    if (!files.length) openNotification('warning', null, this.lang.lang.noFilCanBeUploaded);\n    if (uploadingFileFound) openNotification('warning', null, this.lang.lang.uploadingFileReuploadTips + filtedFiles.join(', '));\n  }\n```\n\n2. registry  \n根据上一步拿到的文件地址数组创建多个Mobx observable对象跟踪每个上传对象的基本识别信息，包括文件名、文件大小、类型、分片信息(分片大小和总分片数)、上传状态信息：uninitial(未初始化)/pending(准备)/uploading(上传中)/pause(暂停)/error(错误)/break(上传完成)、上传开始时间、上传完成时间，为了便于访问这些Mobx observable对象，建立一个weakMap存储file对象和observable对象的弱映射关系。\n```js\n/**\n   * [registry 注册上传文件信息]\n   * @param {[Object]} file [文件对象]\n   * @param {[String]} uploadId [文件上传进程id]\n   * @param {[Object]} state [文件初始化状态]\n   */\n  @action registry = (files, region, prefix) => {\n    let fileObj = null;\n    this.loading = true;\n    files.forEach((file) => {\n      if (this.files.includes(file)) {\n        return;\n      }\n      this.files.push(file);\n      fileObj = {\n        name: file.webkitRelativePath || file.name,\n        prefix: prefix || '',\n        size: file.size,\n        type: file.type || mapMimeType((file.webkitRelativePath || file.name).split('.').pop()).type,\n        state: 'uninitial',\n        creationTime: '',\n        completionTime: '',\n        index: 0,\n        file,\n        initialized: false,\n        partEtags: [],\n        region,\n        blockSize: this.blockSize,\n        total: Math.ceil(file.size / this.blockSize),\n        activePoint: new Date(),\n        speed: '0 MB/S',\n        id: encodeURIComponent(new Date() + file.name + file.type + file.size),\n      };\n      this.taskType.uninitial.push(file);\n      this.taskType.series.push(file);\n      const obj = observable(fileObj);\n      if (!this.fileStorage.get(region)) {\n        this.fileStorage.set(region, [obj]);\n      } else {\n        this.fileStorage.get(region).push(obj);\n      }\n      this.fileStorageMap.set(file, obj);\n    });\n    this.loading = false;\n  }\n```\n\n3. startTasks  \n获取文件队列中可用于上传的文件对象，根据文件状态对其做初始化或切割文件上传的操作，同时实时修改对应的Mobx observable上传对象的元数据标识，包括当前上传文件的分片索引(单个文件上传进度=分片索引/总分片数目)、已上传完成的分片etag信息(由服务器返回，可用于完成分片上传时校验已上传的所有分片数据是否匹配)、当前上传对象4的上传状态(uninitial/pending/uploading/pause/eror/break)、当前上传对象的上传速度(速度=单个分片大小/单个分片上传所用时间)。\n```js\n/**\n   * [startTasks 开启上传任务队列]\n   * @param  {[String]} region [桶名]\n   */\n  startTasks = (region) => {\n    // 根据空闲任务类型和空闲任务并发限制开启空闲任务\n    this.refreshTasks(region);\n    if (this.isUploadListEmpty(region)) return;\n\n    const maxLength = this.multiTaskCount - this.taskType.uploading.length;\n    const taskSeries = [];\n    for (let i = 0; i < (maxLength) && this.taskType.series[i]; i += 1) {\n      // const file = this.taskType.series.shift();\n      const file = this.taskType.series[i];\n      const storageObject = this.fileStorageMap.get(file);\n      if (storageObject.state === 'uploading') continue; // 上传中\n      if (storageObject.state === 'pause') continue;\n      taskSeries.push(storageObject);\n    }\n\n    let index;\n    taskSeries.forEach((storageObject) => {\n      index = this.taskType.series.indexOf(storageObject.file);\n      index !== -1 && this.taskType.series.splice(index, 1);\n      if (this.taskType.uninitial.includes(storageObject.file)) {\n        this.initRequest(\n          storageObject.file,\n          {\n            bucket: region,\n            object: storageObject.name,\n            prefix: storageObject.prefix,\n          }\n        ).then(({ err, init }) => {\n          if (!err && init) {\n            this.upload(storageObject.file, {\n              bucket: region,\n              object: storageObject.name,\n              prefix: storageObject.prefix,\n              uploadId: storageObject.uploadId,\n            });\n          }\n        });\n      } else {\n        this.upload(storageObject.file, {\n          bucket: region,\n          object: storageObject.name,\n          prefix: storageObject.prefix,\n          uploadId: storageObject.uploadId,\n        });\n      }\n    });\n  }\n```\n\n4. refreshTasks  \n根据当前设置的并行上传任务数目和正在上传的任务数目及时从文件预备上传队列提取文件放入上传可调用文件队列。\n```js\n/* 刷线任务列表 */\n  @action\n  refreshTasks = (region) => {\n    // 统计空闲任务\n    const storageObject = this.fileStorage.get(region);\n    if (!storageObject) return;\n    for (let i = 0; i < storageObject.length; i += 1) {\n      if (\n        storageObject[i].index !== storageObject[i].total\n        && (storageObject[i].state === 'pending'\n        || storageObject[i].state === 'uninitial')\n      ) {\n        const { file } = storageObject[i];\n        if (!this.taskType.series.includes(file)) {\n          this.taskType.series.push(file);\n        }\n      }\n    }\n  }\n```\n\n5. upload & update  \n根据当前文件对象的上传分片索引对文件进行切割并更新索引，然后把切割下来的数据通过Ajax请求发送给中间件处理，中间件发送到后台后返回得到的当前分片的etag信息，前端拿到etag信息并存储到当前上传对象分片etag信息数组里面。\n```js\n/**\n   * [upload 分割文件发起上传请求]\n   * @param  {[Object]} file    [description]\n   * @param  {[Object]} _params [...]\n   * @param  {[String]}   _params.bucket [bucket name]\n   * @param  {[String]}   _params.object [object name]\n   * @param  {[String]}   _params.uploadId [upload id]\n   */\n  @action\n  upload = (file, _params) => {\n    const storageObject = this.fileStorageMap.get(file);\n    let single = false; // 不分片\n    /* 异常状态退出 */\n    if (!this.isValidUploadingTask(storageObject)) return;\n\n    if (storageObject.state === 'pending') {\n      this.taskType.pending.splice(this.taskType.pending.indexOf(file), 1);\n      this.taskType.uploading.push(file);\n      storageObject.state = 'uploading';\n    }\n\n\n    const num = storageObject.index;\n\n    if (num === 0 && file.size <= storageObject.blockSize) {\n      // 不用分片的情况\n      single = true;\n    } else if (num === storageObject.total) {\n      // 所有分片都已经发出\n      return;\n    }\n    const nextSize = Math.min((num + 1) * storageObject.blockSize, file.size);\n    const fileData = file.slice(num * storageObject.blockSize, nextSize);\n    const params = Object.assign(_params, {\n      partNumber: num + 1,\n    });\n    storageObject.activePoint = new Date();\n    this.uploadRequest({ params, data: fileData, single }).then((rsp) => {\n      if (rsp.code !== 200) {\n        openNotification('error', null, (rsp.result.data ? rsp.result.data.Code : this.lang.lang.uploadError));\n        this.markError(file);\n        this.startTasks(params.bucket);\n        return;\n      }\n      const { completed, etags } = this.update({\n        region: params.bucket,\n        etag: rsp.result.etag,\n        size: fileData.size,\n        id: storageObject.id,\n        index: params.partNumber,\n      });\n      if (completed) {\n        (single ?\n          () => {\n            this.complete(file, params.bucket);\n          } :\n          (partEtags) => {\n            this.completeRequest({\n              bucket: params.bucket,\n              uploadId: params.uploadId,\n              object: params.object,\n              prefix: params.prefix,\n              partEtags,\n            }, file);\n          })(etags);\n      } else {\n        this.upload(file, {\n          bucket: params.bucket,\n          object: params.object,\n          uploadId: params.uploadId,\n          partNumber: params.partNumber,\n          prefix: params.prefix,\n        });\n      }\n    }).catch((error) => {\n      this.markError(file);\n      this.startTasks(params.bucket);\n      console.log(`${params.bucket}_${params.object} upload error: ${error}`);\n    });\n    storageObject.index += 1;\n  }\n\n```\n\n7. complete  \n当最后一个分片上传请求完成返回后，我们就拿到了服务端返回的这个文件的所有分片etag信息，前端需要校验当前上传对象etag数组的长度是否匹配，数组内每个etag元素的索引和etag值是否匹配，校验完成后发送最后一个请求到后端进行校验和组装分片，最终完成一个文件的分片上传过程。\n```js\n/**\n   * [completeRequest 完成所有分片数据上传]\n   * @param  {[Object]} _params [...]\n   * @param  {[String]}   _params.bucket [bucket name]\n   * @param  {[String]}   _params.object [object name]\n   * @param  {[String]}   _params.uploadId [upload id]\n   * @param  {[String]}   _params.partEtags [upload id]\n   * @param  {[Object]} file [文件对象]\n   */\n  @action completeRequest = (params, file) => {\n    postDataPro(\n      {\n        ...{\n          ...params,\n          ...{\n            object: params.prefix + params.object,\n          },\n        },\n        partEtags: {\n          CompleteMultipartUpload: {\n            Part: params.partEtags.map(info => ({\n              PartNumber: info.number,\n              ETag: info.etag,\n            })),\n          },\n        },\n      },\n      objectResourceApi.object.completeFragmentUpload\n    ).then((data) => {\n      this.complete(file, params.bucket);\n    }).catch((error) => {\n      this.startTasks(params.bucket);\n      this.markError(file);\n    });\n  }\n\n  /**\n   * [complete 完成上传]\n   * @param {[Object]} file [文件对象]\n   * @param {[String]} bucket [桶名]\n   */\n  @action\n  complete = (file, bucket) => {\n    const index = this.taskType.uploading.indexOf(file);\n    this.taskType.uploading.splice(index, 1);\n    this.taskType.break.push(file);\n    const storageObject = this.fileStorageMap.get(file);\n    storageObject.completionTime = (new Date().toTimeString()).split(' ')[0];\n    storageObject.state = 'break';\n    storageObject.index = storageObject.total;\n\n    this.startTasks(bucket);\n  };\n\n```\n\n#### 其它操作\n\n1. 暂停文件上传  \n将上传对象的状态从uploading置为pause，然后把该对象对应的文件从可调用上传文件队列移除。\n\n2. 开始暂停的上传任务  \n将上传对象的状态从pause置为pending，然后把该对象对应的文件放入可调用上传文件队列，等待下一次刷新文件上传任务队列。\n\n3. 续传上传错误的任务\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，保持文件的已上传分片索引记录，等待下一次刷新文件上传任务队列，直接调用上传函数进行切割并上传。\n\n4. 重传上传错误的任务\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，并将文件已上传分片索引记录置为初始状态，等待下一次刷新文件上传任务队列，从文件初始位置重新开始切割文件并上传。\n\n#### 一些关键代码\n\n1. 一个分片上传完成后将后台返回的etag信息更新到本地的上传对象属性，并判断此文件是否上传完成。\n```js\n/**\n   * [update 更新本地上传记录]\n   * @param {[String]} region [桶名]\n   * @param {[String]} etag [分片标志]\n   */\n  @action\n  update = ({\n    region, etag, size, id, index,\n  }) => {\n    const target = this.fileStorage.get(region);\n    for (let i = 0; i < target.length; i += 1) {\n      if (target[i].id === id) {\n        target[i].speed = `${(size / 1024 / 1024 / (((new Date() - target[i].activePoint) / 1000))).toFixed(2)} MB/S`;\n        if (target[i].speed === '0.00 MB/S') {\n          target[i].speed = `${formatSizeStr(size)}/S`;\n        }\n        target[i].partEtags = target[i].partEtags.filter(etagItem => etagItem.number !== index);\n        target[i].partEtags.push({\n          number: index,\n          etag,\n        });\n        // 最后一个分片恰好又暂停的情况\n        if (index === target[i].total) {\n          if (target[i].state === 'pause') {\n            index -= 1;\n          }\n        }\n        // 判断上传是否完成\n        if (target[i].total === 0 || target[i].partEtags.toJS().length === target[i].total) {\n          return {\n            completed: true,\n            etags: target[i].partEtags,\n          };\n        }\n        return {\n          completed: false,\n        };\n      }\n    }\n  }\n```","source":"_posts/基于s3对象存储多文件分片上传的Javascript实现.md","raw":"---\ntitle: \"基于s3对象存储多文件分片上传的Javascript实现\"\ncatalog: true\ntoc_nav_num: true\ndate: 2020-03-07 16:18:00\nsubtitle: \"aws s3 javascript\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- FileUpload\n- AWS\n- S3\ncatagories:\n- Javascript\nupdateDate: 2020-03-07 16:18:00\ntop: 1\n---\n\n### Contents\n\n1. 概述\n\n2. 浏览器文件操作限制\n\n3. 前端多文件分片上传的原理和实现\n\n### 预览\n\n![upload](/blogs/img/article/upload.png)\n\n### 概述\n\nAmazon S3 提供了一个简单 Web 服务接口，可用于随时在 Web 上的任何位置存储和检索任何数量的数据。此服务让所有开发人员都能访问同一个具备高扩展性、可靠性、安全性和快速价廉的数据存储基础设施， Amazon 用它来运行其全球的网站网络。此服务旨在为开发人员带来最大化的规模效益。  \n本文主要针对兼容aws-s3接口的第三方存储服务，在不使用官方sdk的情况下直接使用Restful接口进行存储桶多文件分片上传，主要包含浏览器端的多文件分片上传逻辑的Javascript代码实现。\n\n### 浏览器文件操作限制\n\n* HTML5新特性`input[type=file]`支持调用浏览器文件访问窗口来获取文件数据，实际上JS代码使用此特性访问本地文件系统后拿到的是一个指向文件的引用地址，且如果页面刷新了那么这个地址不可复用，JS代码并没有实际操作文件本身。前端上传数据时根据这个指向文件的地址把文件的一小块分片数据载入到内存并通过Ajax请求发送到中间件进行处理。\n* 浏览器JS代码没有文件系统操作权限，不能任意存储和读取文件，因此不支持刷新浏览器后上传进度断点恢复，刷新之后断点恢复的前提是能拿到文件数据，但是JS代码没权限访问之前拿到的文件引用地址，并且存储之前上传过的文件分片数据这一做法也不合理。 \n* 相对于文件上传，文件下载则完全不可控，由于文件操作权限，所以整个下载文件操作都是由浏览器自带的的下载任务管理器控制的，没有浏览器接口能拿到这些下载任务进度，所以下载任务进度也是不能获取的。\n\n### 前端多文件分片上传的原理和实现\n\n_完整Github[源码](https://github.com/NoJsJa/javascript-learning/tree/master/file-slice-upload)_\n\n> 使用了React16/Webpack4/Mobx状态管理库\n\n* 支持批量文件分割并行上传\n* 多文件操作：暂停/恢复/终止/续传/重传\n* 自定义上传任务数目、单个分片大小\n\n#### 运行流程图\n\n![upload](/blogs/img/article/shards_upload.jpg)\n\n#### 主要流程\n\n1. cacheFile  \n前端通过input组件拿到所有文件地址并缓存起来。\n```js\n /**\n   * [cacheFile 缓存即将注册的文件]\n   */\n  @action\n  cacheFile = (files, bucket) => {\n    const symbolArr = this.filesCache.map(file => this.getSymbol(file));\n    const filtedFiles = [];\n    let uploadingFileFound = false;\n    files.forEach((file) => {\n      if (!symbolArr.includes(this.getSymbol(file))) {\n        if (this.findIsUploading(this.getSymbol(file), bucket)) {\n          uploadingFileFound = true;\n          filtedFiles.push(file.name);\n        } else {\n          this.filesCache.push(file);\n          symbolArr.push(this.getSymbol(file));\n        }\n      }\n    });\n    if (!files.length) openNotification('warning', null, this.lang.lang.noFilCanBeUploaded);\n    if (uploadingFileFound) openNotification('warning', null, this.lang.lang.uploadingFileReuploadTips + filtedFiles.join(', '));\n  }\n```\n\n2. registry  \n根据上一步拿到的文件地址数组创建多个Mobx observable对象跟踪每个上传对象的基本识别信息，包括文件名、文件大小、类型、分片信息(分片大小和总分片数)、上传状态信息：uninitial(未初始化)/pending(准备)/uploading(上传中)/pause(暂停)/error(错误)/break(上传完成)、上传开始时间、上传完成时间，为了便于访问这些Mobx observable对象，建立一个weakMap存储file对象和observable对象的弱映射关系。\n```js\n/**\n   * [registry 注册上传文件信息]\n   * @param {[Object]} file [文件对象]\n   * @param {[String]} uploadId [文件上传进程id]\n   * @param {[Object]} state [文件初始化状态]\n   */\n  @action registry = (files, region, prefix) => {\n    let fileObj = null;\n    this.loading = true;\n    files.forEach((file) => {\n      if (this.files.includes(file)) {\n        return;\n      }\n      this.files.push(file);\n      fileObj = {\n        name: file.webkitRelativePath || file.name,\n        prefix: prefix || '',\n        size: file.size,\n        type: file.type || mapMimeType((file.webkitRelativePath || file.name).split('.').pop()).type,\n        state: 'uninitial',\n        creationTime: '',\n        completionTime: '',\n        index: 0,\n        file,\n        initialized: false,\n        partEtags: [],\n        region,\n        blockSize: this.blockSize,\n        total: Math.ceil(file.size / this.blockSize),\n        activePoint: new Date(),\n        speed: '0 MB/S',\n        id: encodeURIComponent(new Date() + file.name + file.type + file.size),\n      };\n      this.taskType.uninitial.push(file);\n      this.taskType.series.push(file);\n      const obj = observable(fileObj);\n      if (!this.fileStorage.get(region)) {\n        this.fileStorage.set(region, [obj]);\n      } else {\n        this.fileStorage.get(region).push(obj);\n      }\n      this.fileStorageMap.set(file, obj);\n    });\n    this.loading = false;\n  }\n```\n\n3. startTasks  \n获取文件队列中可用于上传的文件对象，根据文件状态对其做初始化或切割文件上传的操作，同时实时修改对应的Mobx observable上传对象的元数据标识，包括当前上传文件的分片索引(单个文件上传进度=分片索引/总分片数目)、已上传完成的分片etag信息(由服务器返回，可用于完成分片上传时校验已上传的所有分片数据是否匹配)、当前上传对象4的上传状态(uninitial/pending/uploading/pause/eror/break)、当前上传对象的上传速度(速度=单个分片大小/单个分片上传所用时间)。\n```js\n/**\n   * [startTasks 开启上传任务队列]\n   * @param  {[String]} region [桶名]\n   */\n  startTasks = (region) => {\n    // 根据空闲任务类型和空闲任务并发限制开启空闲任务\n    this.refreshTasks(region);\n    if (this.isUploadListEmpty(region)) return;\n\n    const maxLength = this.multiTaskCount - this.taskType.uploading.length;\n    const taskSeries = [];\n    for (let i = 0; i < (maxLength) && this.taskType.series[i]; i += 1) {\n      // const file = this.taskType.series.shift();\n      const file = this.taskType.series[i];\n      const storageObject = this.fileStorageMap.get(file);\n      if (storageObject.state === 'uploading') continue; // 上传中\n      if (storageObject.state === 'pause') continue;\n      taskSeries.push(storageObject);\n    }\n\n    let index;\n    taskSeries.forEach((storageObject) => {\n      index = this.taskType.series.indexOf(storageObject.file);\n      index !== -1 && this.taskType.series.splice(index, 1);\n      if (this.taskType.uninitial.includes(storageObject.file)) {\n        this.initRequest(\n          storageObject.file,\n          {\n            bucket: region,\n            object: storageObject.name,\n            prefix: storageObject.prefix,\n          }\n        ).then(({ err, init }) => {\n          if (!err && init) {\n            this.upload(storageObject.file, {\n              bucket: region,\n              object: storageObject.name,\n              prefix: storageObject.prefix,\n              uploadId: storageObject.uploadId,\n            });\n          }\n        });\n      } else {\n        this.upload(storageObject.file, {\n          bucket: region,\n          object: storageObject.name,\n          prefix: storageObject.prefix,\n          uploadId: storageObject.uploadId,\n        });\n      }\n    });\n  }\n```\n\n4. refreshTasks  \n根据当前设置的并行上传任务数目和正在上传的任务数目及时从文件预备上传队列提取文件放入上传可调用文件队列。\n```js\n/* 刷线任务列表 */\n  @action\n  refreshTasks = (region) => {\n    // 统计空闲任务\n    const storageObject = this.fileStorage.get(region);\n    if (!storageObject) return;\n    for (let i = 0; i < storageObject.length; i += 1) {\n      if (\n        storageObject[i].index !== storageObject[i].total\n        && (storageObject[i].state === 'pending'\n        || storageObject[i].state === 'uninitial')\n      ) {\n        const { file } = storageObject[i];\n        if (!this.taskType.series.includes(file)) {\n          this.taskType.series.push(file);\n        }\n      }\n    }\n  }\n```\n\n5. upload & update  \n根据当前文件对象的上传分片索引对文件进行切割并更新索引，然后把切割下来的数据通过Ajax请求发送给中间件处理，中间件发送到后台后返回得到的当前分片的etag信息，前端拿到etag信息并存储到当前上传对象分片etag信息数组里面。\n```js\n/**\n   * [upload 分割文件发起上传请求]\n   * @param  {[Object]} file    [description]\n   * @param  {[Object]} _params [...]\n   * @param  {[String]}   _params.bucket [bucket name]\n   * @param  {[String]}   _params.object [object name]\n   * @param  {[String]}   _params.uploadId [upload id]\n   */\n  @action\n  upload = (file, _params) => {\n    const storageObject = this.fileStorageMap.get(file);\n    let single = false; // 不分片\n    /* 异常状态退出 */\n    if (!this.isValidUploadingTask(storageObject)) return;\n\n    if (storageObject.state === 'pending') {\n      this.taskType.pending.splice(this.taskType.pending.indexOf(file), 1);\n      this.taskType.uploading.push(file);\n      storageObject.state = 'uploading';\n    }\n\n\n    const num = storageObject.index;\n\n    if (num === 0 && file.size <= storageObject.blockSize) {\n      // 不用分片的情况\n      single = true;\n    } else if (num === storageObject.total) {\n      // 所有分片都已经发出\n      return;\n    }\n    const nextSize = Math.min((num + 1) * storageObject.blockSize, file.size);\n    const fileData = file.slice(num * storageObject.blockSize, nextSize);\n    const params = Object.assign(_params, {\n      partNumber: num + 1,\n    });\n    storageObject.activePoint = new Date();\n    this.uploadRequest({ params, data: fileData, single }).then((rsp) => {\n      if (rsp.code !== 200) {\n        openNotification('error', null, (rsp.result.data ? rsp.result.data.Code : this.lang.lang.uploadError));\n        this.markError(file);\n        this.startTasks(params.bucket);\n        return;\n      }\n      const { completed, etags } = this.update({\n        region: params.bucket,\n        etag: rsp.result.etag,\n        size: fileData.size,\n        id: storageObject.id,\n        index: params.partNumber,\n      });\n      if (completed) {\n        (single ?\n          () => {\n            this.complete(file, params.bucket);\n          } :\n          (partEtags) => {\n            this.completeRequest({\n              bucket: params.bucket,\n              uploadId: params.uploadId,\n              object: params.object,\n              prefix: params.prefix,\n              partEtags,\n            }, file);\n          })(etags);\n      } else {\n        this.upload(file, {\n          bucket: params.bucket,\n          object: params.object,\n          uploadId: params.uploadId,\n          partNumber: params.partNumber,\n          prefix: params.prefix,\n        });\n      }\n    }).catch((error) => {\n      this.markError(file);\n      this.startTasks(params.bucket);\n      console.log(`${params.bucket}_${params.object} upload error: ${error}`);\n    });\n    storageObject.index += 1;\n  }\n\n```\n\n7. complete  \n当最后一个分片上传请求完成返回后，我们就拿到了服务端返回的这个文件的所有分片etag信息，前端需要校验当前上传对象etag数组的长度是否匹配，数组内每个etag元素的索引和etag值是否匹配，校验完成后发送最后一个请求到后端进行校验和组装分片，最终完成一个文件的分片上传过程。\n```js\n/**\n   * [completeRequest 完成所有分片数据上传]\n   * @param  {[Object]} _params [...]\n   * @param  {[String]}   _params.bucket [bucket name]\n   * @param  {[String]}   _params.object [object name]\n   * @param  {[String]}   _params.uploadId [upload id]\n   * @param  {[String]}   _params.partEtags [upload id]\n   * @param  {[Object]} file [文件对象]\n   */\n  @action completeRequest = (params, file) => {\n    postDataPro(\n      {\n        ...{\n          ...params,\n          ...{\n            object: params.prefix + params.object,\n          },\n        },\n        partEtags: {\n          CompleteMultipartUpload: {\n            Part: params.partEtags.map(info => ({\n              PartNumber: info.number,\n              ETag: info.etag,\n            })),\n          },\n        },\n      },\n      objectResourceApi.object.completeFragmentUpload\n    ).then((data) => {\n      this.complete(file, params.bucket);\n    }).catch((error) => {\n      this.startTasks(params.bucket);\n      this.markError(file);\n    });\n  }\n\n  /**\n   * [complete 完成上传]\n   * @param {[Object]} file [文件对象]\n   * @param {[String]} bucket [桶名]\n   */\n  @action\n  complete = (file, bucket) => {\n    const index = this.taskType.uploading.indexOf(file);\n    this.taskType.uploading.splice(index, 1);\n    this.taskType.break.push(file);\n    const storageObject = this.fileStorageMap.get(file);\n    storageObject.completionTime = (new Date().toTimeString()).split(' ')[0];\n    storageObject.state = 'break';\n    storageObject.index = storageObject.total;\n\n    this.startTasks(bucket);\n  };\n\n```\n\n#### 其它操作\n\n1. 暂停文件上传  \n将上传对象的状态从uploading置为pause，然后把该对象对应的文件从可调用上传文件队列移除。\n\n2. 开始暂停的上传任务  \n将上传对象的状态从pause置为pending，然后把该对象对应的文件放入可调用上传文件队列，等待下一次刷新文件上传任务队列。\n\n3. 续传上传错误的任务\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，保持文件的已上传分片索引记录，等待下一次刷新文件上传任务队列，直接调用上传函数进行切割并上传。\n\n4. 重传上传错误的任务\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，并将文件已上传分片索引记录置为初始状态，等待下一次刷新文件上传任务队列，从文件初始位置重新开始切割文件并上传。\n\n#### 一些关键代码\n\n1. 一个分片上传完成后将后台返回的etag信息更新到本地的上传对象属性，并判断此文件是否上传完成。\n```js\n/**\n   * [update 更新本地上传记录]\n   * @param {[String]} region [桶名]\n   * @param {[String]} etag [分片标志]\n   */\n  @action\n  update = ({\n    region, etag, size, id, index,\n  }) => {\n    const target = this.fileStorage.get(region);\n    for (let i = 0; i < target.length; i += 1) {\n      if (target[i].id === id) {\n        target[i].speed = `${(size / 1024 / 1024 / (((new Date() - target[i].activePoint) / 1000))).toFixed(2)} MB/S`;\n        if (target[i].speed === '0.00 MB/S') {\n          target[i].speed = `${formatSizeStr(size)}/S`;\n        }\n        target[i].partEtags = target[i].partEtags.filter(etagItem => etagItem.number !== index);\n        target[i].partEtags.push({\n          number: index,\n          etag,\n        });\n        // 最后一个分片恰好又暂停的情况\n        if (index === target[i].total) {\n          if (target[i].state === 'pause') {\n            index -= 1;\n          }\n        }\n        // 判断上传是否完成\n        if (target[i].total === 0 || target[i].partEtags.toJS().length === target[i].total) {\n          return {\n            completed: true,\n            etags: target[i].partEtags,\n          };\n        }\n        return {\n          completed: false,\n        };\n      }\n    }\n  }\n```","slug":"基于s3对象存储多文件分片上传的Javascript实现","published":1,"updated":"2020-03-10T16:58:29.819Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxna000na895rwlrr6fc","content":"<h3 id=\"contents\">Contents</h3>\n<ol>\n<li>\n<p>概述</p>\n</li>\n<li>\n<p>浏览器文件操作限制</p>\n</li>\n<li>\n<p>前端多文件分片上传的原理和实现</p>\n</li>\n</ol>\n<h3 id=\"预览\">预览</h3>\n<p><img src=\"/blogs/img/article/upload.png\" alt=\"upload\"></p>\n<h3 id=\"概述\">概述</h3>\n<p>Amazon S3 提供了一个简单 Web 服务接口，可用于随时在 Web 上的任何位置存储和检索任何数量的数据。此服务让所有开发人员都能访问同一个具备高扩展性、可靠性、安全性和快速价廉的数据存储基础设施， Amazon 用它来运行其全球的网站网络。此服务旨在为开发人员带来最大化的规模效益。<br>\n本文主要针对兼容aws-s3接口的第三方存储服务，在不使用官方sdk的情况下直接使用Restful接口进行存储桶多文件分片上传，主要包含浏览器端的多文件分片上传逻辑的Javascript代码实现。</p>\n<h3 id=\"浏览器文件操作限制\">浏览器文件操作限制</h3>\n<ul>\n<li>HTML5新特性<code>input[type=file]</code>支持调用浏览器文件访问窗口来获取文件数据，实际上JS代码使用此特性访问本地文件系统后拿到的是一个指向文件的引用地址，且如果页面刷新了那么这个地址不可复用，JS代码并没有实际操作文件本身。前端上传数据时根据这个指向文件的地址把文件的一小块分片数据载入到内存并通过Ajax请求发送到中间件进行处理。</li>\n<li>浏览器JS代码没有文件系统操作权限，不能任意存储和读取文件，因此不支持刷新浏览器后上传进度断点恢复，刷新之后断点恢复的前提是能拿到文件数据，但是JS代码没权限访问之前拿到的文件引用地址，并且存储之前上传过的文件分片数据这一做法也不合理。</li>\n<li>相对于文件上传，文件下载则完全不可控，由于文件操作权限，所以整个下载文件操作都是由浏览器自带的的下载任务管理器控制的，没有浏览器接口能拿到这些下载任务进度，所以下载任务进度也是不能获取的。</li>\n</ul>\n<h3 id=\"前端多文件分片上传的原理和实现\">前端多文件分片上传的原理和实现</h3>\n<p><em>完整Github<a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/file-slice-upload\" target=\"_blank\" rel=\"noopener\">源码</a></em></p>\n<blockquote>\n<p>使用了React16/Webpack4/Mobx状态管理库</p>\n</blockquote>\n<ul>\n<li>支持批量文件分割并行上传</li>\n<li>多文件操作：暂停/恢复/终止/续传/重传</li>\n<li>自定义上传任务数目、单个分片大小</li>\n</ul>\n<h4 id=\"运行流程图\">运行流程图</h4>\n<p><img src=\"/blogs/img/article/shards_upload.jpg\" alt=\"upload\"></p>\n<h4 id=\"主要流程\">主要流程</h4>\n<ol>\n<li>cacheFile<br>\n前端通过input组件拿到所有文件地址并缓存起来。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * [cacheFile 缓存即将注册的文件]</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"> @action</span><br><span class=\"line\"> cacheFile = <span class=\"function\">(<span class=\"params\">files, bucket</span>) =&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> symbolArr = <span class=\"keyword\">this</span>.filesCache.map(<span class=\"function\"><span class=\"params\">file</span> =&gt;</span> <span class=\"keyword\">this</span>.getSymbol(file));</span><br><span class=\"line\">   <span class=\"keyword\">const</span> filtedFiles = [];</span><br><span class=\"line\">   <span class=\"keyword\">let</span> uploadingFileFound = <span class=\"literal\">false</span>;</span><br><span class=\"line\">   files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!symbolArr.includes(<span class=\"keyword\">this</span>.getSymbol(file))) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.findIsUploading(<span class=\"keyword\">this</span>.getSymbol(file), bucket)) &#123;</span><br><span class=\"line\">         uploadingFileFound = <span class=\"literal\">true</span>;</span><br><span class=\"line\">         filtedFiles.push(file.name);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         <span class=\"keyword\">this</span>.filesCache.push(file);</span><br><span class=\"line\">         symbolArr.push(<span class=\"keyword\">this</span>.getSymbol(file));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (!files.length) openNotification(<span class=\"string\">'warning'</span>, <span class=\"literal\">null</span>, <span class=\"keyword\">this</span>.lang.lang.noFilCanBeUploaded);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (uploadingFileFound) openNotification(<span class=\"string\">'warning'</span>, <span class=\"literal\">null</span>, <span class=\"keyword\">this</span>.lang.lang.uploadingFileReuploadTips + filtedFiles.join(<span class=\"string\">', '</span>));</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>registry<br>\n根据上一步拿到的文件地址数组创建多个Mobx observable对象跟踪每个上传对象的基本识别信息，包括文件名、文件大小、类型、分片信息(分片大小和总分片数)、上传状态信息：uninitial(未初始化)/pending(准备)/uploading(上传中)/pause(暂停)/error(错误)/break(上传完成)、上传开始时间、上传完成时间，为了便于访问这些Mobx observable对象，建立一个weakMap存储file对象和observable对象的弱映射关系。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [registry 注册上传文件信息]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; uploadId [文件上传进程id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; state [文件初始化状态]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action registry = <span class=\"function\">(<span class=\"params\">files, region, prefix</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> fileObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loading = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.files.includes(file)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.files.push(file);</span><br><span class=\"line\">      fileObj = &#123;</span><br><span class=\"line\">        name: file.webkitRelativePath || file.name,</span><br><span class=\"line\">        prefix: prefix || <span class=\"string\">''</span>,</span><br><span class=\"line\">        size: file.size,</span><br><span class=\"line\">        type: file.type || mapMimeType((file.webkitRelativePath || file.name).split(<span class=\"string\">'.'</span>).pop()).type,</span><br><span class=\"line\">        state: <span class=\"string\">'uninitial'</span>,</span><br><span class=\"line\">        creationTime: <span class=\"string\">''</span>,</span><br><span class=\"line\">        completionTime: <span class=\"string\">''</span>,</span><br><span class=\"line\">        index: <span class=\"number\">0</span>,</span><br><span class=\"line\">        file,</span><br><span class=\"line\">        initialized: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        partEtags: [],</span><br><span class=\"line\">        region,</span><br><span class=\"line\">        blockSize: <span class=\"keyword\">this</span>.blockSize,</span><br><span class=\"line\">        total: <span class=\"built_in\">Math</span>.ceil(file.size / <span class=\"keyword\">this</span>.blockSize),</span><br><span class=\"line\">        activePoint: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">        speed: <span class=\"string\">'0 MB/S'</span>,</span><br><span class=\"line\">        id: <span class=\"built_in\">encodeURIComponent</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + file.name + file.type + file.size),</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.uninitial.push(file);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.series.push(file);</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = observable(fileObj);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.fileStorage.get(region)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.fileStorage.set(region, [obj]);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.fileStorage.get(region).push(obj);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fileStorageMap.set(file, obj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loading = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>startTasks<br>\n获取文件队列中可用于上传的文件对象，根据文件状态对其做初始化或切割文件上传的操作，同时实时修改对应的Mobx observable上传对象的元数据标识，包括当前上传文件的分片索引(单个文件上传进度=分片索引/总分片数目)、已上传完成的分片etag信息(由服务器返回，可用于完成分片上传时校验已上传的所有分片数据是否匹配)、当前上传对象4的上传状态(uninitial/pending/uploading/pause/eror/break)、当前上传对象的上传速度(速度=单个分片大小/单个分片上传所用时间)。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [startTasks 开启上传任务队列]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125; region [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  startTasks = <span class=\"function\">(<span class=\"params\">region</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据空闲任务类型和空闲任务并发限制开启空闲任务</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.refreshTasks(region);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isUploadListEmpty(region)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> maxLength = <span class=\"keyword\">this</span>.multiTaskCount - <span class=\"keyword\">this</span>.taskType.uploading.length;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> taskSeries = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; (maxLength) &amp;&amp; <span class=\"keyword\">this</span>.taskType.series[i]; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// const file = this.taskType.series.shift();</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> file = <span class=\"keyword\">this</span>.taskType.series[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'uploading'</span>) <span class=\"keyword\">continue</span>; <span class=\"comment\">// 上传中</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'pause'</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      taskSeries.push(storageObject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> index;</span><br><span class=\"line\">    taskSeries.forEach(<span class=\"function\">(<span class=\"params\">storageObject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      index = <span class=\"keyword\">this</span>.taskType.series.indexOf(storageObject.file);</span><br><span class=\"line\">      index !== <span class=\"number\">-1</span> &amp;&amp; <span class=\"keyword\">this</span>.taskType.series.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.taskType.uninitial.includes(storageObject.file)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initRequest(</span><br><span class=\"line\">          storageObject.file,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            bucket: region,</span><br><span class=\"line\">            object: storageObject.name,</span><br><span class=\"line\">            prefix: storageObject.prefix,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ).then(<span class=\"function\">(<span class=\"params\">&#123; err, init &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (!err &amp;&amp; init) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.upload(storageObject.file, &#123;</span><br><span class=\"line\">              bucket: region,</span><br><span class=\"line\">              object: storageObject.name,</span><br><span class=\"line\">              prefix: storageObject.prefix,</span><br><span class=\"line\">              uploadId: storageObject.uploadId,</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.upload(storageObject.file, &#123;</span><br><span class=\"line\">          bucket: region,</span><br><span class=\"line\">          object: storageObject.name,</span><br><span class=\"line\">          prefix: storageObject.prefix,</span><br><span class=\"line\">          uploadId: storageObject.uploadId,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>refreshTasks<br>\n根据当前设置的并行上传任务数目和正在上传的任务数目及时从文件预备上传队列提取文件放入上传可调用文件队列。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 刷线任务列表 */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  refreshTasks = <span class=\"function\">(<span class=\"params\">region</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 统计空闲任务</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorage.get(region);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!storageObject) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; storageObject.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        storageObject[i].index !== storageObject[i].total</span><br><span class=\"line\">        &amp;&amp; (storageObject[i].state === <span class=\"string\">'pending'</span></span><br><span class=\"line\">        || storageObject[i].state === <span class=\"string\">'uninitial'</span>)</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; file &#125; = storageObject[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.taskType.series.includes(file)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.taskType.series.push(file);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>upload &amp; update<br>\n根据当前文件对象的上传分片索引对文件进行切割并更新索引，然后把切割下来的数据通过Ajax请求发送给中间件处理，中间件发送到后台后返回得到的当前分片的etag信息，前端拿到etag信息并存储到当前上传对象分片etag信息数组里面。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [upload 分割文件发起上传请求]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; file    [description]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; _params [...]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.bucket [bucket name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.object [object name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.uploadId [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  upload = <span class=\"function\">(<span class=\"params\">file, _params</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> single = <span class=\"literal\">false</span>; <span class=\"comment\">// 不分片</span></span><br><span class=\"line\">    <span class=\"comment\">/* 异常状态退出 */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.isValidUploadingTask(storageObject)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.pending.splice(<span class=\"keyword\">this</span>.taskType.pending.indexOf(file), <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.uploading.push(file);</span><br><span class=\"line\">      storageObject.state = <span class=\"string\">'uploading'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> num = storageObject.index;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (num === <span class=\"number\">0</span> &amp;&amp; file.size &lt;= storageObject.blockSize) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 不用分片的情况</span></span><br><span class=\"line\">      single = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num === storageObject.total) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 所有分片都已经发出</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextSize = <span class=\"built_in\">Math</span>.min((num + <span class=\"number\">1</span>) * storageObject.blockSize, file.size);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fileData = file.slice(num * storageObject.blockSize, nextSize);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> params = <span class=\"built_in\">Object</span>.assign(_params, &#123;</span><br><span class=\"line\">      partNumber: num + <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    storageObject.activePoint = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.uploadRequest(&#123; params, <span class=\"attr\">data</span>: fileData, single &#125;).then(<span class=\"function\">(<span class=\"params\">rsp</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (rsp.code !== <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        openNotification(<span class=\"string\">'error'</span>, <span class=\"literal\">null</span>, (rsp.result.data ? rsp.result.data.Code : <span class=\"keyword\">this</span>.lang.lang.uploadError));</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> &#123; completed, etags &#125; = <span class=\"keyword\">this</span>.update(&#123;</span><br><span class=\"line\">        region: params.bucket,</span><br><span class=\"line\">        etag: rsp.result.etag,</span><br><span class=\"line\">        size: fileData.size,</span><br><span class=\"line\">        id: storageObject.id,</span><br><span class=\"line\">        index: params.partNumber,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (completed) &#123;</span><br><span class=\"line\">        (single ?</span><br><span class=\"line\">          () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.complete(file, params.bucket);</span><br><span class=\"line\">          &#125; :</span><br><span class=\"line\">          (partEtags) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.completeRequest(&#123;</span><br><span class=\"line\">              bucket: params.bucket,</span><br><span class=\"line\">              uploadId: params.uploadId,</span><br><span class=\"line\">              object: params.object,</span><br><span class=\"line\">              prefix: params.prefix,</span><br><span class=\"line\">              partEtags,</span><br><span class=\"line\">            &#125;, file);</span><br><span class=\"line\">          &#125;)(etags);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.upload(file, &#123;</span><br><span class=\"line\">          bucket: params.bucket,</span><br><span class=\"line\">          object: params.object,</span><br><span class=\"line\">          uploadId: params.uploadId,</span><br><span class=\"line\">          partNumber: params.partNumber,</span><br><span class=\"line\">          prefix: params.prefix,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">$&#123;params.bucket&#125;</span>_<span class=\"subst\">$&#123;params.object&#125;</span> upload error: <span class=\"subst\">$&#123;error&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    storageObject.index += <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>complete<br>\n当最后一个分片上传请求完成返回后，我们就拿到了服务端返回的这个文件的所有分片etag信息，前端需要校验当前上传对象etag数组的长度是否匹配，数组内每个etag元素的索引和etag值是否匹配，校验完成后发送最后一个请求到后端进行校验和组装分片，最终完成一个文件的分片上传过程。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [completeRequest 完成所有分片数据上传]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; _params [...]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.bucket [bucket name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.object [object name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.uploadId [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.partEtags [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action completeRequest = <span class=\"function\">(<span class=\"params\">params, file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    postDataPro(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        ...&#123;</span><br><span class=\"line\">          ...params,</span><br><span class=\"line\">          ...&#123;</span><br><span class=\"line\">            object: params.prefix + params.object,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        partEtags: &#123;</span><br><span class=\"line\">          CompleteMultipartUpload: &#123;</span><br><span class=\"line\">            Part: params.partEtags.map(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> (&#123;</span><br><span class=\"line\">              PartNumber: info.number,</span><br><span class=\"line\">              ETag: info.etag,</span><br><span class=\"line\">            &#125;)),</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      objectResourceApi.object.completeFragmentUpload</span><br><span class=\"line\">    ).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.complete(file, params.bucket);</span><br><span class=\"line\">    &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [complete 完成上传]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; bucket [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  complete = <span class=\"function\">(<span class=\"params\">file, bucket</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"keyword\">this</span>.taskType.uploading.indexOf(file);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.taskType.uploading.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.taskType.break.push(file);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">    storageObject.completionTime = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().toTimeString()).split(<span class=\"string\">' '</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">    storageObject.state = <span class=\"string\">'break'</span>;</span><br><span class=\"line\">    storageObject.index = storageObject.total;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startTasks(bucket);</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"其它操作\">其它操作</h4>\n<ol>\n<li>\n<p>暂停文件上传<br>\n将上传对象的状态从uploading置为pause，然后把该对象对应的文件从可调用上传文件队列移除。</p>\n</li>\n<li>\n<p>开始暂停的上传任务<br>\n将上传对象的状态从pause置为pending，然后把该对象对应的文件放入可调用上传文件队列，等待下一次刷新文件上传任务队列。</p>\n</li>\n<li>\n<p>续传上传错误的任务<br>\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，保持文件的已上传分片索引记录，等待下一次刷新文件上传任务队列，直接调用上传函数进行切割并上传。</p>\n</li>\n<li>\n<p>重传上传错误的任务<br>\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，并将文件已上传分片索引记录置为初始状态，等待下一次刷新文件上传任务队列，从文件初始位置重新开始切割文件并上传。</p>\n</li>\n</ol>\n<h4 id=\"一些关键代码\">一些关键代码</h4>\n<ol>\n<li>一个分片上传完成后将后台返回的etag信息更新到本地的上传对象属性，并判断此文件是否上传完成。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [update 更新本地上传记录]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; region [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; etag [分片标志]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  update = (&#123;</span><br><span class=\"line\">    region, etag, size, id, index,</span><br><span class=\"line\">  &#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = <span class=\"keyword\">this</span>.fileStorage.get(region);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; target.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (target[i].id === id) &#123;</span><br><span class=\"line\">        target[i].speed = <span class=\"string\">`<span class=\"subst\">$&#123;(size <span class=\"regexp\">/ 1024 /</span> <span class=\"number\">1024</span> <span class=\"regexp\">/ (((new Date() - target[i].activePoint) /</span> <span class=\"number\">1000</span>))).toFixed(<span class=\"number\">2</span>)&#125;</span> MB/S`</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target[i].speed === <span class=\"string\">'0.00 MB/S'</span>) &#123;</span><br><span class=\"line\">          target[i].speed = <span class=\"string\">`<span class=\"subst\">$&#123;formatSizeStr(size)&#125;</span>/S`</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        target[i].partEtags = target[i].partEtags.filter(<span class=\"function\"><span class=\"params\">etagItem</span> =&gt;</span> etagItem.number !== index);</span><br><span class=\"line\">        target[i].partEtags.push(&#123;</span><br><span class=\"line\">          number: index,</span><br><span class=\"line\">          etag,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// 最后一个分片恰好又暂停的情况</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index === target[i].total) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (target[i].state === <span class=\"string\">'pause'</span>) &#123;</span><br><span class=\"line\">            index -= <span class=\"number\">1</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断上传是否完成</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target[i].total === <span class=\"number\">0</span> || target[i].partEtags.toJS().length === target[i].total) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            completed: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            etags: target[i].partEtags,</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          completed: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3>Contents</h3>\n<ol>\n<li>\n<p>概述</p>\n</li>\n<li>\n<p>浏览器文件操作限制</p>\n</li>\n<li>\n<p>前端多文件分片上传的原理和实现</p>\n</li>\n</ol>\n<h3>预览</h3>\n<p><img src=\"/blogs/img/article/upload.png\" alt=\"upload\"></p>\n<h3>概述</h3>\n<p>Amazon S3 提供了一个简单 Web 服务接口，可用于随时在 Web 上的任何位置存储和检索任何数量的数据。此服务让所有开发人员都能访问同一个具备高扩展性、可靠性、安全性和快速价廉的数据存储基础设施， Amazon 用它来运行其全球的网站网络。此服务旨在为开发人员带来最大化的规模效益。<br>\n本文主要针对兼容aws-s3接口的第三方存储服务，在不使用官方sdk的情况下直接使用Restful接口进行存储桶多文件分片上传，主要包含浏览器端的多文件分片上传逻辑的Javascript代码实现。</p>\n<h3>浏览器文件操作限制</h3>\n<ul>\n<li>HTML5新特性<code>input[type=file]</code>支持调用浏览器文件访问窗口来获取文件数据，实际上JS代码使用此特性访问本地文件系统后拿到的是一个指向文件的引用地址，且如果页面刷新了那么这个地址不可复用，JS代码并没有实际操作文件本身。前端上传数据时根据这个指向文件的地址把文件的一小块分片数据载入到内存并通过Ajax请求发送到中间件进行处理。</li>\n<li>浏览器JS代码没有文件系统操作权限，不能任意存储和读取文件，因此不支持刷新浏览器后上传进度断点恢复，刷新之后断点恢复的前提是能拿到文件数据，但是JS代码没权限访问之前拿到的文件引用地址，并且存储之前上传过的文件分片数据这一做法也不合理。</li>\n<li>相对于文件上传，文件下载则完全不可控，由于文件操作权限，所以整个下载文件操作都是由浏览器自带的的下载任务管理器控制的，没有浏览器接口能拿到这些下载任务进度，所以下载任务进度也是不能获取的。</li>\n</ul>\n<h3>前端多文件分片上传的原理和实现</h3>\n<p><em>完整Github<a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/file-slice-upload\" target=\"_blank\" rel=\"noopener\">源码</a></em></p>\n<blockquote>\n<p>使用了React16/Webpack4/Mobx状态管理库</p>\n</blockquote>\n<ul>\n<li>支持批量文件分割并行上传</li>\n<li>多文件操作：暂停/恢复/终止/续传/重传</li>\n<li>自定义上传任务数目、单个分片大小</li>\n</ul>\n<h4>运行流程图</h4>\n<p><img src=\"/blogs/img/article/shards_upload.jpg\" alt=\"upload\"></p>\n<h4>主要流程</h4>\n<ol>\n<li>cacheFile<br>\n前端通过input组件拿到所有文件地址并缓存起来。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * [cacheFile 缓存即将注册的文件]</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"> @action</span><br><span class=\"line\"> cacheFile = <span class=\"function\">(<span class=\"params\">files, bucket</span>) =&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> symbolArr = <span class=\"keyword\">this</span>.filesCache.map(<span class=\"function\"><span class=\"params\">file</span> =&gt;</span> <span class=\"keyword\">this</span>.getSymbol(file));</span><br><span class=\"line\">   <span class=\"keyword\">const</span> filtedFiles = [];</span><br><span class=\"line\">   <span class=\"keyword\">let</span> uploadingFileFound = <span class=\"literal\">false</span>;</span><br><span class=\"line\">   files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!symbolArr.includes(<span class=\"keyword\">this</span>.getSymbol(file))) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.findIsUploading(<span class=\"keyword\">this</span>.getSymbol(file), bucket)) &#123;</span><br><span class=\"line\">         uploadingFileFound = <span class=\"literal\">true</span>;</span><br><span class=\"line\">         filtedFiles.push(file.name);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         <span class=\"keyword\">this</span>.filesCache.push(file);</span><br><span class=\"line\">         symbolArr.push(<span class=\"keyword\">this</span>.getSymbol(file));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (!files.length) openNotification(<span class=\"string\">'warning'</span>, <span class=\"literal\">null</span>, <span class=\"keyword\">this</span>.lang.lang.noFilCanBeUploaded);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (uploadingFileFound) openNotification(<span class=\"string\">'warning'</span>, <span class=\"literal\">null</span>, <span class=\"keyword\">this</span>.lang.lang.uploadingFileReuploadTips + filtedFiles.join(<span class=\"string\">', '</span>));</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>registry<br>\n根据上一步拿到的文件地址数组创建多个Mobx observable对象跟踪每个上传对象的基本识别信息，包括文件名、文件大小、类型、分片信息(分片大小和总分片数)、上传状态信息：uninitial(未初始化)/pending(准备)/uploading(上传中)/pause(暂停)/error(错误)/break(上传完成)、上传开始时间、上传完成时间，为了便于访问这些Mobx observable对象，建立一个weakMap存储file对象和observable对象的弱映射关系。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [registry 注册上传文件信息]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; uploadId [文件上传进程id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; state [文件初始化状态]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action registry = <span class=\"function\">(<span class=\"params\">files, region, prefix</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> fileObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loading = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    files.forEach(<span class=\"function\">(<span class=\"params\">file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.files.includes(file)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.files.push(file);</span><br><span class=\"line\">      fileObj = &#123;</span><br><span class=\"line\">        name: file.webkitRelativePath || file.name,</span><br><span class=\"line\">        prefix: prefix || <span class=\"string\">''</span>,</span><br><span class=\"line\">        size: file.size,</span><br><span class=\"line\">        type: file.type || mapMimeType((file.webkitRelativePath || file.name).split(<span class=\"string\">'.'</span>).pop()).type,</span><br><span class=\"line\">        state: <span class=\"string\">'uninitial'</span>,</span><br><span class=\"line\">        creationTime: <span class=\"string\">''</span>,</span><br><span class=\"line\">        completionTime: <span class=\"string\">''</span>,</span><br><span class=\"line\">        index: <span class=\"number\">0</span>,</span><br><span class=\"line\">        file,</span><br><span class=\"line\">        initialized: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        partEtags: [],</span><br><span class=\"line\">        region,</span><br><span class=\"line\">        blockSize: <span class=\"keyword\">this</span>.blockSize,</span><br><span class=\"line\">        total: <span class=\"built_in\">Math</span>.ceil(file.size / <span class=\"keyword\">this</span>.blockSize),</span><br><span class=\"line\">        activePoint: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">        speed: <span class=\"string\">'0 MB/S'</span>,</span><br><span class=\"line\">        id: <span class=\"built_in\">encodeURIComponent</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + file.name + file.type + file.size),</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.uninitial.push(file);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.series.push(file);</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = observable(fileObj);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.fileStorage.get(region)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.fileStorage.set(region, [obj]);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.fileStorage.get(region).push(obj);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fileStorageMap.set(file, obj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loading = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>startTasks<br>\n获取文件队列中可用于上传的文件对象，根据文件状态对其做初始化或切割文件上传的操作，同时实时修改对应的Mobx observable上传对象的元数据标识，包括当前上传文件的分片索引(单个文件上传进度=分片索引/总分片数目)、已上传完成的分片etag信息(由服务器返回，可用于完成分片上传时校验已上传的所有分片数据是否匹配)、当前上传对象4的上传状态(uninitial/pending/uploading/pause/eror/break)、当前上传对象的上传速度(速度=单个分片大小/单个分片上传所用时间)。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [startTasks 开启上传任务队列]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125; region [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  startTasks = <span class=\"function\">(<span class=\"params\">region</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据空闲任务类型和空闲任务并发限制开启空闲任务</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.refreshTasks(region);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isUploadListEmpty(region)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> maxLength = <span class=\"keyword\">this</span>.multiTaskCount - <span class=\"keyword\">this</span>.taskType.uploading.length;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> taskSeries = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; (maxLength) &amp;&amp; <span class=\"keyword\">this</span>.taskType.series[i]; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// const file = this.taskType.series.shift();</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> file = <span class=\"keyword\">this</span>.taskType.series[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'uploading'</span>) <span class=\"keyword\">continue</span>; <span class=\"comment\">// 上传中</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'pause'</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      taskSeries.push(storageObject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> index;</span><br><span class=\"line\">    taskSeries.forEach(<span class=\"function\">(<span class=\"params\">storageObject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      index = <span class=\"keyword\">this</span>.taskType.series.indexOf(storageObject.file);</span><br><span class=\"line\">      index !== <span class=\"number\">-1</span> &amp;&amp; <span class=\"keyword\">this</span>.taskType.series.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.taskType.uninitial.includes(storageObject.file)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initRequest(</span><br><span class=\"line\">          storageObject.file,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            bucket: region,</span><br><span class=\"line\">            object: storageObject.name,</span><br><span class=\"line\">            prefix: storageObject.prefix,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ).then(<span class=\"function\">(<span class=\"params\">&#123; err, init &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (!err &amp;&amp; init) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.upload(storageObject.file, &#123;</span><br><span class=\"line\">              bucket: region,</span><br><span class=\"line\">              object: storageObject.name,</span><br><span class=\"line\">              prefix: storageObject.prefix,</span><br><span class=\"line\">              uploadId: storageObject.uploadId,</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.upload(storageObject.file, &#123;</span><br><span class=\"line\">          bucket: region,</span><br><span class=\"line\">          object: storageObject.name,</span><br><span class=\"line\">          prefix: storageObject.prefix,</span><br><span class=\"line\">          uploadId: storageObject.uploadId,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>refreshTasks<br>\n根据当前设置的并行上传任务数目和正在上传的任务数目及时从文件预备上传队列提取文件放入上传可调用文件队列。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 刷线任务列表 */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  refreshTasks = <span class=\"function\">(<span class=\"params\">region</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 统计空闲任务</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorage.get(region);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!storageObject) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; storageObject.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        storageObject[i].index !== storageObject[i].total</span><br><span class=\"line\">        &amp;&amp; (storageObject[i].state === <span class=\"string\">'pending'</span></span><br><span class=\"line\">        || storageObject[i].state === <span class=\"string\">'uninitial'</span>)</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; file &#125; = storageObject[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.taskType.series.includes(file)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.taskType.series.push(file);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>upload &amp; update<br>\n根据当前文件对象的上传分片索引对文件进行切割并更新索引，然后把切割下来的数据通过Ajax请求发送给中间件处理，中间件发送到后台后返回得到的当前分片的etag信息，前端拿到etag信息并存储到当前上传对象分片etag信息数组里面。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [upload 分割文件发起上传请求]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; file    [description]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; _params [...]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.bucket [bucket name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.object [object name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.uploadId [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  upload = <span class=\"function\">(<span class=\"params\">file, _params</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> single = <span class=\"literal\">false</span>; <span class=\"comment\">// 不分片</span></span><br><span class=\"line\">    <span class=\"comment\">/* 异常状态退出 */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.isValidUploadingTask(storageObject)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (storageObject.state === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.pending.splice(<span class=\"keyword\">this</span>.taskType.pending.indexOf(file), <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.taskType.uploading.push(file);</span><br><span class=\"line\">      storageObject.state = <span class=\"string\">'uploading'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> num = storageObject.index;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (num === <span class=\"number\">0</span> &amp;&amp; file.size &lt;= storageObject.blockSize) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 不用分片的情况</span></span><br><span class=\"line\">      single = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num === storageObject.total) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 所有分片都已经发出</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextSize = <span class=\"built_in\">Math</span>.min((num + <span class=\"number\">1</span>) * storageObject.blockSize, file.size);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fileData = file.slice(num * storageObject.blockSize, nextSize);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> params = <span class=\"built_in\">Object</span>.assign(_params, &#123;</span><br><span class=\"line\">      partNumber: num + <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    storageObject.activePoint = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.uploadRequest(&#123; params, <span class=\"attr\">data</span>: fileData, single &#125;).then(<span class=\"function\">(<span class=\"params\">rsp</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (rsp.code !== <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        openNotification(<span class=\"string\">'error'</span>, <span class=\"literal\">null</span>, (rsp.result.data ? rsp.result.data.Code : <span class=\"keyword\">this</span>.lang.lang.uploadError));</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> &#123; completed, etags &#125; = <span class=\"keyword\">this</span>.update(&#123;</span><br><span class=\"line\">        region: params.bucket,</span><br><span class=\"line\">        etag: rsp.result.etag,</span><br><span class=\"line\">        size: fileData.size,</span><br><span class=\"line\">        id: storageObject.id,</span><br><span class=\"line\">        index: params.partNumber,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (completed) &#123;</span><br><span class=\"line\">        (single ?</span><br><span class=\"line\">          () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.complete(file, params.bucket);</span><br><span class=\"line\">          &#125; :</span><br><span class=\"line\">          (partEtags) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.completeRequest(&#123;</span><br><span class=\"line\">              bucket: params.bucket,</span><br><span class=\"line\">              uploadId: params.uploadId,</span><br><span class=\"line\">              object: params.object,</span><br><span class=\"line\">              prefix: params.prefix,</span><br><span class=\"line\">              partEtags,</span><br><span class=\"line\">            &#125;, file);</span><br><span class=\"line\">          &#125;)(etags);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.upload(file, &#123;</span><br><span class=\"line\">          bucket: params.bucket,</span><br><span class=\"line\">          object: params.object,</span><br><span class=\"line\">          uploadId: params.uploadId,</span><br><span class=\"line\">          partNumber: params.partNumber,</span><br><span class=\"line\">          prefix: params.prefix,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">$&#123;params.bucket&#125;</span>_<span class=\"subst\">$&#123;params.object&#125;</span> upload error: <span class=\"subst\">$&#123;error&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    storageObject.index += <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>complete<br>\n当最后一个分片上传请求完成返回后，我们就拿到了服务端返回的这个文件的所有分片etag信息，前端需要校验当前上传对象etag数组的长度是否匹配，数组内每个etag元素的索引和etag值是否匹配，校验完成后发送最后一个请求到后端进行校验和组装分片，最终完成一个文件的分片上传过程。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [completeRequest 完成所有分片数据上传]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; _params [...]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.bucket [bucket name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.object [object name]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.uploadId [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[String]&#125;   _params.partEtags [upload id]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param  &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action completeRequest = <span class=\"function\">(<span class=\"params\">params, file</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    postDataPro(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        ...&#123;</span><br><span class=\"line\">          ...params,</span><br><span class=\"line\">          ...&#123;</span><br><span class=\"line\">            object: params.prefix + params.object,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        partEtags: &#123;</span><br><span class=\"line\">          CompleteMultipartUpload: &#123;</span><br><span class=\"line\">            Part: params.partEtags.map(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> (&#123;</span><br><span class=\"line\">              PartNumber: info.number,</span><br><span class=\"line\">              ETag: info.etag,</span><br><span class=\"line\">            &#125;)),</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      objectResourceApi.object.completeFragmentUpload</span><br><span class=\"line\">    ).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.complete(file, params.bucket);</span><br><span class=\"line\">    &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.startTasks(params.bucket);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.markError(file);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [complete 完成上传]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[Object]&#125; file [文件对象]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; bucket [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  complete = <span class=\"function\">(<span class=\"params\">file, bucket</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"keyword\">this</span>.taskType.uploading.indexOf(file);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.taskType.uploading.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.taskType.break.push(file);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storageObject = <span class=\"keyword\">this</span>.fileStorageMap.get(file);</span><br><span class=\"line\">    storageObject.completionTime = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().toTimeString()).split(<span class=\"string\">' '</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">    storageObject.state = <span class=\"string\">'break'</span>;</span><br><span class=\"line\">    storageObject.index = storageObject.total;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startTasks(bucket);</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<h4>其它操作</h4>\n<ol>\n<li>\n<p>暂停文件上传<br>\n将上传对象的状态从uploading置为pause，然后把该对象对应的文件从可调用上传文件队列移除。</p>\n</li>\n<li>\n<p>开始暂停的上传任务<br>\n将上传对象的状态从pause置为pending，然后把该对象对应的文件放入可调用上传文件队列，等待下一次刷新文件上传任务队列。</p>\n</li>\n<li>\n<p>续传上传错误的任务<br>\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，保持文件的已上传分片索引记录，等待下一次刷新文件上传任务队列，直接调用上传函数进行切割并上传。</p>\n</li>\n<li>\n<p>重传上传错误的任务<br>\n将上传对象的状态从error置为pending，然后把该对象对应的文件放入可调用上传文件队列，并将文件已上传分片索引记录置为初始状态，等待下一次刷新文件上传任务队列，从文件初始位置重新开始切割文件并上传。</p>\n</li>\n</ol>\n<h4>一些关键代码</h4>\n<ol>\n<li>一个分片上传完成后将后台返回的etag信息更新到本地的上传对象属性，并判断此文件是否上传完成。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * [update 更新本地上传记录]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; region [桶名]</span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;[String]&#125; etag [分片标志]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  @action</span><br><span class=\"line\">  update = (&#123;</span><br><span class=\"line\">    region, etag, size, id, index,</span><br><span class=\"line\">  &#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = <span class=\"keyword\">this</span>.fileStorage.get(region);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; target.length; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (target[i].id === id) &#123;</span><br><span class=\"line\">        target[i].speed = <span class=\"string\">`<span class=\"subst\">$&#123;(size <span class=\"regexp\">/ 1024 /</span> <span class=\"number\">1024</span> <span class=\"regexp\">/ (((new Date() - target[i].activePoint) /</span> <span class=\"number\">1000</span>))).toFixed(<span class=\"number\">2</span>)&#125;</span> MB/S`</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target[i].speed === <span class=\"string\">'0.00 MB/S'</span>) &#123;</span><br><span class=\"line\">          target[i].speed = <span class=\"string\">`<span class=\"subst\">$&#123;formatSizeStr(size)&#125;</span>/S`</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        target[i].partEtags = target[i].partEtags.filter(<span class=\"function\"><span class=\"params\">etagItem</span> =&gt;</span> etagItem.number !== index);</span><br><span class=\"line\">        target[i].partEtags.push(&#123;</span><br><span class=\"line\">          number: index,</span><br><span class=\"line\">          etag,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// 最后一个分片恰好又暂停的情况</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index === target[i].total) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (target[i].state === <span class=\"string\">'pause'</span>) &#123;</span><br><span class=\"line\">            index -= <span class=\"number\">1</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断上传是否完成</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target[i].total === <span class=\"number\">0</span> || target[i].partEtags.toJS().length === target[i].total) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            completed: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            etags: target[i].partEtags,</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          completed: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>"},{"title":"简单实现一个Javascript动画处理类","catalog":true,"toc_nav_num":true,"date":"2018-11-04T17:10:00.000Z","subtitle":"animation javascript","header-img":"/blogs/img/article_header/article_header.png","catagories":["Javascript"],"updateDate":"2018-11-04T17:10:00.000Z","top":null,"_content":"\n#### 预览图\n----------------\n> Gif预览图录制时帧数较低，实际浏览器上运行时会更流畅 ~  \n\n[=> 源代码](https://github.com/NoJsJa/javascript-learning/tree/master/js-animation)\n\n![animation.gif](/blogs/img/article/animation.gif)\n\n#### 代码实现\n-------------------\n\n##### 缓动函数\n> 涉及一些数学原理，感兴趣的可以单独了解一下。\n```js\n/**\n * [tween 缓动算法]\n * @param {[Number]}  t [动画已经消耗的时间]\n * @param {[String]}  b [目标开始的位置]\n * @param {[String]}  c [目标开始位置和结束位置的距离]\n * @param {[Number]}  d [动画总持续时间]\n */\nvar tween = {\n  linear: function( time, start, distance, duration ) { return distance*time/duration + start; },\n  easeIn: function( time, start, distance, duration ) { return distance * ( time /= duration ) * time + start; },\n  strongEaseIn: function(time, start, distance, duration) { return distance * ( time /= duration ) * time * time * time * time + start; },\n  strongEaseOut: function(time, start, distance, duration) { return distance * ( ( time = time / duration - 1) * time * time * time * time + 1 ) + start; },\n  sinEaseIn: function( time, start, distance, duration ) { return distance * ( time /= duration) * time * time + start; },\n  sinEaseOut: function(time,start,distance,duration){ return distance * ( ( time = time / duration - 1) * time * time + 1 ) + start; },\n};\n```\n\n##### 帧请求函数兼容写法\n> requestAnimationFrame是浏览器用于定时循环操作的一个接口，类似于setTimeout，主要用途是按帧对网页进行重绘。设置这个API的目的是为了让各种网页动画效果（DOM动画、Canvas动画、SVG动画、WebGL动画）能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。代码中使用这个API，就是告诉浏览器希望执行一个动画，让浏览器在下一个动画帧安排一次网页重绘。\n```js\n// 动画帧请求函数兼容写法\nwindow.requestAnimationFrame = (function(){\n  return  window.requestAnimationFrame       ||\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame    ||\n          window.oRequestAnimationFrame      ||\n          window.msRequestAnimationFrame     ||\n          function( callback ){\n            return window.setTimeout(callback, 1000 / 60);\n          };\n})();\n```\n\n##### 编写Animation动画类\n> 使用了了ES5语法，为了直接兼容浏览器，ES6的语法会更简洁，代码零散度更低。  \n\n* 初始化执行动画的某个dom元素\n\n```js\n/* ------------------- 动画控制类 ------------------- */\nvar Animation = function () {\n  this.store = { // status store\n  };\n};\n\n/* ------------------- 初始化处理元素 ------------------- */\nAnimation.prototype.setTarget = function (selector) {\n  var element = document.querySelector(selector);\n  if (element) {\n    this.store[selector] = {\n      selector: selector,\n      element: document.querySelector(selector),\n      status: 'pending',\n      queue: [\n      ],\n      timeStart: '',\n      positionStart: {\n        x: '',\n        y: '',\n      },\n      positionEnd: {\n        x: '',\n        y: '',\n      },\n    };\n  }\n};\n```\n* 动画调用主要函数`update`的编写\n\n> 运用了设计模式中`享元模式`的思想来分离变化(`Animation.store属性`)和不变的部分。  \n\n```js\n/**\n * [start 开始动画]\n * @param  {[String]} selector [选择器]\n * @param  {[type]} func     [缓动动画]\n */\nAnimation.prototype.start = function (selector, func) {\n  var that = this;\n  var target = this.store[selector];\n  target.status = 'running';\n\n  // 帧调用函数\n  that.update({x: 0, y: 0}, selector);\n};\n\n/**\n * [update 更新位置]\n * @param  {[type]} selector [description]\n */\nAnimation.prototype.update =  function (position, selector) {\n  var target = this.store[selector],\n    that = this,\n    timeUsed,\n    positionX, positionY;\n  //\n  if (!target || !target.queue.length) {\n    target.status = 'pending';\n    return;\n  };\n\n  // reset position\n  target.element.style.left = position.x + 'px';\n  target.element.style.top = position.y + 'px';\n\n  // position\n  target.positionStart = {\n    x: position.x,\n    y: position.y,\n  };\n  target.positionEnd = {\n    x: position.x + target.queue[0].x,\n    y: position.y + target.queue[0].y,\n  };\n  // time\n  target.timeStart = new Date().getTime();\n\n  // 递归调用\n  var callback = function () {\n    timeUsed = new Date().getTime() - target.timeStart;\n    // 当前动画完成\n    if (timeUsed >= target.queue[0].duration) {\n      target.queue.shift();\n      // 误差矫正\n      that.step(target.element, target.positionEnd.x, target.positionEnd.y);\n      target.status = 'running';\n      // var position = target.element.getBoundingClientRect();\n      var position = {\n        x: parseInt(target.element.style.left),\n        y: parseInt(target.element.style.top),\n      };\n      // 下一个动画\n      that.update(position, selector);\n      return;\n    }\n    // 计算元素坐标\n    positionX = target.queue[0].func(\n      timeUsed,\n      target.positionStart.x,\n      target.positionEnd.x - target.positionStart.x,\n      target.queue[0].duration,\n    );\n    positionY = target.queue[0].func(\n      timeUsed,\n      target.positionStart.y,\n      target.positionEnd.y - target.positionStart.y,\n      target.queue[0].duration,\n    );\n    that.step(target.element, positionX, positionY);\n\n    // 递归帧函数调用\n    requestAnimationFrame(callback);\n  };\n\n  requestAnimationFrame(callback);\n};\n```\n\n* 其它一些方法(部分暂未实现)\n\n```js\n/**\n * [step dom操作]\n * @param  {[DOM]} element [dom 元素]\n * @param  {[Number]} x        [x坐标]\n * @param  {[Number]} y        [y坐标]\n */\nAnimation.prototype.step = function (element, x, y) {\n  element.style.left = x + 'px';\n  element.style.top = y + 'px';\n};\n\n/* ------------------- 暂停动画 ------------------- */\nAnimation.prototype.pause = function (selector) {\n  // 尚待实现\n};\n\n/* ------------------- 结束动画 ------------------- */\nAnimation.prototype.stop = function (selector) {\n    // 尚待实现\n};\n\n/**\n * [push 加入动画队列]\n * @param  {[String]} selector [dom选择器]\n * @param  {[Object]} conf     [相对位置数据]\n */\nAnimation.prototype.push = function (selector, conf) {\n  if (this.store[selector]) {\n    this.store[selector].queue.push({\n      x: conf.x,\n      y: conf.y,\n      duration: conf.duration || 1000,\n      func: tween[conf.func] || tween['linear'],\n    });\n  }\n};\n\n/* ------------------- 动画出队列 ------------------- */\nAnimation.prototype.pop = function (selector) {\n  if (this.store[selector]) {\n    this.store[selector].queue.pop();\n  }\n};\n\n/* ------------------- 清空动画队列 ------------------- */\nAnimation.prototype.clear = function (selector) {\n  if (this.store[selector]) {\n    this.store[selector].queue.length = 1;\n  }\n};\n```\n##### Animation调用方式\n1. 初始化元素\n2. 插入多个动画数据(坐标相对值、动画执行时间、缓动方式)\n3. 开始执行动画\n\n```js\nvar anime = new Animation();\nanime.setTarget('#animationTarget');\n// 右下角移动50px\nanime.push('#animationTarget', { x: 50, y: 50, duration: 1000, func: 'easeIn' });\n// 右上角移动50px\nanime.push('#animationTarget', { x: -50, y: -50, duration: 500, func: 'linear' });\n// 横向移动50px\nanime.push('#animationTarget', { x: 50, y: 0, duration: 1000, func: 'easeIn' });\n// 纵向移动50px\nanime.push('#animationTarget', { x: 0, y: 50, duration: 500, func: 'linear' });\n// 开始执行动画\nanime.start('#animationTarget');\n```\n\n#### 总结\n-------------\nJavaScript动画的性能比CSS动画低很多，平时实际做页面时应该尽量使用CSS3和Canvas来实现动画效果，但是一名合格的JSER，也应该对Js的动画实现原理熟知，知道怎样优化动画性能，以及运用适合的设计模式优化代码结构。\n\n##### 感谢阅读\n","source":"_posts/简单实现一个Javascript动画处理类.md","raw":"---\ntitle: \"简单实现一个Javascript动画处理类\"\ncatalog: true\ntoc_nav_num: true\ndate: 2018-11-05 01:10:00\nsubtitle: \"animation javascript\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Animation\ncatagories:\n- Javascript\nupdateDate: 2018-11-05 01:10:00\ntop: \n---\n\n#### 预览图\n----------------\n> Gif预览图录制时帧数较低，实际浏览器上运行时会更流畅 ~  \n\n[=> 源代码](https://github.com/NoJsJa/javascript-learning/tree/master/js-animation)\n\n![animation.gif](/blogs/img/article/animation.gif)\n\n#### 代码实现\n-------------------\n\n##### 缓动函数\n> 涉及一些数学原理，感兴趣的可以单独了解一下。\n```js\n/**\n * [tween 缓动算法]\n * @param {[Number]}  t [动画已经消耗的时间]\n * @param {[String]}  b [目标开始的位置]\n * @param {[String]}  c [目标开始位置和结束位置的距离]\n * @param {[Number]}  d [动画总持续时间]\n */\nvar tween = {\n  linear: function( time, start, distance, duration ) { return distance*time/duration + start; },\n  easeIn: function( time, start, distance, duration ) { return distance * ( time /= duration ) * time + start; },\n  strongEaseIn: function(time, start, distance, duration) { return distance * ( time /= duration ) * time * time * time * time + start; },\n  strongEaseOut: function(time, start, distance, duration) { return distance * ( ( time = time / duration - 1) * time * time * time * time + 1 ) + start; },\n  sinEaseIn: function( time, start, distance, duration ) { return distance * ( time /= duration) * time * time + start; },\n  sinEaseOut: function(time,start,distance,duration){ return distance * ( ( time = time / duration - 1) * time * time + 1 ) + start; },\n};\n```\n\n##### 帧请求函数兼容写法\n> requestAnimationFrame是浏览器用于定时循环操作的一个接口，类似于setTimeout，主要用途是按帧对网页进行重绘。设置这个API的目的是为了让各种网页动画效果（DOM动画、Canvas动画、SVG动画、WebGL动画）能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。代码中使用这个API，就是告诉浏览器希望执行一个动画，让浏览器在下一个动画帧安排一次网页重绘。\n```js\n// 动画帧请求函数兼容写法\nwindow.requestAnimationFrame = (function(){\n  return  window.requestAnimationFrame       ||\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame    ||\n          window.oRequestAnimationFrame      ||\n          window.msRequestAnimationFrame     ||\n          function( callback ){\n            return window.setTimeout(callback, 1000 / 60);\n          };\n})();\n```\n\n##### 编写Animation动画类\n> 使用了了ES5语法，为了直接兼容浏览器，ES6的语法会更简洁，代码零散度更低。  \n\n* 初始化执行动画的某个dom元素\n\n```js\n/* ------------------- 动画控制类 ------------------- */\nvar Animation = function () {\n  this.store = { // status store\n  };\n};\n\n/* ------------------- 初始化处理元素 ------------------- */\nAnimation.prototype.setTarget = function (selector) {\n  var element = document.querySelector(selector);\n  if (element) {\n    this.store[selector] = {\n      selector: selector,\n      element: document.querySelector(selector),\n      status: 'pending',\n      queue: [\n      ],\n      timeStart: '',\n      positionStart: {\n        x: '',\n        y: '',\n      },\n      positionEnd: {\n        x: '',\n        y: '',\n      },\n    };\n  }\n};\n```\n* 动画调用主要函数`update`的编写\n\n> 运用了设计模式中`享元模式`的思想来分离变化(`Animation.store属性`)和不变的部分。  \n\n```js\n/**\n * [start 开始动画]\n * @param  {[String]} selector [选择器]\n * @param  {[type]} func     [缓动动画]\n */\nAnimation.prototype.start = function (selector, func) {\n  var that = this;\n  var target = this.store[selector];\n  target.status = 'running';\n\n  // 帧调用函数\n  that.update({x: 0, y: 0}, selector);\n};\n\n/**\n * [update 更新位置]\n * @param  {[type]} selector [description]\n */\nAnimation.prototype.update =  function (position, selector) {\n  var target = this.store[selector],\n    that = this,\n    timeUsed,\n    positionX, positionY;\n  //\n  if (!target || !target.queue.length) {\n    target.status = 'pending';\n    return;\n  };\n\n  // reset position\n  target.element.style.left = position.x + 'px';\n  target.element.style.top = position.y + 'px';\n\n  // position\n  target.positionStart = {\n    x: position.x,\n    y: position.y,\n  };\n  target.positionEnd = {\n    x: position.x + target.queue[0].x,\n    y: position.y + target.queue[0].y,\n  };\n  // time\n  target.timeStart = new Date().getTime();\n\n  // 递归调用\n  var callback = function () {\n    timeUsed = new Date().getTime() - target.timeStart;\n    // 当前动画完成\n    if (timeUsed >= target.queue[0].duration) {\n      target.queue.shift();\n      // 误差矫正\n      that.step(target.element, target.positionEnd.x, target.positionEnd.y);\n      target.status = 'running';\n      // var position = target.element.getBoundingClientRect();\n      var position = {\n        x: parseInt(target.element.style.left),\n        y: parseInt(target.element.style.top),\n      };\n      // 下一个动画\n      that.update(position, selector);\n      return;\n    }\n    // 计算元素坐标\n    positionX = target.queue[0].func(\n      timeUsed,\n      target.positionStart.x,\n      target.positionEnd.x - target.positionStart.x,\n      target.queue[0].duration,\n    );\n    positionY = target.queue[0].func(\n      timeUsed,\n      target.positionStart.y,\n      target.positionEnd.y - target.positionStart.y,\n      target.queue[0].duration,\n    );\n    that.step(target.element, positionX, positionY);\n\n    // 递归帧函数调用\n    requestAnimationFrame(callback);\n  };\n\n  requestAnimationFrame(callback);\n};\n```\n\n* 其它一些方法(部分暂未实现)\n\n```js\n/**\n * [step dom操作]\n * @param  {[DOM]} element [dom 元素]\n * @param  {[Number]} x        [x坐标]\n * @param  {[Number]} y        [y坐标]\n */\nAnimation.prototype.step = function (element, x, y) {\n  element.style.left = x + 'px';\n  element.style.top = y + 'px';\n};\n\n/* ------------------- 暂停动画 ------------------- */\nAnimation.prototype.pause = function (selector) {\n  // 尚待实现\n};\n\n/* ------------------- 结束动画 ------------------- */\nAnimation.prototype.stop = function (selector) {\n    // 尚待实现\n};\n\n/**\n * [push 加入动画队列]\n * @param  {[String]} selector [dom选择器]\n * @param  {[Object]} conf     [相对位置数据]\n */\nAnimation.prototype.push = function (selector, conf) {\n  if (this.store[selector]) {\n    this.store[selector].queue.push({\n      x: conf.x,\n      y: conf.y,\n      duration: conf.duration || 1000,\n      func: tween[conf.func] || tween['linear'],\n    });\n  }\n};\n\n/* ------------------- 动画出队列 ------------------- */\nAnimation.prototype.pop = function (selector) {\n  if (this.store[selector]) {\n    this.store[selector].queue.pop();\n  }\n};\n\n/* ------------------- 清空动画队列 ------------------- */\nAnimation.prototype.clear = function (selector) {\n  if (this.store[selector]) {\n    this.store[selector].queue.length = 1;\n  }\n};\n```\n##### Animation调用方式\n1. 初始化元素\n2. 插入多个动画数据(坐标相对值、动画执行时间、缓动方式)\n3. 开始执行动画\n\n```js\nvar anime = new Animation();\nanime.setTarget('#animationTarget');\n// 右下角移动50px\nanime.push('#animationTarget', { x: 50, y: 50, duration: 1000, func: 'easeIn' });\n// 右上角移动50px\nanime.push('#animationTarget', { x: -50, y: -50, duration: 500, func: 'linear' });\n// 横向移动50px\nanime.push('#animationTarget', { x: 50, y: 0, duration: 1000, func: 'easeIn' });\n// 纵向移动50px\nanime.push('#animationTarget', { x: 0, y: 50, duration: 500, func: 'linear' });\n// 开始执行动画\nanime.start('#animationTarget');\n```\n\n#### 总结\n-------------\nJavaScript动画的性能比CSS动画低很多，平时实际做页面时应该尽量使用CSS3和Canvas来实现动画效果，但是一名合格的JSER，也应该对Js的动画实现原理熟知，知道怎样优化动画性能，以及运用适合的设计模式优化代码结构。\n\n##### 感谢阅读\n","slug":"简单实现一个Javascript动画处理类","published":1,"updated":"2020-03-10T16:48:11.030Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxna000oa895f75jwv05","content":"<h4 id=\"预览图\">预览图</h4>\n<hr>\n<blockquote>\n<p>Gif预览图录制时帧数较低，实际浏览器上运行时会更流畅 ~</p>\n</blockquote>\n<p><a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/js-animation\" target=\"_blank\" rel=\"noopener\">=&gt; 源代码</a></p>\n<p><img src=\"/blogs/img/article/animation.gif\" alt=\"animation.gif\"></p>\n<h4 id=\"代码实现\">代码实现</h4>\n<hr>\n<h5 id=\"缓动函数\">缓动函数</h5>\n<blockquote>\n<p>涉及一些数学原理，感兴趣的可以单独了解一下。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [tween 缓动算法]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[Number]&#125;  t [动画已经消耗的时间]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[String]&#125;  b [目标开始的位置]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[String]&#125;  c [目标开始位置和结束位置的距离]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[Number]&#125;  d [动画总持续时间]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tween = &#123;</span><br><span class=\"line\">  linear: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance*time/duration + start; &#125;,</span><br><span class=\"line\">  easeIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration ) * time + start; &#125;,</span><br><span class=\"line\">  strongEaseIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time, start, distance, duration</span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration ) * time * time * time * time + start; &#125;,</span><br><span class=\"line\">  strongEaseOut: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time, start, distance, duration</span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( ( time = time / duration - <span class=\"number\">1</span>) * time * time * time * time + <span class=\"number\">1</span> ) + start; &#125;,</span><br><span class=\"line\">  sinEaseIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration) * time * time + start; &#125;,</span><br><span class=\"line\">  sinEaseOut: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time,start,distance,duration</span>)</span>&#123; <span class=\"keyword\">return</span> distance * ( ( time = time / duration - <span class=\"number\">1</span>) * time * time + <span class=\"number\">1</span> ) + start; &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"帧请求函数兼容写法\">帧请求函数兼容写法</h5>\n<blockquote>\n<p>requestAnimationFrame是浏览器用于定时循环操作的一个接口，类似于setTimeout，主要用途是按帧对网页进行重绘。设置这个API的目的是为了让各种网页动画效果（DOM动画、Canvas动画、SVG动画、WebGL动画）能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。代码中使用这个API，就是告诉浏览器希望执行一个动画，让浏览器在下一个动画帧安排一次网页重绘。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动画帧请求函数兼容写法</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.requestAnimationFrame = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span>  <span class=\"built_in\">window</span>.requestAnimationFrame       ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.webkitRequestAnimationFrame ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.mozRequestAnimationFrame    ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.oRequestAnimationFrame      ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.msRequestAnimationFrame     ||</span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> callback </span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>);</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h5 id=\"编写animation动画类\">编写Animation动画类</h5>\n<blockquote>\n<p>使用了了ES5语法，为了直接兼容浏览器，ES6的语法会更简洁，代码零散度更低。</p>\n</blockquote>\n<ul>\n<li>初始化执行动画的某个dom元素</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ------------------- 动画控制类 ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Animation = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.store = &#123; <span class=\"comment\">// status store</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 初始化处理元素 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.setTarget = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> element = <span class=\"built_in\">document</span>.querySelector(selector);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector] = &#123;</span><br><span class=\"line\">      selector: selector,</span><br><span class=\"line\">      element: <span class=\"built_in\">document</span>.querySelector(selector),</span><br><span class=\"line\">      status: <span class=\"string\">'pending'</span>,</span><br><span class=\"line\">      queue: [</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      timeStart: <span class=\"string\">''</span>,</span><br><span class=\"line\">      positionStart: &#123;</span><br><span class=\"line\">        x: <span class=\"string\">''</span>,</span><br><span class=\"line\">        y: <span class=\"string\">''</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      positionEnd: &#123;</span><br><span class=\"line\">        x: <span class=\"string\">''</span>,</span><br><span class=\"line\">        y: <span class=\"string\">''</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>动画调用主要函数<code>update</code>的编写</li>\n</ul>\n<blockquote>\n<p>运用了设计模式中<code>享元模式</code>的思想来分离变化(<code>Animation.store属性</code>)和不变的部分。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [start 开始动画]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; selector [选择器]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; func     [缓动动画]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.start = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector, func</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> target = <span class=\"keyword\">this</span>.store[selector];</span><br><span class=\"line\">  target.status = <span class=\"string\">'running'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 帧调用函数</span></span><br><span class=\"line\">  that.update(&#123;<span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span>&#125;, selector);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [update 更新位置]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; selector [description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.update =  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">position, selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> target = <span class=\"keyword\">this</span>.store[selector],</span><br><span class=\"line\">    that = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">    timeUsed,</span><br><span class=\"line\">    positionX, positionY;</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!target || !target.queue.length) &#123;</span><br><span class=\"line\">    target.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// reset position</span></span><br><span class=\"line\">  target.element.style.left = position.x + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">  target.element.style.top = position.y + <span class=\"string\">'px'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// position</span></span><br><span class=\"line\">  target.positionStart = &#123;</span><br><span class=\"line\">    x: position.x,</span><br><span class=\"line\">    y: position.y,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  target.positionEnd = &#123;</span><br><span class=\"line\">    x: position.x + target.queue[<span class=\"number\">0</span>].x,</span><br><span class=\"line\">    y: position.y + target.queue[<span class=\"number\">0</span>].y,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// time</span></span><br><span class=\"line\">  target.timeStart = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 递归调用</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    timeUsed = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - target.timeStart;</span><br><span class=\"line\">    <span class=\"comment\">// 当前动画完成</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timeUsed &gt;= target.queue[<span class=\"number\">0</span>].duration) &#123;</span><br><span class=\"line\">      target.queue.shift();</span><br><span class=\"line\">      <span class=\"comment\">// 误差矫正</span></span><br><span class=\"line\">      that.step(target.element, target.positionEnd.x, target.positionEnd.y);</span><br><span class=\"line\">      target.status = <span class=\"string\">'running'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// var position = target.element.getBoundingClientRect();</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> position = &#123;</span><br><span class=\"line\">        x: <span class=\"built_in\">parseInt</span>(target.element.style.left),</span><br><span class=\"line\">        y: <span class=\"built_in\">parseInt</span>(target.element.style.top),</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"comment\">// 下一个动画</span></span><br><span class=\"line\">      that.update(position, selector);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 计算元素坐标</span></span><br><span class=\"line\">    positionX = target.queue[<span class=\"number\">0</span>].func(</span><br><span class=\"line\">      timeUsed,</span><br><span class=\"line\">      target.positionStart.x,</span><br><span class=\"line\">      target.positionEnd.x - target.positionStart.x,</span><br><span class=\"line\">      target.queue[<span class=\"number\">0</span>].duration,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    positionY = target.queue[<span class=\"number\">0</span>].func(</span><br><span class=\"line\">      timeUsed,</span><br><span class=\"line\">      target.positionStart.y,</span><br><span class=\"line\">      target.positionEnd.y - target.positionStart.y,</span><br><span class=\"line\">      target.queue[<span class=\"number\">0</span>].duration,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    that.step(target.element, positionX, positionY);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 递归帧函数调用</span></span><br><span class=\"line\">    requestAnimationFrame(callback);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  requestAnimationFrame(callback);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>其它一些方法(部分暂未实现)</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [step dom操作]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[DOM]&#125; element [dom 元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Number]&#125; x        [x坐标]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Number]&#125; y        [y坐标]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.step = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, x, y</span>) </span>&#123;</span><br><span class=\"line\">  element.style.left = x + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">  element.style.top = y + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 暂停动画 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.pause = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 尚待实现</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 结束动画 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.stop = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 尚待实现</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [push 加入动画队列]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; selector [dom选择器]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; conf     [相对位置数据]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.push = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector, conf</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.push(&#123;</span><br><span class=\"line\">      x: conf.x,</span><br><span class=\"line\">      y: conf.y,</span><br><span class=\"line\">      duration: conf.duration || <span class=\"number\">1000</span>,</span><br><span class=\"line\">      func: tween[conf.func] || tween[<span class=\"string\">'linear'</span>],</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 动画出队列 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.pop = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.pop();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 清空动画队列 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.clear = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.length = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"animation调用方式\">Animation调用方式</h5>\n<ol>\n<li>初始化元素</li>\n<li>插入多个动画数据(坐标相对值、动画执行时间、缓动方式)</li>\n<li>开始执行动画</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> anime = <span class=\"keyword\">new</span> Animation();</span><br><span class=\"line\">anime.setTarget(<span class=\"string\">'#animationTarget'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 右下角移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">50</span>, <span class=\"attr\">y</span>: <span class=\"number\">50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">1000</span>, <span class=\"attr\">func</span>: <span class=\"string\">'easeIn'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 右上角移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">-50</span>, <span class=\"attr\">y</span>: <span class=\"number\">-50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">500</span>, <span class=\"attr\">func</span>: <span class=\"string\">'linear'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 横向移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">50</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span>, <span class=\"attr\">duration</span>: <span class=\"number\">1000</span>, <span class=\"attr\">func</span>: <span class=\"string\">'easeIn'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 纵向移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">500</span>, <span class=\"attr\">func</span>: <span class=\"string\">'linear'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 开始执行动画</span></span><br><span class=\"line\">anime.start(<span class=\"string\">'#animationTarget'</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"总结\">总结</h4>\n<hr>\n<p>JavaScript动画的性能比CSS动画低很多，平时实际做页面时应该尽量使用CSS3和Canvas来实现动画效果，但是一名合格的JSER，也应该对Js的动画实现原理熟知，知道怎样优化动画性能，以及运用适合的设计模式优化代码结构。</p>\n<h5 id=\"感谢阅读\">感谢阅读</h5>\n","site":{"data":{}},"excerpt":"","more":"<h4>预览图</h4>\n<hr>\n<blockquote>\n<p>Gif预览图录制时帧数较低，实际浏览器上运行时会更流畅 ~</p>\n</blockquote>\n<p><a href=\"https://github.com/NoJsJa/javascript-learning/tree/master/js-animation\" target=\"_blank\" rel=\"noopener\">=&gt; 源代码</a></p>\n<p><img src=\"/blogs/img/article/animation.gif\" alt=\"animation.gif\"></p>\n<h4>代码实现</h4>\n<hr>\n<h5>缓动函数</h5>\n<blockquote>\n<p>涉及一些数学原理，感兴趣的可以单独了解一下。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [tween 缓动算法]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[Number]&#125;  t [动画已经消耗的时间]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[String]&#125;  b [目标开始的位置]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[String]&#125;  c [目标开始位置和结束位置的距离]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;[Number]&#125;  d [动画总持续时间]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tween = &#123;</span><br><span class=\"line\">  linear: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance*time/duration + start; &#125;,</span><br><span class=\"line\">  easeIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration ) * time + start; &#125;,</span><br><span class=\"line\">  strongEaseIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time, start, distance, duration</span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration ) * time * time * time * time + start; &#125;,</span><br><span class=\"line\">  strongEaseOut: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time, start, distance, duration</span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( ( time = time / duration - <span class=\"number\">1</span>) * time * time * time * time + <span class=\"number\">1</span> ) + start; &#125;,</span><br><span class=\"line\">  sinEaseIn: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> time, start, distance, duration </span>) </span>&#123; <span class=\"keyword\">return</span> distance * ( time /= duration) * time * time + start; &#125;,</span><br><span class=\"line\">  sinEaseOut: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">time,start,distance,duration</span>)</span>&#123; <span class=\"keyword\">return</span> distance * ( ( time = time / duration - <span class=\"number\">1</span>) * time * time + <span class=\"number\">1</span> ) + start; &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5>帧请求函数兼容写法</h5>\n<blockquote>\n<p>requestAnimationFrame是浏览器用于定时循环操作的一个接口，类似于setTimeout，主要用途是按帧对网页进行重绘。设置这个API的目的是为了让各种网页动画效果（DOM动画、Canvas动画、SVG动画、WebGL动画）能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。代码中使用这个API，就是告诉浏览器希望执行一个动画，让浏览器在下一个动画帧安排一次网页重绘。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动画帧请求函数兼容写法</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.requestAnimationFrame = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span>  <span class=\"built_in\">window</span>.requestAnimationFrame       ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.webkitRequestAnimationFrame ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.mozRequestAnimationFrame    ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.oRequestAnimationFrame      ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.msRequestAnimationFrame     ||</span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> callback </span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>);</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h5>编写Animation动画类</h5>\n<blockquote>\n<p>使用了了ES5语法，为了直接兼容浏览器，ES6的语法会更简洁，代码零散度更低。</p>\n</blockquote>\n<ul>\n<li>初始化执行动画的某个dom元素</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ------------------- 动画控制类 ------------------- */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Animation = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.store = &#123; <span class=\"comment\">// status store</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 初始化处理元素 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.setTarget = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> element = <span class=\"built_in\">document</span>.querySelector(selector);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector] = &#123;</span><br><span class=\"line\">      selector: selector,</span><br><span class=\"line\">      element: <span class=\"built_in\">document</span>.querySelector(selector),</span><br><span class=\"line\">      status: <span class=\"string\">'pending'</span>,</span><br><span class=\"line\">      queue: [</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      timeStart: <span class=\"string\">''</span>,</span><br><span class=\"line\">      positionStart: &#123;</span><br><span class=\"line\">        x: <span class=\"string\">''</span>,</span><br><span class=\"line\">        y: <span class=\"string\">''</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      positionEnd: &#123;</span><br><span class=\"line\">        x: <span class=\"string\">''</span>,</span><br><span class=\"line\">        y: <span class=\"string\">''</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>动画调用主要函数<code>update</code>的编写</li>\n</ul>\n<blockquote>\n<p>运用了设计模式中<code>享元模式</code>的思想来分离变化(<code>Animation.store属性</code>)和不变的部分。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [start 开始动画]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; selector [选择器]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; func     [缓动动画]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.start = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector, func</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> target = <span class=\"keyword\">this</span>.store[selector];</span><br><span class=\"line\">  target.status = <span class=\"string\">'running'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 帧调用函数</span></span><br><span class=\"line\">  that.update(&#123;<span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span>&#125;, selector);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [update 更新位置]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[type]&#125; selector [description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.update =  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">position, selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> target = <span class=\"keyword\">this</span>.store[selector],</span><br><span class=\"line\">    that = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">    timeUsed,</span><br><span class=\"line\">    positionX, positionY;</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!target || !target.queue.length) &#123;</span><br><span class=\"line\">    target.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// reset position</span></span><br><span class=\"line\">  target.element.style.left = position.x + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">  target.element.style.top = position.y + <span class=\"string\">'px'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// position</span></span><br><span class=\"line\">  target.positionStart = &#123;</span><br><span class=\"line\">    x: position.x,</span><br><span class=\"line\">    y: position.y,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  target.positionEnd = &#123;</span><br><span class=\"line\">    x: position.x + target.queue[<span class=\"number\">0</span>].x,</span><br><span class=\"line\">    y: position.y + target.queue[<span class=\"number\">0</span>].y,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// time</span></span><br><span class=\"line\">  target.timeStart = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 递归调用</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    timeUsed = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - target.timeStart;</span><br><span class=\"line\">    <span class=\"comment\">// 当前动画完成</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timeUsed &gt;= target.queue[<span class=\"number\">0</span>].duration) &#123;</span><br><span class=\"line\">      target.queue.shift();</span><br><span class=\"line\">      <span class=\"comment\">// 误差矫正</span></span><br><span class=\"line\">      that.step(target.element, target.positionEnd.x, target.positionEnd.y);</span><br><span class=\"line\">      target.status = <span class=\"string\">'running'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// var position = target.element.getBoundingClientRect();</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> position = &#123;</span><br><span class=\"line\">        x: <span class=\"built_in\">parseInt</span>(target.element.style.left),</span><br><span class=\"line\">        y: <span class=\"built_in\">parseInt</span>(target.element.style.top),</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"comment\">// 下一个动画</span></span><br><span class=\"line\">      that.update(position, selector);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 计算元素坐标</span></span><br><span class=\"line\">    positionX = target.queue[<span class=\"number\">0</span>].func(</span><br><span class=\"line\">      timeUsed,</span><br><span class=\"line\">      target.positionStart.x,</span><br><span class=\"line\">      target.positionEnd.x - target.positionStart.x,</span><br><span class=\"line\">      target.queue[<span class=\"number\">0</span>].duration,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    positionY = target.queue[<span class=\"number\">0</span>].func(</span><br><span class=\"line\">      timeUsed,</span><br><span class=\"line\">      target.positionStart.y,</span><br><span class=\"line\">      target.positionEnd.y - target.positionStart.y,</span><br><span class=\"line\">      target.queue[<span class=\"number\">0</span>].duration,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    that.step(target.element, positionX, positionY);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 递归帧函数调用</span></span><br><span class=\"line\">    requestAnimationFrame(callback);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  requestAnimationFrame(callback);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>其它一些方法(部分暂未实现)</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [step dom操作]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[DOM]&#125; element [dom 元素]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Number]&#125; x        [x坐标]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Number]&#125; y        [y坐标]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.step = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, x, y</span>) </span>&#123;</span><br><span class=\"line\">  element.style.left = x + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">  element.style.top = y + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 暂停动画 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.pause = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 尚待实现</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 结束动画 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.stop = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 尚待实现</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [push 加入动画队列]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[String]&#125; selector [dom选择器]</span></span><br><span class=\"line\"><span class=\"comment\"> * @param  &#123;[Object]&#125; conf     [相对位置数据]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Animation.prototype.push = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector, conf</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.push(&#123;</span><br><span class=\"line\">      x: conf.x,</span><br><span class=\"line\">      y: conf.y,</span><br><span class=\"line\">      duration: conf.duration || <span class=\"number\">1000</span>,</span><br><span class=\"line\">      func: tween[conf.func] || tween[<span class=\"string\">'linear'</span>],</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 动画出队列 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.pop = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.pop();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ------------------- 清空动画队列 ------------------- */</span></span><br><span class=\"line\">Animation.prototype.clear = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.store[selector]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.store[selector].queue.length = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5>Animation调用方式</h5>\n<ol>\n<li>初始化元素</li>\n<li>插入多个动画数据(坐标相对值、动画执行时间、缓动方式)</li>\n<li>开始执行动画</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> anime = <span class=\"keyword\">new</span> Animation();</span><br><span class=\"line\">anime.setTarget(<span class=\"string\">'#animationTarget'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 右下角移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">50</span>, <span class=\"attr\">y</span>: <span class=\"number\">50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">1000</span>, <span class=\"attr\">func</span>: <span class=\"string\">'easeIn'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 右上角移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">-50</span>, <span class=\"attr\">y</span>: <span class=\"number\">-50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">500</span>, <span class=\"attr\">func</span>: <span class=\"string\">'linear'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 横向移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">50</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span>, <span class=\"attr\">duration</span>: <span class=\"number\">1000</span>, <span class=\"attr\">func</span>: <span class=\"string\">'easeIn'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 纵向移动50px</span></span><br><span class=\"line\">anime.push(<span class=\"string\">'#animationTarget'</span>, &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">50</span>, <span class=\"attr\">duration</span>: <span class=\"number\">500</span>, <span class=\"attr\">func</span>: <span class=\"string\">'linear'</span> &#125;);</span><br><span class=\"line\"><span class=\"comment\">// 开始执行动画</span></span><br><span class=\"line\">anime.start(<span class=\"string\">'#animationTarget'</span>);</span><br></pre></td></tr></table></figure>\n<h4>总结</h4>\n<hr>\n<p>JavaScript动画的性能比CSS动画低很多，平时实际做页面时应该尽量使用CSS3和Canvas来实现动画效果，但是一名合格的JSER，也应该对Js的动画实现原理熟知，知道怎样优化动画性能，以及运用适合的设计模式优化代码结构。</p>\n<h5>感谢阅读</h5>\n"},{"title":"联想y7000安装ubuntu18.04显卡驱动解决方案","catalog":true,"toc_nav_num":true,"date":"2019-09-29T02:49:00.000Z","subtitle":"y7000 ubuntu18.04","header-img":"/blogs/img/article_header/article_header.png","catagories":["Linux"],"updateDate":"2019-09-29T02:49:00.000Z","top":null,"_content":"\n\n![Desktop](/blogs/img/article/Desktop3.png)\n![Desktop](/blogs/img/article/Desktop2.png)\n![Desktop](/blogs/img/article/Desktop.png)\n\n### Contents\n\n1. 笔记本配置和操作系统版本\n\n2. 安装Ubuntu18.04-3后出现的异常\n\n3. 解决方案\n\n### 笔记本配置\n\n* CPU : Intel® Core™ i5-8300H CPU @ 2.30GHz × 8\n\n* GPU: Nvidia GeForce GTX 1050 Ti/PCIe/SSE2 和 Intel 集显\n\n* 操作系统: Ubuntu 18.04.3 bionic\n\n* 内核版本: Linux 5.0.0-27-generic\n\n* 内存: 16G\n\n* 分区:  GPT磁盘分区 + UEFI引导方案 ，创建`efi`系统分区和`/`根分区\n\n### 安装Ubuntu18.04-3后出现的异常\n\n* 开机卡死或登录卡死\n\n* 登录后不能检测到无线网卡\n\n* 屏幕亮度不可调节\n\n* HDMI外接屏幕不可用\n\n### 解决方案\n\n卡死的原因基本都是显卡驱动的原因，集成显卡勉强能用，但是不支持外接屏幕和亮度调节，屏幕滚动的时候也会\n出现画面撕裂的情况，属于不能忍受的情况，当开机卡死的时候我们需要先强制让Ubuntu使用集成显卡，然后才能\n进入系统，进入系统之后再禁用系统自带的Nvidia驱动，然后安装新的推荐使用的驱动即可，具体操作流程如下：\n\n#### 1.  强制使用集显\n\n在开机grub界面，按e，编辑启动 选项\n修改参数`“quiet splash”`为`“quiet splash nomodeset”`，之后F10，重新启动正常进入Ubuntu系统\n进入系统后让这个设置一直有效的方法是：\n\n```sh\n$: sudo gedit /etc/default/grub\n```\n\n跟开机时一样的参数修改，完成后保存文件并关闭，输入以下指令使其生效：\n\n```sh\n$: sudo update-grub\n```\n\n#### 2. 重新安装Nvidia显卡驱动\n\n禁用ubuntu默认显卡(集显)驱动\n\n```sh\n$: sudo vi /etc/modprobe.d/blacklist.conf\n```\n\n在文件最末尾添加如下参数加入黑名单：\n\n```sh\nblacklist vga16fb\nblacklist nouveau\nblacklist rivafb\nblacklist rivatv\nblacklist nvidiafb\n```\n\n卸载干净所有安装过的nvidia驱动：\n\n```sh\n$: sudo apt-get remove  --purge nvidia-*\n```\n\n查看驱动状态，无输出则说明已经被屏蔽掉\n\n```sh\n$: lsmod | grep nouveau\n```\n\n添加驱动源：\n\n```sh\n$: sudo add-apt-repository ppa:graphics-drivers/ppa\n$: sudo apt-get update\n```\n\n查看合适驱动版本：\n\n```sh\nubuntu-drivers devices\n```\n\n这里推荐直接使用`nvidia-driver-390`或`nvidia-driver-430`驱动\n\n```sh\n$: sudo apt-get install nvidia-driver-430 nvidia-settings nvidia-prime\n```\n\n重启\n\n```sh\n$: sudo update-initramfs -u\n$: sudo reboot\n```\n\n重启时，在开机grub界面，按e，编辑启动 选项\n修改参数`“quiet splash nomodeset”`为`“quiet splash acpi_osi=linux”`，之后F10，重新启动正常进入Ubuntu系统\n\n开机后查看驱动安装状态：\n\n```sh\n$: sudo nvidia-smi\n```\n\n编辑grab文件执行上一步相同的参数修改，最后更新：\n\n```sh\n$: sudo gedit /etc/default/grub\n$: sudo update-grub\n```\n\n#### 3. 解决无线网络不能使用的问题\n\n原因： 联想自家的驱动和Ubuntu的驱动产生了冲突，禁用联想自带的驱动即可\n\n将联想驱动加入黑名单:\n\n```sh\n$: sudo gedit /etc/modprobe.d/blacklist.conf\n```\n\n在文件中添加：\n\n```sh\nblacklist ideapad_laptop\n```\n\n即时生效：\n\n```sh\n$: sudo modprobe -r ideapad_laptop\n```\n\n_关于Ubuntu主题美化和其它问题解决请移步：[Ubuntu 18.04 踩坑记录](https://www.jianshu.com/p/23b0d3015db8)_","source":"_posts/联想y7000安装ubuntu18.04显卡驱动解决方案.md","raw":"---\ntitle: \"联想y7000安装ubuntu18.04显卡驱动解决方案\"\ncatalog: true\ntoc_nav_num: true\ndate: 2019-09-29 10:49:00\nsubtitle: \"y7000 ubuntu18.04\"\nheader-img: \"/blogs/img/article_header/article_header.png\"\ntags:\n- Linux\n- Ubuntu18.04\ncatagories:\n- Linux\nupdateDate: 2019-09-29 10:49:00\ntop: \n---\n\n\n![Desktop](/blogs/img/article/Desktop3.png)\n![Desktop](/blogs/img/article/Desktop2.png)\n![Desktop](/blogs/img/article/Desktop.png)\n\n### Contents\n\n1. 笔记本配置和操作系统版本\n\n2. 安装Ubuntu18.04-3后出现的异常\n\n3. 解决方案\n\n### 笔记本配置\n\n* CPU : Intel® Core™ i5-8300H CPU @ 2.30GHz × 8\n\n* GPU: Nvidia GeForce GTX 1050 Ti/PCIe/SSE2 和 Intel 集显\n\n* 操作系统: Ubuntu 18.04.3 bionic\n\n* 内核版本: Linux 5.0.0-27-generic\n\n* 内存: 16G\n\n* 分区:  GPT磁盘分区 + UEFI引导方案 ，创建`efi`系统分区和`/`根分区\n\n### 安装Ubuntu18.04-3后出现的异常\n\n* 开机卡死或登录卡死\n\n* 登录后不能检测到无线网卡\n\n* 屏幕亮度不可调节\n\n* HDMI外接屏幕不可用\n\n### 解决方案\n\n卡死的原因基本都是显卡驱动的原因，集成显卡勉强能用，但是不支持外接屏幕和亮度调节，屏幕滚动的时候也会\n出现画面撕裂的情况，属于不能忍受的情况，当开机卡死的时候我们需要先强制让Ubuntu使用集成显卡，然后才能\n进入系统，进入系统之后再禁用系统自带的Nvidia驱动，然后安装新的推荐使用的驱动即可，具体操作流程如下：\n\n#### 1.  强制使用集显\n\n在开机grub界面，按e，编辑启动 选项\n修改参数`“quiet splash”`为`“quiet splash nomodeset”`，之后F10，重新启动正常进入Ubuntu系统\n进入系统后让这个设置一直有效的方法是：\n\n```sh\n$: sudo gedit /etc/default/grub\n```\n\n跟开机时一样的参数修改，完成后保存文件并关闭，输入以下指令使其生效：\n\n```sh\n$: sudo update-grub\n```\n\n#### 2. 重新安装Nvidia显卡驱动\n\n禁用ubuntu默认显卡(集显)驱动\n\n```sh\n$: sudo vi /etc/modprobe.d/blacklist.conf\n```\n\n在文件最末尾添加如下参数加入黑名单：\n\n```sh\nblacklist vga16fb\nblacklist nouveau\nblacklist rivafb\nblacklist rivatv\nblacklist nvidiafb\n```\n\n卸载干净所有安装过的nvidia驱动：\n\n```sh\n$: sudo apt-get remove  --purge nvidia-*\n```\n\n查看驱动状态，无输出则说明已经被屏蔽掉\n\n```sh\n$: lsmod | grep nouveau\n```\n\n添加驱动源：\n\n```sh\n$: sudo add-apt-repository ppa:graphics-drivers/ppa\n$: sudo apt-get update\n```\n\n查看合适驱动版本：\n\n```sh\nubuntu-drivers devices\n```\n\n这里推荐直接使用`nvidia-driver-390`或`nvidia-driver-430`驱动\n\n```sh\n$: sudo apt-get install nvidia-driver-430 nvidia-settings nvidia-prime\n```\n\n重启\n\n```sh\n$: sudo update-initramfs -u\n$: sudo reboot\n```\n\n重启时，在开机grub界面，按e，编辑启动 选项\n修改参数`“quiet splash nomodeset”`为`“quiet splash acpi_osi=linux”`，之后F10，重新启动正常进入Ubuntu系统\n\n开机后查看驱动安装状态：\n\n```sh\n$: sudo nvidia-smi\n```\n\n编辑grab文件执行上一步相同的参数修改，最后更新：\n\n```sh\n$: sudo gedit /etc/default/grub\n$: sudo update-grub\n```\n\n#### 3. 解决无线网络不能使用的问题\n\n原因： 联想自家的驱动和Ubuntu的驱动产生了冲突，禁用联想自带的驱动即可\n\n将联想驱动加入黑名单:\n\n```sh\n$: sudo gedit /etc/modprobe.d/blacklist.conf\n```\n\n在文件中添加：\n\n```sh\nblacklist ideapad_laptop\n```\n\n即时生效：\n\n```sh\n$: sudo modprobe -r ideapad_laptop\n```\n\n_关于Ubuntu主题美化和其它问题解决请移步：[Ubuntu 18.04 踩坑记录](https://www.jianshu.com/p/23b0d3015db8)_","slug":"联想y7000安装ubuntu18.04显卡驱动解决方案","published":1,"updated":"2020-03-10T16:53:30.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck846hxnb000qa8957y0zkqmq","content":"<p><img src=\"/blogs/img/article/Desktop3.png\" alt=\"Desktop\"><br>\n<img src=\"/blogs/img/article/Desktop2.png\" alt=\"Desktop\"><br>\n<img src=\"/blogs/img/article/Desktop.png\" alt=\"Desktop\"></p>\n<h3 id=\"contents\">Contents</h3>\n<ol>\n<li>\n<p>笔记本配置和操作系统版本</p>\n</li>\n<li>\n<p>安装Ubuntu18.04-3后出现的异常</p>\n</li>\n<li>\n<p>解决方案</p>\n</li>\n</ol>\n<h3 id=\"笔记本配置\">笔记本配置</h3>\n<ul>\n<li>\n<p>CPU : Intel® Core™ i5-8300H CPU @ 2.30GHz × 8</p>\n</li>\n<li>\n<p>GPU: Nvidia GeForce GTX 1050 Ti/PCIe/SSE2 和 Intel 集显</p>\n</li>\n<li>\n<p>操作系统: Ubuntu 18.04.3 bionic</p>\n</li>\n<li>\n<p>内核版本: Linux 5.0.0-27-generic</p>\n</li>\n<li>\n<p>内存: 16G</p>\n</li>\n<li>\n<p>分区:  GPT磁盘分区 + UEFI引导方案 ，创建<code>efi</code>系统分区和<code>/</code>根分区</p>\n</li>\n</ul>\n<h3 id=\"安装ubuntu1804-3后出现的异常\">安装Ubuntu18.04-3后出现的异常</h3>\n<ul>\n<li>\n<p>开机卡死或登录卡死</p>\n</li>\n<li>\n<p>登录后不能检测到无线网卡</p>\n</li>\n<li>\n<p>屏幕亮度不可调节</p>\n</li>\n<li>\n<p>HDMI外接屏幕不可用</p>\n</li>\n</ul>\n<h3 id=\"解决方案\">解决方案</h3>\n<p>卡死的原因基本都是显卡驱动的原因，集成显卡勉强能用，但是不支持外接屏幕和亮度调节，屏幕滚动的时候也会<br>\n出现画面撕裂的情况，属于不能忍受的情况，当开机卡死的时候我们需要先强制让Ubuntu使用集成显卡，然后才能<br>\n进入系统，进入系统之后再禁用系统自带的Nvidia驱动，然后安装新的推荐使用的驱动即可，具体操作流程如下：</p>\n<h4 id=\"1-强制使用集显\">1.  强制使用集显</h4>\n<p>在开机grub界面，按e，编辑启动 选项<br>\n修改参数<code>“quiet splash”</code>为<code>“quiet splash nomodeset”</code>，之后F10，重新启动正常进入Ubuntu系统<br>\n进入系统后让这个设置一直有效的方法是：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/default/grub</span><br></pre></td></tr></table></figure>\n<p>跟开机时一样的参数修改，完成后保存文件并关闭，输入以下指令使其生效：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-重新安装nvidia显卡驱动\">2. 重新安装Nvidia显卡驱动</h4>\n<p>禁用ubuntu默认显卡(集显)驱动</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo vi /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure>\n<p>在文件最末尾添加如下参数加入黑名单：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blacklist vga16fb</span><br><span class=\"line\">blacklist nouveau</span><br><span class=\"line\">blacklist rivafb</span><br><span class=\"line\">blacklist rivatv</span><br><span class=\"line\">blacklist nvidiafb</span><br></pre></td></tr></table></figure>\n<p>卸载干净所有安装过的nvidia驱动：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get remove  --purge nvidia-*</span><br></pre></td></tr></table></figure>\n<p>查看驱动状态，无输出则说明已经被屏蔽掉</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: lsmod | grep nouveau</span><br></pre></td></tr></table></figure>\n<p>添加驱动源：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class=\"line\">$: sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>查看合适驱动版本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu-drivers devices</span><br></pre></td></tr></table></figure>\n<p>这里推荐直接使用<code>nvidia-driver-390</code>或<code>nvidia-driver-430</code>驱动</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get install nvidia-driver-430 nvidia-settings nvidia-prime</span><br></pre></td></tr></table></figure>\n<p>重启</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-initramfs -u</span><br><span class=\"line\">$: sudo reboot</span><br></pre></td></tr></table></figure>\n<p>重启时，在开机grub界面，按e，编辑启动 选项<br>\n修改参数<code>“quiet splash nomodeset”</code>为<code>“quiet splash acpi_osi=linux”</code>，之后F10，重新启动正常进入Ubuntu系统</p>\n<p>开机后查看驱动安装状态：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo nvidia-smi</span><br></pre></td></tr></table></figure>\n<p>编辑grab文件执行上一步相同的参数修改，最后更新：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/default/grub</span><br><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<h4 id=\"3-解决无线网络不能使用的问题\">3. 解决无线网络不能使用的问题</h4>\n<p>原因： 联想自家的驱动和Ubuntu的驱动产生了冲突，禁用联想自带的驱动即可</p>\n<p>将联想驱动加入黑名单:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure>\n<p>在文件中添加：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blacklist ideapad_laptop</span><br></pre></td></tr></table></figure>\n<p>即时生效：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo modprobe -r ideapad_laptop</span><br></pre></td></tr></table></figure>\n<p><em>关于Ubuntu主题美化和其它问题解决请移步：<a href=\"https://www.jianshu.com/p/23b0d3015db8\" target=\"_blank\" rel=\"noopener\">Ubuntu 18.04 踩坑记录</a></em></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/blogs/img/article/Desktop3.png\" alt=\"Desktop\"><br>\n<img src=\"/blogs/img/article/Desktop2.png\" alt=\"Desktop\"><br>\n<img src=\"/blogs/img/article/Desktop.png\" alt=\"Desktop\"></p>\n<h3>Contents</h3>\n<ol>\n<li>\n<p>笔记本配置和操作系统版本</p>\n</li>\n<li>\n<p>安装Ubuntu18.04-3后出现的异常</p>\n</li>\n<li>\n<p>解决方案</p>\n</li>\n</ol>\n<h3>笔记本配置</h3>\n<ul>\n<li>\n<p>CPU : Intel® Core™ i5-8300H CPU @ 2.30GHz × 8</p>\n</li>\n<li>\n<p>GPU: Nvidia GeForce GTX 1050 Ti/PCIe/SSE2 和 Intel 集显</p>\n</li>\n<li>\n<p>操作系统: Ubuntu 18.04.3 bionic</p>\n</li>\n<li>\n<p>内核版本: Linux 5.0.0-27-generic</p>\n</li>\n<li>\n<p>内存: 16G</p>\n</li>\n<li>\n<p>分区:  GPT磁盘分区 + UEFI引导方案 ，创建<code>efi</code>系统分区和<code>/</code>根分区</p>\n</li>\n</ul>\n<h3>安装Ubuntu18.04-3后出现的异常</h3>\n<ul>\n<li>\n<p>开机卡死或登录卡死</p>\n</li>\n<li>\n<p>登录后不能检测到无线网卡</p>\n</li>\n<li>\n<p>屏幕亮度不可调节</p>\n</li>\n<li>\n<p>HDMI外接屏幕不可用</p>\n</li>\n</ul>\n<h3>解决方案</h3>\n<p>卡死的原因基本都是显卡驱动的原因，集成显卡勉强能用，但是不支持外接屏幕和亮度调节，屏幕滚动的时候也会<br>\n出现画面撕裂的情况，属于不能忍受的情况，当开机卡死的时候我们需要先强制让Ubuntu使用集成显卡，然后才能<br>\n进入系统，进入系统之后再禁用系统自带的Nvidia驱动，然后安装新的推荐使用的驱动即可，具体操作流程如下：</p>\n<h4>1.  强制使用集显</h4>\n<p>在开机grub界面，按e，编辑启动 选项<br>\n修改参数<code>“quiet splash”</code>为<code>“quiet splash nomodeset”</code>，之后F10，重新启动正常进入Ubuntu系统<br>\n进入系统后让这个设置一直有效的方法是：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/default/grub</span><br></pre></td></tr></table></figure>\n<p>跟开机时一样的参数修改，完成后保存文件并关闭，输入以下指令使其生效：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<h4>2. 重新安装Nvidia显卡驱动</h4>\n<p>禁用ubuntu默认显卡(集显)驱动</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo vi /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure>\n<p>在文件最末尾添加如下参数加入黑名单：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blacklist vga16fb</span><br><span class=\"line\">blacklist nouveau</span><br><span class=\"line\">blacklist rivafb</span><br><span class=\"line\">blacklist rivatv</span><br><span class=\"line\">blacklist nvidiafb</span><br></pre></td></tr></table></figure>\n<p>卸载干净所有安装过的nvidia驱动：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get remove  --purge nvidia-*</span><br></pre></td></tr></table></figure>\n<p>查看驱动状态，无输出则说明已经被屏蔽掉</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: lsmod | grep nouveau</span><br></pre></td></tr></table></figure>\n<p>添加驱动源：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class=\"line\">$: sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>查看合适驱动版本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu-drivers devices</span><br></pre></td></tr></table></figure>\n<p>这里推荐直接使用<code>nvidia-driver-390</code>或<code>nvidia-driver-430</code>驱动</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo apt-get install nvidia-driver-430 nvidia-settings nvidia-prime</span><br></pre></td></tr></table></figure>\n<p>重启</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo update-initramfs -u</span><br><span class=\"line\">$: sudo reboot</span><br></pre></td></tr></table></figure>\n<p>重启时，在开机grub界面，按e，编辑启动 选项<br>\n修改参数<code>“quiet splash nomodeset”</code>为<code>“quiet splash acpi_osi=linux”</code>，之后F10，重新启动正常进入Ubuntu系统</p>\n<p>开机后查看驱动安装状态：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo nvidia-smi</span><br></pre></td></tr></table></figure>\n<p>编辑grab文件执行上一步相同的参数修改，最后更新：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/default/grub</span><br><span class=\"line\">$: sudo update-grub</span><br></pre></td></tr></table></figure>\n<h4>3. 解决无线网络不能使用的问题</h4>\n<p>原因： 联想自家的驱动和Ubuntu的驱动产生了冲突，禁用联想自带的驱动即可</p>\n<p>将联想驱动加入黑名单:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure>\n<p>在文件中添加：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blacklist ideapad_laptop</span><br></pre></td></tr></table></figure>\n<p>即时生效：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$: sudo modprobe -r ideapad_laptop</span><br></pre></td></tr></table></figure>\n<p><em>关于Ubuntu主题美化和其它问题解决请移步：<a href=\"https://www.jianshu.com/p/23b0d3015db8\" target=\"_blank\" rel=\"noopener\">Ubuntu 18.04 踩坑记录</a></em></p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ck846hxmp0001a8954hwbwkx2","tag_id":"ck846hxmu0005a895w6a8da28","_id":"ck846hxn4000fa895n0rc207c"},{"post_id":"ck846hxmp0001a8954hwbwkx2","tag_id":"ck846hxn0000aa895t2b9i659","_id":"ck846hxn5000ha895ejxc1au6"},{"post_id":"ck846hxms0003a8952sa1ze1s","tag_id":"ck846hxn3000da895m6wq9gu6","_id":"ck846hxne000sa895atv63gvt"},{"post_id":"ck846hxms0003a8952sa1ze1s","tag_id":"ck846hxn5000ia8955x0f11k1","_id":"ck846hxne000ta895rdwxnyun"},{"post_id":"ck846hxms0003a8952sa1ze1s","tag_id":"ck846hxn8000la895d17879jo","_id":"ck846hxnf000va895i53pskjl"},{"post_id":"ck846hxms0003a8952sa1ze1s","tag_id":"ck846hxnb000pa895bbt5oz7c","_id":"ck846hxnf000wa895vb5g2xbf"},{"post_id":"ck846hxmw0006a895jzrkeofr","tag_id":"ck846hxn3000da895m6wq9gu6","_id":"ck846hxng0010a895k4iffav5"},{"post_id":"ck846hxmw0006a895jzrkeofr","tag_id":"ck846hxn5000ia8955x0f11k1","_id":"ck846hxng0011a895rnl35olo"},{"post_id":"ck846hxmw0006a895jzrkeofr","tag_id":"ck846hxn8000la895d17879jo","_id":"ck846hxng0013a895a89hcgul"},{"post_id":"ck846hxmw0006a895jzrkeofr","tag_id":"ck846hxnb000pa895bbt5oz7c","_id":"ck846hxng0014a895vm1ahsr7"},{"post_id":"ck846hxmx0008a895d91qzum8","tag_id":"ck846hxng000za895hywdus09","_id":"ck846hxnh0016a8950wv0yo72"},{"post_id":"ck846hxmx0008a895d91qzum8","tag_id":"ck846hxmu0005a895w6a8da28","_id":"ck846hxnh0017a8958e0mxy35"},{"post_id":"ck846hxn0000ba8951uaik56x","tag_id":"ck846hxmu0005a895w6a8da28","_id":"ck846hxni001ca895rlbdztyk"},{"post_id":"ck846hxn0000ba8951uaik56x","tag_id":"ck846hxnh0018a89582acf5th","_id":"ck846hxni001da895udr4b0kg"},{"post_id":"ck846hxn2000ca89504lb9e7j","tag_id":"ck846hxnh001ba895p876xvv3","_id":"ck846hxni001ga895grglbrdc"},{"post_id":"ck846hxn2000ca89504lb9e7j","tag_id":"ck846hxni001ea8952jkcg4v1","_id":"ck846hxni001ha895w8oy9z2q"},{"post_id":"ck846hxn4000ea895lqxolntj","tag_id":"ck846hxni001fa895qc49z5e2","_id":"ck846hxnj001ka8950gfkxs4f"},{"post_id":"ck846hxn4000ea895lqxolntj","tag_id":"ck846hxni001ia895ii390ob9","_id":"ck846hxnj001la8953h5j9jat"},{"post_id":"ck846hxn5000ga8950o72748l","tag_id":"ck846hxni001ea8952jkcg4v1","_id":"ck846hxnk001oa895juqomw8f"},{"post_id":"ck846hxn5000ga8950o72748l","tag_id":"ck846hxnh001ba895p876xvv3","_id":"ck846hxnk001pa895jvcu475r"},{"post_id":"ck846hxn6000ja895euaponrl","tag_id":"ck846hxnk001na895yt2qlq2q","_id":"ck846hxnk001sa895yzi2c1jb"},{"post_id":"ck846hxn6000ja895euaponrl","tag_id":"ck846hxnk001qa895w3uj1gyg","_id":"ck846hxnl001ta895ztyckvo0"},{"post_id":"ck846hxn7000ka89584sf0dzn","tag_id":"ck846hxnk001ra8958xehqeja","_id":"ck846hxnl001va895c3tkax40"},{"post_id":"ck846hxn7000ka89584sf0dzn","tag_id":"ck846hxn3000da895m6wq9gu6","_id":"ck846hxnl001wa895hzqfip21"},{"post_id":"ck846hxn9000ma895uz53o355","tag_id":"ck846hxnk001na895yt2qlq2q","_id":"ck846hxnl001za895s3oloz7e"},{"post_id":"ck846hxn9000ma895uz53o355","tag_id":"ck846hxnl001xa895iga4wd68","_id":"ck846hxnm0020a89542y314u7"},{"post_id":"ck846hxna000na895rwlrr6fc","tag_id":"ck846hxnl001ya895hf2fidre","_id":"ck846hxnm0024a895vd1qmvxh"},{"post_id":"ck846hxna000na895rwlrr6fc","tag_id":"ck846hxnm0021a895dhd5gtwe","_id":"ck846hxnm0025a895svurpox9"},{"post_id":"ck846hxna000na895rwlrr6fc","tag_id":"ck846hxnm0022a895urinndoi","_id":"ck846hxnn0027a89537kq47pl"},{"post_id":"ck846hxna000oa895f75jwv05","tag_id":"ck846hxnm0023a895gw2dz4vs","_id":"ck846hxnn0028a895vthfejlw"},{"post_id":"ck846hxnb000qa8957y0zkqmq","tag_id":"ck846hxmu0005a895w6a8da28","_id":"ck846hxnn0029a895e3qy9lqv"},{"post_id":"ck846hxnb000qa8957y0zkqmq","tag_id":"ck846hxng000za895hywdus09","_id":"ck846hxnn002aa895jvw77imh"},{"post_id":"ck846hxmy0009a8957ly4c5js","tag_id":"ck846hxng0012a895jgw5ijem","_id":"ck846p37s0000bd95xns2akuc"},{"post_id":"ck846hxmy0009a8957ly4c5js","tag_id":"ck846hxn5000ia8955x0f11k1","_id":"ck846p37t0001bd95vzlijmw0"}],"Tag":[{"name":"Linux","_id":"ck846hxmu0005a895w6a8da28"},{"name":"Docker","_id":"ck846hxn0000aa895t2b9i659"},{"name":"ES6","_id":"ck846hxn3000da895m6wq9gu6"},{"name":"React","_id":"ck846hxn5000ia8955x0f11k1"},{"name":"Mobx","_id":"ck846hxn8000la895d17879jo"},{"name":"Electron","_id":"ck846hxnb000pa895bbt5oz7c"},{"name":"Ubuntu18.04","_id":"ck846hxng000za895hywdus09"},{"name":"Echarts","_id":"ck846hxng0012a895jgw5ijem"},{"name":"Mint","_id":"ck846hxnh0018a89582acf5th"},{"name":"Proxy","_id":"ck846hxnh001ba895p876xvv3"},{"name":"Shadowsocks","_id":"ck846hxni001ea8952jkcg4v1"},{"name":"Sass","_id":"ck846hxni001fa895qc49z5e2"},{"name":"Css","_id":"ck846hxni001ia895ii390ob9"},{"name":"Javascript","_id":"ck846hxnk001na895yt2qlq2q"},{"name":"WaterFall","_id":"ck846hxnk001qa895w3uj1gyg"},{"name":"Promise","_id":"ck846hxnk001ra8958xehqeja"},{"name":"ES5","_id":"ck846hxnl001xa895iga4wd68"},{"name":"FileUpload","_id":"ck846hxnl001ya895hf2fidre"},{"name":"AWS","_id":"ck846hxnm0021a895dhd5gtwe"},{"name":"S3","_id":"ck846hxnm0022a895urinndoi"},{"name":"Animation","_id":"ck846hxnm0023a895gw2dz4vs"}]}}